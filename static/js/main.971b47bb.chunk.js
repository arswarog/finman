(this.webpackJsonpfinman=this.webpackJsonpfinman||[]).push([[1],{117:function(e,t,n){e.exports={header:"Header_header__2XAj3",title:"Header_title__284EO"}},180:function(e,t,n){e.exports={App:"App_App__15LM-","App-logo":"App_App-logo__1GLNd","App-logo-spin":"App_App-logo-spin__1EbLw","App-header":"App_App-header__3nnPn","App-link":"App_App-link__TRj1P"}},186:function(e,t,n){},189:function(e,t,n){e.exports={licenses:"LicensesPage_licenses__3Ik4Y"}},194:function(e,t,n){e.exports=n(321)},199:function(e,t,n){},201:function(e,t,n){var a={"./ion-action-sheet.entry.js":[323,5],"./ion-alert.entry.js":[324,6],"./ion-app_8.entry.js":[325,7],"./ion-avatar_3.entry.js":[326,18],"./ion-back-button.entry.js":[327,19],"./ion-backdrop.entry.js":[328,43],"./ion-button_2.entry.js":[329,20],"./ion-card_5.entry.js":[330,21],"./ion-checkbox.entry.js":[331,22],"./ion-chip.entry.js":[332,23],"./ion-col_3.entry.js":[333,44],"./ion-datetime_3.entry.js":[334,10],"./ion-fab_3.entry.js":[335,24],"./ion-img.entry.js":[336,45],"./ion-infinite-scroll_2.entry.js":[337,46],"./ion-input.entry.js":[338,25],"./ion-item-option_3.entry.js":[339,26],"./ion-item_8.entry.js":[340,27],"./ion-loading.entry.js":[341,28],"./ion-menu_3.entry.js":[342,29],"./ion-modal.entry.js":[343,8],"./ion-nav_2.entry.js":[344,15],"./ion-popover.entry.js":[345,9],"./ion-progress-bar.entry.js":[346,30],"./ion-radio_2.entry.js":[347,31],"./ion-range.entry.js":[348,32],"./ion-refresher_2.entry.js":[349,11],"./ion-reorder_2.entry.js":[350,17],"./ion-ripple-effect.entry.js":[351,47],"./ion-route_4.entry.js":[352,33],"./ion-searchbar.entry.js":[353,34],"./ion-segment_2.entry.js":[354,35],"./ion-select_3.entry.js":[355,36],"./ion-slide_2.entry.js":[356,48],"./ion-spinner.entry.js":[357,13],"./ion-split-pane.entry.js":[358,49],"./ion-tab-bar_2.entry.js":[359,37],"./ion-tab_2.entry.js":[360,16],"./ion-text.entry.js":[361,38],"./ion-textarea.entry.js":[362,39],"./ion-toast.entry.js":[363,40],"./ion-toggle.entry.js":[364,12],"./ion-virtual-scroll.entry.js":[365,50]};function r(e){if(!n.o(a,e))return Promise.resolve().then((function(){var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}));var t=a[e],r=t[0];return n.e(t[1]).then((function(){return n(r)}))}r.keys=function(){return Object.keys(a)},r.id=201,e.exports=r},223:function(e,t,n){var a={"./ion-icon.entry.js":[369,57]};function r(e){if(!n.o(a,e))return Promise.resolve().then((function(){var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}));var t=a[e],r=t[0];return n.e(t[1]).then((function(){return n(r)}))}r.keys=function(){return Object.keys(a)},r.id=223,e.exports=r},235:function(e,t){},237:function(e,t){},247:function(e,t){},249:function(e,t){},277:function(e,t){},278:function(e,t){},321:function(e,t,n){"use strict";n.r(t);var a=n(0),r=n.n(a),c=n(61),i=n.n(c),o=n(34),s=(n(199),n(180)),u=n.n(s),l=n(14),d=n(81),m=(n(117),n(181)),f=n(222),h=n(27),p=h,b={"list-outline":h.notificationsOutline,"menu-outline":h.menuOutline,"close-circle":h.closeCircle,"notifications-outline":h.notificationsOutline,"chevron-back-outline":h.chevronBackOutline};f.a(b);var g=function(e){var t=e.icon,n=e.name,a=e.className,c=e.size;if(a=a||"icon",!t&&n){if(!b[n])throw new Error('Icon "'.concat(n,'" not loaded'));t=b[n]}return r.a.createElement(m.a,{mode:"ios",icon:t,className:a,size:c})},v=function(e){var t=e.title,n=e.back,c=Object(l.g)(),i=Object(a.useCallback)((function(){if(n)return!0===n?c.goBack():void c.replace(n)}),[c,n]);return r.a.createElement("div",{className:"appHeader"},n&&r.a.createElement("div",{className:"left"},r.a.createElement("span",{onClick:i,className:"headerButton goBack"},r.a.createElement(g,{name:"chevron-back-outline",role:"img",className:"md hydrated","aria-label":"chevron back outline"}))),r.a.createElement("div",{className:"pageTitle"},t),r.a.createElement("div",{className:"right"}))},y=n(121),O=n.n(y),j=n(66),w=n.n(j),E=function(e){var t,n=e.showButtons,c=e.children,i=e.onChange,o=e.current;i=i||function(e){return null};var s=c.flat(),u=s.findIndex((function(e){return e.key===o}));-1===u&&(u=0),console.log("!!!",o,u),console.log(s),Object(a.useEffect)((function(){return t.slide(u,0)}),[u,t]);var l=n&&u>0?s[u-1].key:"",d=n&&u<s.length-1?s[u+1].key:"";return r.a.createElement("div",{className:w.a.swipeWidget},r.a.createElement(O.a,{ref:function(e){return t=e},className:w.a.swipe,callback:function(e){console.log("current",e);var t=s[e];console.log("current",t),i(t.key)},startSlide:u,speed:0,auto:0},s),l&&r.a.createElement("div",{className:w.a.prev,onClick:function(){t.prev()}}),d&&r.a.createElement("div",{className:w.a.next,onClick:function(){t.next()}}))},x=function(e){var t=e.children;return r.a.createElement(y.SwipeItem,{className:w.a.swipeItem},t)},k=n(22);function N(){return Object(a.useReducer)((function(e){return e+1}),0)[1]}var S=function(e){return e};function _(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:S,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],r=Object(a.useContext)(o.a);console.log("by forceUpdate",e);var c=N(),i=t(r.getState(e));return Object(a.useEffect)((function(){return r.subscribe(e,(function(e){console.log("new value",e,t(e)),c()}))}),[].concat(Object(k.a)(n),[r,e,c,t])),i}var A=n(36),I=n(37);function M(){var e=Object(A.a)(["\n  padding: 56px 12px 72px;\n"]);return M=function(){return e},e}var T,D,C,z=I.a.main(M()),B=n(5),V=n(7),L=n(38),P=Symbol("Packable encoder"),J=Symbol("Packable decoder"),F=n(33),U=function(){function e(t,n){if(Object(B.a)(this,e),this[J]=void 0,this[P]=void 0,this.decode=void 0,this.encode=void 0,!n||"function"!==typeof n)throw new Error("Encoder must be a function");if(!t||"function"!==typeof t)throw new Error("Decoder must be a function");this[P]=n,this[J]=t,this.encode=n,this.decode=t}return Object(V.a)(e,null,[{key:"getSafe",value:function(t){return null===t||void 0===t?null:P in t&&"function"===typeof t[P]&&J in t&&"function"===typeof t[J]?new e(t[J],t[P]):"prototype"in t&&P in t.prototype&&"function"===typeof t.prototype[P]&&J in t.prototype&&"function"===typeof t.prototype[J]?new e(t.prototype[J],t.prototype[P]):null}},{key:"get",value:function(t){var n=e.getSafe(t);if(n)return n;throw new Error("Target not a Packer")}},{key:"for",value:function(t){if(null===t||void 0===t)throw new Error("Rule not defined");if(t instanceof e)return t;var n=e.getSafe(t);if(n)return n;if(t===String||t===Number||t===Boolean)return e.forPrimitive(t);if(Array.isArray(t))return e.forArray(t[0]);throw new Error("Invalid rule")}},{key:"forPrimitive",value:function(t){if(t===String)return new e((function(e){return"string"===typeof e?""+e:null}),(function(e){return"string"===typeof e?e:null}));if(t===Number)return new e((function(e){return+e}),(function(e){return+e}));if(t===Boolean)return new e((function(e){return!!e}),(function(e){return!!e}));throw new Error("Invalid type")}},{key:"forObject",value:function(t){var n=Object.entries(t).map((function(t){var n=Object(F.a)(t,2),a=n[0],r=n[1];return[a,e.for(r)]}));return new e((function(e){return n.reduce((function(t,n){var a=Object(F.a)(n,2),r=a[0],c=a[1];return t[r]=c.decode(e[r]),t}),{})}),(function(e){return n.reduce((function(t,n){var a=Object(F.a)(n,2),r=a[0],c=a[1];return t[r]=c.encode(e[r]),t}),{})}))}},{key:"forClass",value:function(t,n){var a=e.forObject(t);return new e((function(e){return n(a.decode(e))}),a.encode)}},{key:"forArray",value:function(t){var n=e.for(t);return new e((function(e){return e.map(n.decode)}),(function(e){return e.map(n.encode)}))}},{key:"maybe",value:function(t){return new e((function(e){return null===e||void 0===e?null:t.decode(e)}),(function(e){return null===e||void 0===e?null:t.encode(e)}))}}]),e}(),H=Symbol("Fields symbol");function R(e){return function(t){var n=t.prototype,a=n[H];if(!a)throw new Error("To use @PackableClass you need declare @Packable");delete n[H];var r=U.forClass(a,e);n[J]=r.decode,n[P]=r.encode}}function W(e){if(null===e||void 0===e)throw new Error("Rule must be defined");return function(t,n){H in t?t[H][n]=e:t[H]=Object(L.a)({},n,e)}}var Y,G={RUB:{code:"RUB",symbol:"\u20bd",precision:2}},q=(Y=function(e){return new U(e.fromJSON,e.toJSON)},function(e){var t=Y(e);if(!t)throw new Error("Init function must return IPacker");var n=U.for(t);e[J]=n.decode,e[P]=n.encode}((C=D=function(){function e(t,n){Object(B.a)(this,e),this.subunits=t,this.currency=n,this.amount="",this.amount=(t/Math.pow(10,n.precision)).toFixed(2)}return Object(V.a)(e,null,[{key:"from",value:function(t){if("string"===typeof t)return e.fromJSON(t);if(t instanceof e)return t.clone();throw new Error("Can not convert invalid data to Money")}},{key:"fromJSON",value:function(t){if("object"===typeof t&&"number"===typeof t.subunits&&"object"===typeof t.currency&&"string"===typeof t.currency.code)return new e(t.subunits,t.currency);if("string"!==typeof t)throw new Error('Amount "'.concat(t,'" must be a string'));var n=t.trim().split(" ");if(!n||2!==n.length)throw new Error('Money "'.concat(t,'" must have valid format'));var a=n[0],r=n[1].toUpperCase(),c=G[r];if(!c)throw new Error('Unsupported currency "'.concat(r,'"'));var i=+a;if(Number.isNaN(i))throw new Error('Invalid amount "'.concat(a,'" when parse "').concat(t,'"'));return new e(Math.round(i*Math.pow(10,c.precision)),c)}},{key:"toJSON",value:function(e){return e.toJSON()}},{key:"create",value:function(t,n){if("string"!==typeof n)throw new Error('Invalid currency "'.concat(n,'"'));if(n=n.toUpperCase(),"string"===typeof t){if(!t||Number.isNaN(+t))throw new Error('Amount must be valid number but received "'.concat(t,'"'));t=+t}var a=G[n];if(!a)throw new Error('Unsupported currency "'.concat(n,'"'));var r=+t;if(Number.isNaN(r))throw new Error('Invalid amount "'.concat(t,'"'));return new e(Math.round(r*Math.pow(10,a.precision)),a)}}]),Object(V.a)(e,[{key:"clone",value:function(){return new e(this.subunits,this.currency)}},{key:"toString",value:function(){return this.subunits?this.amount+" "+this.currency.symbol:"0 "+this.currency.symbol}},{key:"toJSON",value:function(){return this.subunits?this.amount+" "+this.currency.code:"0 "+this.currency.code}},{key:"add",value:function(t){if(this.currency.code!==t.currency.code)throw new Error("Can not do any operations with different currencies");return new e(this.subunits+t.subunits,this.currency)}},{key:"sub",value:function(t){if(this.currency.code!==t.currency.code)throw new Error("Can not do any operations with different currencies");return new e(this.subunits-t.subunits,this.currency)}},{key:"equal",value:function(e){return this.currency.code===e.currency.code&&this.subunits===e.subunits}},{key:"getEntire",value:function(){return Math.floor(this.subunits/Math.pow(10,this.currency.precision)).toString()}},{key:"getFractional",value:function(){return(this.subunits/Math.pow(10,this.currency.precision)).toFixed(this.currency.precision).substr(-this.currency.precision)}},{key:"getSymbol",value:function(){return this.currency.symbol}},{key:"negative",value:function(){return new e(-this.subunits,this.currency)}},{key:"isPositive",value:function(){return this.subunits>0}},{key:"isNegative",value:function(){return this.subunits<0}}]),e}(),D.empty=void 0,T=C))||T);q.empty=q.create(0,"RUB");var X=n(54),$=n.n(X),Q=function(e){var t=e.money;if(null===t)return r.a.createElement("div",{className:$.a.moneyView},r.a.createElement("span",{className:$.a.entire},"N/A"));if(!(t instanceof q))throw new Error("money must be instance of Money, but get ".concat(typeof t," ").concat(JSON.stringify(t),'"'));return r.a.createElement("div",{className:$.a.moneyView},r.a.createElement("span",{className:$.a.entire},t.getEntire()),r.a.createElement("span",{className:$.a.fractional},t.getFractional()),r.a.createElement("span",{className:$.a.currency},t.getSymbol()))};function Z(){var e=Object(A.a)(['\n  background: #ffffff;\n  box-shadow: 0 1px 3px 0 rgba(0, 0, 0, 0.09);\n  border-radius: 10px;\n  padding: 12px 12px;\n  \n  display: grid;\n  grid-template-columns: auto;\n  grid-template-rows: auto;\n  gap: 12px 12px;\n  grid-template-areas: "icon amount amount" "title title status";\n\n  .amount { \n    grid-area: amount; \n    text-align: right;\n    \n    align-self: center;\n    font-size: 20px;\n    font-weight: 700;\n    letter-spacing: -0.02em;\n    line-height: 1em;\n    color: #27173E;\n    \n    white-space: nowrap;\n  }\n  \n  .icon-wrapper { \n    grid-area: icon;\n    text-align: left;\n    \n    background: #6236FF;\n    width: 36px;\n    height: 36px;\n    display: inline-flex;\n    align-items: center;\n    justify-content: center;\n    border-radius: 18px;\n    color: #fff;\n    font-size: 24px;\n  }\n  \n  .title { \n    grid-area: title;\n    text-align: left;\n    \n    font-size: 13px;\n    color: #958d9e;\n    font-weight: 500;\n    display: block;\n    line-height: 1em;\n    align-self: end;\n  }\n  \n  .status { \n    grid-area: status;\n    text-align: right; \n    \n    //font-size: 13px;\n    color: #958d9e;\n    font-weight: 500;\n    display: block;\n    line-height: 1em;\n    align-self: end;\n  }\n']);return Z=function(){return e},e}var K,ee=I.a.div(Z());!function(e){e.Neutral="neutral",e.Good="good",e.Normal="normal",e.Bad="bad"}(K||(K={}));var te=function(e){var t=e.title,n=e.amount,a=e.icon,c=(e.color,e.progress),i=null===c?"":c<0?c+"%":"+"+c+"%";return r.a.createElement(ee,null,r.a.createElement("div",{className:"icon-wrapper"},r.a.createElement(g,{icon:a})),r.a.createElement("div",{className:"amount"},r.a.createElement(Q,{money:n})),r.a.createElement("div",{className:"title"},t),r.a.createElement("div",{className:"status"},i))},ne=function(e){var t=e.grip;if(!t)return r.a.createElement("div",{className:"alert alert-warning mt-2",role:"alert"},"Grip not specified");var n=function(e){var t=e.months[0];return t?{income:{amount:t.income,progress:null,color:K.Neutral},expense:{amount:t.expense,progress:null,color:K.Neutral},planed:{amount:q.create(0,"RUB"),progress:null,color:K.Neutral},total:{amount:t.balance,progress:null,color:K.Neutral}}:{income:{amount:null,progress:null,color:K.Neutral},expense:{amount:null,progress:null,color:K.Neutral},planed:{amount:q.create(0,"RUB"),progress:null,color:K.Neutral},total:{amount:null,progress:null,color:K.Neutral}}}(t),a=n.income,c=n.expense,i=n.planed,o=n.total,s=[[r.a.createElement(te,Object.assign({title:"Income",icon:p.addCircleOutline},a)),r.a.createElement(te,Object.assign({title:"Expense",icon:p.removeCircleOutline},c))],[r.a.createElement(te,Object.assign({title:"Plane",icon:p.calendarOutline},i)),r.a.createElement(te,Object.assign({title:"Total",icon:p.cashOutline},o))]];return r.a.createElement("div",{className:"section"},s.map((function(e,t){return r.a.createElement("div",{key:t,className:"row mt-2 justify-content-center"},e.map((function(e,t){return r.a.createElement("div",{key:t,className:"col-6"},e)})))})))};function ae(){var e=Object(A.a)(["\n  display: inline-block;\n  border: 2px solid green;\n  border-radius: 50%;\n  background: url(","/category-icons/default.png);\n  width: ",";\n  height: ",";\n  background-size: 100%;\n  box-sizing: content-box;\n  \n  > span {\n    display: block;\n    background-size: 100%;\n    width: ",";\n    height: ",";\n  }\n"]);return ae=function(){return e},e}var re,ce=I.a.span(ae(),"/finman",(function(e){return e.size}),(function(e){return e.size}),(function(e){return e.size}),(function(e){return e.size})),ie=function(e){var t=e.category,n=e.size,a=t.image||"default",c="large"===n?"64px":"32px",i={backgroundImage:"url(".concat("/finman","/category-icons/").concat(a,".png)")};return r.a.createElement(ce,{size:c},r.a.createElement("span",{style:i}))};function oe(){var e=Object(A.a)(["\n  display: flex;\n  margin-top: 16px;\n  overflow-x: hidden;\n  \n  > * {\n    margin: 0 6px;\n    display: flex; // TODO fix it\n  }\n"]);return oe=function(){return e},e}!function(e){e[e.Removed=0]="Removed",e[e.Income=1]="Income",e[e.Expense=2]="Expense",e[e.Adjust=3]="Adjust",e[e.AdjustTo=4]="AdjustTo"}(re||(re={}));var se=I.a.div(oe()),ue=function(e){var t=e.grip;if(!t)return r.a.createElement("div",{className:"alert alert-outline-dark mt-2",role:"alert"},"No data");var n=[{id:"0000-111",name:"Home",image:"essentials-01",parent:null,defaultTxType:re.Income},{id:"default",name:"Default",image:"",parent:null,defaultTxType:re.Income},{id:"0000-111",name:"Home",image:"essentials-01",parent:null,defaultTxType:re.Income},{id:"default",name:"Default",image:"",parent:null,defaultTxType:re.Income},{id:"0000-111",name:"Home",image:"essentials-01",parent:null,defaultTxType:re.Income},{id:"default",name:"Default",image:"",parent:null,defaultTxType:re.Income},{id:"0000-111",name:"Home",image:"essentials-01",parent:null,defaultTxType:re.Income},{id:"default",name:"Default",image:"",parent:null,defaultTxType:re.Income},{id:"0000-111",name:"Home",image:"essentials-01",parent:null,defaultTxType:re.Income},{id:"default",name:"Default",image:"",parent:null,defaultTxType:re.Income}];return r.a.createElement(se,null,n.map((function(e){return r.a.createElement(mn,{to:on.transactions.add({account:t.id,category:e.id})},r.a.createElement(ie,{category:e,size:"large"}))})))},le=function(e){var t=e.account;Object(l.g)();return r.a.createElement("div",{className:"card-block bg-primary"},r.a.createElement("div",{className:"card-main"},r.a.createElement("div",{className:"card-button dropdown"},r.a.createElement("button",{type:"button",className:"btn btn-link btn-icon","data-toggle":"dropdown"},r.a.createElement(g,{icon:p.cogOutline,role:"img",className:"md hydrated","aria-label":"ellipsis horizontal"})),r.a.createElement("div",{className:"dropdown-menu dropdown-menu-right"},r.a.createElement("a",{className:"dropdown-item",href:"javacript:;"},r.a.createElement(g,{icon:p.pencilOutline,role:"img",className:"md hydrated","aria-label":"pencil outline"}),"Edit"),r.a.createElement("a",{className:"dropdown-item",href:"javacript:;"},r.a.createElement(g,{icon:p.closeOutline,role:"img",className:"md hydrated","aria-label":"close outline"}),"Remove"),r.a.createElement("a",{className:"dropdown-item",href:"javacript:;"},r.a.createElement(g,{icon:p.arrowUpCircleOutline,role:"img",className:"md hydrated","aria-label":"arrow up circle outline"}),"Upgrade"))),r.a.createElement("div",{className:"balance"},r.a.createElement("span",{className:"label"},"BALANCE"),r.a.createElement("h1",{className:"title"},r.a.createElement(Q,{money:t.balance}))),r.a.createElement("div",{className:"in"},r.a.createElement("div",{className:"card-number"},r.a.createElement("span",{className:"label"},"Account name"),t.name),r.a.createElement("div",{className:"bottom"},r.a.createElement("div",{className:"card-expiry"},r.a.createElement("span",{className:"label"},"Statistics for"),"Last month")))))},de=n(2),me=n(6),fe=n(21),he="grips/account",pe=Object(me.c)(he+":chooseAccountGrip"),be=Object(me.c)(he+":updateAccountGrip"),ge=Object(me.c)(he+":updateAccountGrip success"),ve=(Object(me.c)(he+":updateAccountGrip failed"),Object(me.c)(he+":updateAccountGrips")),ye=Object(me.c)(he+":updateAccountGrips success"),Oe=(Object(me.c)(he+":updateAccountGrips failed"),Object(me.d)(["grips/account"],{currentID:null,current:null,accounts:Object(fe.a)()},(function(e){return{choose:[e(pe,(function(e,t){var n=e.accounts.get(t);return n?Object(de.a)(Object(de.a)({},e),{},{currentID:t,current:n}):Object(de.a)(Object(de.a)({},e),{},{currentID:t})}))],update:[e(ge,(function(e,t){var n=e.accounts.set(t.id,t),a=n.get(e.currentID);return a||(a=n.get(t.id)),Object(de.a)(Object(de.a)({},e),{},{accounts:n,current:a,currentID:a.id})})),e(ye,(function(e,t){var n=t.reduce((function(e,t){return e.set(t.id,t)}),e.accounts),a=n.get(e.currentID);return a||(a=n.get(t[0].id)),Object(de.a)(Object(de.a)({},e),{},{accounts:n,current:a,currentID:a.id})}))]}}))),je=function(e){var t=e.grip;if(!t)return r.a.createElement("div",{className:"alert alert-outline-dark mt-2",role:"alert"},"No data");var n=t.months.slice(1,4);return n.length?r.a.createElement("ul",{className:"listview link-listview inset mt-2",style:{margin:"0"}},n.map((function(e){return r.a.createElement("li",null,r.a.createElement(mn,{to:on.account.month(t.id,e.month),className:"item"},"Balance on ",e.month,r.a.createElement("span",{className:"text"},r.a.createElement(Q,{money:e.balanceOnEnd}))))}))):null},we=function(){var e=_(Oe),t=e.current,n=e.accounts,a=Object(o.b)((function(e){return"create"===e?null:pe(e)})),c=Array.from(n.values());return n.size?r.a.createElement(r.a.Fragment,null,r.a.createElement(v,{title:"Wallets"}),r.a.createElement(z,null,r.a.createElement(E,{current:(null===t||void 0===t?void 0:t.id)||"",showButtons:!0,onChange:a},c.map((function(e){return r.a.createElement(x,{key:e.id},r.a.createElement(le,{account:e}))}))),r.a.createElement(ne,{grip:t}),r.a.createElement(ue,{grip:t}),r.a.createElement(je,{grip:t}))):r.a.createElement(r.a.Fragment,null,r.a.createElement(v,{title:"Wallets"}),"Loading...")},Ee=Object(me.c)("months:loadMonths"),xe=Object(me.c)("months:loadMonths success"),ke=Object(me.c)("months:loadMonths failed"),Ne=Object(me.c)("months:saveMonths"),Se=Object(me.c)("months:saveMonths success"),_e=Object(me.c)("months:saveMonths failed"),Ae=n(96),Ie=n.n(Ae),Me=n(47),Te=n.n(Me),De=n(82);var Ce=r.a.memo((function(e){var t=e.list,n=(e.dayDate,function(e){return e.map((function(e){return Object(de.a)(Object(de.a)({},e),{},{first:e.category.name,second:e.title,dateString:e.date?Object(De.a)(new Date(e.date),"PP"):""})}))}(t));return r.a.createElement("ul",{className:Te.a.txList},n.map((function(e,t){return r.a.createElement("li",{key:t,className:Te.a.txItem},r.a.createElement("div",{className:Te.a.txItem__left},r.a.createElement("div",{className:Te.a.txItem__first},e.first?e.first:r.a.createElement("span",{className:Te.a.empty},"\u0411\u0435\u0437 \u0437\u0430\u0433\u043e\u043b\u043e\u0432\u043a\u0430")),r.a.createElement("div",{className:Te.a.txItem__second},e.second?e.second:r.a.createElement("span",{className:Te.a.empty},"\u0411\u0435\u0437 \u0437\u0430\u0433\u043e\u043b\u043e\u0432\u043a\u0430"))),r.a.createElement("div",{className:Te.a.txItem__right},r.a.createElement("div",{className:Te.a.txItem__amount},r.a.createElement(Q,{money:e.amount})),r.a.createElement("div",{className:Te.a.txItem__date},e.date)))})))})),ze=r.a.memo((function(e){var t=e.month;if(!t)return r.a.createElement("div",null,"No data");var n=t.days;return r.a.createElement("ul",{className:Ie.a.days},n.map((function(e){return r.a.createElement("li",{key:e.date,className:Ie.a.day},r.a.createElement("div",{className:Ie.a.title},(t=e.date,Object(De.a)(new Date(t),"do LLLL"))),r.a.createElement(Ce,{list:e.transactions,dayDate:e.date}));var t})))}));var Be=n(41),Ve=n.n(Be),Le=function(e){var t=e.brief;if(!t)return r.a.createElement("div",null,"No month");var n=452,a=t.income.subunits+t.expense.subunits,c=t.income.subunits/a*n,i=t.expense.subunits/a*n;return r.a.createElement("div",{className:Ve.a.head},r.a.createElement("h3",{className:Ve.a.title},Object(De.a)(new Date(t.month),"MMMM yyyy")),r.a.createElement("div",{className:Ve.a.info},r.a.createElement("div",{className:Ve.a.circle},r.a.createElement("svg",{width:"160",height:"160"},r.a.createElement("circle",{transform:"rotate(-90)",r:"72",cx:"-80",cy:"80"}),r.a.createElement("circle",{className:"income",transform:"rotate(-90)",r:"72",cx:"-80",cy:"80",stroke:"30bae7",strokeDasharray:[c,n].join(" ")}),r.a.createElement("circle",{className:"expense",transform:"rotate(-90)",r:"72",cx:"-80",cy:"80",strokeDasharray:[0,c,i,n].join(" ")})),r.a.createElement("h4",{className:Ve.a.balance},r.a.createElement(Q,{money:t.balance})),r.a.createElement("div",null,"+",r.a.createElement(Q,{money:t.income})),r.a.createElement("div",null,"-",r.a.createElement(Q,{money:t.expense})))))},Pe=n(186),Je=n.n(Pe),Fe=(Object(me.c)("grips/month:updateMonthGrip"),Object(me.c)("grips/month:updateMonthGrip success")),Ue=(Object(me.c)("grips/month:updateMonthGrip failed"),Object(me.c)("grips/month:updateMonthGrips"),Object(me.c)("grips/month:updateMonthGrips success")),He=(Object(me.c)("grips/month:updateMonthGrips failed"),Object(me.d)(["grips/month"],Object(fe.a)(),(function(e){return{update:[e(Fe,(function(e,t){return e.set(t.id,t)})),e(Ue,(function(e,t){return t.reduce((function(e,t){return e.set(t.id,t)}),e)}))]}}))),Re=function(){var e=Object(l.i)().params,t=Object(o.c)(Oe,(function(t){return t.accounts.get(e.account)}),[e.account]),n=(Object(o.c)(He),Object(l.g)());Object(k.a)(t?t.months:[]).reverse();Object(a.useCallback)((function(e){n.replace(on.account.month(t.id,e))}),[t,n]),Object(o.b)((function(e){return e?Ee([e]):null}),[]);return t?t.months.length?r.a.createElement(We,{account:t,month:e.month||t.lastMonthDate}):r.a.createElement("div",null,"No months in this account"):r.a.createElement("div",null,"No account")},We=function(e){var t=e.account,n=e.month,c=Object(o.c)(He),i=Object(l.g)(),s=Object(k.a)(t?t.months:[]);s.reverse();var u=Object(a.useCallback)((function(e){i.replace(on.account.month(t.id,e))}),[t,i]),d=Object(o.b)((function(e){return e?Ee([e]):null}),[]),m=t.months.findIndex((function(e){return e.month===n}));-1===m&&(m=0);var f=t.months[m],h=t.months[m+1],p=t.months[m-1];Object(a.useEffect)((function(){f&&!c.has(f.id)&&d(f.id),h&&!c.has(h.id)&&d(h.id),p&&!c.has(p.id)&&d(p.id)}),[h,p,f]);var b=c.get(null===f||void 0===f?void 0:f.id);return r.a.createElement(r.a.Fragment,null,r.a.createElement(v,{title:"Account ".concat(t.name)}),r.a.createElement("main",{className:Je.a.main+" noselect"},r.a.createElement(E,{onChange:u,current:f.month,showButtons:!0},s.map((function(e){return r.a.createElement(x,{key:e.month},r.a.createElement(Le,{months:c,brief:e}))}))),r.a.createElement(ze,{month:b})))};var Ye,Ge,qe,Xe,$e,Qe,Ze,Ke,et,tt,nt,at,rt,ct,it,ot={list:function(){return"".concat("","/accounts")},view:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:":account";return"".concat("","/accounts/").concat(e)},monthsList:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:":account";return"".concat("","/accounts/").concat(e,"/months")},month:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:":account",t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:":month";return"".concat("","/accounts/").concat(e,"/months/").concat(t)}},st=[{path:ot.list(),exact:!0,component:we},{path:ot.view(),exact:!0,component:we},{path:ot.month(),component:Re},{path:ot.monthsList(),component:Re}],ut=n(187),lt=Object(me.c)("client:setOnlineStatus"),dt=Object(me.c)("client:refresh"),mt=Object(me.d)(["client"],{online:!1},(function(e){return{online:[e(lt,(function(e,t){return Object(de.a)(Object(de.a)({},e),{},{online:t})}))]}})),ft=Object(me.c)("accounts:chooseAccount"),ht=Object(me.c)("accounts:loadAccounts"),pt=Object(me.c)("accounts:loadAccounts success"),bt=Object(me.c)("accounts:loadAccounts failed"),gt=Object(me.c)("accounts:saveAccounts"),vt=Object(me.c)("accounts:saveAccounts success"),yt=Object(me.c)("accounts:saveAccounts failed"),Ot=Object(me.d)(["accounts"],{current:null,accounts:Object(fe.a)()},(function(e){return{choose:[e(ft,(function(e,t){var n=e.accounts.get(t);return n?Object(de.a)(Object(de.a)({},e),{},{current:n}):e}))],load:[e(pt,(function(e,t){var n=t.current,a=t.accounts,r=a.map((function(e){return[e.id,e]})),c=Object(fe.a)(r);return Object(de.a)(Object(de.a)({},e),{},{current:c.has(n)?c.get(n):a[0],accounts:c})}))],save:[e(gt,(function(e,t){var n;return{accounts:e.accounts.set(t.id,t),current:t.id===(null===(n=e.current)||void 0===n?void 0:n.id)?t:e.current}}))]}})),jt=Object(me.d)(["months"],Object(fe.a)(),(function(e){return{load:[e(xe,(function(e,t){return t.reduce((function(e,t){return e.set(t.id,t)}),e)}))],save:[e(Ne,(function(e,t){return t.reduce((function(e,t){return e.set(t.id,t)}),e)}))]}})),wt=Object(me.c)("categories:loadCategories"),Et=Object(me.c)("categories:loadCategories success"),xt=Object(me.c)("categories:loadCategories failed"),kt=Object(me.c)("categories:saveCategories"),Nt=(Object(me.c)("categories:saveCategories success"),Object(me.c)("categories:saveCategories failed"),n(17)),St=n(18),_t=n(9),At=n(10),It=(n(55),n(370)),Mt=(Ye=R((function(e){return new Mt(e)})),Ge=W(String),qe=W(String),Xe=W(String),$e=W(Number),Qe=W(String),Ze=W(Boolean),Ye((et=function(){function e(t){if(Object(B.a)(this,e),Object(_t.a)(this,"id",tt,this),Object(_t.a)(this,"name",nt,this),Object(_t.a)(this,"parent",at,this),Object(_t.a)(this,"defaultTxType",rt,this),Object(_t.a)(this,"image",ct,this),Object(_t.a)(this,"isInitial",it,this),!t.name)throw new Error("Name must be set");Object.assign(this,t)}return Object(V.a)(e,null,[{key:"create",value:function(t,n,a){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"default",c=arguments.length>4?arguments[4]:void 0;return new e({id:c||Object(It.a)(),name:t,image:r,defaultTxType:n}).setParent(a)}},{key:"createInitial",value:function(t,n,a,r,c){if(!c)throw new Error("ID must be set");return new e(Object(de.a)(Object(de.a)({},e.create(t,n,a,r,c)),{},{isInitial:!0}))}},{key:"fromJSON",value:function(t){return U.get(e).decode(t)}},{key:"toJSON",value:function(e){return e.toJSON()}}]),Object(V.a)(e,[{key:"toJSON",value:function(){return U.get(e).encode(this)}},{key:"setName",value:function(t){if(this.isInitial)throw new Error("Can not set name to initial category");return new e(Object(de.a)(Object(de.a)({},this),{},{name:t}))}},{key:"setDefaultTransactionType",value:function(t){return new e(Object(de.a)(Object(de.a)({},this),{},{defaultTxType:t}))}},{key:"setImage",value:function(t){return new e(Object(de.a)(Object(de.a)({},this),{},{image:t}))}},{key:"setParent",value:function(t){if(this.isInitial)throw new Error("Can not set parent to initial category");return new e(t?"string"===typeof t?Object(de.a)(Object(de.a)({},this),{},{parent:t}):Object(de.a)(Object(de.a)({},this),{},{parent:t.id}):Object(de.a)(Object(de.a)({},this),{},{parent:null}))}}]),e}(),tt=Object(At.a)(et.prototype,"id",[Ge],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return""}}),nt=Object(At.a)(et.prototype,"name",[qe],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return""}}),at=Object(At.a)(et.prototype,"parent",[Xe],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),rt=Object(At.a)(et.prototype,"defaultTxType",[$e],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return re.Expense}}),ct=Object(At.a)(et.prototype,"image",[Qe],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return"default"}}),it=Object(At.a)(et.prototype,"isInitial",[Ze],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),Ke=et))||Ke),Tt=function(e){Object(Nt.a)(n,e);var t=Object(St.a)(n);function n(e,a){var r;return Object(B.a)(this,n),(r=t.call(this,e)).children=[],r.children=a.filter((function(e){return e.parent===r.id})),r}return n}(Mt),Dt=Object(me.d)(["categories"],Object(fe.a)(),(function(e){return{load:[e(Et,(function(e,t){var n=t.list.filter((function(e){return!e.parent})).map((function(e){return new Tt(e,t.list)})),a=n.flatMap((function(e){return[e].concat(Object(k.a)(e.children))})),r=Object(fe.a)(a.map((function(e){return[e.id,e]})));return(e=e.set(t.id,{block:t,tree:n,list:a,map:r})).set(t.account,{block:t,tree:n,list:a,map:r})}))],save:[e(kt,(function(e,t){throw new Error("Not implemented")}))]}})),Ct=Object(me.b)(Object(me.a)({Client:mt,Accounts:Ot,Categories:Dt,Months:jt,AccountGrips:Oe,MonthGrips:He}));Object(ut.a)(Ct),Ct.subscribe((function(e,t){console.group("*** action",e.type),console.log(e.payload),console.log(t),console.groupEnd()}));var zt=Object(me.c)("transaction:addTransaction"),Bt=n(83),Vt=n(94),Lt=n(188),Pt=function(e){var t=e.name,n=e.label,c=e.clearable,i=e.placeholder,o=e.hint,s=e.component,u=e.children,l=e.render,d=Object(Bt.c)(t),m=Object(a.useRef)(),f=Object(a.useState)(!1),h=Object(F.a)(f,2),p=h[0],b=h[1],v=Object(a.useCallback)((function(){return b(!0)}),[b]),y=Object(a.useCallback)((function(){return b(!1)}),[b]),O=Object(a.useCallback)((function(){m.current.focus(),d.input.onChange("")}),[m]);return r.a.createElement("div",{className:"form-group basic"},r.a.createElement("div",{className:["input-wrapper",p?"active":"","not-empty"].join(" ")},r.a.createElement("label",{className:"label",htmlFor:"form-input-".concat(t)},n),r.a.createElement(Bt.a,{id:"form-input-".concat(t),name:t,className:"form-control",ref:m,onFocus:v,onBlur:y,placeholder:i,component:s,render:l},u),c&&r.a.createElement("i",{className:"clear-input",onClick:O},r.a.createElement(g,{name:"close-circle",role:"img",className:"md hydrated","aria-label":"close circle"}))),r.a.createElement("div",{className:"input-info"},o))};function Jt(e){var t=e.inputRef,n=e.onChange,a=Object(Vt.a)(e,["inputRef","onChange"]);return r.a.createElement(Lt.a,Object.assign({},a,{getInputRef:t,onValueChange:function(t){n({target:{name:e.name,value:t.value}})},prefix:"$",thousandSeparator:" ",isNumericString:!0}))}var Ft=function(e){return r.a.createElement(Pt,e,(function(e){var t=e.input;e.meta;return r.a.createElement(Jt,Object.assign({},t,{className:"form-control",type:"text",placeholder:"Amount"}))}))};function Ut(){var e=Object(A.a)(["\n    display: inline-block;\n    padding: 5px 10px;\n    cursor: pointer;\n    user-select: none;\n"]);return Ut=function(){return e},e}var Ht=I.a.div(Ut()),Rt=function(e){var t=e.type,n=e.value,c=e.disabled,i=e.onChange,o=re[t],s=n===t,u=Object(a.useCallback)((function(){return i(t)}),[i,t]);return c?r.a.createElement(Ht,null,r.a.createElement("div",{className:"custom-control custom-checkbox d-inline"},r.a.createElement("input",{type:"checkbox",className:"custom-control-input",id:"customCheck2",checked:s}),r.a.createElement("label",{className:"custom-control-label p-0",htmlFor:"customCheck2"})),o):r.a.createElement(Ht,{onClick:u},r.a.createElement("div",{className:"custom-control custom-checkbox d-inline"},r.a.createElement("input",{type:"checkbox",className:"custom-control-input",id:"customCheck2",value:t,checked:s}),r.a.createElement("label",{className:"custom-control-label p-0",htmlFor:"customCheck2"})),o)},Wt=function(e){var t=e.types,n=Object(Vt.a)(e,["types"]);return r.a.createElement(Pt,Object.assign({},n,{clearable:!1}),(function(e){var n=e.input;return t.map((function(e){return r.a.createElement(Rt,{type:e,value:n.value,onChange:n.onChange})}))}))},Yt=function(e){return r.a.createElement(Pt,Object.assign({},e,{component:"input"}))},Gt=function(e){return r.a.createElement(Pt,e,(function(e){var t=e.input;e.meta;return r.a.createElement("input",Object.assign({},t,{className:"form-control",type:"date",placeholder:"Date"}))}))},qt=function(e){var t=e.onSubmit,n=e.value,a=e.validate;return r.a.createElement(Bt.b,{onSubmit:t,initialValues:n,validate:a,render:function(e){var t=e.handleSubmit;e.form,e.submitting,e.pristine,e.values;return r.a.createElement("form",{onSubmit:t,noValidate:!0,autoComplete:"off"},r.a.createElement(Ft,{name:"amount",label:"Amount",hint:"This is amount",placeholder:"Enter amount"}),r.a.createElement(Yt,{name:"category",label:"Category"}),r.a.createElement(Wt,{name:"type",label:"",types:[re.Income,re.Expense]}),r.a.createElement(Yt,{name:"title",label:"Title"}),r.a.createElement(Gt,{name:"date",label:"Date",component:"input"}),r.a.createElement(Yt,{name:"account",label:"Account"}),r.a.createElement("button",{type:"submit",className:"btn btn-primary rounded mr-1"},"Save"))}})};function Xt(){var e=Object(A.a)(["\n  text-align: left;\n  font-size: 15px;\n  padding: ",";\n  color: #27173E;\n  font-weight: 500;\n  margin: 0;\n"]);return Xt=function(){return e},e}function $t(){var e=Object(A.a)(["\n  margin: 16px 0;\n  padding: ",";\n"]);return $t=function(){return e},e}var Qt=I.a.section($t(),(function(e){return e.full?"0":"0 16px"})),Zt=I.a.h3(Xt(),(function(e){return e.full?"6px 16px":"6px 0"})),Kt=function(e){var t=e.full,n=e.title,a=e.children;return r.a.createElement(Qt,{full:t},r.a.createElement(Zt,{full:t},n),a)},en=function(e){var t=e.full,n=e.children;return r.a.createElement("div",{className:["card","mt-1",t?"full":""].join(" ")},r.a.createElement("div",{className:"card-body"},n))},tn=n(97),nn=n.n(tn),an=[],rn={add:function(e){return"".concat("","/transaction/add")+function(e){return e&&Object.keys(e).length?"?"+new URLSearchParams(e).toString():""}(e)},list:function(){return"".concat("","/transactions")}},cn=[{path:rn.add(),component:function(){var e=new URLSearchParams(Object(l.h)().search),t=_(Oe).current,n=Object(a.useState)({type:e.get("type")&&e.get("type")in re?re[e.get("type")]:re.Expense,amount:e.get("amount")||"",date:e.get("date")||"2020-06-01",account:e.get("account")||(null===t||void 0===t?void 0:t.id)||"",category:e.get("category")||"default"}),c=Object(F.a)(n,2),i=c[0],o=c[1];return r.a.createElement(r.a.Fragment,null,r.a.createElement(v,{title:"Add transaction",back:!0}),r.a.createElement(z,null,r.a.createElement(Kt,{full:!0,title:"Add transaction"},r.a.createElement(en,null,r.a.createElement(qt,{value:i,onSubmit:function(e){console.log(e),o(e),Ct.dispatch(zt(e))},validate:function(e){var t={};return e.account||(t.account="Required"),t}})))))}},{path:rn.list(),component:function(){return r.a.createElement("div",{className:nn.a.page},r.a.createElement(v,{title:"Transactions of ".concat("2020-05")}),r.a.createElement("main",null,r.a.createElement("div",{className:nn.a.filter},r.a.createElement("button",{className:nn.a.active},"\u0412\u0441\u0435"),r.a.createElement("button",null,"\u0422\u0440\u0430\u0442\u044b"),r.a.createElement("button",null,"\u041f\u0440\u0438\u0445\u043e\u0434")),r.a.createElement(Ce,{list:an,dayDate:"2020-05-05"})))}}],on={account:ot,transactions:rn,home:function(){return"".concat("","/accounts")},licenses:function(){return"".concat("","/licenses")},menu:function(){return"".concat("","/menu")}},sn=n(189),un=n.n(sn),ln=function(e){var t=e.title,n=e.link,a=e.author,c=e.license;return r.a.createElement("li",null,r.a.createElement("a",{href:n,target:"_blank",className:"item"},r.a.createElement("div",{className:"in"},r.a.createElement("div",null,r.a.createElement("header",null,a),t,r.a.createElement("footer",null,c)))))},dn=[].concat(Object(k.a)(st),Object(k.a)(cn),[{path:on.menu(),component:function(){return r.a.createElement(r.a.Fragment,null,r.a.createElement(v,{title:"Menu",back:!0}),r.a.createElement(z,null,r.a.createElement("div",{className:"listview-title mt-1"},"Storage"),r.a.createElement("ul",{className:"listview image-listview text inset",style:{marginLeft:"0",marginRight:"0"}},r.a.createElement("li",null,r.a.createElement("div",{className:"item"},r.a.createElement("div",{className:"in"},r.a.createElement("div",null,"Subsets"),r.a.createElement("span",{className:"text-muted"},"0")))),r.a.createElement("li",null,r.a.createElement("div",{className:"item"},r.a.createElement("div",{className:"in"},r.a.createElement("div",null,"Accounts"),r.a.createElement("span",{className:"text-muted"},"1")))),r.a.createElement("li",null,r.a.createElement("div",{className:"item"},r.a.createElement("div",{className:"in"},r.a.createElement("div",null,"Month blocks"),r.a.createElement("span",{className:"text-muted"},"123")))),r.a.createElement("li",null,r.a.createElement("div",{className:"button item"},r.a.createElement("div",{className:"in"},r.a.createElement("div",null,"Remove all data",r.a.createElement("div",{className:"text-muted"},"This action cannot be undone"))))))))}},{path:on.licenses(),component:function(){return r.a.createElement(r.a.Fragment,null,r.a.createElement(v,{title:"Licenses"}),r.a.createElement(z,{className:un.a.licenses},r.a.createElement("ul",{className:"listview link-listview inset mt-2"},r.a.createElement(ln,{link:"https://reactjs.org/",title:"ReactJS",author:"Facebook Open Source",license:"MIT License"}),r.a.createElement(ln,{link:"https://reatom.js.org/",title:"Reatom state manager",author:"Arutyunyan Artyom",license:"MIT License"}),r.a.createElement(ln,{link:"https://iconstore.co/icons/dripicons-v2/",title:'Icons "Dripicons" Version 2.0',author:"Amit Jakhu",license:"CC BY 4.0"}))))}}]),mn=d.b,fn=d.c,hn=[{path:on.home(),exact:!0,icon:p.walletOutline,label:"Wallets"},{path:on.transactions.add(),icon:p.addCircleOutline,label:"New item"},{path:on.menu(),icon:p.ellipsisHorizontalOutline,label:"Menu"}],pn=function(){return r.a.createElement("div",{className:"appBottomMenu"},hn.map((function(e){return r.a.createElement(fn,{to:e.path,exact:e.exact,className:"item"},r.a.createElement("div",{className:"col"},r.a.createElement(g,{icon:e.icon,role:"img",className:"md hydrated","aria-label":"pie chart outline"}),r.a.createElement("strong",null,e.label)))})))};var bn,gn=n(4),vn=n.n(gn),yn=n(46);function On(e,t,n){Array.isArray(n)?n.forEach((function(n){return On(e,t,n)})):e.addEventListener(n,(function(e){console.log('[eventLogger] Emitter: "'.concat(t,'", event "').concat(n,'":'),e)}))}!function(e){e[e.Initializing=0]="Initializing",e[e.Upgrading=1]="Upgrading",e[e.Migrating=2]="Migrating",e[e.Ready=3]="Ready",e[e.Failed=4]="Failed"}(bn||(bn={}));var jn=function(){function e(t,n){Object(B.a)(this,e),this.db=t,this.scheme=n,this.transaction=void 0,this.storage=void 0,this.transaction=t.transaction(n.collection,"readwrite"),On(this.transaction,"transaction",["abort","complete","error"]),this.storage=this.transaction.objectStore(n.collection)}return Object(V.a)(e,[{key:"add",value:function(e){var t=this;return new Promise((function(n,a){var r=t.storage.add(e);On(r,"request",["error","success"]),r.onsuccess=function(e){return n(e.target.result)},r.onerror=function(e){return a(e)}}))}},{key:"get",value:function(e){var t=this;return new Promise((function(n,a){var r=t.storage.get(e);On(r,"request",["error","success"]),r.onsuccess=function(e){return n(e.target.result)},r.onerror=function(e){return a(e)}}))}},{key:"getAll",value:function(e,t){var n=this;return Array.isArray(e)?Promise.all(e.map((function(e){return n.get(e)}))):new Promise((function(t,a){var r=n.storage.getAll(e);On(r,"request",["error","success"]),r.onsuccess=function(e){return t(e.target.result)},r.onerror=function(e){return a(e)}}))}},{key:"update",value:function(e){var t=this;return new Promise((function(n,a){var r=t.storage.put(e);On(r,"request",["error","success"]),r.onsuccess=function(e){return n(e.target.result)},r.onerror=function(e){return a(e)}}))}}]),e}(),wn=function(){function e(t,n,a,r){if(Object(B.a)(this,e),this.schemes=n,this.onInstall=a,this.onUpgrade=r,this.listeners=[],this._status=bn.Initializing,this.db=null,!window.indexedDB)throw new Error("IndexedDB not supported");n.forEach((function(e){if(n.find((function(t){return t!==e&&t.collection===e.collection})))throw new Error('Collection "'.concat(e.collection,'" used in different schemes.\nYou can use collection only in one scheme'))}));var c=Math.max.apply(Math,[1].concat(Object(k.a)(n.map((function(e){return e.dbVersion})))));console.log("Start DB with version: ".concat(c,", count of models: ").concat(n.length)),this.openDB(t,c).then((function(){return console.log("Successfully open DB")}),(function(e){return console.error("Failed to open DB",e)}))}return Object(V.a)(e,[{key:"status",get:function(){return this._status}}]),Object(V.a)(e,[{key:"transaction",value:function(e){if(this._status!==bn.Ready&&this._status!==bn.Migrating)throw new Error("Database not ready");return this.getAccessor(e)}},{key:"addStatusListener",value:function(e){var t=this;this.listeners.push(e),setTimeout((function(){return e(t.status)}))}},{key:"removeStatusListener",value:function(e){this.listeners=this.listeners.filter((function(t){return t!==e}))}},{key:"setStatus",value:function(e){console.log('change DB status to "'.concat(bn[e],'"')),e!==this._status&&(console.log('Change DB status from "'.concat(bn[this._status],'" to "').concat(bn[e],'"')),this._status=e,this.listeners.forEach((function(t){return t(e)})))}},{key:"getAccessor",value:function(e){if(this.db)return new jn(this.db,e);throw new Error("Cannot create accessor for closed database")}},{key:"openDB",value:function(e,t){var n=this;return this.setStatus(bn.Initializing),new Promise((function(a,r){var c=window.indexedDB.open(e,t),i=!1,o=t,s=t;On(c,"openRequest",["upgradeneeded","blocked","error","success"]),c.addEventListener("upgradeneeded",(function(e){n.setStatus(bn.Upgrading),i=!0,o=e.oldVersion,s=e.newVersion,o?console.log("Upgrade DB from version ".concat(o)):console.log("Initialize DB");var t=n.db=e.target.transaction;console.log(t);var a=n.db=e.target.result;console.log(Array.from(a.objectStoreNames)),n.schemes.forEach((function(e){var n;try{n=t.objectStore(e.collection)}catch(r){console.warn(r),n=a.createObjectStore(e.collection,{keyPath:e.key})}console.log(n),e.upgrade&&e.upgrade(n,o,s)}))})),c.addEventListener("success",function(){var e=Object(yn.a)(vn.a.mark((function e(t){return vn.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n.db=t.target.result,!i){e.next=11;break}if(n.setStatus(bn.Migrating),o){e.next=8;break}return e.next=6,n.onInstall(n);case 6:e.next=11;break;case 8:if(!n.onUpgrade){e.next=11;break}return e.next=11,n.onUpgrade(n,o,s);case 11:n.setStatus(bn.Ready),a();case 13:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),c.addEventListener("error",(function(e){console.log(e),n.setStatus(bn.Failed),r(e)}))}))}}]),e}();var En,xn={collection:"accounts",dbVersion:1,key:"id",upgrade:function(e,t,n){console.log("update account from ",t,n)}},kn={collection:"months",dbVersion:1,key:"id",upgrade:function(e,t,n){console.log("update months from ",t,n)}},Nn=n(64);!function(e){e[e.NoSynced=0]="NoSynced",e[e.Prepared=1]="Prepared",e[e.Syncing=2]="Syncing",e[e.FullySynced=3]="FullySynced",e[e.Fixed=4]="Fixed"}(En||(En={}));var Sn=U.forObject({balance:q,income:q,expense:q}),_n=U.forObject({balance:q,income:q,expense:q,balanceOnStart:q,balanceOnEnd:q}),An={balance:q.empty,income:q.empty,expense:q.empty},In=Object(de.a)(Object(de.a)({},An),{},{balanceOnStart:q.empty,balanceOnEnd:q.empty});Object.freeze(An),Object.freeze(In);var Mn,Tn,Dn,Cn,zn,Bn,Vn,Ln,Pn,Jn,Fn,Un,Hn,Rn,Wn,Yn,Gn,qn=U.maybe(U.forObject({id:String,month:String,summary:_n,prevMonths:[String],prevVersions:[String],dataHash:String})),Xn=n(371),$n=n(65),Qn=n.n($n),Zn={income:q.empty,expense:q.empty,balance:q.empty};function Kn(e){var t=e.reduce((function(e,t){var n=Object(F.a)(e,2),a=n[0],r=n[1];switch(t.type){case re.Removed:return[a,r];case re.Income:return[a,r.add(t.amount)];case re.Expense:return[a.add(t.amount),r];default:throw new Error("Can't process type \"".concat(re[t.type],'"'))}}),[q.empty,q.empty]),n=Object(F.a)(t,2),a=n[0],r=n[1];return{balance:r.sub(a),expense:a,income:r}}function ea(e,t){var n=e.balance.add(t.balance),a=e.expense.add(t.expense),r=e.income.add(t.income);if(!r.sub(a).equal(n)){if(!ta(e))throw new Error('"Base" summary invalid');if(!ta(t))throw new Error('"Add" summary invalid');throw new Error("Incorrect balance")}return{balance:n,expense:a,income:r}}function ta(e){return e.income.sub(e.expense).equal(e.balance)}function na(e){var t=e.match(/^(\d{4})-(\d{2})$/);if(!t)throw new Error('Invalid MonthDate "'.concat(e,'"'));var n=+t[1],a=+t[2]-1,r=new Date(n,a,1,12,0,0);if(r.getFullYear()!==n)throw new Error('Invalid year in "'.concat(e,'"'));if(r.getMonth()!==a)throw new Error('Invalid month in "'.concat(e,'"'));return r}function aa(e){return e.split("-",2).join("-")}var ra,ca,ia,oa,sa,ua,la,da,ma,fa,ha,pa,ba,ga,va,ya,Oa,ja,wa,Ea,xa,ka,Na,Sa,_a,Aa,Ia,Ma,Ta,Da,Ca,za,Ba,Va,La,Pa,Ja=(Mn=R((function(e){return new Ja(e)})),Tn=W(String),Dn=W(q),Cn=W(Number),zn=W(String),Bn=W(String),Vn=W(Number),Ln=W(Number),Mn((Jn=function(){function e(t){Object(B.a)(this,e),Object(_t.a)(this,"id",Fn,this),Object(_t.a)(this,"amount",Un,this),Object(_t.a)(this,"type",Hn,this),Object(_t.a)(this,"category",Rn,this),Object(_t.a)(this,"title",Wn,this),Object(_t.a)(this,"createdAt",Yn,this),Object(_t.a)(this,"updatedAt",Gn,this),Object.assign(this,t)}return Object(V.a)(e,null,[{key:"createWithID",value:function(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:re.Removed,a=arguments.length>2?arguments[2]:void 0,r=arguments.length>3?arguments[3]:void 0,c=new e({id:t,amount:q.empty,type:n,category:"",title:"",createdAt:0,updatedAt:0});return a?c.setAmount(a,r):c}},{key:"create",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:re.Removed,n=arguments.length>1?arguments[1]:void 0,a=arguments.length>2?arguments[2]:void 0,r=Object(Xn.a)(),c=new e({id:r,amount:q.empty,type:t,category:"",title:"",createdAt:0,updatedAt:0});return n?c.setAmount(n,a):c}},{key:"fromJSON",value:function(t){return U.get(e).decode(t)}},{key:"toJSON",value:function(e){return e.toJSON()}}]),Object(V.a)(e,[{key:"toJSON",value:function(){return U.get(e).encode(this)}},{key:"setAmount",value:function(t,n){var a;return a="string"!==typeof t&&"number"!==typeof t||"string"!==typeof n?q.from(t):q.create(t,n),new e(Object(de.a)(Object(de.a)({},this),{},{amount:a}))}},{key:"setType",value:function(t){return new e(Object(de.a)(Object(de.a)({},this),{},{type:t}))}},{key:"setCategory",value:function(t){return new e(Object(de.a)(Object(de.a)({},this),{},{category:t}))}},{key:"setTitle",value:function(t){return new e(Object(de.a)(Object(de.a)({},this),{},{title:t}))}},{key:"setCreatedAt",value:function(t){return new e(Object(de.a)(Object(de.a)({},this),{},{createdAt:t}))}},{key:"setUpdatedAt",value:function(t){return new e(Object(de.a)(Object(de.a)({},this),{},{updatedAt:t}))}}]),e}(),Fn=Object(At.a)(Jn.prototype,"id",[Tn],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return""}}),Un=Object(At.a)(Jn.prototype,"amount",[Dn],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return q.empty}}),Hn=Object(At.a)(Jn.prototype,"type",[Cn],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return re.Removed}}),Rn=Object(At.a)(Jn.prototype,"category",[zn],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return""}}),Wn=Object(At.a)(Jn.prototype,"title",[Bn],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return""}}),Yn=Object(At.a)(Jn.prototype,"createdAt",[Vn],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),Gn=Object(At.a)(Jn.prototype,"updatedAt",[Ln],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),Pn=Jn))||Pn),Fa=(ra=R((function(e){return new Fa(e)})),ca=W(String),ia=W(Sn),oa=W([Ja]),ra((ua=function(){function e(t){Object(B.a)(this,e),Object(_t.a)(this,"date",la,this),Object(_t.a)(this,"summary",da,this),Object(_t.a)(this,"transactions",ma,this),this.dateTime=new Date,Object.assign(this,t),this.dateTime=function(e){var t=e.match(/^(\d{4})-(\d{2})-(\d{2})$/);if(!t)throw new Error('Invalid DayDate "'.concat(e,'"'));var n=+t[1],a=+t[2]-1,r=+t[3],c=new Date(n,a,r,12,0,0);if(c.getFullYear()!==n)throw new Error('Invalid year in "'.concat(e,'"'));if(c.getMonth()!==a)throw new Error('Invalid month in "'.concat(e,'"'));if(c.getDate()!==r)throw new Error('Invalid date in "'.concat(e,'"'));return c}(this.date)}return Object(V.a)(e,null,[{key:"create",value:function(t){return new e({date:t})}},{key:"fromJSON",value:function(t){return U.get(e).decode(t)}}]),Object(V.a)(e,[{key:"toJSON",value:function(){return U.get(e).encode(this)}},{key:"addTransaction",value:function(t){var n=[].concat(Object(k.a)(this.transactions),[t]),a=Kn(n);return new e(Object(de.a)(Object(de.a)({},this),{},{summary:a,transactions:n}))}}]),e}(),la=Object(At.a)(ua.prototype,"date",[ca],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return""}}),da=Object(At.a)(ua.prototype,"summary",[ia],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return An}}),ma=Object(At.a)(ua.prototype,"transactions",[oa],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),sa=ua))||sa),Ua=n(372),Ha=(fa=R((function(e){return new Ha(e)})),ha=W(String),pa=W(Number),ba=W(String),ga=W(String),va=W(Number),ya=W([String]),Oa=W([String]),ja=W(String),wa=W(Number),Ea=W(_n),xa=W([Fa]),ka=W(Number),fa((Sa=function(){function e(t){Object(B.a)(this,e),Object(_t.a)(this,"id",_a,this),Object(_t.a)(this,"version",Aa,this),Object(_t.a)(this,"account",Ia,this),Object(_t.a)(this,"month",Ma,this),Object(_t.a)(this,"syncStatus",Ta,this),Object(_t.a)(this,"prevMonths",Da,this),Object(_t.a)(this,"prevVersions",Ca,this),Object(_t.a)(this,"dataHash",za,this),Object(_t.a)(this,"timestamp",Ba,this),this.updatedAt=new Date(0),Object(_t.a)(this,"summary",Va,this),Object(_t.a)(this,"days",La,this),Object(_t.a)(this,"daysInMonth",Pa,this),Object.assign(this,t),this.dataHash=this.getDataHash(),this.id=e.generateID(this,this.dataHash)}return Object(V.a)(e,[{key:"toJSON",value:function(){return U.get(e).encode(this)}}],[{key:"createFirstBlock",value:function(t,n,a){return new e({timestamp:a,account:t,month:n,daysInMonth:Object(Ua.a)(na(n)),days:[],syncStatus:En.Fixed})}},{key:"generateID",value:function(e,t){if(1!==e.version)throw new Error("Version ".concat(e.version," not supported"));var n={version:e.version,account:e.account,prevMonths:e.prevMonths,prevVersions:e.prevVersions,dataHash:t||e.getDataHash()},a=Qn()(JSON.stringify(n)).toString(),r=na(e.month),c=(12*(r.getFullYear()-1970)+r.getMonth()).toString(16).padStart(3,"0"),i=(e.timestamp/1e3).toString(16).substr(0,11).replace(".",""),o="".concat(c).concat(i).concat(a).substr(0,32);return o=[o.substr(0,8),o.substr(8,4),o.substr(12,4),o.substr(16,4),o.substr(20,12)].join("-")}},{key:"merge",value:function(e,t){throw new Error}},{key:"getBrief",value:function(e){return{id:e.id,month:e.month,summary:e.summary,prevMonths:e.prevMonths,prevVersions:e.prevVersions,dataHash:e.dataHash}}},{key:"fromJSON",value:function(t){return U.get(e).decode(t)}}]),Object(V.a)(e,[{key:"getBrief",value:function(){return e.getBrief(this)}},{key:"getDataHash",value:function(){if(!this.days.length)return"0000000000000000000000000000000000000000";var e={days:this.days.map((function(e){return e.toJSON()}))};return Qn()(JSON.stringify(e)).toString()}},{key:"changeSyncStatus",value:function(t){if(t===this.syncStatus)return this;switch(this.syncStatus){case En.NoSynced:if(t===En.Prepared)return new e(Object(de.a)(Object(de.a)({},this),{},{syncStatus:t}));break;case En.Prepared:if(t===En.Syncing)return new e(Object(de.a)(Object(de.a)({},this),{},{syncStatus:t}));break;case En.Syncing:if(t===En.FullySynced)return new e(Object(de.a)(Object(de.a)({},this),{},{syncStatus:t}));break;case En.FullySynced:}throw new Error('Can not change sync status from "'.concat(En[this.syncStatus],'" to "').concat(En[t],'"'))}},{key:"createDay",value:function(e){if("number"===typeof e)return Fa.create(this.createDayDate(e));if(e.substr(0,7)===this.month)return Fa.create(e);throw new Error('Date "'.concat(e,'" not of month "').concat(this.month,'"'))}},{key:"createDayDate",value:function(e){return this.month+"-"+e.toString().padStart(2,"0")}},{key:"createNextBlock",value:function(t,n){var a=Object(Ua.a)(na(t)),r={balanceOnStart:this.summary.balanceOnEnd,income:q.empty,expense:q.empty,balanceOnEnd:this.summary.balanceOnEnd,balance:q.empty};return new e({account:this.account,month:t,prevMonths:[this.id],prevVersions:[],timestamp:n,summary:r,days:[],daysInMonth:a,syncStatus:En.Fixed})}},{key:"isDateOfMonth",value:function(e){return e.substr(0,7)===this.month}},{key:"recalculateWithNewStartBalance",value:function(t){return new e(Object(de.a)(Object(de.a)({},this),{},{summary:Ra(t,this.days)}))}},{key:"updatePrevMonths",value:function(t,n){var a=this;if(1!==t.length)throw new Error("Sorry, can not process not one prevMonths");if(t[0].month>=this.month)throw new Error("All prevMonths must be earlier then updating month");return t.length===this.prevMonths.length&&t.every((function(e,t){return a.prevMonths[t]===e.id}))?this:new e(Object(de.a)(Object(de.a)({},this),{},{timestamp:n,prevMonths:t.map((function(e){return e.id})),prevVersions:this.syncStatus?this.id?[this.id]:[]:this.prevVersions||[],summary:Ra(q.from(t[0].summary.balanceOnEnd),this.days)}))}},{key:"getDay",value:function(e){return this.days.find((function(t){return t.date===e}))||this.createDay(e)}},{key:"updateDay",value:function(t){if(!(t instanceof Fa))throw new Error("Cannot update month, newDay must be instance of Day");if(!this.isDateOfMonth(t.date))throw new Error('Day "'.concat(t.date,'" not of month "').concat(this.month,'"'));var n=this.days.slice(),a=this.days.findIndex((function(e){return e.date===t.date}));-1===a?(n.push(t),n.sort((function(e,t){return e.date>t.date?1:-1}))):n.splice(a,1,t);var r=Ra(this.summary.balanceOnStart,n);return new e(Object(de.a)(Object(de.a)({},this),{},{syncStatus:En.NoSynced,days:n,summary:r,prevVersions:this.syncStatus?this.id?[this.id]:[]:this.prevVersions||[]}))}}]),e}(),_a=Object(At.a)(Sa.prototype,"id",[ha],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return""}}),Aa=Object(At.a)(Sa.prototype,"version",[pa],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1}}),Ia=Object(At.a)(Sa.prototype,"account",[ba],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return""}}),Ma=Object(At.a)(Sa.prototype,"month",[ga],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return""}}),Ta=Object(At.a)(Sa.prototype,"syncStatus",[va],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return En.NoSynced}}),Da=Object(At.a)(Sa.prototype,"prevMonths",[ya],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),Ca=Object(At.a)(Sa.prototype,"prevVersions",[Oa],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),za=Object(At.a)(Sa.prototype,"dataHash",[ja],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return""}}),Ba=Object(At.a)(Sa.prototype,"timestamp",[wa],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),Va=Object(At.a)(Sa.prototype,"summary",[Ea],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return In}}),La=Object(At.a)(Sa.prototype,"days",[xa],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),Pa=Object(At.a)(Sa.prototype,"daysInMonth",[ka],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),Na=Sa))||Na);function Ra(e,t){var n=t.reduce((function(e,t){return ea(e,t.summary)}),An);return Object(de.a)(Object(de.a)({},n),{},{balanceOnStart:e,balanceOnEnd:e.add(n.balance)})}var Wa=n(52);function Ya(e,t,n){e=Ha.getBrief(e),t=t.map(Ha.getBrief),n=n.map(Ha.getBrief);var a=qa(e,t),r=a.chain,c=a.completed;if(0===n.length){if(c)return r;throw Object(Nn.a)(Cr,Object(k.a)(r.pop().prevMonths))}if(c){if(!Ga(r[r.length-1],n[n.length-1],t))throw new zr(n,r)}else{var i=r[r.length-1].prevMonths[0],o=n.findIndex((function(e){return e.id===i}));if(console.log("completed",c),console.log("preFirstIndex",o),console.log("head",[e.month,e.id,e.prevMonths,e.prevVersions].join(" ")),console.log("adds"),console.log(t.map((function(e){return[e.month,e.id,e.prevMonths,e.prevVersions].join(" ")}))),console.log("old chain"),console.log(n.map((function(e){return[e.month,e.id,e.prevMonths,e.prevVersions].join(" ")}))),-1===o)throw new Cr(i)}var s=new Set;n.forEach((function(e){return s.add(e.month)})),r.forEach((function(e){return s.add(e.month)}));var u=Array.from(s.keys());u.sort();var l=u.map((function(e){var a=r.find((function(t){return t.month===e})),c=n.find((function(t){return t.month===e})),i=a?Ga(a,c,t):null;if(!1===i)throw new zr(n,r);return{month:e,oldEl:c,element:a,check:i}}));console.log("table"),console.table(l),l.reverse();var d=l.map((function(e){return e.element||e.oldEl}));if(function(e){if(0===e.length)return!1;console.log("check chain"),console.table(e);for(var t=0;t<e.length-1;t++){var n=e[t],a=e[t+1];if(a.month>=n.month)throw new Dr("month must be less then ".concat(n.month),e,a);if(!n.prevMonths.length)throw new Dr("unexpected end of chain",e,n);if(n.prevMonths.length>1)throw new Dr("can not process month with not 1 prevMonths",e,n);if(n.prevMonths[0]!==a.id)throw new Dr("invalid prevMonth",e,n)}}(d),d[0].id!==e.id)throw new Error("Invalid Head month");return d}function Ga(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[];if(!t)return!0;if(e.month!==t.month)return!1;var a=[t].concat(Object(k.a)(n));if(e.prevVersions.every((function(e,n){return t.prevVersions[n]===e})))return!0;for(var r=function(){if(0===e.prevVersions.length)return{v:!1};if(e.prevVersions.length>1)throw new Error("\u042f \u043d\u0435 \u0443\u043c\u0435\u044e \u0432\u043e \u043c\u043d\u043e\u0433\u043e \u043f\u0440\u0435\u0434\u044b\u0434\u0443\u0449\u0438\u0445 \u043c\u0435\u0441\u044f\u0446\u0435\u0432");var t=e.prevVersions[0],n=a.find((function(e){return e.id===t}));if(!n)throw new Cr(t);e=n};e.id!==t.id;){var c=r();if("object"===typeof c)return c.v}return!0}function qa(e,t){for(var n=[],a=e,r=function(){if(n.push(a),0===a.prevMonths.length)return{v:{completed:!0,chain:n}};if(1!==a.prevMonths.length)throw new Error("Can not process merged month ".concat(a.id," (").concat(a.month,"): more then 1 prevMonths"));if(a.prevVersions.length>1)throw new Error("Can not process merged month ".concat(a.id," (").concat(a.month,"): more then 1 prevVersions"));var e=a.prevMonths[0];return(a=t.find((function(t){return t.id===e})))?void 0:{v:{completed:!1,chain:n}}};;){var c=r();if("object"===typeof c)return c.v}}var Xa,$a,Qa,Za,Ka,er,tr,nr,ar,rr,cr,ir,or,sr,ur,lr,dr,mr,fr,hr,pr,br,gr,vr,yr,Or,jr,wr,Er,xr,kr,Nr,Sr,_r,Ar,Ir,Mr,Tr,Dr=function(e){Object(Nt.a)(n,e);var t=Object(St.a)(n);function n(e,a,r){var c;return Object(B.a)(this,n),(c=t.call(this,"Invalid chain: ".concat(e," at ").concat(r.id," (").concat(r.month,")"))).reason=e,c.chain=a,c.invalidMonth=r,c}return n}(Object(Wa.a)(Error)),Cr=function(e){Object(Nt.a)(n,e);var t=Object(St.a)(n);function n(){var e;Object(B.a)(this,n);for(var a=arguments.length,r=new Array(a),c=0;c<a;c++)r[c]=arguments[c];return(e=t.call(this,"Required months: ".concat(r.join(", ")))).ids=void 0,e.ids=r,e}return n}(Object(Wa.a)(Error)),zr=function(e){Object(Nt.a)(n,e);var t=Object(St.a)(n);function n(e,a){var r;return Object(B.a)(this,n),(r=t.call(this,["Can not fast forward","from ".concat(e[0].id," (").concat(e[0].month,", length ").concat(e.length,")"),"to ".concat(a[0].id," (").concat(a[0].month,", length ").concat(a.length,")")].join("\n"))).from=e,r.to=a,r}return n}(Object(Wa.a)(Error)),Br=(Xa=R((function(e){return new Br(e)})),$a=W(String),Qa=W(String),Za=W(q),Ka=W(q),er=W(q),tr=W(String),nr=W(qn),ar=W([qn]),Xa((cr=function(){function e(t){return Object(B.a)(this,e),Object(_t.a)(this,"id",ir,this),Object(_t.a)(this,"name",or,this),Object(_t.a)(this,"balance",sr,this),Object(_t.a)(this,"income",ur,this),Object(_t.a)(this,"expense",lr,this),Object(_t.a)(this,"categoriesBlockId",dr,this),Object(_t.a)(this,"head",mr,this),Object(_t.a)(this,"months",fr,this),this.fullMonths=Object(fe.a)(),Object.assign(this,t)}return Object(V.a)(e,null,[{key:"create",value:function(t,n){return new e({id:n||Object(Xn.a)(),name:t})}},{key:"fromJSON",value:function(t){return U.get(e).decode(t)}},{key:"toJSON",value:function(e){return e.toJSON()}}]),Object(V.a)(e,[{key:"toJSON",value:function(){return U.get(e).encode(this)}},{key:"UNSAFE_forceSetHead",value:function(t,n){var a=qa(t,n),r=a.chain;if(!a.completed){var c=r.pop(),i=[].concat(Object(k.a)(c.prevMonths),Object(k.a)(c.prevVersions)).filter((function(e){return!n.find((function(t){return t.id!==e}))}));throw Object(Nn.a)(Cr,Object(k.a)(i))}var o=r.reduce((function(e,t){return ea(e,t.summary)}),Zn),s=o.income,u=o.expense,l=o.balance;return new e(Object(de.a)(Object(de.a)({},this),{},{head:t,months:r.map(Ha.getBrief),balance:l,income:s,expense:u}))}},{key:"updateHead",value:function(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],a=Ya(t,n,this.months),r=a.reduce((function(e,t){return ea(e,t.summary)}),Zn),c=r.income,i=r.expense,o=r.balance;return new e(Object(de.a)(Object(de.a)({},this),{},{head:Ha.getBrief(t),months:a.map(Ha.getBrief),balance:o,income:c,expense:i}))}},{key:"UNSAFE_updateCategoriesBlock",value:function(t){if(t.account!==this.id)throw new Error("CategoriesBlock.id must be equal to Account.id");return new e(Object(de.a)(Object(de.a)({},this),{},{categoriesBlockId:t.id}))}},{key:"checkChain",value:function(){if(!this.head&&0===this.months.length)return!0;var e=qa(this.head,this.months),t=e.chain;return!!e.completed&&t.length===this.months.length}}]),e}(),ir=Object(At.a)(cr.prototype,"id",[$a],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return""}}),or=Object(At.a)(cr.prototype,"name",[Qa],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return""}}),sr=Object(At.a)(cr.prototype,"balance",[Za],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return q.empty}}),ur=Object(At.a)(cr.prototype,"income",[Ka],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return q.empty}}),lr=Object(At.a)(cr.prototype,"expense",[er],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return q.empty}}),dr=Object(At.a)(cr.prototype,"categoriesBlockId",[tr],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return"default"}}),mr=Object(At.a)(cr.prototype,"head",[nr],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),fr=Object(At.a)(cr.prototype,"months",[ar],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),rr=cr))||rr),Vr=(hr=R((function(e){return new Vr(e)})),pr=W(String),br=W(String),gr=W(Number),vr=W(Number),yr=W(String),Or=W(Number),jr=W([String]),wr=W([Mt]),hr((xr=function(){function e(t){Object(B.a)(this,e),Object(_t.a)(this,"id",kr,this),Object(_t.a)(this,"account",Nr,this),Object(_t.a)(this,"version",Sr,this),Object(_t.a)(this,"syncStatus",_r,this),Object(_t.a)(this,"dataHash",Ar,this),Object(_t.a)(this,"timestamp",Ir,this),Object(_t.a)(this,"prevVersions",Mr,this),this.updatedAt=new Date(0),Object(_t.a)(this,"list",Tr,this),Object.assign(this,t),this.dataHash=e.getDataHash(this),this.id=e.generateID(this,this.dataHash),this.updatedAt=new Date(this.timestamp)}return Object(V.a)(e,null,[{key:"createInitialBlock",value:function(t,n,a){var r=n.flatMap((function(e){return[Mt.createInitial(e.name,e.defaultType,null,e.image,e.id)].concat(Object(k.a)(e.children.map((function(t){return Mt.createInitial(t.name,t.defaultType,e.id,t.image,t.id)}))))}));return new e({account:t,syncStatus:En.Prepared,timestamp:a,prevVersions:[],list:r})}},{key:"getDataHash",value:function(e){if(!e.list.length)return"0000000000000000000000000000000000000000";var t={list:e.list.map((function(e){return e.toJSON()}))};return Qn()(JSON.stringify(t)).toString()}},{key:"generateID",value:function(t,n){if(1!==t.version)throw new Error("Version ".concat(t.version," not supported"));if(n||(n=e.getDataHash(t)),"0000000000000000000000000000000000000000"===n)return"00000000-0000-0000-0000-000000000000";var a={version:t.version,account:t.account,prevVersions:t.prevVersions,dataHash:n},r=Qn()(JSON.stringify(a)).toString(),c="".concat(r).substr(0,32);return c=[c.substr(0,8),c.substr(8,4),c.substr(12,4),c.substr(16,4),c.substr(20,12)].join("-")}},{key:"merge",value:function(e){throw new Error("Not implemented")}},{key:"fromJSON",value:function(t){return U.get(e).decode(t)}},{key:"toJSON",value:function(e){return e.toJSON()}}]),Object(V.a)(e,[{key:"toJSON",value:function(){return U.get(e).encode(this)}},{key:"get",value:function(e){return this.list.find((function(t){return t.id===e}))}},{key:"getList",value:function(e){return e?this.list.filter((function(t){return t.parent===e})):this.list}},{key:"changeSyncStatus",value:function(t){if(t===this.syncStatus)return this;switch(this.syncStatus){case En.NoSynced:if(t===En.Prepared)return new e(Object(de.a)(Object(de.a)({},this),{},{syncStatus:t}));break;case En.Prepared:if(t===En.Syncing)return new e(Object(de.a)(Object(de.a)({},this),{},{syncStatus:t}));break;case En.Syncing:if(t===En.FullySynced)return new e(Object(de.a)(Object(de.a)({},this),{},{syncStatus:t}));break;case En.FullySynced:}throw new Error('Can not change sync status from "'.concat(En[this.syncStatus],'" to "').concat(En[t],'"'))}},{key:"addCategory",value:function(t){var n=this.list.find((function(e){return e.id===t.id}));if(n)throw new Lr("Category with this ID already exists",this,t);if(n=this.list.find((function(e){return e.name.toLowerCase()===t.name.toLowerCase()})))throw new Lr("Category with this Name already exists",this,t);return new e(Object(de.a)(Object(de.a)({},this),{},{syncStatus:En.NoSynced,list:[].concat(Object(k.a)(this.list),[t])}))}},{key:"updateCategory",value:function(t){if(this.list.find((function(e){return e.name.toLowerCase()===t.name.toLowerCase()&&e.id!==t.id})))throw new Lr('Category with name "'.concat(t.name,'" already exists'));if(!this.list.find((function(e){return e.id===t.id})))throw new Error('Category "'.concat(t.name,'" (').concat(t.id,") not found"));return new e(Object(de.a)(Object(de.a)({},this),{},{syncStatus:En.NoSynced,list:this.list.map((function(e){return e.id===t.id?t:e}))}))}},{key:"removeCategory",value:function(t){var n=this.list.find((function(e){return e.id===t}));if(!n)throw new Error("Category ".concat(t," not found"));return new e(Object(de.a)(Object(de.a)({},this),{},{syncStatus:En.NoSynced,list:this.list.filter((function(e){return e!==n}))}))}}]),e}(),kr=Object(At.a)(xr.prototype,"id",[pr],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return""}}),Nr=Object(At.a)(xr.prototype,"account",[br],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return""}}),Sr=Object(At.a)(xr.prototype,"version",[gr],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1}}),_r=Object(At.a)(xr.prototype,"syncStatus",[vr],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return En.NoSynced}}),Ar=Object(At.a)(xr.prototype,"dataHash",[yr],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return""}}),Ir=Object(At.a)(xr.prototype,"timestamp",[Or],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),Mr=Object(At.a)(xr.prototype,"prevVersions",[jr],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),Tr=Object(At.a)(xr.prototype,"list",[wr],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Er=xr))||Er),Lr=function(e){Object(Nt.a)(n,e);var t=Object(St.a)(n);function n(e,a,r){var c;return Object(B.a)(this,n),(c=t.call(this,e)).block=a,c.category=r,c}return n}(Object(Wa.a)(Error)),Pr=[{id:"default",name:"Default",image:"default",defaultType:re.Expense,children:[]},{id:"0000-111",name:"Home",image:"default",defaultType:re.Income,children:[]}],Jr={collection:"categories",dbVersion:1,key:"id",upgrade:function(e,t,n){console.log("update categories from ",t,n)}},Fr=new wn("finman",[Jr,xn,kn],function(){var e=Object(yn.a)(vn.a.mark((function e(t){var n,a;return vn.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=Br.create("Default"),a=Vr.createInitialBlock(n.id,Pr,(new Date).getTime()),n=n.UNSAFE_updateCategoriesBlock(a),e.next=5,t.transaction(xn).add(n.toJSON());case 5:return e.next=7,t.transaction(Jr).add(a.toJSON());case 7:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),Ur={};function Hr(e,t){if(Ur[e.getType()])throw new Error('Can not add new handler for action "'.concat(e.getType(),'"'));Ur[e.getType()]=t}Hr(ft,(function(e){localStorage.setItem("currentAccount",e)})),Hr(ht,(function(e,t){Fr.transaction(xn).getAll().then((function(e){if(!e.length)return console.warn("No accounts exists");var n=e.map(Br.fromJSON),a=localStorage.getItem("currentAccount");t.dispatch(pt({accounts:n})),t.dispatch(pe(a))}),(function(e){return t.dispatch(bt(e))}))})),Hr(gt,(function(e,t){Fr.transaction(xn).update(e.toJSON()).then((function(n){return t.dispatch(vt(e.id))}),(function(n){return t.dispatch(yt({id:e.id,error:n}))}))})),Hr(Ee,(function(e,t){Fr.transaction(kn).getAll(e).then((function(n){console.log(e),console.log(n);var a=n.map(Ha.fromJSON);t.dispatch(xe(a))}),(function(n){return t.dispatch(ke({ids:e,error:n}))}))})),Hr(Ne,(function(e,t){var n=e.map((function(e){return e.id})),a=Fr.transaction(kn);Promise.all(e.map((function(e){return a.update(e.toJSON())}))).then((function(){return t.dispatch(Se(n))}),(function(e){return t.dispatch(_e({ids:n,error:e}))}))})),Hr(wt,(function(e,t){Fr.transaction(Jr).get(e).then((function(e){return t.dispatch(Et(Vr.fromJSON(e)))}),(function(e){return t.dispatch(xt(e))}))}));var Rr=n(123),Wr=n(16),Yr=new(function(){function e(){Object(B.a)(this,e),this.sagas=[]}return Object(V.a)(e,[{key:"register",value:function(e){this.sagas.push(e)}},{key:"onAction",value:function(e,t){arguments.length>2&&void 0!==arguments[2]&&arguments[2];this.register(vn.a.mark((function n(){return vn.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,Object(Wr.f)(e.getType(),t);case 2:case"end":return n.stop()}}),n)})))}},{key:"start",value:function(e){console.log("Start ".concat(this.sagas.length," sagas"));var t={dispatch:e.dispatch,getState:function(){return e.getState},channel:Object(Rr.b)()};e.subscribe(t.channel.put),this.sagas.forEach((function(e){return Object(Rr.a)(t,e)}))}}]),e}());var Gr={call:function(e){var t=vn.a.mark((function t(){var n,a,r,c=arguments;return vn.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:for(n=c.length,a=new Array(n),r=0;r<n;r++)a[r]=c[r];return t.next=3,Wr.a.apply(void 0,[e].concat(a));case 3:return t.abrupt("return",t.sent);case 4:case"end":return t.stop()}}),t)}));return t.originalSaga=e,t}},qr=vn.a.mark(Xr);function Xr(e){var t,n;return vn.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("*** refreshSaga started"),e.next=3,Object(Wr.c)(ht());case 3:return e.next=5,Object(Wr.e)([pt.getType(),bt.getType()]);case 5:if((t=e.sent).type!==bt.getType()){e.next=8;break}return e.abrupt("return");case 8:return n=t.payload.accounts,e.next=11,Object(Wr.c)(ve(n));case 11:case"end":return e.stop()}}),qr)}Yr.onAction(dt,Xr);var $r=n(93),Qr=vn.a.mark(ec),Zr={selectAtom:Gr.call(ec),getTimestamp:Gr.call(nc)},Kr=function(e){return Object(Wr.a)(ec,e)};function ec(e){return vn.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,Object(Wr.d)((function(t){return t(e)}));case 2:return t.abrupt("return",t.sent);case 3:case"end":return t.stop()}}),Qr)}var tc=function(){return Object(Wr.a)(nc)};function nc(){return(new Date).getTime()}var ac=vn.a.mark(cc),rc={get:Gr.call(cc)};function cc(e){var t,n,a,r;return vn.a.wrap((function(c){for(;;)switch(c.prev=c.next){case 0:return c.next=2,Kr(Dt);case 2:if(!(n=c.sent).has(e)){c.next=5;break}return c.abrupt("return",null===(t=n.get(e))||void 0===t?void 0:t.block);case 5:return c.next=7,Object(Wr.c)(wt(e));case 7:return c.next=9,Object(Wr.e)([Et.getType(),xt.getType()]);case 9:if((a=c.sent).type!==Et.getType()){c.next=18;break}if(a.payload.id!==e){c.next=16;break}return c.next=14,Kr(Dt);case 14:return r=c.sent,c.abrupt("return",r.get(e));case 16:c.next=20;break;case 18:if(a.payload.id!==e){c.next=20;break}throw a.payload.error;case 20:c.next=7;break;case 21:case"end":return c.stop()}}),ac)}var ic,oc=n(95),sc=function e(t,n){Object(B.a)(this,e),this.id=void 0,this.name=void 0,this.categories=Object(fe.a)(),this.firstMonthDate=null,this.lastMonthDate=null,this.months=[],this.tags=Object(fe.a)(),this.balance=q.empty,this.expense=q.empty,this.income=q.empty,this.categories=n};ic=Symbol.toStringTag;var uc=function e(t,n,a){Object(B.a)(this,e),this.id=void 0,this.balance=void 0,this.balanceOnEnd=void 0,this.balanceOnStart=void 0,this.categories=void 0,this.days=void 0,this.expense=void 0,this.income=void 0,this.month=void 0,this.tags=void 0,this[ic]="AbstractMonthGrip",this.month=t,a.length&&a.reduce((function(e,t){if(e.date>=t.date)throw new Error("Days must be sorted");return t})),this.days=a;var r=Object(fe.a)();Object(fe.a)();this.days.forEach((function(e){return e.categories.forEach((function(e){return r=r.set(e.id,e)}))})),this.categories=r,this.balanceOnStart=n,this.balanceOnEnd=this.days.reduce((function(e,t){var n=e.add(t.balance);if(!t.balanceOnStart.equal(e))throw new Error("Start balance on day ".concat(t.date," must be ").concat(e," but received ").concat(t.balanceOnStart));if(!t.balanceOnEnd.equal(n))throw new Error("End balance on day ".concat(t.date," must be ").concat(n," but received ").concat(t.balanceOnEnd));if(!t.balance.equal(t.balanceOnEnd.sub(t.balanceOnStart)))throw new Error("Balance on day ".concat(t.date," must be ").concat(t.balanceOnEnd.sub(t.balanceOnStart)," but received ").concat(t.balance));return n}),this.balanceOnStart),this.balance=this.balanceOnEnd.sub(this.balanceOnStart),this.income=this.days.reduce((function(e,t){return e.add(t.income)}),q.empty),this.expense=this.days.reduce((function(e,t){return e.add(t.expense)}),q.empty)},lc=function e(t){Object(B.a)(this,e),this.account=void 0,this.amount=void 0,this.category=void 0,this.changeAmount=void 0,this.createdAt=void 0,this.date=void 0,this.sourceTxs=void 0,this.tags=void 0,this.title=void 0,this.type=void 0,this.updatedAt=void 0,Object.assign(this,t)},dc=function(e){Object(Nt.a)(n,e);var t=Object(St.a)(n);function n(e,a,r,c){Object(B.a)(this,n);var i=a.transactions.map((function(e){var t=c.get(e.category||"default");if(!t)throw new Error('Category "'.concat(e.category||"default",'" not found'));var n={account:r,amount:e.amount,changeAmount:e.amount,title:e.title,type:e.type,category:t,createdAt:e.createdAt?new Date(e.createdAt):null,updatedAt:e.updatedAt?new Date(e.updatedAt):null,date:a.date,sourceTxs:[e],tags:Object(fe.b)()};switch(e.type){case re.Income:return n;case re.Expense:return Object(de.a)(Object(de.a)({},n),{},{changeAmount:e.amount.negative()});default:throw new Error('Unsupported type "'.concat(re[e.type],'"'))}}));return t.call(this,a.date,e,i)}return n}((function e(t,n,a){Object(B.a)(this,e),this.balance=void 0,this.balanceOnEnd=void 0,this.balanceOnStart=void 0,this.categories=void 0,this.date=void 0,this.expense=void 0,this.income=void 0,this.tags=void 0,this.transactions=void 0,this.date=t,this.transactions=a.map((function(e){return new lc(e)}));var r=Object(fe.a)();Object(fe.a)();this.transactions.forEach((function(e){r=r.set(e.category.id,e.category)})),this.categories=r,this.balanceOnStart=n,this.balance=this.transactions.reduce((function(e,t){return e.add(t.changeAmount)}),q.empty),this.balanceOnEnd=this.balanceOnStart.add(this.balance),this.income=this.transactions.filter((function(e){return e.changeAmount.isPositive()})).reduce((function(e,t){return e.add(t.changeAmount)}),q.empty),this.expense=this.transactions.filter((function(e){return e.changeAmount.isNegative()})).reduce((function(e,t){return e.add(t.changeAmount)}),q.empty).negative()})),mc=function(e){Object(Nt.a)(n,e);var t=Object(St.a)(n);function n(e,a,r,c){var i;Object(B.a)(this,n);var o=a.days.reduce((function(e,t){var n=e.days,a=e.balanceOnEnd,i=new dc(a,t,r,c);return n.push(i),{days:n,balanceOnEnd:i.balanceOnEnd}}),{days:[],balanceOnEnd:e}),s=o.days,u=o.balanceOnEnd;if((i=t.call(this,a.month,e,s)).id=a.id,!i.balanceOnEnd.equal(u))throw new Error("Wrong balance on end: expected ".concat(u," but received ").concat(i.balanceOnEnd));return i}return n}(uc),fc=function(e){Object(Nt.a)(n,e);var t=Object(St.a)(n);function n(e,a){var r;Object(B.a)(this,n);var c=Object(fe.a)(a.list.map((function(e){return[e.id,e]})));return(r=t.call(this,[e],c)).account=void 0,r.id=e.id,r.account=e,r.name=e.name,e.head?(r.lastMonthDate=e.head.month,r.firstMonthDate=e.months[e.months.length-1].month,r.months=e.months.map(hc),r.balance=e.head.summary.balanceOnEnd,r.income=q.empty,r.expense=q.empty,r):Object(oc.a)(r)}return Object(V.a)(n,[{key:"makeMonth",value:function(e){return new mc(e.summary.balanceOnStart,e,this.account,this.categories)}}]),n}(sc);function hc(e){return{id:e.id,month:e.month,balanceOnStart:e.summary.balanceOnStart,balanceOnEnd:e.summary.balanceOnEnd,balance:e.summary.balance,income:e.summary.income,expense:e.summary.expense,categories:Object(fe.a)(),tags:Object(fe.a)()}}var pc=vn.a.mark(gc),bc=vn.a.mark(vc);function gc(e){var t,n,a,r;return vn.a.wrap((function(c){for(;;)switch(c.prev=c.next){case 0:console.log("*** updateAccountGripsSaga started"),t=e.payload,n=Object($r.a)(t),c.prev=3,n.s();case 5:if((a=n.n()).done){c.next=11;break}return r=a.value,c.next=9,Object(Wr.b)(vc,be(r));case 9:c.next=5;break;case 11:c.next=16;break;case 13:c.prev=13,c.t0=c.catch(3),n.e(c.t0);case 16:return c.prev=16,n.f(),c.finish(16);case 19:case"end":return c.stop()}}),pc,null,[[3,13,16,19]])}function vc(e){var t,n,a;return vn.a.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return t=e.payload,console.log("*** updateAccountGripSaga started for account ".concat(t.name)),r.delegateYield(rc.get(t.categoriesBlockId),"t0",3);case 3:return n=r.t0,console.log("loadCategories",n),a=new fc(t,n),r.next=8,Object(Wr.c)(ge(a));case 8:case"end":return r.stop()}}),bc)}Yr.onAction(ve,gc),Yr.onAction(be,vc);var yc=vn.a.mark(Ec),Oc=vn.a.mark(xc),jc=vn.a.mark(kc),wc={get:Gr.call(xc),getByIds:Gr.call(Ec),save:Gr.call(kc)};function Ec(e){var t,n,a,r;return vn.a.wrap((function(c){for(;;)switch(c.prev=c.next){case 0:return c.next=2,Kr(jt);case 2:if(t=c.sent,console.log(t),n=e.filter((function(e){return!t.has(e)}))){c.next=7;break}return c.abrupt("return",e.map((function(e){return t.get(e)})));case 7:return c.next=9,Object(Wr.c)(Ee(n));case 9:return c.next=11,Object(Wr.e)([xe,ke]);case 11:if((a=c.sent).type!==xe.getType()){c.next=20;break}if(!a.payload.every((function(e,t){return e.id===n[t]}))){c.next=18;break}return c.delegateYield(vn.a.mark((function t(){var n;return vn.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,Kr(jt);case 2:return n=t.sent,t.abrupt("return",{v:e.map((function(e){return n.get(e)}))});case 4:case"end":return t.stop()}}),t)}))(),"t0",15);case 15:if("object"!==typeof(r=c.t0)){c.next=18;break}return c.abrupt("return",r.v);case 18:c.next=22;break;case 20:if(!a.payload.ids.every((function(e,t){return e===n[t]}))){c.next=22;break}throw a.payload.error;case 22:c.next=9;break;case 23:case"end":return c.stop()}}),yc)}function xc(e,t){var n,a,r,c,i,o,s,u,l,d,m,f,h,p,b,g,v,y;return vn.a.wrap((function(O){for(;;)switch(O.prev=O.next){case 0:if(e.head){O.next=6;break}return O.next=3,tc();case 3:return n=O.sent,console.log("timestamp",n),O.abrupt("return",Ha.createFirstBlock(e.id,t,n));case 6:if(!(t>e.head.month)){O.next=15;break}return O.delegateYield(wc.getByIds([e.head.id]),"t0",8);case 8:return a=O.t0,r=Object(F.a)(a,1),c=r[0],O.next=13,tc();case 13:return i=O.sent,O.abrupt("return",c.createNextBlock(t,i));case 15:if(!((o=e.months.findIndex((function(e){return e.month===t})))>-1)){O.next=21;break}return s=e.months.slice(0,o+1).map((function(e){return e.id})),O.delegateYield(wc.getByIds(s),"t1",19);case 19:return u=O.t1,O.abrupt("return",u.pop());case 21:l=[],d=0;case 23:if(!(d<e.months.length)){O.next=31;break}if(m=e.months[d],l.push(m.id),!(m.month<t)){O.next=28;break}return O.abrupt("break",31);case 28:d++,O.next=23;break;case 31:return O.delegateYield(wc.getByIds(l),"t2",32);case 32:return f=O.t2,h=[],O.delegateYield(Zr.getTimestamp(),"t3",35);case 35:for(p=O.t3,b=f.pop(),g=b=b.createNextBlock(t,p),h.push(b),v=f.pop();v;v=f.pop())y=v.updatePrevMonths([b],p),h.push(y),b=y;return O.delegateYield(wc.save(h),"t4",41);case 41:return O.abrupt("return",g);case 42:case"end":return O.stop()}}),Oc)}function kc(e){var t,n;return vn.a.wrap((function(a){for(;;)switch(a.prev=a.next){case 0:return a.next=2,Object(Wr.c)(Ne(e));case 2:t=vn.a.mark((function t(){var n;return vn.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,Object(Wr.e)([Se.getType(),_e.getType()]);case 2:if(n=t.sent,console.log(n),n.type!==Se.getType()){t.next=9;break}if(!e.every((function(e,t){return n.payload[t]===e.id}))){t.next=7;break}return t.abrupt("return",{v:void 0});case 7:t.next=15;break;case 9:if(n.type!==_e.getType()){t.next=14;break}if(!e.every((function(e,t){return n.payload.ids[t]===e.id}))){t.next=12;break}throw n.payload.error;case 12:t.next=15;break;case 14:console.error("invalid action "+n.type,n);case 15:case"end":return t.stop()}}),t)}));case 3:return a.delegateYield(t(),"t0",4);case 4:if("object"!==typeof(n=a.t0)){a.next=7;break}return a.abrupt("return",n.v);case 7:a.next=3;break;case 9:case"end":return a.stop()}}),jc)}var Nc=vn.a.mark(Mc),Sc=vn.a.mark(Tc),_c=vn.a.mark(Dc),Ac=vn.a.mark(Cc),Ic={select:Gr.call(Mc),getGrip:Gr.call(Tc),update:Gr.call(Dc),save:Gr.call(Cc)};function Mc(e){var t,n;return vn.a.wrap((function(a){for(;;)switch(a.prev=a.next){case 0:return a.next=2,Object(Wr.d)((function(e){return e(Ot)}));case 2:if(t=a.sent,n=t.accounts.get(e)){a.next=6;break}throw new Error('Account "'.concat(e,'" not found'));case 6:return a.abrupt("return",n);case 7:case"end":return a.stop()}}),Nc)}function Tc(e){var t,n;return vn.a.wrap((function(a){for(;;)switch(a.prev=a.next){case 0:return a.next=2,Object(Wr.d)((function(e){return e(Oe)}));case 2:if(t=a.sent,n=t.accounts.get(e)){a.next=6;break}throw new Error('AccountGrip "'.concat(e,'" not found'));case 6:return a.abrupt("return",n);case 7:case"end":return a.stop()}}),Sc)}function Dc(e,t){var n,a,r,c,i,o,s,u,l,d,m,f,h,p,b;return vn.a.wrap((function(g){for(;;)switch(g.prev=g.next){case 0:if(console.log("*** updateAccountSaga"),console.log(e.months.map((function(e){return e.month}))),console.log(t.month,t.id),r=e.months.findIndex((function(e){return e.month===t.month})),c=e.months.findIndex((function(e){return e.month<t.month})),e.head){g.next=10;break}return g.delegateYield(wc.save([t]),"t0",7);case 7:return i=e.updateHead(t),g.delegateYield(Ic.save(i),"t1",9);case 9:return g.abrupt("return",i);case 10:if(o=-1===r?c:r,s=e.months.slice(0,o+1).map((function(e){return e.id})),u=[t],console.log(s),!s.length){g.next=22;break}return g.t2=u.push,g.t3=u,g.t4=k.a,g.delegateYield(wc.getByIds(s),"t5",19);case 19:g.t6=g.t5,g.t7=(0,g.t4)(g.t6),g.t2.apply.call(g.t2,g.t3,g.t7);case 22:return g.delegateYield(Zr.getTimestamp(),"t8",23);case 23:if(l=g.t8,console.log({currentMonthIndex:r,prevMonthIndex:c,toIndex:o,additions:u.map((function(e){return[e.month+" "+e.id]})),months:e.months.slice(0,o+1).map((function(e){return e.month}))}),d=[t],console.log("additional"),console.log(u.map((function(e){return"".concat(e.month," ").concat(e.id)}))),console.log("chain"),console.log(e.months.map((function(e){return"".concat(e.month," ").concat(e.id)}))),console.log("prevMonthIndex",c,null===(n=e.months[c])||void 0===n?void 0:n.month),-1!==r||-1!==c){g.next=33;break}throw new Error("Unexpection");case 33:if(-1!==r||-1===c){g.next=37;break}r=c,g.next=42;break;case 37:if((m=e.months[r]).month===t.month){g.next=40;break}throw new Error("somethings wrong");case 40:if(Ga(t,m)){g.next=42;break}throw new Error("somethings wrong");case 42:if(console.log("currentMonthIndex",r,null===(a=e.months[r])||void 0===a?void 0:a.month),-1===r){g.next=52;break}for(f=t,h=function(t){console.log("index",t,e.months[t].month);var n=e.months[t].id,a=u.find((function(e){return e.id===n}));if(!a)throw new Cr(n);f=a.updatePrevMonths([f],l),u.push(f),d.push(f)},p=r-1;p>=0;p--)h(p);return console.log("additionalMonths",u.map((function(e){return[e.month+" "+e.id]}))),b=e.updateHead(f,u),g.delegateYield(wc.save(d),"t9",50);case 50:return g.delegateYield(Ic.save(b),"t10",51);case 51:return g.abrupt("return",b);case 52:throw new Error("may be first");case 53:case"end":return g.stop()}}),_c)}function Cc(e){var t;return vn.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,Object(Wr.c)(gt(e));case 2:return n.next=4,Object(Wr.e)([vt,yt]);case 4:if((t=n.sent).type!==vt.getType()){n.next=10;break}if(t.payload!==e.id){n.next=8;break}return n.abrupt("return");case 8:n.next=12;break;case 10:if(t.payload.id!==e.id){n.next=12;break}throw t.payload.error;case 12:n.next=2;break;case 14:case"end":return n.stop()}}),Ac)}var zc=vn.a.mark(Vc),Bc=vn.a.mark(Lc);function Vc(e){var t,n,a,r;return vn.a.wrap((function(c){for(;;)switch(c.prev=c.next){case 0:console.log("update Month grips saga"),t=e.payload,n=Object($r.a)(t),c.prev=3,n.s();case 5:if((a=n.n()).done){c.next=11;break}return r=a.value,c.next=9,Object(Wr.b)(Lc,r);case 9:c.next=5;break;case 11:c.next=16;break;case 13:c.prev=13,c.t0=c.catch(3),n.e(c.t0);case 16:return c.prev=16,n.f(),c.finish(16);case 19:case"end":return c.stop()}}),zc,null,[[3,13,16,19]])}function Lc(e){var t,n;return vn.a.wrap((function(a){for(;;)switch(a.prev=a.next){case 0:return console.log("update Month grip saga for ".concat(e.month)),console.log("123456"),a.delegateYield(Ic.getGrip(e.account),"t0",3);case 3:return t=a.t0,console.log("123"),n=t.makeMonth(e),console.log("234"),a.next=9,Object(Wr.c)(Fe(n));case 9:console.log("345");case 10:case"end":return a.stop()}}),Bc)}Yr.onAction(xe,Vc);var Pc=vn.a.mark(Jc);function Jc(e){var t,n,a,r,c,i,o;return vn.a.wrap((function(s){for(;;)switch(s.prev=s.next){case 0:return console.log("*** addTransactionSaga started"),t=e.payload,s.delegateYield(Ic.select(t.account),"t0",3);case 3:return n=s.t0,s.delegateYield(wc.get(n,aa(t.date)),"t1",5);case 5:return a=s.t1,console.log("addTransactionSaga",a.id,a.prevVersions),r=Ja.create(t.type,t.amount,"RUB"),t.title&&(r=r.setTitle(t.title)),t.category&&(r=r.setCategory(t.category)),c=a.getDay(t.date).addTransaction(r),i=a.updateDay(c),console.log("updatedMonth",i.id,i.prevVersions),s.delegateYield(Ic.update(n,i),"t2",14);case 14:return o=s.t2,console.log("*** addTransactionSaga complete"),s.next=18,Object(Wr.c)(be(o));case 18:return s.abrupt("return",o);case 19:case"end":return s.stop()}}),Pc)}Yr.onAction(zt,Jc);var Fc=vn.a.mark(Uc);function Uc(){var e;return vn.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:console.log("init transactionUpdateSaga");case 1:return t.next=4,Object(Wr.e)(pt.getType());case 4:e=t.sent,console.log("load successssssss",e),t.next=1;break;case 8:case"end":return t.stop()}}),Fc)}Yr.register(Uc);var Hc,Rc=function(){return function(e){console.log("useDBReady");var t=function(t){console.log(bn[t]),t===bn.Ready&&e()};Object(a.useEffect)((function(){return Fr.addStatusListener(t),function(){return Fr.removeStatusListener(t)}}))}(Object(o.b)((function(){var e;return console.log("*** refreshAllHandler"),(e=Ct).subscribe((function(t){console.log(t),Ur[t.type]&&Ur[t.type](t.payload,e)})),console.log("*** refreshAllHandler complete"),dt()}),[])),r.a.createElement("div",{className:u.a.App},r.a.createElement(d.a,null,r.a.createElement(l.d,null,dn.map((function(e,t){return r.a.createElement(l.b,Object.assign({},e,{key:t}))})),r.a.createElement(l.a,{to:on.home()})),r.a.createElement(pn,null)))};(Hc=Ct).dispatch(lt(navigator.onLine)),window.addEventListener("online",(function(){return Hc.dispatch(lt(!0))})),window.addEventListener("offline",(function(){return Hc.dispatch(lt(!1))})),Yr.start(Ct);Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));i.a.render(r.a.createElement(r.a.StrictMode,null,r.a.createElement(o.a.Provider,{value:Ct},r.a.createElement(Rc,null))),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()})).catch((function(e){console.error(e.message)}))},41:function(e,t,n){e.exports={head:"MonthViewWidget_head__2tdqX",title:"MonthViewWidget_title__2uHWT",info:"MonthViewWidget_info__ltwmS",circle:"MonthViewWidget_circle__19VOB",balance:"MonthViewWidget_balance__qUNX4"}},47:function(e,t,n){e.exports={txList:"TxList_txList__3rowt",txItem:"TxList_txItem__2-7sR",txItem__left:"TxList_txItem__left__3Dekh",txItem__first:"TxList_txItem__first__eF_WE",txItem__second:"TxList_txItem__second__-lQ89",txItem__amount:"TxList_txItem__amount__2PbUA",txItem__date:"TxList_txItem__date__3uUSP",empty:"TxList_empty__2S-7j"}},54:function(e,t,n){e.exports={moneyView:"MoneyView_moneyView__2U7sP",fractional:"MoneyView_fractional__1hdQj"}},66:function(e,t,n){e.exports={swipeWidget:"SwipeWidget_swipeWidget__12ZdL",prev:"SwipeWidget_prev__UDZne",next:"SwipeWidget_next__1huSl",swipe:"SwipeWidget_swipe__1ww0t","swipe-wrap":"SwipeWidget_swipe-wrap__x4MEz",swipeItem:"SwipeWidget_swipeItem__2D3OP"}},96:function(e,t,n){e.exports={days:"MonthTxList_days__1hzzo",day:"MonthTxList_day__1_h7Y",title:"MonthTxList_title__VajvW"}},97:function(e,t,n){e.exports={page:"TransactionsPage_page__1uE4j",filter:"TransactionsPage_filter__3x4B8",active:"TransactionsPage_active__3XoOk"}}},[[194,3,4]]]);
//# sourceMappingURL=main.971b47bb.chunk.js.map