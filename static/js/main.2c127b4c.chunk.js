(this.webpackJsonpfinman=this.webpackJsonpfinman||[]).push([[0],{138:function(e,t,n){e.exports={App:"App_App__15LM-","App-logo":"App_App-logo__1GLNd","App-logo-spin":"App_App-logo-spin__1EbLw","App-header":"App_App-header__3nnPn","App-link":"App_App-link__TRj1P"}},139:function(e,t,n){e.exports={currentAccount:"AccountsPage_currentAccount__3IcrQ"}},142:function(e,t,n){e.exports={bottomNavigation:"NavBar_bottomNavigation__hEWk4"}},145:function(e,t,n){e.exports=n(248)},150:function(e,t,n){},161:function(e,t){},163:function(e,t){},173:function(e,t){},175:function(e,t){},203:function(e,t){},204:function(e,t){},248:function(e,t,n){"use strict";n.r(t);var a,r=n(0),o=n.n(r),c=n(137),i=n.n(c),s=n(20),u=(n(150),n(138)),l=n.n(u),d=n(7),h=n(30),m=n(53),f=n.n(m),p=function(e){var t=e.money;return o.a.createElement("div",{className:f.a.moneyView},o.a.createElement("span",{className:f.a.entire},t.getEntire()),o.a.createElement("span",{className:f.a.fractional},t.getFractional()),o.a.createElement("span",{className:f.a.currency},t.getSymbol()))},v=n(139),b=n.n(v),y=n(3),g=n(8),w=n(35),O="accounts",E=Object(g.c)(O+":chooseAccount"),j=Object(g.c)(O+":loadAccounts"),x=Object(g.c)(O+":loadAccounts success"),k=Object(g.c)(O+":loadAccounts failed"),S=Object(g.c)(O+":saveAccounts"),_=Object(g.c)(O+":saveAccounts success"),N=Object(g.c)(O+":saveAccounts failed"),M=Object(g.d)(["accounts"],{current:null,accounts:Object(w.a)()},(function(e){return{choose:[e(E,(function(e,t){var n=e.accounts.get(t);return n?Object(y.a)(Object(y.a)({},e),{},{current:n}):e}))],load:[e(x,(function(e,t){var n=t.map((function(e){return[e.id,e]}));return{current:t[0]||null,accounts:Object(w.a)(n)}}))],save:[e(S,(function(e,t){var n;return{accounts:e.accounts.set(t.id,t),current:t.id===(null===(n=e.current)||void 0===n?void 0:n.id)?t:e.current}}))]}})),A=Object(g.c)("months:loadMonths"),I=Object(g.c)("months:loadMonths success"),D=Object(g.c)("months:loadMonths failed"),J=Object(g.c)("months:saveMonths"),V=Object(g.c)("months:saveMonths success"),T=Object(g.c)("months:saveMonths failed"),B=Object(g.d)(["months"],Object(w.a)(),(function(e){return{load:[e(I,(function(e,t){return t.reduce((function(e,t){return e.set(t.id,t)}),e)}))],save:[e(J,(function(e,t){return t.reduce((function(e,t){return e.set(t.id,t)}),e)}))]}})),L=n(63),P=n.n(L),F=n(28),C=n.n(F);!function(e){e[e.Removed=0]="Removed",e[e.Income=1]="Income",e[e.Expense=2]="Expense",e[e.Adjust=3]="Adjust",e[e.AdjustTo=4]="AdjustTo"}(a||(a={}));var U=n(62);var H=o.a.memo((function(e){var t=function(e,t){return e.map((function(e){var n;switch(e.type){case a.Income:n=e.amount;break;case a.Expense:n=e.amount.negative();break;default:throw new Error("Unprocessed TxType "+a[e.type])}return{first:e.category,second:e.title,amount:n,date:t?Object(U.a)(new Date(t),"PP"):""}}))}(e.list,e.dayDate);return o.a.createElement("ul",{className:C.a.txList},t.map((function(e,t){return o.a.createElement("li",{key:t,className:C.a.txItem},o.a.createElement("div",{className:C.a.txItem__left},o.a.createElement("div",{className:C.a.txItem__first},e.first?e.first:o.a.createElement("span",{className:C.a.empty},"\u0411\u0435\u0437 \u0437\u0430\u0433\u043e\u043b\u043e\u0432\u043a\u0430")),o.a.createElement("div",{className:C.a.txItem__second},e.second?e.second:o.a.createElement("span",{className:C.a.empty},"\u0411\u0435\u0437 \u0437\u0430\u0433\u043e\u043b\u043e\u0432\u043a\u0430"))),o.a.createElement("div",{className:C.a.txItem__right},o.a.createElement("div",{className:C.a.txItem__amount},o.a.createElement(p,{money:e.amount})),o.a.createElement("div",{className:C.a.txItem__date},e.date)))})))})),R=o.a.memo((function(e){var t=e.month.days;return o.a.createElement("ul",{className:P.a.days},t.map((function(e){return o.a.createElement("li",{key:e.date,className:P.a.day},o.a.createElement("div",{className:P.a.title},(t=e.date,Object(U.a)(new Date(t),"do LLLL"))),o.a.createElement(H,{list:e.transactions,dayDate:e.date}));var t})))}));var Y=n(33),W=n.n(Y),q=function(e){var t=e.months,n=e.account,a=e.brief,r=e.prev,c=e.next;if(!a)return o.a.createElement("div",null,"No month");if(!t.has(a.id))return o.a.createElement("div",null,"Loading month");var i=t.get(a.id);return i?o.a.createElement(o.a.Fragment,null,o.a.createElement("div",{className:W.a.head},o.a.createElement("h3",{className:W.a.title},Object(U.a)(new Date(i.month),"MMMM yyyy")),o.a.createElement("div",{className:W.a.info},r&&o.a.createElement(h.b,{className:W.a.prev,to:me.account.months(n.id,r.month)},o.a.createElement("svg",{width:"24",height:"24",xmlns:"http://www.w3.org/2000/svg","fill-rule":"evenodd","clip-rule":"evenodd"},o.a.createElement("path",{d:"M20 .755l-14.374 11.245 14.374 11.219-.619.781-15.381-12 15.391-12 .609.755z"}))),c&&o.a.createElement(h.b,{className:W.a.next,to:me.account.months(n.id,c.month)},o.a.createElement("svg",{width:"24",height:"24",xmlns:"http://www.w3.org/2000/svg","fill-rule":"evenodd","clip-rule":"evenodd"},o.a.createElement("path",{d:"M4 .755l14.374 11.245-14.374 11.219.619.781 15.381-12-15.391-12-.609.755z"}))),o.a.createElement("div",{className:W.a.circle},o.a.createElement("h4",{className:W.a.balance},o.a.createElement(p,{money:i.summary.balance})),o.a.createElement("div",null,"+",o.a.createElement(p,{money:i.summary.income})),o.a.createElement("div",null,"-",o.a.createElement(p,{money:i.summary.expense}))))),o.a.createElement(R,{month:i})):o.a.createElement("div",null,"Loading month")},z=n(85),Q=n.n(z),X=function(e){var t=e.title;return o.a.createElement("header",{className:Q.a.header},o.a.createElement("h1",{className:Q.a.title},t))},$=function(){var e=Object(d.i)().params,t=Object(s.c)(M,(function(t){return t.accounts.get(e.account)}),[e.account]),n=Object(s.c)(B),a=Object(s.b)((function(e){return e?A([e]):null}),[]);if(!t)return o.a.createElement("div",null,"No account");if(!t.months.length)return o.a.createElement("div",null,"No months in this account");var r=e.month||t.head.month||"",c=t.months.findIndex((function(e){return e.month===r}));-1===c&&(c=0);var i=t.months[c],u=t.months[c+1],l=t.months[c-1];return i&&!n.has(i.id)&&a(i.id),u&&!n.has(u.id)&&a(u.id),l&&!n.has(l.id)&&a(l.id),o.a.createElement(o.a.Fragment,null,o.a.createElement(X,{title:"Account ".concat(t.name)}),o.a.createElement("main",null,o.a.createElement(q,{months:n,account:t,brief:i,prev:u,next:l})))};var G={list:function(){return"".concat("","/accounts")},view:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:":account";return"".concat("","/account/").concat(e)},monthsList:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:":account";return"".concat("","/account/").concat(e,"/months")},months:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:":account",t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:":month";return"".concat("","/account/").concat(e,"/months/").concat(t)}},K=[{path:G.list(),exact:!0,component:function(){var e=Object(d.g)(),t=Object(s.c)(M),n=Array.from(t.accounts.values()),a=Object(s.b)((function(t){e.push(me.account.view(t))}),[]);return o.a.createElement("div",null,"\u0421\u0442\u0440\u0430\u043d\u0438\u0446\u0430 \u0441 \u0438\u043d\u0444\u043e\u0440\u043c\u0430\u0446\u0438\u0435\u0439 \u043e\u0431\u043e \u0432\u0441\u0435\u0445 \u0430\u043a\u043a\u0430\u0443\u043d\u0442\u0430\u0445 (\u043a\u043e\u0448\u0435\u043b\u044c\u043a\u0430\u0445)",n.map((function(e){return o.a.createElement("div",{className:e===t.current?b.a.currentAccount:"",key:e.id,onClick:function(){return a(e.id)}},o.a.createElement("h3",null,e.name),o.a.createElement("h4",null,o.a.createElement(p,{money:e.balance})))})),o.a.createElement("button",{onClick:function(){t.current&&e.push(me.transactions.add({account:t.current.id}))}},"Add"))}},{path:G.view(),exact:!0,component:function(){var e=Object(s.c)(M),t=Object(d.i)(),n=e.accounts.get(t.params.account);return n?o.a.createElement("div",null,"AccountMonthsPage",o.a.createElement("div",null,o.a.createElement("h3",null,n.name),o.a.createElement("h4",null,o.a.createElement(p,{money:n.balance})),o.a.createElement("div",null,"+",o.a.createElement(p,{money:n.income})),o.a.createElement("div",null,"-",o.a.createElement(p,{money:n.expense})),o.a.createElement(h.b,{to:me.account.monthsList(n.id)},"Show history"))):o.a.createElement("div",null,"No account")}},{path:G.months(),component:$},{path:G.monthsList(),component:$}],Z=n(26),ee=n(141),te=Object(g.c)("client:setOnlineStatus"),ne=Object(g.c)("client:refresh",(function(e,t){(0,t.dispatch)(j())})),ae=Object(g.d)(["client"],{online:!1},(function(e){return{online:[e(te,(function(e,t){return Object(y.a)(Object(y.a)({},e),{},{online:t})}))]}})),re=Object(g.b)(Object(g.a)({Client:ae,Accounts:M,Months:B}));Object(ee.a)(re);var oe=Object(g.c)("transaction:addTransaction"),ce=n(64),ie=n.n(ce),se=[{id:1},{id:2},{id:2},{id:2},{id:2},{id:2},{id:2},{id:2},{id:2},{id:2},{id:2},{id:2},{id:2},{id:2},{id:2},{id:2},{id:2},{id:2},{id:2},{id:2},{id:2},{id:2},{id:2},{id:2},{id:2},{id:2},{id:2},{id:2},{id:2},{id:2},{id:2},{id:2},{id:2},{id:2},{id:2},{id:2},{id:2},{id:2},{id:2},{id:2},{id:2},{id:2},{id:2},{id:2},{id:2},{id:2},{id:2},{id:2},{id:2},{id:2},{id:2},{id:2},{id:2},{id:2},{id:2},{id:2},{id:2},{id:2},{id:2},{id:2},{id:2},{id:2},{id:2},{id:2},{id:2},{id:2}],ue={add:function(e){return"".concat("","/transaction/add")+function(e){return e&&Object.keys(e).length?"?"+new URLSearchParams(e).toString():""}(e)},list:function(){return"".concat("","/transactions")}},le=[{path:ue.add(),component:function(){var e=new URLSearchParams(Object(d.h)().search),t=Object(r.useState)("123"),n=Object(Z.a)(t,2),c=n[0],i=n[1],s=Object(r.useState)("2020-06-12"),u=Object(Z.a)(s,2),l=u[0],h=u[1],m=Object(r.useState)(a.Expense),f=Object(Z.a)(m,2),p=f[0],v=f[1],b=Object(r.useState)(e.get("account")||""),y=Object(Z.a)(b,2),g=y[0],w=(y[1],function(e){v(+e.target.value)});return o.a.createElement("div",null,"add transaction",o.a.createElement("form",{onSubmit:function(e){e.preventDefault();var t={account:g,amount:c,date:l,category:"",title:"",type:p};console.log(t),re.dispatch(oe(t))}},o.a.createElement("div",null,"Amount:",o.a.createElement("input",{type:"number",value:c,onChange:function(e){i(e.target.value)}})),o.a.createElement("div",null,"Date:",o.a.createElement("input",{type:"date",value:l,onChange:function(e){h(e.target.value)},list:"datalist"}),o.a.createElement("datalist",{id:"datalist"},o.a.createElement("option",{value:"2020-06-12",label:"Today"}),o.a.createElement("option",{value:"2020-06-11",label:"Yesterday"}))),o.a.createElement("div",null,"Type:",o.a.createElement("input",{type:"radio",id:"type-income",onChange:w,checked:p===a.Income,name:"type",value:a.Income}),o.a.createElement("label",{htmlFor:"type-income"},"Income"),o.a.createElement("input",{type:"radio",id:"type-expense",checked:p===a.Expense,onChange:w,name:"type",value:a.Expense}),o.a.createElement("label",{htmlFor:"type-expense"},"Expense")),o.a.createElement("div",null,"Account:",o.a.createElement("input",{type:"text",value:g,onChange:function(e){v(+e.target.value)}})),o.a.createElement("div",null,o.a.createElement("button",{type:"submit"},"Add"))),o.a.createElement("pre",null,"amount: ",c),o.a.createElement("pre",null,"date: ",l),o.a.createElement("pre",null,"type: ",p))}},{path:ue.list(),component:function(){return o.a.createElement("div",{className:ie.a.page},o.a.createElement(X,{title:"Transactions of ".concat("2020-05")}),o.a.createElement("main",null,o.a.createElement("div",{className:ie.a.filter},o.a.createElement("button",{className:ie.a.active},"\u0412\u0441\u0435"),o.a.createElement("button",null,"\u0422\u0440\u0430\u0442\u044b"),o.a.createElement("button",null,"\u041f\u0440\u0438\u0445\u043e\u0434")),o.a.createElement(H,{list:se,dayDate:"2020-05-05"})))}}],de=n(18),he=[].concat(Object(de.a)(K),Object(de.a)(le)),me={account:G,transactions:ue,home:function(){return"".concat("","/accounts")}},fe=n(142),pe=n.n(fe),ve=function(){return o.a.createElement("nav",{className:pe.a.bottomNavigation},o.a.createElement("ul",null,o.a.createElement("li",null,o.a.createElement(h.b,{to:me.home()},"Home")),o.a.createElement("li",null,o.a.createElement(h.b,{to:me.transactions.list},"Transactions"))))};var be,ye=n(14),ge=n(12);function we(e,t,n){Array.isArray(n)?n.forEach((function(n){return we(e,t,n)})):e.addEventListener(n,(function(e){console.log('[eventLogger] Emitter: "'.concat(t,'", event "').concat(n,'":'),e)}))}!function(e){e[e.Initializing=0]="Initializing",e[e.Upgrading=1]="Upgrading",e[e.Ready=2]="Ready",e[e.Failed=3]="Failed"}(be||(be={}));var Oe=function(){function e(t,n){Object(ye.a)(this,e),this.db=t,this.scheme=n,this.transaction=void 0,this.storage=void 0,this.transaction=t.transaction(n.collection,"readwrite"),we(this.transaction,"transaction",["abort","complete","error"]),this.storage=this.transaction.objectStore(n.collection)}return Object(ge.a)(e,[{key:"add",value:function(e,t){return new Promise((function(e,t){}))}},{key:"get",value:function(e){var t=this;return new Promise((function(n,a){var r=t.storage.get(e);we(r,"request",["error","success"]),r.onsuccess=function(e){return n(e.target.result)},r.onerror=function(e){return a(e)}}))}},{key:"getAll",value:function(e,t){var n=this;return Array.isArray(e)?Promise.all(e.map((function(e){return n.get(e)}))):new Promise((function(t,a){var r=n.storage.getAll(e);we(r,"request",["error","success"]),r.onsuccess=function(e){return t(e.target.result)},r.onerror=function(e){return a(e)}}))}},{key:"update",value:function(e){var t=this;return new Promise((function(n,a){var r=t.storage.put(e);we(r,"request",["error","success"]),r.onsuccess=function(e){return n(e.target.result)},r.onerror=function(e){return a(e)}}))}}]),e}(),Ee=function(){function e(t,n){if(Object(ye.a)(this,e),this.schemes=n,this.listeners=[],this._status=be.Initializing,this.db=null,!window.indexedDB)throw new Error("IndexedDB not supported");var a=Math.max.apply(Math,[1].concat(Object(de.a)(n.map((function(e){return e.dbVersion})))));console.log("Start DB with version: ".concat(a,", count of models: ").concat(n.length)),this.openDB(t,a).then((function(){return console.log("Successfully open DB")}),(function(e){return console.error("Failed to open DB",e)}))}return Object(ge.a)(e,[{key:"status",get:function(){return this._status}}]),Object(ge.a)(e,[{key:"transaction",value:function(e){if(this._status!==be.Ready)throw new Error("Database not ready");return this.getAccessor(e)}},{key:"addStatusListener",value:function(e){this.listeners.push(e)}},{key:"removeStatusListener",value:function(e){this.listeners=this.listeners.filter((function(t){return t!==e}))}},{key:"setStatus",value:function(e){e!==this._status&&(console.log('Change DB status from "'.concat(be[this._status],'" to "').concat(be[e],'"')),this._status=e,this.listeners.forEach((function(t){return t(e)})))}},{key:"getAccessor",value:function(e){if(this.db)return new Oe(this.db,e);throw new Error("Cannot create accessor for closed database")}},{key:"openDB",value:function(e,t){var n=this;return this.setStatus(be.Initializing),new Promise((function(a,r){var o=window.indexedDB.open(e,t);we(o,"openRequest",["upgradeneeded","blocked","error","success"]),o.addEventListener("upgradeneeded",(function(e){n.setStatus(be.Upgrading);var t=e.oldVersion,a=e.newVersion;t?console.log("Upgrade DB from version ".concat(t)):console.log("Initialize DB");var r=n.db=e.target.transaction;console.log(r);var o=n.db=e.target.result;console.log(Array.from(o.objectStoreNames)),n.schemes.forEach((function(e){var n;try{n=r.objectStore(e.collection)}catch(c){console.warn(c),n=o.createObjectStore(e.collection,{keyPath:e.key})}console.log(n),e.upgrade&&e.upgrade(n,t,a)}))})),o.addEventListener("success",(function(e){n.db=e.target.result,n.setStatus(be.Ready),a()})),o.addEventListener("error",(function(e){console.log(e),n.setStatus(be.Failed),r(e)}))}))}}]),e}();var je={RUB:{code:"RUB",symbol:"\u20bd",precision:2}},xe=function(){function e(t,n){Object(ye.a)(this,e),this.subunits=t,this.currency=n,this.amount="",this.amount=(t/Math.pow(10,n.precision)).toFixed(2)}return Object(ge.a)(e,null,[{key:"from",value:function(t){if("string"===typeof t)return e.fromJSON(t);if(t instanceof e)return t.clone();throw new Error("Can not convert invalid data to Money")}},{key:"fromJSON",value:function(t){if("string"!==typeof t)throw new Error('Amount "'.concat(t,'" must be a string'));var n=t.trim().split(" ");if(!n||2!==n.length)throw new Error('Money "'.concat(t,'" must have valid format'));var a=n[0],r=n[1].toUpperCase(),o=je[r];if(!o)throw new Error('Unsupported currency "'.concat(r,'"'));var c=+a;if(Number.isNaN(c))throw new Error('Invalid amount "'.concat(a,'" when parse "').concat(t,'"'));var i=Math.round(c*Math.pow(10,o.precision));(i/Math.pow(10,o.precision)).toFixed(2);return new e(i,o)}},{key:"create",value:function(t,n){if("string"!==typeof n)throw new Error('Invalid currency "'.concat(n,'"'));if(n=n.toUpperCase(),"string"===typeof t){if(!t||Number.isNaN(+t))throw new Error('Amount must be valid number but received "'.concat(t,'"'));t=+t}var a=je[n];if(!a)throw new Error('Unsupported currency "'.concat(n,'"'));var r=+t;if(Number.isNaN(r))throw new Error('Invalid amount "'.concat(t,'"'));return new e(Math.round(r*Math.pow(10,a.precision)),a)}}]),Object(ge.a)(e,[{key:"clone",value:function(){return new e(this.subunits,this.currency)}},{key:"toString",value:function(){return this.subunits?this.amount+" "+this.currency.symbol:"0 "+this.currency.symbol}},{key:"toJSON",value:function(){return this.subunits?this.amount+" "+this.currency.code:"0 "+this.currency.code}},{key:"add",value:function(t){if(this.currency.code!==t.currency.code)throw new Error("Can not do any operations with different currencies");return new e(this.subunits+t.subunits,this.currency)}},{key:"sub",value:function(t){if(this.currency.code!==t.currency.code)throw new Error("Can not do any operations with different currencies");return new e(this.subunits-t.subunits,this.currency)}},{key:"equal",value:function(e){return this.currency.code===e.currency.code&&this.subunits===e.subunits}},{key:"getEntire",value:function(){return Math.floor(this.subunits/Math.pow(10,this.currency.precision)).toString()}},{key:"getFractional",value:function(){return(this.subunits/Math.pow(10,this.currency.precision)).toFixed(this.currency.precision).substr(-this.currency.precision)}},{key:"getSymbol",value:function(){return this.currency.symbol}},{key:"negative",value:function(){return new e(-this.subunits,this.currency)}}]),e}();xe.empty=xe.create(0,"RUB");var ke,Se=n(250),_e=n(86),Ne=n.n(_e),Me={balance:xe.empty,income:xe.empty,expense:xe.empty},Ae=Object(y.a)(Object(y.a)({},Me),{},{balanceOnStart:xe.empty,balanceOnEnd:xe.empty});Object.freeze(Me),Object.freeze(Ae),function(e){e[e.NoSynced=0]="NoSynced",e[e.Prepared=1]="Prepared",e[e.Syncing=2]="Syncing",e[e.FullySynced=3]="FullySynced",e[e.Fixed=4]="Fixed"}(ke||(ke={}));var Ie={income:xe.empty,expense:xe.empty,balance:xe.empty};function De(e){var t=e.reduce((function(e,t){var n=Object(Z.a)(e,2),r=n[0],o=n[1];switch(t.type){case a.Removed:return[r,o];case a.Income:return[r,o.add(t.amount)];case a.Expense:return[r.add(t.amount),o];default:throw new Error("Can't process type \"".concat(a[t.type],'"'))}}),[xe.empty,xe.empty]),n=Object(Z.a)(t,2),r=n[0],o=n[1];return{balance:o.sub(r),expense:r,income:o}}function Je(e,t){var n=e.balance.add(t.balance),a=e.expense.add(t.expense),r=e.income.add(t.income);if(!r.sub(a).equal(n)){if(!Ve(e))throw new Error('"Base" summary invalid');if(!Ve(t))throw new Error('"Add" summary invalid');throw new Error("Incorrect balance")}return{balance:n,expense:a,income:r}}function Ve(e){return e.income.sub(e.expense).equal(e.balance)}function Te(e){var t=e.match(/^(\d{4})-(\d{2})$/);if(!t)throw new Error('Invalid MonthDate "'.concat(e,'"'));var n=+t[1],a=+t[2]-1,r=new Date(n,a,1,12,0,0);if(r.getFullYear()!==n)throw new Error('Invalid year in "'.concat(e,'"'));if(r.getMonth()!==a)throw new Error('Invalid month in "'.concat(e,'"'));return r}function Be(e){return e.split("-",2).join("-")}var Le=function(){function e(t){Object(ye.a)(this,e),this.id="",this.amount=xe.empty,this.type=a.Removed,this.category="",this.title="",this.createdAt=0,this.updatedAt=0,Object.assign(this,t)}return Object(ge.a)(e,null,[{key:"createWithID",value:function(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:a.Removed,r=arguments.length>2?arguments[2]:void 0,o=arguments.length>3?arguments[3]:void 0,c=new e({id:t,amount:xe.empty,type:n,category:"",title:"",createdAt:0,updatedAt:0});return r?c.setAmount(r,o):c}},{key:"create",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:a.Removed,n=arguments.length>1?arguments[1]:void 0,r=arguments.length>2?arguments[2]:void 0,o=Object(Se.a)(),c=new e({id:o,amount:xe.empty,type:t,category:"",title:"",createdAt:0,updatedAt:0});return n?c.setAmount(n,r):c}},{key:"fromJSON",value:function(t){return new e({id:t.id,amount:xe.from(t.amount),type:t.type,category:t.category,title:t.title,createdAt:t.createdAt,updatedAt:t.updatedAt})}}]),Object(ge.a)(e,[{key:"toJSON",value:function(){return{id:this.id,amount:this.amount.toJSON(),type:this.type,category:this.category,title:this.title,createdAt:this.createdAt,updatedAt:this.updatedAt}}},{key:"setAmount",value:function(t,n){var a;return a="string"!==typeof t&&"number"!==typeof t||"string"!==typeof n?xe.from(t):xe.create(t,n),new e(Object(y.a)(Object(y.a)({},this),{},{amount:a}))}},{key:"setType",value:function(t){return new e(Object(y.a)(Object(y.a)({},this),{},{type:t}))}},{key:"setCategory",value:function(t){return new e(Object(y.a)(Object(y.a)({},this),{},{category:t}))}},{key:"setTitle",value:function(t){return new e(Object(y.a)(Object(y.a)({},this),{},{title:t}))}},{key:"setCreatedAt",value:function(t){return new e(Object(y.a)(Object(y.a)({},this),{},{createdAt:t}))}},{key:"setUpdatedAt",value:function(t){return new e(Object(y.a)(Object(y.a)({},this),{},{updatedAt:t}))}}]),e}(),Pe=function(){function e(t){Object(ye.a)(this,e),this.date="",this.dateTime=new Date,this.summary=Me,this.transactions=[],Object.assign(this,t),this.dateTime=function(e){var t=e.match(/^(\d{4})-(\d{2})-(\d{2})$/);if(!t)throw new Error('Invalid DayDate "'.concat(e,'"'));var n=+t[1],a=+t[2]-1,r=+t[3],o=new Date(n,a,r,12,0,0);if(o.getFullYear()!==n)throw new Error('Invalid year in "'.concat(e,'"'));if(o.getMonth()!==a)throw new Error('Invalid month in "'.concat(e,'"'));if(o.getDate()!==r)throw new Error('Invalid date in "'.concat(e,'"'));return o}(this.date)}return Object(ge.a)(e,null,[{key:"create",value:function(t){return new e({date:t})}},{key:"fromJSON",value:function(t){return new e({date:t.date,summary:{balance:xe.fromJSON(t.summary.balance),income:xe.fromJSON(t.summary.income),expense:xe.fromJSON(t.summary.expense)},transactions:t.transactions.map(Le.fromJSON)})}}]),Object(ge.a)(e,[{key:"toJSON",value:function(){return{date:this.date,summary:{balance:this.summary.balance.toJSON(),income:this.summary.income.toJSON(),expense:this.summary.expense.toJSON()},transactions:this.transactions.map((function(e){return e.toJSON()}))}}},{key:"addTransaction",value:function(t){var n=[].concat(Object(de.a)(this.transactions),[t]),a=De(n);return new e(Object(y.a)(Object(y.a)({},this),{},{summary:a,transactions:n}))}}]),e}(),Fe=n(249),Ce=function(){function e(t){Object(ye.a)(this,e),this.id="",this.version=1,this.account="",this.month="",this.syncStatus=ke.NoSynced,this.prevMonths=[],this.prevVersions=[],this.dataHash="",this.timestamp=0,this.updatedAt=new Date(0),this.summary=Ae,this.days=[],this.daysInMonth=0,Object.assign(this,t),this.dataHash=this.getDataHash(),this.id=e.generateID(this,this.dataHash)}return Object(ge.a)(e,[{key:"toJSON",value:function(){return{id:this.id,version:this.version,account:this.account,month:this.month,syncStatus:this.syncStatus,prevMonths:this.prevMonths,prevVersions:this.prevVersions,dataHash:this.dataHash,timestamp:this.timestamp,updatedAt:this.updatedAt,daysInMonth:this.daysInMonth,summary:{balance:this.summary.balance.toJSON(),income:this.summary.income.toJSON(),expense:this.summary.expense.toJSON(),balanceOnStart:this.summary.balanceOnStart.toJSON(),balanceOnEnd:this.summary.balanceOnEnd.toJSON()},days:this.days.map((function(e){return e.toJSON()}))}}}],[{key:"createFirstBlock",value:function(t,n,a){return new e({timestamp:a,account:t,month:n,daysInMonth:Object(Fe.a)(Te(n)),days:[],syncStatus:ke.Fixed})}},{key:"generateID",value:function(e,t){if(1!==e.version)throw new Error("Version ".concat(e.version," not supported"));var n={version:e.version,account:e.account,prevMonths:e.prevMonths,prevVersions:e.prevVersions,dataHash:t||e.getDataHash()},a=Ne()(JSON.stringify(n)).toString(),r=Te(e.month),o=(12*(r.getFullYear()-1970)+r.getMonth()).toString(16).padStart(3,"0"),c=(e.timestamp/1e3).toString(16).substr(0,11).replace(".",""),i="".concat(o).concat(c).concat(a).substr(0,32);return i=[i.substr(0,8),i.substr(8,4),i.substr(12,4),i.substr(16,4),i.substr(20,12)].join("-")}},{key:"merge",value:function(e,t){throw new Error}},{key:"getBrief",value:function(e){return{id:e.id,month:e.month,summary:e.summary,prevMonths:e.prevMonths,prevVersions:e.prevVersions,dataHash:e.dataHash}}},{key:"fromJSON",value:function(t){return new e({id:t.id,version:t.version,account:t.account,month:t.month,syncStatus:t.syncStatus,prevMonths:t.prevMonths,prevVersions:t.prevVersions,dataHash:t.dataHash,timestamp:t.timestamp,updatedAt:t.updatedAt,daysInMonth:t.daysInMonth,summary:{balance:xe.fromJSON(t.summary.balance),income:xe.fromJSON(t.summary.income),expense:xe.fromJSON(t.summary.expense),balanceOnStart:xe.fromJSON(t.summary.balanceOnStart),balanceOnEnd:xe.fromJSON(t.summary.balanceOnEnd)},days:t.days.map(Pe.fromJSON)})}}]),Object(ge.a)(e,[{key:"getBrief",value:function(){return e.getBrief(this)}},{key:"getDataHash",value:function(){if(!this.days.length)return"0000000000000000000000000000000000000000";var e={days:this.days.map((function(e){return e.toJSON()}))};return Ne()(JSON.stringify(e)).toString()}},{key:"changeSyncStatus",value:function(t){if(t===this.syncStatus)return this;switch(this.syncStatus){case ke.NoSynced:if(t===ke.Prepared)return new e(Object(y.a)(Object(y.a)({},this),{},{syncStatus:t}));break;case ke.Prepared:if(t===ke.Syncing)return new e(Object(y.a)(Object(y.a)({},this),{},{syncStatus:t}));break;case ke.Syncing:if(t===ke.FullySynced)return new e(Object(y.a)(Object(y.a)({},this),{},{syncStatus:t}));break;case ke.FullySynced:}throw new Error('Can not change sync status from "'.concat(ke[this.syncStatus],'" to "').concat(ke[t],'"'))}},{key:"createDay",value:function(e){if("number"===typeof e)return Pe.create(this.createDayDate(e));if(e.substr(0,7)===this.month)return Pe.create(e);throw new Error('Date "'.concat(e,'" not of month "').concat(this.month,'"'))}},{key:"createDayDate",value:function(e){return this.month+"-"+e.toString().padStart(2,"0")}},{key:"createNextBlock",value:function(t,n){var a=Object(Fe.a)(Te(t)),r={balanceOnStart:this.summary.balanceOnEnd,income:xe.empty,expense:xe.empty,balanceOnEnd:this.summary.balanceOnEnd,balance:xe.empty};return new e({account:this.account,month:t,prevMonths:[this.id],prevVersions:[],timestamp:n,summary:r,days:[],daysInMonth:a,syncStatus:ke.Fixed})}},{key:"isDateOfMonth",value:function(e){return e.substr(0,7)===this.month}},{key:"recalculateWithNewStartBalance",value:function(t){return new e(Object(y.a)(Object(y.a)({},this),{},{summary:Ue(t,this.days)}))}},{key:"updatePrevMonths",value:function(t,n){var a=this;if(1!==t.length)throw new Error("Sorry, can not process not one prevMonths");if(t[0].month>=this.month)throw new Error("All prevMonths must be earlier then updating month");return t.length===this.prevMonths.length&&t.every((function(e,t){return a.prevMonths[t]===e.id}))?this:new e(Object(y.a)(Object(y.a)({},this),{},{timestamp:n,prevMonths:t.map((function(e){return e.id})),prevVersions:this.syncStatus?this.id?[this.id]:[]:this.prevVersions||[],summary:Ue(xe.from(t[0].summary.balanceOnEnd),this.days)}))}},{key:"getDay",value:function(e){return this.days.find((function(t){return t.date===e}))||this.createDay(e)}},{key:"updateDay",value:function(t){if(!(t instanceof Pe))throw new Error("Cannot update month, newDay must be instance of Day");if(!this.isDateOfMonth(t.date))throw new Error('Day "'.concat(t.date,'" not of month "').concat(this.month,'"'));var n=this.days.slice(),a=this.days.findIndex((function(e){return e.date===t.date}));-1===a?(n.push(t),n.sort((function(e,t){return e.date>t.date?1:-1}))):n.splice(a,1,t);var r=Ue(this.summary.balanceOnStart,n);return new e(Object(y.a)(Object(y.a)({},this),{},{syncStatus:ke.NoSynced,days:n,summary:r,prevVersions:this.syncStatus?this.id?[this.id]:[]:this.prevVersions||[]}))}}]),e}();function Ue(e,t){var n=t.reduce((function(e,t){return Je(e,t.summary)}),Me);return Object(y.a)(Object(y.a)({},n),{},{balanceOnStart:e,balanceOnEnd:e.add(n.balance)})}var He=function(){function e(t){Object(ye.a)(this,e),this.id="",this.name="",this.balance=xe.empty,this.months=[],this.head=null,this.loaded=!1,Object.assign(this,t);Ce.createFirstBlock("123","2020-10",123151213235)}return Object(ge.a)(e,[{key:"toJSON",value:function(){return{id:this.id,name:this.name,balance:this.balance.toJSON()}}}],[{key:"create",value:function(t){return new e({id:Object(Se.a)(),name:t})}},{key:"fromJSON",value:function(t){return new e({id:t.id,name:t.name,balance:xe.from(t.balance)})}}]),e}(),Re={collection:"subsets",dbVersion:1,key:"id",upgrade:function(e,t,n){console.log("update subsets from ",t,n);var a=He.create("Default");e.add(a.toJSON())}},Ye=n(40),We=n(65),qe=n(66),ze=n(67);function Qe(e,t,n){e=Ce.getBrief(e),t=t.map(Ce.getBrief),n=n.map(Ce.getBrief);var a=$e(e,t),r=a.chain,o=a.completed;if(0===n.length){if(o)return r;throw Object(Ye.a)(Ke,Object(de.a)(r.pop().prevMonths))}if(o){if(!Xe(r[r.length-1],n[n.length-1],t))throw new Ze(n,r)}else{var c=r[r.length-1].prevMonths[0],i=n.findIndex((function(e){return e.id===c}));if(console.log("completed",o),console.log("preFirstIndex",i),console.log("head",[e.month,e.id,e.prevMonths,e.prevVersions].join(" ")),console.log("adds"),console.log(t.map((function(e){return[e.month,e.id,e.prevMonths,e.prevVersions].join(" ")}))),console.log("old chain"),console.log(n.map((function(e){return[e.month,e.id,e.prevMonths,e.prevVersions].join(" ")}))),-1===i)throw new Ke(c)}var s=new Set;n.forEach((function(e){return s.add(e.month)})),r.forEach((function(e){return s.add(e.month)}));var u=Array.from(s.keys());u.sort();var l=u.map((function(e){var a=r.find((function(t){return t.month===e})),o=n.find((function(t){return t.month===e})),c=a?Xe(a,o,t):null;if(!1===c)throw new Ze(n,r);return{month:e,oldEl:o,element:a,check:c}}));console.log("table"),console.table(l),l.reverse();var d=l.map((function(e){return e.element||e.oldEl}));if(function(e){if(0===e.length)return!1;console.log("check chain"),console.table(e);for(var t=0;t<e.length-1;t++){var n=e[t],a=e[t+1];if(a.month>=n.month)throw new Ge("month must be less then ".concat(n.month),e,a);if(!n.prevMonths.length)throw new Ge("unexpected end of chain",e,n);if(n.prevMonths.length>1)throw new Ge("can not process month with not 1 prevMonths",e,n);if(n.prevMonths[0]!==a.id)throw new Ge("invalid prevMonth",e,n)}}(d),d[0].id!==e.id)throw new Error("Invalid Head month");return d}function Xe(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[];if(!t)return!0;if(e.month!==t.month)return!1;var a=[t].concat(Object(de.a)(n));if(e.prevVersions.every((function(e,n){return t.prevVersions[n]===e})))return!0;for(var r=function(){if(0===e.prevVersions.length)return{v:!1};if(e.prevVersions.length>1)throw new Error("\u042f \u043d\u0435 \u0443\u043c\u0435\u044e \u0432\u043e \u043c\u043d\u043e\u0433\u043e \u043f\u0440\u0435\u0434\u044b\u0434\u0443\u0449\u0438\u0445 \u043c\u0435\u0441\u044f\u0446\u0435\u0432");var t=e.prevVersions[0],n=a.find((function(e){return e.id===t}));if(!n)throw new Ke(t);e=n};e.id!==t.id;){var o=r();if("object"===typeof o)return o.v}return!0}function $e(e,t){for(var n=[],a=e,r=function(){if(n.push(a),0===a.prevMonths.length)return{v:{completed:!0,chain:n}};if(1!==a.prevMonths.length)throw new Error("Can not process merged month ".concat(a.id," (").concat(a.month,"): more then 1 prevMonths"));if(a.prevVersions.length>1)throw new Error("Can not process merged month ".concat(a.id," (").concat(a.month,"): more then 1 prevVersions"));var e=a.prevMonths[0];return(a=t.find((function(t){return t.id===e})))?void 0:{v:{completed:!1,chain:n}}};;){var o=r();if("object"===typeof o)return o.v}}var Ge=function(e){Object(We.a)(n,e);var t=Object(qe.a)(n);function n(e,a,r){var o;return Object(ye.a)(this,n),(o=t.call(this,"Invalid chain: ".concat(e," at ").concat(r.id," (").concat(r.month,")"))).reason=e,o.chain=a,o.invalidMonth=r,o}return n}(Object(ze.a)(Error)),Ke=function(e){Object(We.a)(n,e);var t=Object(qe.a)(n);function n(){var e;Object(ye.a)(this,n);for(var a=arguments.length,r=new Array(a),o=0;o<a;o++)r[o]=arguments[o];return(e=t.call(this,"Required months: ".concat(r.join(", ")))).ids=void 0,e.ids=r,e}return n}(Object(ze.a)(Error)),Ze=function(e){Object(We.a)(n,e);var t=Object(qe.a)(n);function n(e,a){var r;return Object(ye.a)(this,n),(r=t.call(this,["Can not fast forward","from ".concat(e[0].id," (").concat(e[0].month,", length ").concat(e.length,")"),"to ".concat(a[0].id," (").concat(a[0].month,", length ").concat(a.length,")")].join("\n"))).from=e,r.to=a,r}return n}(Object(ze.a)(Error)),et=function(){function e(t){return Object(ye.a)(this,e),this.id="",this.name="",this.balance=xe.empty,this.income=xe.empty,this.expense=xe.empty,this.head=null,this.months=[],this.fullMonths=Object(w.a)(),Object.assign(this,t)}return Object(ge.a)(e,null,[{key:"create",value:function(t,n){return new e({id:n||Object(Se.a)(),name:t})}},{key:"fromJSON",value:function(t){return new e({id:t.id,name:t.name,balance:xe.fromJSON(t.balance),income:xe.fromJSON(t.income),expense:xe.fromJSON(t.expense),months:t.months,head:t.head})}}]),Object(ge.a)(e,[{key:"toJSON",value:function(){return{id:this.id,name:this.name,balance:this.balance.toJSON(),income:this.income.toJSON(),expense:this.expense.toJSON(),months:this.months,head:this.head}}},{key:"forceSetHead_unsafe",value:function(t,n){var a=$e(t,n),r=a.chain;if(!a.completed){var o=r.pop(),c=[].concat(Object(de.a)(o.prevMonths),Object(de.a)(o.prevVersions)).filter((function(e){return!n.find((function(t){return t.id!==e}))}));throw Object(Ye.a)(Ke,Object(de.a)(c))}var i=r.reduce((function(e,t){return Je(e,t.summary)}),Ie),s=i.income,u=i.expense,l=i.balance;return new e(Object(y.a)(Object(y.a)({},this),{},{head:t,months:r.map(Ce.getBrief),balance:l,income:s,expense:u}))}},{key:"updateHead",value:function(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],a=Qe(t,n,this.months),r=a.reduce((function(e,t){return Je(e,t.summary)}),Ie),o=r.income,c=r.expense,i=r.balance;return new e(Object(y.a)(Object(y.a)({},this),{},{head:Ce.getBrief(t),months:a.map(Ce.getBrief),balance:i,income:o,expense:c}))}},{key:"checkChain",value:function(){if(!this.head&&0===this.months.length)return!0;var e=$e(this.head,this.months),t=e.chain;return!!e.completed&&t.length===this.months.length}}]),e}(),tt={collection:"accounts",dbVersion:1,key:"id",upgrade:function(e,t,n){console.log("update account from ",t,n);var a=et.create("Default");e.add(a.toJSON())}},nt={collection:"months",dbVersion:1,key:"id",upgrade:function(e,t,n){console.log("update months from ",t,n)}},at=new Ee("test",[Re,tt,nt]);var rt=n(9),ot=n.n(rt),ct=n(88),it=n(17),st=new(function(){function e(){Object(ye.a)(this,e),this.sagas=[]}return Object(ge.a)(e,[{key:"register",value:function(e){this.sagas.push(e)}},{key:"onAction",value:function(e,t){arguments.length>2&&void 0!==arguments[2]&&arguments[2];this.register(ot.a.mark((function n(){return ot.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,Object(it.e)(e.getType(),t);case 2:case"end":return n.stop()}}),n)})))}},{key:"start",value:function(e){console.log("Start ".concat(this.sagas.length," sagas"));var t={dispatch:e.dispatch,getState:function(){return e.getState},channel:Object(ct.b)()};e.subscribe(t.channel.put),this.sagas.forEach((function(e){return Object(ct.a)(t,e)}))}}]),e}());var ut={call:function(e){var t=ot.a.mark((function t(){var n,a,r,o=arguments;return ot.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:for(n=o.length,a=new Array(n),r=0;r<n;r++)a[r]=o[r];return t.next=3,it.a.apply(void 0,[e].concat(a));case 3:return t.abrupt("return",t.sent);case 4:case"end":return t.stop()}}),t)}));return t.originalSaga=e,t}},lt=ot.a.mark(mt),dt={selectAtom:ut.call(mt),getTimestamp:ut.call(pt)},ht=function(e){return Object(it.a)(mt,e)};function mt(e){return ot.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,Object(it.c)((function(t){return t(e)}));case 2:return t.abrupt("return",t.sent);case 3:case"end":return t.stop()}}),lt)}var ft=function(){return Object(it.a)(pt)};function pt(){return(new Date).getTime()}var vt=ot.a.mark(wt),bt=ot.a.mark(Ot),yt=ot.a.mark(Et),gt={get:ut.call(Ot),getByIds:ut.call(wt),save:ut.call(Et)};function wt(e){var t,n,a,r;return ot.a.wrap((function(o){for(;;)switch(o.prev=o.next){case 0:return o.next=2,ht(B);case 2:if(t=o.sent,console.log(t),n=e.filter((function(e){return!t.has(e)}))){o.next=7;break}return o.abrupt("return",e.map((function(e){return t.get(e)})));case 7:return o.next=9,Object(it.b)(A(n));case 9:return o.next=11,Object(it.d)([I,D]);case 11:if((a=o.sent).type!==I.getType()){o.next=20;break}if(!a.payload.every((function(e,t){return e.id===n[t]}))){o.next=18;break}return o.delegateYield(ot.a.mark((function t(){var n;return ot.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,ht(B);case 2:return n=t.sent,t.abrupt("return",{v:e.map((function(e){return n.get(e)}))});case 4:case"end":return t.stop()}}),t)}))(),"t0",15);case 15:if("object"!==typeof(r=o.t0)){o.next=18;break}return o.abrupt("return",r.v);case 18:o.next=22;break;case 20:if(!a.payload.ids.every((function(e,t){return e===n[t]}))){o.next=22;break}throw a.payload.error;case 22:o.next=9;break;case 23:case"end":return o.stop()}}),vt)}function Ot(e,t){var n,a,r,o,c,i,s,u,l,d,h,m,f,p,v,b,y,g;return ot.a.wrap((function(w){for(;;)switch(w.prev=w.next){case 0:if(e.head){w.next=6;break}return w.next=3,ft();case 3:return n=w.sent,console.log("timestamp",n),w.abrupt("return",Ce.createFirstBlock(e.id,t,n));case 6:if(!(t>e.head.month)){w.next=15;break}return w.delegateYield(gt.getByIds([e.head.id]),"t0",8);case 8:return a=w.t0,r=Object(Z.a)(a,1),o=r[0],w.next=13,ft();case 13:return c=w.sent,w.abrupt("return",o.createNextBlock(t,c));case 15:if(!((i=e.months.findIndex((function(e){return e.month===t})))>-1)){w.next=21;break}return s=e.months.slice(0,i+1).map((function(e){return e.id})),w.delegateYield(gt.getByIds(s),"t1",19);case 19:return u=w.t1,w.abrupt("return",u.pop());case 21:l=[],d=0;case 23:if(!(d<e.months.length)){w.next=31;break}if(h=e.months[d],l.push(h.id),!(h.month<t)){w.next=28;break}return w.abrupt("break",31);case 28:d++,w.next=23;break;case 31:return w.delegateYield(gt.getByIds(l),"t2",32);case 32:return m=w.t2,f=[],w.delegateYield(dt.getTimestamp(),"t3",35);case 35:for(p=w.t3,v=m.pop(),b=v=v.createNextBlock(t,p),f.push(v),y=m.pop();y;y=m.pop())g=y.updatePrevMonths([v],p),f.push(g),v=g;return w.delegateYield(gt.save(f),"t4",41);case 41:return w.abrupt("return",b);case 42:case"end":return w.stop()}}),bt)}function Et(e){var t,n;return ot.a.wrap((function(a){for(;;)switch(a.prev=a.next){case 0:return a.next=2,Object(it.b)(J(e));case 2:t=ot.a.mark((function t(){var n;return ot.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,Object(it.d)([V,T]);case 2:if((n=t.sent).type!==V.getType()){t.next=8;break}if(!e.every((function(e,t){return n.payload[t]===e.id}))){t.next=6;break}return t.abrupt("return",{v:void 0});case 6:t.next=10;break;case 8:if(!e.every((function(e,t){return n.payload.ids[t]===e.id}))){t.next=10;break}throw n.payload.error;case 10:case"end":return t.stop()}}),t)}));case 3:return a.delegateYield(t(),"t0",4);case 4:if("object"!==typeof(n=a.t0)){a.next=7;break}return a.abrupt("return",n.v);case 7:a.next=3;break;case 9:case"end":return a.stop()}}),yt)}var jt=ot.a.mark(_t),xt=ot.a.mark(Nt),kt=ot.a.mark(Mt),St={select:ut.call(_t),update:ut.call(Nt),save:ut.call(Mt)};function _t(e){var t,n;return ot.a.wrap((function(a){for(;;)switch(a.prev=a.next){case 0:return a.next=2,Object(it.c)((function(e){return e(M)}));case 2:if(t=a.sent,n=t.accounts.get(e)){a.next=6;break}throw new Error('Account "'.concat(e,'" not found'));case 6:return a.abrupt("return",n);case 7:case"end":return a.stop()}}),jt)}function Nt(e,t){var n,a,r,o,c,i,s,u,l,d,h,m,f,p,v;return ot.a.wrap((function(b){for(;;)switch(b.prev=b.next){case 0:if(console.log("*** updateAccountSaga"),console.log(e.months.map((function(e){return e.month}))),console.log(t.month,t.id),r=e.months.findIndex((function(e){return e.month===t.month})),o=e.months.findIndex((function(e){return e.month<t.month})),e.head){b.next=10;break}return b.delegateYield(gt.save([t]),"t0",7);case 7:return c=e.updateHead(t),b.delegateYield(St.save(c),"t1",9);case 9:return b.abrupt("return",c);case 10:if(i=-1===r?o:r,s=e.months.slice(0,i+1).map((function(e){return e.id})),u=[t],console.log(s),!s.length){b.next=22;break}return b.t2=u.push,b.t3=u,b.t4=de.a,b.delegateYield(gt.getByIds(s),"t5",19);case 19:b.t6=b.t5,b.t7=(0,b.t4)(b.t6),b.t2.apply.call(b.t2,b.t3,b.t7);case 22:return b.delegateYield(dt.getTimestamp(),"t8",23);case 23:if(l=b.t8,console.log({currentMonthIndex:r,prevMonthIndex:o,toIndex:i,additions:u.map((function(e){return[e.month+" "+e.id]})),months:e.months.slice(0,i+1).map((function(e){return e.month}))}),d=[t],console.log("additional"),console.log(u.map((function(e){return"".concat(e.month," ").concat(e.id)}))),console.log("chain"),console.log(e.months.map((function(e){return"".concat(e.month," ").concat(e.id)}))),console.log("prevMonthIndex",o,null===(n=e.months[o])||void 0===n?void 0:n.month),-1!==r||-1!==o){b.next=33;break}throw new Error("Unexpection");case 33:if(-1!==r||-1===o){b.next=37;break}r=o,b.next=42;break;case 37:if((h=e.months[r]).month===t.month){b.next=40;break}throw new Error("somethings wrong");case 40:if(Xe(t,h)){b.next=42;break}throw new Error("somethings wrong");case 42:if(console.log("currentMonthIndex",r,null===(a=e.months[r])||void 0===a?void 0:a.month),-1===r){b.next=52;break}for(m=t,f=function(t){console.log("index",t,e.months[t].month);var n=e.months[t].id,a=u.find((function(e){return e.id===n}));if(!a)throw new Ke(n);m=a.updatePrevMonths([m],l),u.push(m),d.push(m)},p=r-1;p>=0;p--)f(p);return console.log("additionalMonths",u.map((function(e){return[e.month+" "+e.id]}))),v=e.updateHead(m,u),b.delegateYield(gt.save(d),"t9",50);case 50:return b.delegateYield(St.save(v),"t10",51);case 51:return b.abrupt("return",v);case 52:throw new Error("may be first");case 53:case"end":return b.stop()}}),xt)}function Mt(e){var t;return ot.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,Object(it.b)(S(e));case 2:return n.next=4,Object(it.d)([_,N]);case 4:if((t=n.sent).type!==_.getType()){n.next=10;break}if(t.payload!==e.id){n.next=8;break}return n.abrupt("return");case 8:n.next=12;break;case 10:if(t.payload.id!==e.id){n.next=12;break}throw t.payload.error;case 12:n.next=2;break;case 14:case"end":return n.stop()}}),kt)}var At=ot.a.mark(It);function It(e){var t,n,a,r,o,c,i;return ot.a.wrap((function(s){for(;;)switch(s.prev=s.next){case 0:return console.log("*** addTransactionSaga started"),t=e.payload,s.delegateYield(St.select(t.account),"t0",3);case 3:return n=s.t0,s.delegateYield(gt.get(n,Be(t.date)),"t1",5);case 5:return a=s.t1,console.log("addTransactionSaga",a.id,a.prevVersions),r=Le.create(t.type,t.amount,"RUB"),o=a.getDay(t.date).addTransaction(r),c=a.updateDay(o),console.log("updatedMonth",c.id,c.prevVersions),s.delegateYield(St.update(n,c),"t2",12);case 12:return i=s.t2,console.log("*** addTransactionSaga complete"),s.abrupt("return",i);case 15:case"end":return s.stop()}}),At)}st.onAction(oe,It);var Dt=ot.a.mark(Jt);function Jt(){var e;return ot.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:console.log("init transactionUpdateSaga");case 1:return t.next=4,Object(it.d)(x.getType());case 4:e=t.sent,console.log("load successssssss",e),t.next=1;break;case 8:case"end":return t.stop()}}),Dt)}st.register(Jt);var Vt,Tt=function(){Object(s.c)(ae);return function(e){console.log("useDBReady");var t=Object(r.useState)(at.status),n=Object(Z.a)(t,2),a=(n[0],n[1]),o=function(t){console.log(be[t]),t===be.Ready&&e(),a(t)};Object(r.useEffect)((function(){return at.addStatusListener(o),function(){return at.removeStatusListener(o)}}))}(Object(s.b)((function(){var e;return console.log("*** refreshAllHandler"),(e=re).subscribe((function(t){switch(console.log(t),t.type){case j.getType():at.transaction(tt).getAll().then((function(t){return e.dispatch(x(t.map(et.fromJSON)))}),(function(t){return e.dispatch(k(t))}));break;case S.getType():var n=t.payload;at.transaction(tt).update(n.toJSON()).then((function(t){return e.dispatch(_(n.id))}),(function(t){return e.dispatch(N({id:n.id,error:t}))}));break;case A.getType():var a=t.payload;at.transaction(nt).getAll(a).then((function(t){console.log(a),console.log(t);var n=t.map(Ce.fromJSON);e.dispatch(I(n))}),(function(t){return e.dispatch(D({ids:a,error:t}))}));break;case J.getType():var r=t.payload.map((function(e){return e.toJSON()})),o=r.map((function(e){return e.id})),c=at.transaction(nt);Promise.all(r.map((function(e){return c.update(e)}))).then((function(){return e.dispatch(V(o))}),(function(t){return e.dispatch(T({ids:o,error:t}))}))}})),console.log("*** refreshAllHandler complete"),ne()}),[])),o.a.createElement("div",{className:l.a.App},o.a.createElement(h.a,null,o.a.createElement(d.d,null,he.map((function(e){return o.a.createElement(d.b,e)})),o.a.createElement(d.a,{to:me.home()})),o.a.createElement(ve,null)))};(Vt=re).dispatch(te(navigator.onLine)),window.addEventListener("online",(function(){return Vt.dispatch(te(!0))})),window.addEventListener("offline",(function(){return Vt.dispatch(te(!1))})),st.start(re);function Bt(e,t){navigator.serviceWorker.register(e).then((function(e){e.onupdatefound=function(){var n=e.installing;null!=n&&(n.onstatechange=function(){"installed"===n.state&&(navigator.serviceWorker.controller?(console.log("New content is available and will be used when all tabs for this page are closed. See https://bit.ly/CRA-PWA."),t&&t.onUpdate&&t.onUpdate(e)):(console.log("Content is cached for offline use."),t&&t.onSuccess&&t.onSuccess(e)))})}})).catch((function(e){console.error("Error during service worker registration:",e)}))}i.a.render(o.a.createElement(o.a.StrictMode,null,o.a.createElement(s.a.Provider,{value:re},o.a.createElement(Tt,null))),document.getElementById("root")),function(e){if("serviceWorker"in navigator){if(new URL("/finman",window.location.href).origin!==window.location.origin)return;window.addEventListener("load",(function(){var t="".concat("/finman","/service-worker.js");!function(e,t){fetch(e,{headers:{"Service-Worker":"script"}}).then((function(n){var a=n.headers.get("content-type");404===n.status||null!=a&&-1===a.indexOf("javascript")?navigator.serviceWorker.ready.then((function(e){e.unregister().then((function(){window.location.reload()}))})):Bt(e,t)})).catch((function(){console.log("No internet connection found. App is running in offline mode.")}))}(t,e),navigator.serviceWorker.ready.then((function(){console.log("Offline Mode ready")}))}))}}(),function(){console.log("*************** initDB");var e=[{ssn:"444-44-4444",name:"Bill",age:35,email:"bill@company.com"},{ssn:"555-55-5555",name:"Donna",age:32,email:"donna@home.org"}],t=indexedDB.open("the_name",3);t.onerror=function(e){},t.onsuccess=function(e){var t=e.target.result;window.db=t,t.transaction(["customers"],"readwrite").objectStore("customers").add({age:44,email:"asd",name:"asd",ssn:"123"}).onsuccess=function(e){return console.log(e)}},t.onupgradeneeded=function(t){var n=t.target.result;console.log("upgrade");var a=n.createObjectStore("customers",{keyPath:"ssn"});for(var r in a.createIndex("name","name",{unique:!1}),a.createIndex("email","email",{unique:!0}),e)a.add(e[r])}}()},28:function(e,t,n){e.exports={txList:"TxList_txList__3rowt",txItem:"TxList_txItem__2-7sR",txItem__left:"TxList_txItem__left__3Dekh",txItem__first:"TxList_txItem__first__eF_WE",txItem__second:"TxList_txItem__second__-lQ89",txItem__amount:"TxList_txItem__amount__2PbUA",txItem__date:"TxList_txItem__date__3uUSP",empty:"TxList_empty__2S-7j"}},33:function(e,t,n){e.exports={head:"MonthViewWidget_head__2tdqX",title:"MonthViewWidget_title__2uHWT",prev:"MonthViewWidget_prev__2DTEF",next:"MonthViewWidget_next__1Vm-Q",info:"MonthViewWidget_info__ltwmS",circle:"MonthViewWidget_circle__19VOB",balance:"MonthViewWidget_balance__qUNX4"}},53:function(e,t,n){e.exports={moneyView:"MoneyView_moneyView__2U7sP",fractional:"MoneyView_fractional__1hdQj"}},63:function(e,t,n){e.exports={days:"MonthTxList_days__1hzzo",day:"MonthTxList_day__1_h7Y",title:"MonthTxList_title__VajvW"}},64:function(e,t,n){e.exports={page:"TransactionsPage_page__1uE4j",filter:"TransactionsPage_filter__3x4B8",active:"TransactionsPage_active__3XoOk"}},85:function(e,t,n){e.exports={header:"Header_header__30F5v",title:"Header_title__1vmPo"}}},[[145,1,2]]]);
//# sourceMappingURL=main.2c127b4c.chunk.js.map