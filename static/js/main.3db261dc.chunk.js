(this.webpackJsonpfinman=this.webpackJsonpfinman||[]).push([[0],{143:function(e,t,n){e.exports={App:"App_App__15LM-","App-logo":"App_App-logo__1GLNd","App-logo-spin":"App_App-logo-spin__1EbLw","App-header":"App_App-header__3nnPn","App-link":"App_App-link__TRj1P"}},145:function(e,t,n){},147:function(e,t,n){e.exports={bottomNavigation:"NavBar_bottomNavigation__hEWk4"}},150:function(e,t,n){e.exports=n(254)},155:function(e,t,n){},167:function(e,t){},169:function(e,t){},179:function(e,t){},181:function(e,t){},209:function(e,t){},210:function(e,t){},24:function(e,t,n){e.exports={head:"MonthViewWidget_head__2tdqX",title:"MonthViewWidget_title__2uHWT",info:"MonthViewWidget_info__ltwmS",circle:"MonthViewWidget_circle__19VOB",balance:"MonthViewWidget_balance__qUNX4"}},254:function(e,t,n){"use strict";n.r(t);var a=n(0),r=n.n(a),o=n(87),c=n.n(o),i=n(21),s=(n(155),n(143)),u=n.n(s),l=n(7),d=n(55),m=n(13),h=n(11),f={RUB:{code:"RUB",symbol:"\u20bd",precision:2}},p=function(){function e(t,n){Object(m.a)(this,e),this.subunits=t,this.currency=n,this.amount="",this.amount=(t/Math.pow(10,n.precision)).toFixed(2)}return Object(h.a)(e,null,[{key:"from",value:function(t){if("string"===typeof t)return e.fromJSON(t);if(t instanceof e)return t.clone();throw new Error("Can not convert invalid data to Money")}},{key:"fromJSON",value:function(t){if("object"===typeof t&&"number"===typeof t.subunits&&"object"===typeof t.currency&&"string"===typeof t.currency.code)return new e(t.subunits,t.currency);if("string"!==typeof t)throw new Error('Amount "'.concat(t,'" must be a string'));var n=t.trim().split(" ");if(!n||2!==n.length)throw new Error('Money "'.concat(t,'" must have valid format'));var a=n[0],r=n[1].toUpperCase(),o=f[r];if(!o)throw new Error('Unsupported currency "'.concat(r,'"'));var c=+a;if(Number.isNaN(c))throw new Error('Invalid amount "'.concat(a,'" when parse "').concat(t,'"'));return new e(Math.round(c*Math.pow(10,o.precision)),o)}},{key:"create",value:function(t,n){if("string"!==typeof n)throw new Error('Invalid currency "'.concat(n,'"'));if(n=n.toUpperCase(),"string"===typeof t){if(!t||Number.isNaN(+t))throw new Error('Amount must be valid number but received "'.concat(t,'"'));t=+t}var a=f[n];if(!a)throw new Error('Unsupported currency "'.concat(n,'"'));var r=+t;if(Number.isNaN(r))throw new Error('Invalid amount "'.concat(t,'"'));return new e(Math.round(r*Math.pow(10,a.precision)),a)}}]),Object(h.a)(e,[{key:"clone",value:function(){return new e(this.subunits,this.currency)}},{key:"toString",value:function(){return this.subunits?this.amount+" "+this.currency.symbol:"0 "+this.currency.symbol}},{key:"toJSON",value:function(){return this.subunits?this.amount+" "+this.currency.code:"0 "+this.currency.code}},{key:"add",value:function(t){if(this.currency.code!==t.currency.code)throw new Error("Can not do any operations with different currencies");return new e(this.subunits+t.subunits,this.currency)}},{key:"sub",value:function(t){if(this.currency.code!==t.currency.code)throw new Error("Can not do any operations with different currencies");return new e(this.subunits-t.subunits,this.currency)}},{key:"equal",value:function(e){return this.currency.code===e.currency.code&&this.subunits===e.subunits}},{key:"getEntire",value:function(){return Math.floor(this.subunits/Math.pow(10,this.currency.precision)).toString()}},{key:"getFractional",value:function(){return(this.subunits/Math.pow(10,this.currency.precision)).toFixed(this.currency.precision).substr(-this.currency.precision)}},{key:"getSymbol",value:function(){return this.currency.symbol}},{key:"negative",value:function(){return new e(-this.subunits,this.currency)}}]),e}();p.empty=p.create(0,"RUB");var v=n(57),b=n.n(v),y=function(e){var t=e.money;if(!(t instanceof p))throw new Error("money must be instance of Money, but get ".concat(typeof t," ").concat(JSON.stringify(t),'"'));return r.a.createElement("div",{className:b.a.moneyView},r.a.createElement("span",{className:b.a.entire},t.getEntire()),r.a.createElement("span",{className:b.a.fractional},t.getFractional()),r.a.createElement("span",{className:b.a.currency},t.getSymbol()))},g=n(37),w=n.n(g),O=n(2),E=n(8),j=n(35),x="accounts",_=Object(E.c)(x+":chooseAccount"),S=Object(E.c)(x+":loadAccounts"),k=Object(E.c)(x+":loadAccounts success"),N=Object(E.c)(x+":loadAccounts failed"),M=Object(E.c)(x+":saveAccounts"),A=Object(E.c)(x+":saveAccounts success"),I=Object(E.c)(x+":saveAccounts failed"),B=Object(E.d)(["accounts"],{current:null,accounts:Object(j.a)()},(function(e){return{choose:[e(_,(function(e,t){var n=e.accounts.get(t);return n?Object(O.a)(Object(O.a)({},e),{},{current:n}):e}))],load:[e(k,(function(e,t){var n=t.current,a=t.accounts,r=a.map((function(e){return[e.id,e]})),o=Object(j.a)(r);return Object(O.a)(Object(O.a)({},e),{},{current:o.has(n)?o.get(n):a[0],accounts:o})}))],save:[e(M,(function(e,t){var n;return{accounts:e.accounts.set(t.id,t),current:t.id===(null===(n=e.current)||void 0===n?void 0:n.id)?t:e.current}}))]}})),D=n(88),J=n.n(D),T=function(e){var t=e.title;return r.a.createElement("header",{className:J.a.header},r.a.createElement("h1",{className:J.a.title},t))},V=n(89),L=n.n(V),C=n(45),P=n.n(C),F=function(e){var t,n=e.showButtons,o=e.children,c=e.onChange,i=e.current;c=c||function(e){return null};var s=o.flat(),u=s.findIndex((function(e){return e.key===i}));-1===u&&(u=0),console.log("!!!",i,u),console.log(s),Object(a.useEffect)((function(){return t.slide(u,0)}),[u]);var l=n&&u>0?s[u-1].key:"",d=n&&u<s.length-1?s[u+1].key:"";return r.a.createElement("div",{className:P.a.swipeWidget},r.a.createElement(L.a,{ref:function(e){return t=e},className:P.a.swipe,callback:function(e){console.log("current",e);var t=s[e];console.log("current",t),c(t.key)},startSlide:u,speed:0,auto:0},s),l&&r.a.createElement("div",{className:P.a.prev,onClick:function(){t.prev()}},r.a.createElement("svg",{width:"24",height:"24",xmlns:"http://www.w3.org/2000/svg",fillRule:"evenodd",clipRule:"evenodd"},r.a.createElement("path",{d:"M20 .755l-14.374 11.245 14.374 11.219-.619.781-15.381-12 15.391-12 .609.755z"}))),d&&r.a.createElement("div",{className:P.a.next,onClick:function(){t.next()}},r.a.createElement("svg",{width:"24",height:"24",xmlns:"http://www.w3.org/2000/svg",fillRule:"evenodd",clipRule:"evenodd"},r.a.createElement("path",{d:"M4 .755l14.374 11.245-14.374 11.219.619.781 15.381-12-15.391-12-.609.755z"}))))},W=function(e){var t=e.children;return r.a.createElement(V.SwipeItem,{className:P.a.swipeItem},t)};function H(){return Object(a.useReducer)((function(e){return e+1}),0)[1]}var R=function(e){return e};function U(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:R,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],r=Object(a.useContext)(i.a);console.log("by forceUpdate",e);var o=H(),c=t(r.getState(e));return Object(a.useEffect)((function(){return r.subscribe(e,(function(e){console.log("new value",e,t(e)),o()}))}),n),c}var Y,z=n(33),q=n.n(z);!function(e){e.Neutral="neutral",e.Good="good",e.Normal="normal",e.Bad="bad"}(Y||(Y={}));var G={Button:Object(a.memo)((function(e){var t=e.title,n=e.link,a=e.amount,o=100,c=Y.Good,i=Y.Neutral,s="";if("percent"in e){var u=function(e){var t=e.percent,n=t<=.99?Math.ceil(100*t-100)+"%":t>=1.01?"+"+Math.floor(100*t-100)+"%":"+0%",a=t<=1?Math.ceil(100*t):Math.floor(1/t*100);if("moreIsBetter"in e&&e.moreIsBetter)return t>=1.1?{percentDiff:n,barBgColor:Y.Good,barColor:Y.Normal,barWidth:a}:t<=.9?{percentDiff:n,barBgColor:Y.Neutral,barColor:Y.Bad,barWidth:a}:{percentDiff:n,barBgColor:Y.Good,barColor:Y.Normal,barWidth:a};if("lessIsBetter"in e&&e.lessIsBetter)return t>=1.1?{percentDiff:n,barBgColor:Y.Normal,barColor:Y.Bad,barWidth:a}:t<=.9?{percentDiff:n,barBgColor:Y.Neutral,barColor:Y.Good,barWidth:a}:{percentDiff:n,barBgColor:Y.Neutral,barColor:Y.Normal,barWidth:a};throw new Error("Must be moreIsBetter or lessIsBetter")}(e);o=u.barWidth,c=u.barColor,i=u.barBgColor,s=u.percentDiff}return r.a.createElement(Fe,{className:q.a.button,to:n},r.a.createElement("div",{className:q.a.left},r.a.createElement("div",{className:q.a.title},t,r.a.createElement("em",null,s)),r.a.createElement("div",{className:q.a.bar,style:{backgroundColor:X(i)}},r.a.createElement("div",{style:{width:o+"%",backgroundColor:X(c)}}))),r.a.createElement("div",{className:q.a.right},a instanceof p?r.a.createElement(y,{money:a||p.empty}):a))})),List:Object(a.memo)((function(e){var t=e.children,n=e.cover,a=t.flat();return r.a.createElement("div",{className:[q.a.list,n&&q.a.list_cover].join(" ")},a)}))};function X(e){switch(e){case Y.Good:return"yellowgreen";case Y.Normal:return"yellow";case Y.Bad:return"red";case Y.Neutral:default:return"#d0d0d0"}}var K=n(36);function Q(e){return e?Object(K.a)(new Date(e),"MMMM"):"month"}var Z,$=function(){Object(l.g)();var e,t,n,a,o=U(B,(function(e){return e.current}),[]),c=U(B,(function(e){return e.accounts}),[]),s=Object(i.b)((function(e){return"create"===e?null:_(e)})),u=Array.from(c.values());return c.size?r.a.createElement(r.a.Fragment,null,r.a.createElement(T,{title:"Accounts"}),r.a.createElement("main",{className:w.a.accountPage+" noselect"},r.a.createElement(F,{current:(null===o||void 0===o?void 0:o.id)||"",showButtons:!0,onChange:s},u.map((function(e){return r.a.createElement(W,{key:e.id},r.a.createElement(ee,{account:e}))}))),r.a.createElement(G.List,{cover:!0},r.a.createElement(G.Button,{title:"Expenses in ".concat(Q(null===(e=o.head)||void 0===e?void 0:e.month)),link:Ve.account.monthsList(o.id),amount:null===(t=o.head)||void 0===t?void 0:t.summary.expense}),r.a.createElement(G.Button,{title:"Incomes in ".concat(Q(null===(n=o.head)||void 0===n?void 0:n.month)),link:Ve.account.monthsList(o.id),amount:null===(a=o.head)||void 0===a?void 0:a.summary.income})))):r.a.createElement(r.a.Fragment,null,r.a.createElement(T,{title:"Accounts"}),"Loading...")},ee=function(e){var t=e.account,n=Object(l.g)();return r.a.createElement("div",{className:w.a.accountWidget+" "+w.a.accountStyle_blue},r.a.createElement("div",{className:w.a.name},t.name),r.a.createElement("div",{className:w.a.balance},r.a.createElement("h5",null,"Balance:"),r.a.createElement(y,{money:t.balance})),r.a.createElement("button",{className:w.a.addTx,onClick:function(){n.push(Ve.transactions.add({account:t.id}))}},"+"))},te=n(17),ne=Object(E.c)("months:loadMonths"),ae=Object(E.c)("months:loadMonths success"),re=Object(E.c)("months:loadMonths failed"),oe=Object(E.c)("months:saveMonths"),ce=Object(E.c)("months:saveMonths success"),ie=Object(E.c)("months:saveMonths failed"),se=Object(E.d)(["months"],Object(j.a)(),(function(e){return{load:[e(ae,(function(e,t){return t.reduce((function(e,t){return e.set(t.id,t)}),e)}))],save:[e(oe,(function(e,t){return t.reduce((function(e,t){return e.set(t.id,t)}),e)}))]}})),ue=n(67),le=n.n(ue),de=n(29),me=n.n(de);!function(e){e[e.Removed=0]="Removed",e[e.Income=1]="Income",e[e.Expense=2]="Expense",e[e.Adjust=3]="Adjust",e[e.AdjustTo=4]="AdjustTo"}(Z||(Z={}));var he=r.a.memo((function(e){var t=function(e,t){return e.map((function(e){var n;switch(e.type){case Z.Income:n=e.amount;break;case Z.Expense:n=e.amount.negative();break;default:throw new Error("Unprocessed TxType "+Z[e.type])}return{first:e.category,second:e.title,amount:n,date:t?Object(K.a)(new Date(t),"PP"):""}}))}(e.list,e.dayDate);return r.a.createElement("ul",{className:me.a.txList},t.map((function(e,t){return r.a.createElement("li",{key:t,className:me.a.txItem},r.a.createElement("div",{className:me.a.txItem__left},r.a.createElement("div",{className:me.a.txItem__first},e.first?e.first:r.a.createElement("span",{className:me.a.empty},"\u0411\u0435\u0437 \u0437\u0430\u0433\u043e\u043b\u043e\u0432\u043a\u0430")),r.a.createElement("div",{className:me.a.txItem__second},e.second?e.second:r.a.createElement("span",{className:me.a.empty},"\u0411\u0435\u0437 \u0437\u0430\u0433\u043e\u043b\u043e\u0432\u043a\u0430"))),r.a.createElement("div",{className:me.a.txItem__right},r.a.createElement("div",{className:me.a.txItem__amount},r.a.createElement(y,{money:e.amount})),r.a.createElement("div",{className:me.a.txItem__date},e.date)))})))})),fe=r.a.memo((function(e){var t=e.month;if(!t)return r.a.createElement("div",null,"No data");var n=t.days;return r.a.createElement("ul",{className:le.a.days},n.map((function(e){return r.a.createElement("li",{key:e.date,className:le.a.day},r.a.createElement("div",{className:le.a.title},(t=e.date,Object(K.a)(new Date(t),"do LLLL"))),r.a.createElement(he,{list:e.transactions,dayDate:e.date}));var t})))}));var pe=n(24),ve=n.n(pe),be=function(e){e.months;var t=e.brief;e.prev,e.next,e.moveToPrev,e.moveToNext;if(!t)return r.a.createElement("div",null,"No month");var n=452,a=t.summary.income.subunits+t.summary.expense.subunits,o=t.summary.income.subunits/a*n,c=t.summary.expense.subunits/a*n;return r.a.createElement("div",{className:ve.a.head},r.a.createElement("h3",{className:ve.a.title},Object(K.a)(new Date(t.month),"MMMM yyyy")),r.a.createElement("div",{className:ve.a.info},r.a.createElement("div",{className:ve.a.circle},r.a.createElement("svg",{width:"160",height:"160"},r.a.createElement("circle",{transform:"rotate(-90)",r:"72",cx:"-80",cy:"80"}),r.a.createElement("circle",{className:"income",transform:"rotate(-90)",r:"72",cx:"-80",cy:"80",stroke:"30bae7",strokeDasharray:[o,n].join(" ")}),r.a.createElement("circle",{className:"expense",transform:"rotate(-90)",r:"72",cx:"-80",cy:"80",strokeDasharray:[0,o,c,n].join(" ")})),r.a.createElement("h4",{className:ve.a.balance},r.a.createElement(y,{money:t.summary.balance})),r.a.createElement("div",null,"+",r.a.createElement(y,{money:t.summary.income})),r.a.createElement("div",null,"-",r.a.createElement(y,{money:t.summary.expense})))))},ye=n(145),ge=n.n(ye),we=function(){var e=Object(l.i)().params,t=Object(i.c)(B,(function(t){return t.accounts.get(e.account)}),[e.account]),n=Object(i.c)(se),o=Object(l.g)(),c=Object(te.a)(t?t.months:[]);c.reverse();var s=Object(a.useCallback)((function(e){o.replace(Ve.account.months(t.id,e))}),[t]),u=Object(i.b)((function(e){return e?ne([e]):null}),[]);if(!t)return r.a.createElement("div",null,"No account");if(!t.months.length)return r.a.createElement("div",null,"No months in this account");var d=t.months.findIndex((function(t){return t.month===e.month}));-1===d&&(d=0);var m=t.months[d],h=t.months[d+1],f=t.months[d-1];m&&!n.has(m.id)&&u(m.id),h&&!n.has(h.id)&&u(h.id),f&&!n.has(f.id)&&u(f.id);var p=n.get(null===m||void 0===m?void 0:m.id);return r.a.createElement(r.a.Fragment,null,r.a.createElement(T,{title:"Account ".concat(t.name)}),r.a.createElement("main",{className:ge.a.main+" noselect"},r.a.createElement(F,{onChange:s,current:m.month,showButtons:!0},c.map((function(e){return r.a.createElement(W,{key:e.month},r.a.createElement(be,{months:n,brief:e}))}))),r.a.createElement(fe,{month:p})))};var Oe={list:function(){return"".concat("","/accounts")},view:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:":account";return"".concat("","/accounts/").concat(e)},monthsList:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:":account";return"".concat("","/accounts/").concat(e,"/months")},months:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:":account",t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:":month";return"".concat("","/accounts/").concat(e,"/months/").concat(t)}},Ee=[{path:Oe.list(),exact:!0,component:$},{path:Oe.view(),exact:!0,component:$},{path:Oe.months(),component:we},{path:Oe.monthsList(),component:we}],je=n(27),xe=n(146),_e=Object(E.c)("client:setOnlineStatus"),Se=Object(E.c)("client:refresh",(function(e,t){(0,t.dispatch)(S())})),ke=Object(E.d)(["client"],{online:!1},(function(e){return{online:[e(_e,(function(e,t){return Object(O.a)(Object(O.a)({},e),{},{online:t})}))]}})),Ne=Object(E.b)(Object(E.a)({Client:ke,Accounts:B,Months:se}));Object(xe.a)(Ne),Ne.subscribe((function(e,t){console.group("*** action",e.type),console.log(e.payload),console.log(t),console.groupEnd()}));var Me,Ae=Object(E.c)("transaction:addTransaction"),Ie=n(68),Be=n.n(Ie),De=[{id:1},{id:2},{id:2},{id:2},{id:2},{id:2},{id:2},{id:2},{id:2},{id:2},{id:2},{id:2},{id:2},{id:2},{id:2},{id:2},{id:2},{id:2},{id:2},{id:2},{id:2},{id:2},{id:2},{id:2},{id:2},{id:2},{id:2},{id:2},{id:2},{id:2},{id:2},{id:2},{id:2},{id:2},{id:2},{id:2},{id:2},{id:2},{id:2},{id:2},{id:2},{id:2},{id:2},{id:2},{id:2},{id:2},{id:2},{id:2},{id:2},{id:2},{id:2},{id:2},{id:2},{id:2},{id:2},{id:2},{id:2},{id:2},{id:2},{id:2},{id:2},{id:2},{id:2},{id:2},{id:2},{id:2}],Je={add:function(e){return"".concat("","/transaction/add")+function(e){return e&&Object.keys(e).length?"?"+new URLSearchParams(e).toString():""}(e)},list:function(){return"".concat("","/transactions")}},Te=[{path:Je.add(),component:function(){var e=new URLSearchParams(Object(l.h)().search),t=Object(a.useState)("123"),n=Object(je.a)(t,2),o=n[0],c=n[1],i=Object(a.useState)("2020-06-12"),s=Object(je.a)(i,2),u=s[0],d=s[1],m=Object(a.useState)(Z.Expense),h=Object(je.a)(m,2),f=h[0],p=h[1],v=Object(a.useState)(e.get("account")||""),b=Object(je.a)(v,2),y=b[0],g=b[1],w=function(e){p(+e.target.value)};return r.a.createElement(r.a.Fragment,null,r.a.createElement(T,{title:"Add transaction"}),r.a.createElement("main",null,r.a.createElement("form",{onSubmit:function(e){e.preventDefault();var t={account:y,amount:o,date:u,category:"",title:"",type:f};console.log(t),Ne.dispatch(Ae(t))}},r.a.createElement("div",null,"Amount:",r.a.createElement("input",{type:"number",value:o,onChange:function(e){c(e.target.value)}})),r.a.createElement("div",null,"Date:",r.a.createElement("input",{type:"date",value:u,onChange:function(e){d(e.target.value)},list:"datalist"}),r.a.createElement("datalist",{id:"datalist"},r.a.createElement("option",{value:"2020-06-12",label:"Today"}),r.a.createElement("option",{value:"2020-06-11",label:"Yesterday"}))),r.a.createElement("div",null,"Type:",r.a.createElement("input",{type:"radio",id:"type-income",onChange:w,checked:f===Z.Income,name:"type",value:Z.Income}),r.a.createElement("label",{htmlFor:"type-income"},"Income"),r.a.createElement("input",{type:"radio",id:"type-expense",checked:f===Z.Expense,onChange:w,name:"type",value:Z.Expense}),r.a.createElement("label",{htmlFor:"type-expense"},"Expense")),r.a.createElement("div",null,"Account:",r.a.createElement("input",{type:"text",value:y,onChange:function(e){g(e.target.value)}})),r.a.createElement("div",null,r.a.createElement("button",{type:"submit"},"Add"))),r.a.createElement("pre",null,"amount: ",o),r.a.createElement("pre",null,"date: ",u),r.a.createElement("pre",null,"type: ",f)))}},{path:Je.list(),component:function(){return r.a.createElement("div",{className:Be.a.page},r.a.createElement(T,{title:"Transactions of ".concat("2020-05")}),r.a.createElement("main",null,r.a.createElement("div",{className:Be.a.filter},r.a.createElement("button",{className:Be.a.active},"\u0412\u0441\u0435"),r.a.createElement("button",null,"\u0422\u0440\u0430\u0442\u044b"),r.a.createElement("button",null,"\u041f\u0440\u0438\u0445\u043e\u0434")),r.a.createElement(he,{list:De,dayDate:"2020-05-05"})))}}],Ve={account:Oe,transactions:Je,home:function(){return"".concat("","/accounts")},licenses:function(){return"".concat("","/licenses")}},Le=n(58),Ce=n.n(Le),Pe=[].concat(Object(te.a)(Ee),Object(te.a)(Te),[{path:Ve.licenses(),component:function(){return r.a.createElement(r.a.Fragment,null,r.a.createElement(T,{title:"Licenses"}),r.a.createElement("main",{className:Ce.a.licenses},r.a.createElement("ol",null,r.a.createElement("li",null,r.a.createElement("p",{className:Ce.a.name},'Icons "Dripicons" Version 2.0'),r.a.createElement("p",{className:Ce.a.author},"Author ",r.a.createElement("a",{href:"http://amitjakhu.com"},"Amit Jakhu")),r.a.createElement("p",{className:Ce.a.license},"License ",r.a.createElement("a",{href:"https://creativecommons.org/licenses/by/4.0/"},"CC BY 4.0"))))))}}]),Fe=d.b,We=d.c,He=n(147),Re=n.n(He),Ue=function(){return r.a.createElement("nav",{className:Re.a.bottomNavigation},r.a.createElement("ul",null,r.a.createElement("li",null,r.a.createElement(We,{to:Ve.home(),exact:!0},r.a.createElement("div",{className:"icon dripicons-home"}),r.a.createElement("span",null,"Home"))),r.a.createElement("li",null,r.a.createElement(We,{to:Ve.transactions.add()},r.a.createElement("div",{className:"icon dripicons-plus"}),r.a.createElement("span",null,"Add"))),r.a.createElement("li",null,r.a.createElement(We,{to:Ve.licenses()},r.a.createElement("div",{className:"icon dripicons-document"}),r.a.createElement("span",null,"Licenses")))))};function Ye(e,t,n){Array.isArray(n)?n.forEach((function(n){return Ye(e,t,n)})):e.addEventListener(n,(function(e){console.log('[eventLogger] Emitter: "'.concat(t,'", event "').concat(n,'":'),e)}))}!function(e){e[e.Initializing=0]="Initializing",e[e.Upgrading=1]="Upgrading",e[e.Ready=2]="Ready",e[e.Failed=3]="Failed"}(Me||(Me={}));var ze=function(){function e(t,n){Object(m.a)(this,e),this.db=t,this.scheme=n,this.transaction=void 0,this.storage=void 0,this.transaction=t.transaction(n.collection,"readwrite"),Ye(this.transaction,"transaction",["abort","complete","error"]),this.storage=this.transaction.objectStore(n.collection)}return Object(h.a)(e,[{key:"add",value:function(e,t){return new Promise((function(e,t){}))}},{key:"get",value:function(e){var t=this;return new Promise((function(n,a){var r=t.storage.get(e);Ye(r,"request",["error","success"]),r.onsuccess=function(e){return n(e.target.result)},r.onerror=function(e){return a(e)}}))}},{key:"getAll",value:function(e,t){var n=this;return Array.isArray(e)?Promise.all(e.map((function(e){return n.get(e)}))):new Promise((function(t,a){var r=n.storage.getAll(e);Ye(r,"request",["error","success"]),r.onsuccess=function(e){return t(e.target.result)},r.onerror=function(e){return a(e)}}))}},{key:"update",value:function(e){var t=this;return new Promise((function(n,a){var r=t.storage.put(e);Ye(r,"request",["error","success"]),r.onsuccess=function(e){return n(e.target.result)},r.onerror=function(e){return a(e)}}))}}]),e}(),qe=function(){function e(t,n){if(Object(m.a)(this,e),this.schemes=n,this.listeners=[],this._status=Me.Initializing,this.db=null,!window.indexedDB)throw new Error("IndexedDB not supported");var a=Math.max.apply(Math,[1].concat(Object(te.a)(n.map((function(e){return e.dbVersion})))));console.log("Start DB with version: ".concat(a,", count of models: ").concat(n.length)),this.openDB(t,a).then((function(){return console.log("Successfully open DB")}),(function(e){return console.error("Failed to open DB",e)}))}return Object(h.a)(e,[{key:"status",get:function(){return this._status}}]),Object(h.a)(e,[{key:"transaction",value:function(e){if(this._status!==Me.Ready)throw new Error("Database not ready");return this.getAccessor(e)}},{key:"addStatusListener",value:function(e){var t=this;this.listeners.push(e),setTimeout((function(){return e(t.status)}))}},{key:"removeStatusListener",value:function(e){this.listeners=this.listeners.filter((function(t){return t!==e}))}},{key:"setStatus",value:function(e){console.log('change DB status to "'.concat(Me[e],'"')),e!==this._status&&(console.log('Change DB status from "'.concat(Me[this._status],'" to "').concat(Me[e],'"')),this._status=e,this.listeners.forEach((function(t){return t(e)})))}},{key:"getAccessor",value:function(e){if(this.db)return new ze(this.db,e);throw new Error("Cannot create accessor for closed database")}},{key:"openDB",value:function(e,t){var n=this;return this.setStatus(Me.Initializing),new Promise((function(a,r){var o=window.indexedDB.open(e,t);Ye(o,"openRequest",["upgradeneeded","blocked","error","success"]),o.addEventListener("upgradeneeded",(function(e){n.setStatus(Me.Upgrading);var t=e.oldVersion,a=e.newVersion;t?console.log("Upgrade DB from version ".concat(t)):console.log("Initialize DB");var r=n.db=e.target.transaction;console.log(r);var o=n.db=e.target.result;console.log(Array.from(o.objectStoreNames)),n.schemes.forEach((function(e){var n;try{n=r.objectStore(e.collection)}catch(c){console.warn(c),n=o.createObjectStore(e.collection,{keyPath:e.key})}console.log(n),e.upgrade&&e.upgrade(n,t,a)}))})),o.addEventListener("success",(function(e){n.db=e.target.result,n.setStatus(Me.Ready),a()})),o.addEventListener("error",(function(e){console.log(e),n.setStatus(Me.Failed),r(e)}))}))}}]),e}();var Ge,Xe=n(256),Ke=n(92),Qe=n.n(Ke),Ze={balance:p.empty,income:p.empty,expense:p.empty},$e=Object(O.a)(Object(O.a)({},Ze),{},{balanceOnStart:p.empty,balanceOnEnd:p.empty});Object.freeze(Ze),Object.freeze($e),function(e){e[e.NoSynced=0]="NoSynced",e[e.Prepared=1]="Prepared",e[e.Syncing=2]="Syncing",e[e.FullySynced=3]="FullySynced",e[e.Fixed=4]="Fixed"}(Ge||(Ge={}));var et={income:p.empty,expense:p.empty,balance:p.empty};function tt(e){var t=e.reduce((function(e,t){var n=Object(je.a)(e,2),a=n[0],r=n[1];switch(t.type){case Z.Removed:return[a,r];case Z.Income:return[a,r.add(t.amount)];case Z.Expense:return[a.add(t.amount),r];default:throw new Error("Can't process type \"".concat(Z[t.type],'"'))}}),[p.empty,p.empty]),n=Object(je.a)(t,2),a=n[0],r=n[1];return{balance:r.sub(a),expense:a,income:r}}function nt(e,t){var n=e.balance.add(t.balance),a=e.expense.add(t.expense),r=e.income.add(t.income);if(!r.sub(a).equal(n)){if(!at(e))throw new Error('"Base" summary invalid');if(!at(t))throw new Error('"Add" summary invalid');throw new Error("Incorrect balance")}return{balance:n,expense:a,income:r}}function at(e){return e.income.sub(e.expense).equal(e.balance)}function rt(e){var t=e.match(/^(\d{4})-(\d{2})$/);if(!t)throw new Error('Invalid MonthDate "'.concat(e,'"'));var n=+t[1],a=+t[2]-1,r=new Date(n,a,1,12,0,0);if(r.getFullYear()!==n)throw new Error('Invalid year in "'.concat(e,'"'));if(r.getMonth()!==a)throw new Error('Invalid month in "'.concat(e,'"'));return r}function ot(e){return e.split("-",2).join("-")}var ct=function(){function e(t){Object(m.a)(this,e),this.id="",this.amount=p.empty,this.type=Z.Removed,this.category="",this.title="",this.createdAt=0,this.updatedAt=0,Object.assign(this,t)}return Object(h.a)(e,null,[{key:"createWithID",value:function(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Z.Removed,a=arguments.length>2?arguments[2]:void 0,r=arguments.length>3?arguments[3]:void 0,o=new e({id:t,amount:p.empty,type:n,category:"",title:"",createdAt:0,updatedAt:0});return a?o.setAmount(a,r):o}},{key:"create",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Z.Removed,n=arguments.length>1?arguments[1]:void 0,a=arguments.length>2?arguments[2]:void 0,r=Object(Xe.a)(),o=new e({id:r,amount:p.empty,type:t,category:"",title:"",createdAt:0,updatedAt:0});return n?o.setAmount(n,a):o}},{key:"fromJSON",value:function(t){return new e({id:t.id,amount:p.from(t.amount),type:t.type,category:t.category,title:t.title,createdAt:t.createdAt,updatedAt:t.updatedAt})}}]),Object(h.a)(e,[{key:"toJSON",value:function(){return{id:this.id,amount:this.amount.toJSON(),type:this.type,category:this.category,title:this.title,createdAt:this.createdAt,updatedAt:this.updatedAt}}},{key:"setAmount",value:function(t,n){var a;return a="string"!==typeof t&&"number"!==typeof t||"string"!==typeof n?p.from(t):p.create(t,n),new e(Object(O.a)(Object(O.a)({},this),{},{amount:a}))}},{key:"setType",value:function(t){return new e(Object(O.a)(Object(O.a)({},this),{},{type:t}))}},{key:"setCategory",value:function(t){return new e(Object(O.a)(Object(O.a)({},this),{},{category:t}))}},{key:"setTitle",value:function(t){return new e(Object(O.a)(Object(O.a)({},this),{},{title:t}))}},{key:"setCreatedAt",value:function(t){return new e(Object(O.a)(Object(O.a)({},this),{},{createdAt:t}))}},{key:"setUpdatedAt",value:function(t){return new e(Object(O.a)(Object(O.a)({},this),{},{updatedAt:t}))}}]),e}(),it=function(){function e(t){Object(m.a)(this,e),this.date="",this.dateTime=new Date,this.summary=Ze,this.transactions=[],Object.assign(this,t),this.dateTime=function(e){var t=e.match(/^(\d{4})-(\d{2})-(\d{2})$/);if(!t)throw new Error('Invalid DayDate "'.concat(e,'"'));var n=+t[1],a=+t[2]-1,r=+t[3],o=new Date(n,a,r,12,0,0);if(o.getFullYear()!==n)throw new Error('Invalid year in "'.concat(e,'"'));if(o.getMonth()!==a)throw new Error('Invalid month in "'.concat(e,'"'));if(o.getDate()!==r)throw new Error('Invalid date in "'.concat(e,'"'));return o}(this.date)}return Object(h.a)(e,null,[{key:"create",value:function(t){return new e({date:t})}},{key:"fromJSON",value:function(t){return new e({date:t.date,summary:{balance:p.fromJSON(t.summary.balance),income:p.fromJSON(t.summary.income),expense:p.fromJSON(t.summary.expense)},transactions:t.transactions.map(ct.fromJSON)})}}]),Object(h.a)(e,[{key:"toJSON",value:function(){return{date:this.date,summary:{balance:this.summary.balance.toJSON(),income:this.summary.income.toJSON(),expense:this.summary.expense.toJSON()},transactions:this.transactions.map((function(e){return e.toJSON()}))}}},{key:"addTransaction",value:function(t){var n=[].concat(Object(te.a)(this.transactions),[t]),a=tt(n);return new e(Object(O.a)(Object(O.a)({},this),{},{summary:a,transactions:n}))}}]),e}(),st=n(255),ut=function(){function e(t){Object(m.a)(this,e),this.id="",this.version=1,this.account="",this.month="",this.syncStatus=Ge.NoSynced,this.prevMonths=[],this.prevVersions=[],this.dataHash="",this.timestamp=0,this.updatedAt=new Date(0),this.summary=$e,this.days=[],this.daysInMonth=0,Object.assign(this,t),this.dataHash=this.getDataHash(),this.id=e.generateID(this,this.dataHash)}return Object(h.a)(e,[{key:"toJSON",value:function(){return{id:this.id,version:this.version,account:this.account,month:this.month,syncStatus:this.syncStatus,prevMonths:this.prevMonths,prevVersions:this.prevVersions,dataHash:this.dataHash,timestamp:this.timestamp,updatedAt:this.updatedAt,daysInMonth:this.daysInMonth,summary:{balance:this.summary.balance.toJSON(),income:this.summary.income.toJSON(),expense:this.summary.expense.toJSON(),balanceOnStart:this.summary.balanceOnStart.toJSON(),balanceOnEnd:this.summary.balanceOnEnd.toJSON()},days:this.days.map((function(e){return e.toJSON()}))}}}],[{key:"createFirstBlock",value:function(t,n,a){return new e({timestamp:a,account:t,month:n,daysInMonth:Object(st.a)(rt(n)),days:[],syncStatus:Ge.Fixed})}},{key:"generateID",value:function(e,t){if(1!==e.version)throw new Error("Version ".concat(e.version," not supported"));var n={version:e.version,account:e.account,prevMonths:e.prevMonths,prevVersions:e.prevVersions,dataHash:t||e.getDataHash()},a=Qe()(JSON.stringify(n)).toString(),r=rt(e.month),o=(12*(r.getFullYear()-1970)+r.getMonth()).toString(16).padStart(3,"0"),c=(e.timestamp/1e3).toString(16).substr(0,11).replace(".",""),i="".concat(o).concat(c).concat(a).substr(0,32);return i=[i.substr(0,8),i.substr(8,4),i.substr(12,4),i.substr(16,4),i.substr(20,12)].join("-")}},{key:"merge",value:function(e,t){throw new Error}},{key:"getBrief",value:function(e){return{id:e.id,month:e.month,summary:e.summary,prevMonths:e.prevMonths,prevVersions:e.prevVersions,dataHash:e.dataHash}}},{key:"fromJSON",value:function(t){return new e({id:t.id,version:t.version,account:t.account,month:t.month,syncStatus:t.syncStatus,prevMonths:t.prevMonths,prevVersions:t.prevVersions,dataHash:t.dataHash,timestamp:t.timestamp,updatedAt:t.updatedAt,daysInMonth:t.daysInMonth,summary:{balance:p.fromJSON(t.summary.balance),income:p.fromJSON(t.summary.income),expense:p.fromJSON(t.summary.expense),balanceOnStart:p.fromJSON(t.summary.balanceOnStart),balanceOnEnd:p.fromJSON(t.summary.balanceOnEnd)},days:t.days.map(it.fromJSON)})}}]),Object(h.a)(e,[{key:"getBrief",value:function(){return e.getBrief(this)}},{key:"getDataHash",value:function(){if(!this.days.length)return"0000000000000000000000000000000000000000";var e={days:this.days.map((function(e){return e.toJSON()}))};return Qe()(JSON.stringify(e)).toString()}},{key:"changeSyncStatus",value:function(t){if(t===this.syncStatus)return this;switch(this.syncStatus){case Ge.NoSynced:if(t===Ge.Prepared)return new e(Object(O.a)(Object(O.a)({},this),{},{syncStatus:t}));break;case Ge.Prepared:if(t===Ge.Syncing)return new e(Object(O.a)(Object(O.a)({},this),{},{syncStatus:t}));break;case Ge.Syncing:if(t===Ge.FullySynced)return new e(Object(O.a)(Object(O.a)({},this),{},{syncStatus:t}));break;case Ge.FullySynced:}throw new Error('Can not change sync status from "'.concat(Ge[this.syncStatus],'" to "').concat(Ge[t],'"'))}},{key:"createDay",value:function(e){if("number"===typeof e)return it.create(this.createDayDate(e));if(e.substr(0,7)===this.month)return it.create(e);throw new Error('Date "'.concat(e,'" not of month "').concat(this.month,'"'))}},{key:"createDayDate",value:function(e){return this.month+"-"+e.toString().padStart(2,"0")}},{key:"createNextBlock",value:function(t,n){var a=Object(st.a)(rt(t)),r={balanceOnStart:this.summary.balanceOnEnd,income:p.empty,expense:p.empty,balanceOnEnd:this.summary.balanceOnEnd,balance:p.empty};return new e({account:this.account,month:t,prevMonths:[this.id],prevVersions:[],timestamp:n,summary:r,days:[],daysInMonth:a,syncStatus:Ge.Fixed})}},{key:"isDateOfMonth",value:function(e){return e.substr(0,7)===this.month}},{key:"recalculateWithNewStartBalance",value:function(t){return new e(Object(O.a)(Object(O.a)({},this),{},{summary:lt(t,this.days)}))}},{key:"updatePrevMonths",value:function(t,n){var a=this;if(1!==t.length)throw new Error("Sorry, can not process not one prevMonths");if(t[0].month>=this.month)throw new Error("All prevMonths must be earlier then updating month");return t.length===this.prevMonths.length&&t.every((function(e,t){return a.prevMonths[t]===e.id}))?this:new e(Object(O.a)(Object(O.a)({},this),{},{timestamp:n,prevMonths:t.map((function(e){return e.id})),prevVersions:this.syncStatus?this.id?[this.id]:[]:this.prevVersions||[],summary:lt(p.from(t[0].summary.balanceOnEnd),this.days)}))}},{key:"getDay",value:function(e){return this.days.find((function(t){return t.date===e}))||this.createDay(e)}},{key:"updateDay",value:function(t){if(!(t instanceof it))throw new Error("Cannot update month, newDay must be instance of Day");if(!this.isDateOfMonth(t.date))throw new Error('Day "'.concat(t.date,'" not of month "').concat(this.month,'"'));var n=this.days.slice(),a=this.days.findIndex((function(e){return e.date===t.date}));-1===a?(n.push(t),n.sort((function(e,t){return e.date>t.date?1:-1}))):n.splice(a,1,t);var r=lt(this.summary.balanceOnStart,n);return new e(Object(O.a)(Object(O.a)({},this),{},{syncStatus:Ge.NoSynced,days:n,summary:r,prevVersions:this.syncStatus?this.id?[this.id]:[]:this.prevVersions||[]}))}}]),e}();function lt(e,t){var n=t.reduce((function(e,t){return nt(e,t.summary)}),Ze);return Object(O.a)(Object(O.a)({},n),{},{balanceOnStart:e,balanceOnEnd:e.add(n.balance)})}var dt=function(){function e(t){Object(m.a)(this,e),this.id="",this.name="",this.balance=p.empty,this.months=[],this.head=null,this.loaded=!1,Object.assign(this,t);ut.createFirstBlock("123","2020-10",123151213235)}return Object(h.a)(e,[{key:"toJSON",value:function(){return{id:this.id,name:this.name,balance:this.balance.toJSON()}}}],[{key:"create",value:function(t){return new e({id:Object(Xe.a)(),name:t})}},{key:"fromJSON",value:function(t){return new e({id:t.id,name:t.name,balance:p.from(t.balance)})}}]),e}(),mt={collection:"subsets",dbVersion:1,key:"id",upgrade:function(e,t,n){console.log("update subsets from ",t,n);var a=dt.create("Default");e.add(a.toJSON())}},ht=n(43),ft=n(69),pt=n(70),vt=n(71);function bt(e,t,n){e=ut.getBrief(e),t=t.map(ut.getBrief),n=n.map(ut.getBrief);var a=gt(e,t),r=a.chain,o=a.completed;if(0===n.length){if(o)return r;throw Object(ht.a)(Ot,Object(te.a)(r.pop().prevMonths))}if(o){if(!yt(r[r.length-1],n[n.length-1],t))throw new Et(n,r)}else{var c=r[r.length-1].prevMonths[0],i=n.findIndex((function(e){return e.id===c}));if(console.log("completed",o),console.log("preFirstIndex",i),console.log("head",[e.month,e.id,e.prevMonths,e.prevVersions].join(" ")),console.log("adds"),console.log(t.map((function(e){return[e.month,e.id,e.prevMonths,e.prevVersions].join(" ")}))),console.log("old chain"),console.log(n.map((function(e){return[e.month,e.id,e.prevMonths,e.prevVersions].join(" ")}))),-1===i)throw new Ot(c)}var s=new Set;n.forEach((function(e){return s.add(e.month)})),r.forEach((function(e){return s.add(e.month)}));var u=Array.from(s.keys());u.sort();var l=u.map((function(e){var a=r.find((function(t){return t.month===e})),o=n.find((function(t){return t.month===e})),c=a?yt(a,o,t):null;if(!1===c)throw new Et(n,r);return{month:e,oldEl:o,element:a,check:c}}));console.log("table"),console.table(l),l.reverse();var d=l.map((function(e){return e.element||e.oldEl}));if(function(e){if(0===e.length)return!1;console.log("check chain"),console.table(e);for(var t=0;t<e.length-1;t++){var n=e[t],a=e[t+1];if(a.month>=n.month)throw new wt("month must be less then ".concat(n.month),e,a);if(!n.prevMonths.length)throw new wt("unexpected end of chain",e,n);if(n.prevMonths.length>1)throw new wt("can not process month with not 1 prevMonths",e,n);if(n.prevMonths[0]!==a.id)throw new wt("invalid prevMonth",e,n)}}(d),d[0].id!==e.id)throw new Error("Invalid Head month");return d}function yt(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[];if(!t)return!0;if(e.month!==t.month)return!1;var a=[t].concat(Object(te.a)(n));if(e.prevVersions.every((function(e,n){return t.prevVersions[n]===e})))return!0;for(var r=function(){if(0===e.prevVersions.length)return{v:!1};if(e.prevVersions.length>1)throw new Error("\u042f \u043d\u0435 \u0443\u043c\u0435\u044e \u0432\u043e \u043c\u043d\u043e\u0433\u043e \u043f\u0440\u0435\u0434\u044b\u0434\u0443\u0449\u0438\u0445 \u043c\u0435\u0441\u044f\u0446\u0435\u0432");var t=e.prevVersions[0],n=a.find((function(e){return e.id===t}));if(!n)throw new Ot(t);e=n};e.id!==t.id;){var o=r();if("object"===typeof o)return o.v}return!0}function gt(e,t){for(var n=[],a=e,r=function(){if(n.push(a),0===a.prevMonths.length)return{v:{completed:!0,chain:n}};if(1!==a.prevMonths.length)throw new Error("Can not process merged month ".concat(a.id," (").concat(a.month,"): more then 1 prevMonths"));if(a.prevVersions.length>1)throw new Error("Can not process merged month ".concat(a.id," (").concat(a.month,"): more then 1 prevVersions"));var e=a.prevMonths[0];return(a=t.find((function(t){return t.id===e})))?void 0:{v:{completed:!1,chain:n}}};;){var o=r();if("object"===typeof o)return o.v}}var wt=function(e){Object(ft.a)(n,e);var t=Object(pt.a)(n);function n(e,a,r){var o;return Object(m.a)(this,n),(o=t.call(this,"Invalid chain: ".concat(e," at ").concat(r.id," (").concat(r.month,")"))).reason=e,o.chain=a,o.invalidMonth=r,o}return n}(Object(vt.a)(Error)),Ot=function(e){Object(ft.a)(n,e);var t=Object(pt.a)(n);function n(){var e;Object(m.a)(this,n);for(var a=arguments.length,r=new Array(a),o=0;o<a;o++)r[o]=arguments[o];return(e=t.call(this,"Required months: ".concat(r.join(", ")))).ids=void 0,e.ids=r,e}return n}(Object(vt.a)(Error)),Et=function(e){Object(ft.a)(n,e);var t=Object(pt.a)(n);function n(e,a){var r;return Object(m.a)(this,n),(r=t.call(this,["Can not fast forward","from ".concat(e[0].id," (").concat(e[0].month,", length ").concat(e.length,")"),"to ".concat(a[0].id," (").concat(a[0].month,", length ").concat(a.length,")")].join("\n"))).from=e,r.to=a,r}return n}(Object(vt.a)(Error)),jt=function(){function e(){Object(m.a)(this,e)}return Object(h.a)(e,null,[{key:"fromJSON",value:function(e){return{id:e.id,month:e.month,prevMonths:e.prevMonths,prevVersions:e.prevVersions,dataHash:e.dataHash,summary:{balance:p.fromJSON(e.summary.balance),income:p.fromJSON(e.summary.income),expense:p.fromJSON(e.summary.expense),balanceOnStart:p.fromJSON(e.summary.balanceOnStart),balanceOnEnd:p.fromJSON(e.summary.balanceOnEnd)}}}},{key:"toJSON",value:function(e){return{id:e.id,month:e.month,prevMonths:e.prevMonths,prevVersions:e.prevVersions,dataHash:e.dataHash,summary:{balance:e.summary.balance.toJSON(),income:e.summary.income.toJSON(),expense:e.summary.expense.toJSON(),balanceOnStart:e.summary.balanceOnStart.toJSON(),balanceOnEnd:e.summary.balanceOnEnd.toJSON()}}}}]),e}(),xt=function(){function e(t){return Object(m.a)(this,e),this.id="",this.name="",this.balance=p.empty,this.income=p.empty,this.expense=p.empty,this.head=null,this.months=[],this.fullMonths=Object(j.a)(),Object.assign(this,t)}return Object(h.a)(e,null,[{key:"create",value:function(t,n){return new e({id:n||Object(Xe.a)(),name:t})}},{key:"fromJSON",value:function(t){return new e({id:t.id,name:t.name,balance:p.fromJSON(t.balance),income:p.fromJSON(t.income),expense:p.fromJSON(t.expense),months:t.months.map(jt.fromJSON),head:t.head?jt.fromJSON(t.head):null})}}]),Object(h.a)(e,[{key:"toJSON",value:function(){return{id:this.id,name:this.name,balance:this.balance.toJSON(),income:this.income.toJSON(),expense:this.expense.toJSON(),months:this.months.map(jt.toJSON),head:this.head?jt.toJSON(this.head):null}}},{key:"forceSetHead_unsafe",value:function(t,n){var a=gt(t,n),r=a.chain;if(!a.completed){var o=r.pop(),c=[].concat(Object(te.a)(o.prevMonths),Object(te.a)(o.prevVersions)).filter((function(e){return!n.find((function(t){return t.id!==e}))}));throw Object(ht.a)(Ot,Object(te.a)(c))}var i=r.reduce((function(e,t){return nt(e,t.summary)}),et),s=i.income,u=i.expense,l=i.balance;return new e(Object(O.a)(Object(O.a)({},this),{},{head:t,months:r.map(ut.getBrief),balance:l,income:s,expense:u}))}},{key:"updateHead",value:function(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],a=bt(t,n,this.months),r=a.reduce((function(e,t){return nt(e,t.summary)}),et),o=r.income,c=r.expense,i=r.balance;return new e(Object(O.a)(Object(O.a)({},this),{},{head:ut.getBrief(t),months:a.map(ut.getBrief),balance:i,income:o,expense:c}))}},{key:"checkChain",value:function(){if(!this.head&&0===this.months.length)return!0;var e=gt(this.head,this.months),t=e.chain;return!!e.completed&&t.length===this.months.length}}]),e}(),_t={collection:"accounts",dbVersion:1,key:"id",upgrade:function(e,t,n){console.log("update account from ",t,n);var a=xt.create("Default");e.add(a.toJSON())}},St={collection:"months",dbVersion:1,key:"id",upgrade:function(e,t,n){console.log("update months from ",t,n)}},kt=new qe("test",[mt,_t,St]);var Nt={};function Mt(e,t){if(Nt[e.getType()])throw new Error('Can not add new handler for action "'.concat(e.getType(),'"'));Nt[e.getType()]=t}Mt(_,(function(e){localStorage.setItem("currentAccount",e)})),Mt(S,(function(e,t){kt.transaction(_t).getAll().then((function(e){if(!e.length)return console.warn("No accounts exists");t.dispatch(k({current:localStorage.getItem("currentAccount"),accounts:e.map(xt.fromJSON)}))}),(function(e){return t.dispatch(N(e))}))}));var At=n(9),It=n.n(At),Bt=n(94),Dt=n(18),Jt=new(function(){function e(){Object(m.a)(this,e),this.sagas=[]}return Object(h.a)(e,[{key:"register",value:function(e){this.sagas.push(e)}},{key:"onAction",value:function(e,t){arguments.length>2&&void 0!==arguments[2]&&arguments[2];this.register(It.a.mark((function n(){return It.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,Object(Dt.e)(e.getType(),t);case 2:case"end":return n.stop()}}),n)})))}},{key:"start",value:function(e){console.log("Start ".concat(this.sagas.length," sagas"));var t={dispatch:e.dispatch,getState:function(){return e.getState},channel:Object(Bt.b)()};e.subscribe(t.channel.put),this.sagas.forEach((function(e){return Object(Bt.a)(t,e)}))}}]),e}());var Tt={call:function(e){var t=It.a.mark((function t(){var n,a,r,o=arguments;return It.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:for(n=o.length,a=new Array(n),r=0;r<n;r++)a[r]=o[r];return t.next=3,Dt.a.apply(void 0,[e].concat(a));case 3:return t.abrupt("return",t.sent);case 4:case"end":return t.stop()}}),t)}));return t.originalSaga=e,t}},Vt=It.a.mark(Pt),Lt={selectAtom:Tt.call(Pt),getTimestamp:Tt.call(Wt)},Ct=function(e){return Object(Dt.a)(Pt,e)};function Pt(e){return It.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,Object(Dt.c)((function(t){return t(e)}));case 2:return t.abrupt("return",t.sent);case 3:case"end":return t.stop()}}),Vt)}var Ft=function(){return Object(Dt.a)(Wt)};function Wt(){return(new Date).getTime()}var Ht=It.a.mark(zt),Rt=It.a.mark(qt),Ut=It.a.mark(Gt),Yt={get:Tt.call(qt),getByIds:Tt.call(zt),save:Tt.call(Gt)};function zt(e){var t,n,a,r;return It.a.wrap((function(o){for(;;)switch(o.prev=o.next){case 0:return o.next=2,Ct(se);case 2:if(t=o.sent,console.log(t),n=e.filter((function(e){return!t.has(e)}))){o.next=7;break}return o.abrupt("return",e.map((function(e){return t.get(e)})));case 7:return o.next=9,Object(Dt.b)(ne(n));case 9:return o.next=11,Object(Dt.d)([ae,re]);case 11:if((a=o.sent).type!==ae.getType()){o.next=20;break}if(!a.payload.every((function(e,t){return e.id===n[t]}))){o.next=18;break}return o.delegateYield(It.a.mark((function t(){var n;return It.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,Ct(se);case 2:return n=t.sent,t.abrupt("return",{v:e.map((function(e){return n.get(e)}))});case 4:case"end":return t.stop()}}),t)}))(),"t0",15);case 15:if("object"!==typeof(r=o.t0)){o.next=18;break}return o.abrupt("return",r.v);case 18:o.next=22;break;case 20:if(!a.payload.ids.every((function(e,t){return e===n[t]}))){o.next=22;break}throw a.payload.error;case 22:o.next=9;break;case 23:case"end":return o.stop()}}),Ht)}function qt(e,t){var n,a,r,o,c,i,s,u,l,d,m,h,f,p,v,b,y,g;return It.a.wrap((function(w){for(;;)switch(w.prev=w.next){case 0:if(e.head){w.next=6;break}return w.next=3,Ft();case 3:return n=w.sent,console.log("timestamp",n),w.abrupt("return",ut.createFirstBlock(e.id,t,n));case 6:if(!(t>e.head.month)){w.next=15;break}return w.delegateYield(Yt.getByIds([e.head.id]),"t0",8);case 8:return a=w.t0,r=Object(je.a)(a,1),o=r[0],w.next=13,Ft();case 13:return c=w.sent,w.abrupt("return",o.createNextBlock(t,c));case 15:if(!((i=e.months.findIndex((function(e){return e.month===t})))>-1)){w.next=21;break}return s=e.months.slice(0,i+1).map((function(e){return e.id})),w.delegateYield(Yt.getByIds(s),"t1",19);case 19:return u=w.t1,w.abrupt("return",u.pop());case 21:l=[],d=0;case 23:if(!(d<e.months.length)){w.next=31;break}if(m=e.months[d],l.push(m.id),!(m.month<t)){w.next=28;break}return w.abrupt("break",31);case 28:d++,w.next=23;break;case 31:return w.delegateYield(Yt.getByIds(l),"t2",32);case 32:return h=w.t2,f=[],w.delegateYield(Lt.getTimestamp(),"t3",35);case 35:for(p=w.t3,v=h.pop(),b=v=v.createNextBlock(t,p),f.push(v),y=h.pop();y;y=h.pop())g=y.updatePrevMonths([v],p),f.push(g),v=g;return w.delegateYield(Yt.save(f),"t4",41);case 41:return w.abrupt("return",b);case 42:case"end":return w.stop()}}),Rt)}function Gt(e){var t,n;return It.a.wrap((function(a){for(;;)switch(a.prev=a.next){case 0:return a.next=2,Object(Dt.b)(oe(e));case 2:t=It.a.mark((function t(){var n;return It.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,Object(Dt.d)([ce.getType(),ie.getType()]);case 2:if(n=t.sent,console.log(n),n.type!==ce.getType()){t.next=9;break}if(!e.every((function(e,t){return n.payload[t]===e.id}))){t.next=7;break}return t.abrupt("return",{v:void 0});case 7:t.next=15;break;case 9:if(n.type!==ie.getType()){t.next=14;break}if(!e.every((function(e,t){return n.payload.ids[t]===e.id}))){t.next=12;break}throw n.payload.error;case 12:t.next=15;break;case 14:console.error("invalid action "+n.type,n);case 15:case"end":return t.stop()}}),t)}));case 3:return a.delegateYield(t(),"t0",4);case 4:if("object"!==typeof(n=a.t0)){a.next=7;break}return a.abrupt("return",n.v);case 7:a.next=3;break;case 9:case"end":return a.stop()}}),Ut)}var Xt=It.a.mark($t),Kt=It.a.mark(en),Qt=It.a.mark(tn),Zt={select:Tt.call($t),update:Tt.call(en),save:Tt.call(tn)};function $t(e){var t,n;return It.a.wrap((function(a){for(;;)switch(a.prev=a.next){case 0:return a.next=2,Object(Dt.c)((function(e){return e(B)}));case 2:if(t=a.sent,n=t.accounts.get(e)){a.next=6;break}throw new Error('Account "'.concat(e,'" not found'));case 6:return a.abrupt("return",n);case 7:case"end":return a.stop()}}),Xt)}function en(e,t){var n,a,r,o,c,i,s,u,l,d,m,h,f,p,v;return It.a.wrap((function(b){for(;;)switch(b.prev=b.next){case 0:if(console.log("*** updateAccountSaga"),console.log(e.months.map((function(e){return e.month}))),console.log(t.month,t.id),r=e.months.findIndex((function(e){return e.month===t.month})),o=e.months.findIndex((function(e){return e.month<t.month})),e.head){b.next=10;break}return b.delegateYield(Yt.save([t]),"t0",7);case 7:return c=e.updateHead(t),b.delegateYield(Zt.save(c),"t1",9);case 9:return b.abrupt("return",c);case 10:if(i=-1===r?o:r,s=e.months.slice(0,i+1).map((function(e){return e.id})),u=[t],console.log(s),!s.length){b.next=22;break}return b.t2=u.push,b.t3=u,b.t4=te.a,b.delegateYield(Yt.getByIds(s),"t5",19);case 19:b.t6=b.t5,b.t7=(0,b.t4)(b.t6),b.t2.apply.call(b.t2,b.t3,b.t7);case 22:return b.delegateYield(Lt.getTimestamp(),"t8",23);case 23:if(l=b.t8,console.log({currentMonthIndex:r,prevMonthIndex:o,toIndex:i,additions:u.map((function(e){return[e.month+" "+e.id]})),months:e.months.slice(0,i+1).map((function(e){return e.month}))}),d=[t],console.log("additional"),console.log(u.map((function(e){return"".concat(e.month," ").concat(e.id)}))),console.log("chain"),console.log(e.months.map((function(e){return"".concat(e.month," ").concat(e.id)}))),console.log("prevMonthIndex",o,null===(n=e.months[o])||void 0===n?void 0:n.month),-1!==r||-1!==o){b.next=33;break}throw new Error("Unexpection");case 33:if(-1!==r||-1===o){b.next=37;break}r=o,b.next=42;break;case 37:if((m=e.months[r]).month===t.month){b.next=40;break}throw new Error("somethings wrong");case 40:if(yt(t,m)){b.next=42;break}throw new Error("somethings wrong");case 42:if(console.log("currentMonthIndex",r,null===(a=e.months[r])||void 0===a?void 0:a.month),-1===r){b.next=52;break}for(h=t,f=function(t){console.log("index",t,e.months[t].month);var n=e.months[t].id,a=u.find((function(e){return e.id===n}));if(!a)throw new Ot(n);h=a.updatePrevMonths([h],l),u.push(h),d.push(h)},p=r-1;p>=0;p--)f(p);return console.log("additionalMonths",u.map((function(e){return[e.month+" "+e.id]}))),v=e.updateHead(h,u),b.delegateYield(Yt.save(d),"t9",50);case 50:return b.delegateYield(Zt.save(v),"t10",51);case 51:return b.abrupt("return",v);case 52:throw new Error("may be first");case 53:case"end":return b.stop()}}),Kt)}function tn(e){var t;return It.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,Object(Dt.b)(M(e));case 2:return n.next=4,Object(Dt.d)([A,I]);case 4:if((t=n.sent).type!==A.getType()){n.next=10;break}if(t.payload!==e.id){n.next=8;break}return n.abrupt("return");case 8:n.next=12;break;case 10:if(t.payload.id!==e.id){n.next=12;break}throw t.payload.error;case 12:n.next=2;break;case 14:case"end":return n.stop()}}),Qt)}var nn=It.a.mark(an);function an(e){var t,n,a,r,o,c,i;return It.a.wrap((function(s){for(;;)switch(s.prev=s.next){case 0:return console.log("*** addTransactionSaga started"),t=e.payload,s.delegateYield(Zt.select(t.account),"t0",3);case 3:return n=s.t0,s.delegateYield(Yt.get(n,ot(t.date)),"t1",5);case 5:return a=s.t1,console.log("addTransactionSaga",a.id,a.prevVersions),r=ct.create(t.type,t.amount,"RUB"),o=a.getDay(t.date).addTransaction(r),c=a.updateDay(o),console.log("updatedMonth",c.id,c.prevVersions),s.delegateYield(Zt.update(n,c),"t2",12);case 12:return i=s.t2,console.log("*** addTransactionSaga complete"),s.abrupt("return",i);case 15:case"end":return s.stop()}}),nn)}Jt.onAction(Ae,an);var rn=It.a.mark(on);function on(){var e;return It.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:console.log("init transactionUpdateSaga");case 1:return t.next=4,Object(Dt.d)(k.getType());case 4:e=t.sent,console.log("load successssssss",e),t.next=1;break;case 8:case"end":return t.stop()}}),rn)}Jt.register(on);var cn,sn=function(){Object(i.c)(ke);return function(e){console.log("useDBReady");var t=function(t){console.log(Me[t]),t===Me.Ready&&e()};Object(a.useEffect)((function(){return kt.addStatusListener(t),function(){return kt.removeStatusListener(t)}}))}(Object(i.b)((function(){var e;return console.log("*** refreshAllHandler"),(e=Ne).subscribe((function(t){switch(console.log(t),Nt[t.type]&&Nt[t.type](t.payload,e),t.type){case M.getType():var n=t.payload;kt.transaction(_t).update(n.toJSON()).then((function(t){return e.dispatch(A(n.id))}),(function(t){return e.dispatch(I({id:n.id,error:t}))}));break;case ne.getType():var a=t.payload;kt.transaction(St).getAll(a).then((function(t){console.log(a),console.log(t);var n=t.map(ut.fromJSON);e.dispatch(ae(n))}),(function(t){return e.dispatch(re({ids:a,error:t}))}));break;case oe.getType():var r=t.payload.map((function(e){return e.toJSON()})),o=r.map((function(e){return e.id})),c=kt.transaction(St);Promise.all(r.map((function(e){return c.update(e)}))).then((function(){return e.dispatch(ce(o))}),(function(t){return e.dispatch(ie({ids:o,error:t}))}))}})),console.log("*** refreshAllHandler complete"),Se()}),[])),r.a.createElement("div",{className:u.a.App},r.a.createElement(d.a,null,r.a.createElement(l.d,null,Pe.map((function(e,t){return r.a.createElement(l.b,Object.assign({},e,{key:t}))})),r.a.createElement(l.a,{to:Ve.home()})),r.a.createElement(Ue,null)))};(cn=Ne).dispatch(_e(navigator.onLine)),window.addEventListener("online",(function(){return cn.dispatch(_e(!0))})),window.addEventListener("offline",(function(){return cn.dispatch(_e(!1))})),Jt.start(Ne);Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));c.a.render(r.a.createElement(r.a.StrictMode,null,r.a.createElement(i.a.Provider,{value:Ne},r.a.createElement(sn,null))),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()})).catch((function(e){console.error(e.message)})),function(){console.log("*************** initDB");var e=[{ssn:"444-44-4444",name:"Bill",age:35,email:"bill@company.com"},{ssn:"555-55-5555",name:"Donna",age:32,email:"donna@home.org"}],t=indexedDB.open("the_name",3);t.onerror=function(e){},t.onsuccess=function(e){var t=e.target.result;window.db=t,t.transaction(["customers"],"readwrite").objectStore("customers").add({age:44,email:"asd",name:"asd",ssn:"123"}).onsuccess=function(e){return console.log(e)}},t.onupgradeneeded=function(t){var n=t.target.result;console.log("upgrade");var a=n.createObjectStore("customers",{keyPath:"ssn"});for(var r in a.createIndex("name","name",{unique:!1}),a.createIndex("email","email",{unique:!0}),e)a.add(e[r])}}()},29:function(e,t,n){e.exports={txList:"TxList_txList__3rowt",txItem:"TxList_txItem__2-7sR",txItem__left:"TxList_txItem__left__3Dekh",txItem__first:"TxList_txItem__first__eF_WE",txItem__second:"TxList_txItem__second__-lQ89",txItem__amount:"TxList_txItem__amount__2PbUA",txItem__date:"TxList_txItem__date__3uUSP",empty:"TxList_empty__2S-7j"}},33:function(e,t,n){e.exports={list_cover:"DetailsMainButton_list_cover__2DdLg",button:"DetailsMainButton_button__3YOZv",left:"DetailsMainButton_left__3m4Lo",title:"DetailsMainButton_title__1uX6F",bar:"DetailsMainButton_bar__2XK9g",moreGood:"DetailsMainButton_moreGood__2D5VT",barGood:"DetailsMainButton_barGood__1Qzv3",barNormal:"DetailsMainButton_barNormal__1lJoy",barBad:"DetailsMainButton_barBad__ftJbe",right:"DetailsMainButton_right__P2GXw"}},37:function(e,t,n){e.exports={accountPage:"AccountsPage_accountPage__1j2V2",accountWidget:"AccountsPage_accountWidget__uYsSo",name:"AccountsPage_name__2LT7U",balance:"AccountsPage_balance__xyUA5",addTx:"AccountsPage_addTx__KMHVA",accountStyle_blue:"AccountsPage_accountStyle_blue__K6Eqo",accountStyle_green:"AccountsPage_accountStyle_green__3Hm77"}},45:function(e,t,n){e.exports={swipeWidget:"SwipeWidget_swipeWidget__12ZdL",prev:"SwipeWidget_prev__UDZne",next:"SwipeWidget_next__1huSl",swipe:"SwipeWidget_swipe__1ww0t","swipe-wrap":"SwipeWidget_swipe-wrap__x4MEz",swipeItem:"SwipeWidget_swipeItem__2D3OP"}},57:function(e,t,n){e.exports={moneyView:"MoneyView_moneyView__2U7sP",fractional:"MoneyView_fractional__1hdQj"}},58:function(e,t,n){e.exports={licenses:"LicensesPage_licenses__3Ik4Y"}},67:function(e,t,n){e.exports={days:"MonthTxList_days__1hzzo",day:"MonthTxList_day__1_h7Y",title:"MonthTxList_title__VajvW"}},68:function(e,t,n){e.exports={page:"TransactionsPage_page__1uE4j",filter:"TransactionsPage_filter__3x4B8",active:"TransactionsPage_active__3XoOk"}},88:function(e,t,n){e.exports={header:"Header_header__30F5v",title:"Header_title__1vmPo"}}},[[150,1,2]]]);
//# sourceMappingURL=main.3db261dc.chunk.js.map