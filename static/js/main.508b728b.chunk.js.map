{"version":3,"sources":["App.module.scss","pages/LicensesPage.module.scss","../node_modules/@ionic/core/dist/esm-es5 lazy /^/.//.*/.entry/.js$/ include: //.entry/.js$/ exclude: //.system/.entry/.js$/ groupOptions: {} namespace object","../node_modules/ionicons/dist/esm-es5 lazy /^/.//.*/.entry/.js$/ include: //.entry/.js$/ exclude: //.system/.entry/.js$/ groupOptions: {} namespace object","ui-kit/Icon.tsx","components/Header.tsx","widgets/SwipeWidget.tsx","store/reatom.ts","ui-kit/Main.tsx","libs/packable/packable.types.ts","libs/packable/packable.ts","libs/packable/decorator.ts","models/money/money.class.ts","components/MoneyView.tsx","widgets/StatBox.tsx","widgets/GripQuickDetails.tsx","components/CategoryIcon.tsx","models/transaction/transaction.types.ts","widgets/QuickCategories.tsx","widgets/AccountWidget.tsx","atoms/account-grips/account-grips.actions.ts","atoms/account-grips/account-grips.atom.ts","widgets/LastMonthsList.tsx","pages/AccountsPage.tsx","atoms/months/months.actions.ts","widgets/TxList.tsx","widgets/TxList.utils.ts","ui-kit/Section.tsx","widgets/MonthTxList.tsx","widgets/MonthViewWidget.tsx","atoms/month-grips/month-grips.actions.ts","atoms/month-grips/month-grips.atom.ts","pages/AccountMonthsPage.tsx","routes/accounts.ts","routes/config.ts","atoms/client/client.actions.ts","atoms/client/client.atom.ts","atoms/accounts/accounts.actions.ts","atoms/accounts/accounts.atom.ts","atoms/months/months.atom.ts","atoms/categories/categories.actions.ts","models/category/category.class.ts","atoms/categories/categories.atom.ts","store/store.ts","models/transaction/transaction.actions.ts","components/inputs/BaseInput.tsx","components/inputs/MoneyField.tsx","components/inputs/TxTypeField.tsx","components/inputs/TextField.tsx","components/inputs/DayDateField.tsx","components/inputs/SelectField.tsx","components/inputs/AccountField.tsx","components/inputs/CategoryField.tsx","widgets/TransactionForm.tsx","ui-kit/Card.tsx","models/abstract-grip/month-grip.class.ts","models/abstract-grip/transaction-grip.class.ts","models/account-grip/day-grip.class.ts","models/abstract-grip/day-grip.class.ts","models/account-grip/month-grip.class.ts","models/common/date.utils.ts","hooks/index.ts","pages/TransactionViewPage.tsx","routes/transactions.ts","pages/TransactionAddPage.tsx","pages/TransactionsPage.tsx","routes/paths.ts","pages/LicensesPage.tsx","routes/routes.tsx","pages/MainMenu.tsx","routes/Link.tsx","widgets/NavBar.tsx","libs/indexed-db/db.types.ts","libs/indexed-db/db.utils.ts","libs/indexed-db/collection.ts","libs/indexed-db/db.ts","db/schemes/account.scheme.ts","models/common/common.types.ts","db/schemes/month.scheme.ts","models/month/month.types.ts","models/transaction/transactions.utils.ts","models/transaction/transaction.class.ts","models/day/day.class.ts","models/month/month.class.ts","models/account/chain.utils.ts","models/account/account.class.ts","models/category/categoryBlock.class.ts","db/data/initialCategories.ts","db/schemes/categories.scheme.ts","db/db.ts","db/handlers/accounts.ts","db/handlers/months.ts","db/handlers/categoriesBlocks.ts","sagas/saga-launcher.ts","sagas/sagas/refresh.saga.ts","sagas/helpers/helpers.ts","sagas/utils/categoriesBlock.saga.ts","models/account-grip/grip.class.ts","models/abstract-grip/grip.class.ts","sagas/sagas/update-account-grips.saga.ts","sagas/utils/month.saga.ts","sagas/utils/account.saga.ts","sagas/sagas/update-month-grips.saga.ts","sagas/sagas/transaction-add.saga.ts","sagas/sagas/transaction-update.saga.ts","App.tsx","atoms/client/client.service.ts","db/hooks.ts","serviceWorker.ts","index.tsx","widgets/MonthViewWidget.module.scss","widgets/TxList.module.scss","components/MoneyView.module.scss","widgets/SwipeWidget.module.scss","pages/TransactionsPage.module.scss"],"names":["module","exports","map","webpackAsyncContext","req","__webpack_require__","o","Promise","resolve","then","e","Error","code","ids","id","keys","Object","Icons","icons","IconRegistry","IonIcons","Icon","icon","name","className","size","mode","Header","title","back","children","history","useHistory","onClick","useCallback","goBack","replace","role","aria-label","SwipeWidget","swipeEl","showButtons","onChange","current","_","items","flat","currentIndex","findIndex","item","key","console","log","useEffect","slide","prev","next","length","styles","swipeWidget","ref","swipe","callback","index","startSlide","speed","auto","SwipeItemWidget","swipeItem","useForceUpdate","useReducer","s","defaultMapper","atomValue","useAtom","atom","selector","deps","store","useContext","context","forceUpdate","value","getState","subscribe","state","Main","styled","main","EncoderSymbol","Symbol","DecoderSymbol","Packer","decoder","encoder","decode","encode","this","target","prototype","packer","getSafe","rule","String","Number","Boolean","forPrimitive","Array","isArray","forArray","type","raw","fields","list","entries","field","for","data","reduce","obj","afterDecode","forObject","val","undefined","FieldsSymbol","PackableClass","constructor","forClass","Packable","init","currencies","RUB","symbol","precision","Money","fromJSON","toJSON","initResult","subunits","currency","amount","toFixed","clone","parts","trim","split","amountText","currencyName","toUpperCase","units","isNaN","Math","round","money","withSign","str","floor","toString","substr","empty","create","MoneyView","sign","moneyView","entire","JSON","stringify","getEntire","fractional","getFractional","getSymbol","BarColor","StatBoxContainer","div","StatBox","progress","color","percent","GripQuickDetails","grip","month","months","income","Neutral","expense","planed","total","balance","getQuickDetails","stats","addCircleOutline","removeCircleOutline","calendarOutline","cashOutline","row","cell","cellIndex","TransactionType","CategoryIconBox","span","process","props","CategoryIcon","category","image","width","style","backgroundImage","QuickCategoriesBox","QuickCategories","categories","parent","defaultTxType","Income","Link","to","paths","transactions","add","account","AccountWidget","data-toggle","cogOutline","href","pencilOutline","closeOutline","arrowUpCircleOutline","NS","chooseAccountGrip","declareAction","updateAccountGrip","updateAccountGripSuccess","updateAccountGrips","updateAccountGripsSuccess","AccountGrips","declareAtom","currentID","accounts","Map","on","choose","get","update","set","grips","acc","LastMonthsList","slice","margin","format","Date","AccountsPage","chooseAccountHandler","useAction","from","values","loadMonths","loadMonthsSuccess","loadMonthsFailed","saveMonths","saveMonthsSuccess","saveMonthsFailed","TxList","React","memo","txList","dayDate","first","second","dateString","date","makeTxList","tx","view","SectionContainer","section","full","SectionTitle","h3","Section","MonthTxList","days","day","MonthViewHeadWidget","brief","circumference","totalSum","incomePercent","expensePercent","head","info","circle","height","transform","r","cx","cy","stroke","strokeDasharray","join","updateMonthGripSuccess","updateMonthGripsSuccess","MonthGrips","AccountMonthsPage","params","useRouteMatch","reverse","newMonthNum","lastMonthDate","AccountMonthsPageDisplay","monthsList","changeMonth","loadMonth","monthIndex","monthBrief","prevMonth","nextMonth","has","currentMonth","accountsRoutes","path","exact","component","setOnlineStatus","refresh","Client","online","chooseAccount","loadAccounts","loadAccountsSuccess","loadAccountsFailed","saveAccount","saveAccountSuccess","saveAccountFailed","Accounts","load","save","Months","loadCategories","loadCategoriesSuccess","loadCategoriesFailed","saveCategories","Category","assign","defaultTransactionType","v4","setParent","isInitial","Expense","RootCategory","filter","Categories","collection","block","tree","flatMap","createStore","combine","connectReduxDevtools","action","group","payload","groupEnd","addTransaction","BaseInput","label","clearable","placeholder","hint","render","useField","input","useRef","useState","active","setActive","onFocus","onBlur","onClearInput","focus","htmlFor","NumberFormatCustom","inputRef","other","getInputRef","onValueChange","prefix","thousandSeparator","isNumericString","MoneyField","meta","CheckboxWrapper","TxTypeCheckbox","disabled","checked","TxTypeField","types","TextField","DayDateField","SelectField","options","AccountField","CategoryField","cat","TransactionForm","onSubmit","validate","initialValues","handleSubmit","form","submitting","pristine","noValidate","autoComplete","Card","toStringTag","AbstractMonthGrip","balanceOnStart","balanceOnEnd","tags","last","forEach","lastSum","sum","equal","sub","TransactionGrip","changeAmount","createdAt","sourceTxs","updatedAt","AccountDayGrip","Set","negative","gripTransactions","isPositive","isNegative","AccountMonthGrip","push","parseMonthDate","match","year","getFullYear","getMonth","dayDateToMonth","useMonth","accountId","useAccount","monthDate","foundMonthBrief","find","monthData","summary","URLSearchParams","addQueryString","txId","transactionRoutes","useLocation","search","currentAccount","setData","dispatch","errors","useTransaction","padding","arrowForwardOutline","page","home","licenses","menu","LicenseItem","link","author","license","routes","marginLeft","marginRight","ReactRouterDom","NavLink","links","walletOutline","ellipsisHorizontalOutline","NavBar","DBStatus","eventLogger","emitter","emitterName","eventName","addEventListener","event","Collection","db","scheme","transaction","storage","objectStore","reject","request","onsuccess","result","onerror","error","query","count","all","getAll","put","IndexedDB","dbName","schemes","onInstall","onUpgrade","listeners","_status","Initializing","window","indexedDB","version","max","model","dbVersion","openDB","Ready","Migrating","getAccessor","fn","setTimeout","status","setStatus","openRequest","open","isUpgrade","oldVersion","newVersion","Upgrading","objectStoreNames","warn","createObjectStore","keyPath","upgrade","a","Failed","SyncStatus","AccountScheme","MonthScheme","summaryPacker","extendSummaryPacker","EmptySummary","EmptyExtendSummary","freeze","monthBriefPacker","maybe","prevMonths","prevVersions","dataHash","EMPTY_SUMMARY","calculateSummary","Removed","addSummary","base","checkSummary","Transaction","setAmount","uuidGenerator","Day","dateTime","getDate","parseDayDate","Month","getDataHash","generateID","timestamp","daysInMonth","getDaysInMonth","syncStatus","Fixed","hash","sha1","monthID","padStart","ts","blocks","revisions","getBrief","NoSynced","Prepared","Syncing","FullySynced","createDayDate","startBalance","calculateSummaryFromStartBalance","every","createDay","newDay","isDateOfMonth","dayIndex","sort","b","splice","baseSummary","updateMonthChain","additions","old","findChain","chain","completed","RequiredMonthsError","pop","isVersionOfMonth","CanNotFastForwardMonthError","preFirstID","preFirstIndex","monthsNumbersSet","monthsNumbers","table","element","oldEl","check","newChain","i","MonthChainError","checkChain","nextId","lastBlock","nextID","reason","invalidMonth","Account","fullMonths","required","categoriesBlockId","CategoriesBlock","initialsCategories","createInitial","defaultType","child","exists","CategoryConflictError","toLowerCase","toRemove","message","initialCategories","CategoriesScheme","defaultAccount","categoriesBlock","createInitialBlock","getTime","UNSAFE_updateCategoriesBlock","handlers","addActionHandler","handler","getType","localStorage","setItem","getItem","sagaLauncher","sagas","saga","actionCreator","register","takeEvery","sagaOptions","channel","stdChannel","runSaga","SagaPacker","call","PackedSaga","originalSaga","refreshSaga","take","resultAction","onAction","selectAtomFn","SagaUtils","selectAtom","getTimestamp","getTimestampFn","select","getCategoriesBlockSaga","CategoriesBlockUtils","categoriesBlocks","AccountGrip","firstMonthDate","makeMonthGripBriefFromMonthBrief","updateAccountGripsSaga","updateAccountGripSaga","fork","f","getMonthsByIdsSaga","getMonthSaga","saveMonthsSaga","MonthUtils","getByIds","notExists","createFirstBlock","createNextBlock","indexOfMonth","monthsIds","monthsToSave","lastMonth","newMonth","updated","updatePrevMonths","selectAccountSaga","getAccountGripSaga","updateAccountSaga","saveAccountSaga","AccountUtils","getGrip","currentMonthIndex","prevMonthIndex","accountToUpdate","updateHead","toIndex","additionalMonths","monthsToUpdate","existsMonth","previousMonth","currentMonthId","updateMonthGripsSaga","updateMonthGripSaga","accountGrip","makeMonth","addTransactionSaga","setTitle","setCategory","getDay","updatedMonth","updateDay","transactionUpdateSaga","App","onReady","onChangeStatusEvent","addStatusListener","removeStatusListener","useDBReady","route","navigator","onLine","start","location","hostname","ReactDOM","StrictMode","Provider","document","getElementById","serviceWorker","ready","registration","unregister","catch"],"mappings":"qFACAA,EAAOC,QAAU,CAAC,IAAM,iBAAiB,WAAW,sBAAsB,gBAAgB,2BAA2B,aAAa,wBAAwB,WAAW,wB,0CCArKD,EAAOC,QAAU,CAAC,SAAW,iC,gFCD7B,IAAIC,EAAM,CACT,8BAA+B,CAC9B,IACA,GAED,uBAAwB,CACvB,IACA,GAED,uBAAwB,CACvB,IACA,GAED,0BAA2B,CAC1B,IACA,IAED,6BAA8B,CAC7B,IACA,IAED,0BAA2B,CAC1B,IACA,IAED,0BAA2B,CAC1B,IACA,IAED,wBAAyB,CACxB,IACA,IAED,0BAA2B,CAC1B,IACA,IAED,sBAAuB,CACtB,IACA,IAED,uBAAwB,CACvB,IACA,IAED,4BAA6B,CAC5B,IACA,IAED,uBAAwB,CACvB,IACA,IAED,qBAAsB,CACrB,IACA,IAED,mCAAoC,CACnC,IACA,IAED,uBAAwB,CACvB,IACA,IAED,+BAAgC,CAC/B,IACA,IAED,wBAAyB,CACxB,IACA,IAED,yBAA0B,CACzB,IACA,IAED,wBAAyB,CACxB,IACA,IAED,uBAAwB,CACvB,IACA,GAED,uBAAwB,CACvB,IACA,IAED,yBAA0B,CACzB,IACA,GAED,8BAA+B,CAC9B,IACA,IAED,yBAA0B,CACzB,IACA,IAED,uBAAwB,CACvB,IACA,IAED,6BAA8B,CAC7B,IACA,IAED,2BAA4B,CAC3B,IACA,IAED,+BAAgC,CAC/B,IACA,IAED,yBAA0B,CACzB,IACA,IAED,2BAA4B,CAC3B,IACA,IAED,2BAA4B,CAC3B,IACA,IAED,0BAA2B,CAC1B,IACA,IAED,yBAA0B,CACzB,IACA,IAED,yBAA0B,CACzB,IACA,IAED,4BAA6B,CAC5B,IACA,IAED,2BAA4B,CAC3B,IACA,IAED,uBAAwB,CACvB,IACA,IAED,sBAAuB,CACtB,IACA,IAED,0BAA2B,CAC1B,IACA,IAED,uBAAwB,CACvB,IACA,IAED,wBAAyB,CACxB,IACA,IAED,gCAAiC,CAChC,IACA,KAGF,SAASC,EAAoBC,GAC5B,IAAIC,EAAoBC,EAAEJ,EAAKE,GAC9B,OAAOG,QAAQC,UAAUC,MAAK,WA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","file":"static/js/main.508b728b.chunk.js","sourcesContent":["// extracted by mini-css-extract-plugin\nmodule.exports = {\"App\":\"App_App__15LM-\",\"App-logo\":\"App_App-logo__1GLNd\",\"App-logo-spin\":\"App_App-logo-spin__1EbLw\",\"App-header\":\"App_App-header__3nnPn\",\"App-link\":\"App_App-link__TRj1P\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"licenses\":\"LicensesPage_licenses__3Ik4Y\"};","var map = {\n\t\"./ion-action-sheet.entry.js\": [\n\t\t341,\n\t\t5\n\t],\n\t\"./ion-alert.entry.js\": [\n\t\t342,\n\t\t6\n\t],\n\t\"./ion-app_8.entry.js\": [\n\t\t343,\n\t\t7\n\t],\n\t\"./ion-avatar_3.entry.js\": [\n\t\t344,\n\t\t18\n\t],\n\t\"./ion-back-button.entry.js\": [\n\t\t345,\n\t\t19\n\t],\n\t\"./ion-backdrop.entry.js\": [\n\t\t346,\n\t\t43\n\t],\n\t\"./ion-button_2.entry.js\": [\n\t\t347,\n\t\t20\n\t],\n\t\"./ion-card_5.entry.js\": [\n\t\t348,\n\t\t21\n\t],\n\t\"./ion-checkbox.entry.js\": [\n\t\t349,\n\t\t22\n\t],\n\t\"./ion-chip.entry.js\": [\n\t\t350,\n\t\t23\n\t],\n\t\"./ion-col_3.entry.js\": [\n\t\t351,\n\t\t44\n\t],\n\t\"./ion-datetime_3.entry.js\": [\n\t\t352,\n\t\t10\n\t],\n\t\"./ion-fab_3.entry.js\": [\n\t\t353,\n\t\t24\n\t],\n\t\"./ion-img.entry.js\": [\n\t\t354,\n\t\t45\n\t],\n\t\"./ion-infinite-scroll_2.entry.js\": [\n\t\t355,\n\t\t46\n\t],\n\t\"./ion-input.entry.js\": [\n\t\t356,\n\t\t25\n\t],\n\t\"./ion-item-option_3.entry.js\": [\n\t\t357,\n\t\t26\n\t],\n\t\"./ion-item_8.entry.js\": [\n\t\t358,\n\t\t27\n\t],\n\t\"./ion-loading.entry.js\": [\n\t\t359,\n\t\t28\n\t],\n\t\"./ion-menu_3.entry.js\": [\n\t\t360,\n\t\t29\n\t],\n\t\"./ion-modal.entry.js\": [\n\t\t361,\n\t\t8\n\t],\n\t\"./ion-nav_2.entry.js\": [\n\t\t362,\n\t\t15\n\t],\n\t\"./ion-popover.entry.js\": [\n\t\t363,\n\t\t9\n\t],\n\t\"./ion-progress-bar.entry.js\": [\n\t\t364,\n\t\t30\n\t],\n\t\"./ion-radio_2.entry.js\": [\n\t\t365,\n\t\t31\n\t],\n\t\"./ion-range.entry.js\": [\n\t\t366,\n\t\t32\n\t],\n\t\"./ion-refresher_2.entry.js\": [\n\t\t367,\n\t\t11\n\t],\n\t\"./ion-reorder_2.entry.js\": [\n\t\t368,\n\t\t17\n\t],\n\t\"./ion-ripple-effect.entry.js\": [\n\t\t369,\n\t\t47\n\t],\n\t\"./ion-route_4.entry.js\": [\n\t\t370,\n\t\t33\n\t],\n\t\"./ion-searchbar.entry.js\": [\n\t\t371,\n\t\t34\n\t],\n\t\"./ion-segment_2.entry.js\": [\n\t\t372,\n\t\t35\n\t],\n\t\"./ion-select_3.entry.js\": [\n\t\t373,\n\t\t36\n\t],\n\t\"./ion-slide_2.entry.js\": [\n\t\t374,\n\t\t48\n\t],\n\t\"./ion-spinner.entry.js\": [\n\t\t375,\n\t\t13\n\t],\n\t\"./ion-split-pane.entry.js\": [\n\t\t376,\n\t\t49\n\t],\n\t\"./ion-tab-bar_2.entry.js\": [\n\t\t377,\n\t\t37\n\t],\n\t\"./ion-tab_2.entry.js\": [\n\t\t378,\n\t\t16\n\t],\n\t\"./ion-text.entry.js\": [\n\t\t379,\n\t\t38\n\t],\n\t\"./ion-textarea.entry.js\": [\n\t\t380,\n\t\t39\n\t],\n\t\"./ion-toast.entry.js\": [\n\t\t381,\n\t\t40\n\t],\n\t\"./ion-toggle.entry.js\": [\n\t\t382,\n\t\t12\n\t],\n\t\"./ion-virtual-scroll.entry.js\": [\n\t\t383,\n\t\t50\n\t]\n};\nfunction webpackAsyncContext(req) {\n\tif(!__webpack_require__.o(map, req)) {\n\t\treturn Promise.resolve().then(function() {\n\t\t\tvar e = new Error(\"Cannot find module '\" + req + \"'\");\n\t\t\te.code = 'MODULE_NOT_FOUND';\n\t\t\tthrow e;\n\t\t});\n\t}\n\n\tvar ids = map[req], id = ids[0];\n\treturn __webpack_require__.e(ids[1]).then(function() {\n\t\treturn __webpack_require__(id);\n\t});\n}\nwebpackAsyncContext.keys = function webpackAsyncContextKeys() {\n\treturn Object.keys(map);\n};\nwebpackAsyncContext.id = 216;\nmodule.exports = webpackAsyncContext;","var map = {\n\t\"./ion-icon.entry.js\": [\n\t\t387,\n\t\t57\n\t]\n};\nfunction webpackAsyncContext(req) {\n\tif(!__webpack_require__.o(map, req)) {\n\t\treturn Promise.resolve().then(function() {\n\t\t\tvar e = new Error(\"Cannot find module '\" + req + \"'\");\n\t\t\te.code = 'MODULE_NOT_FOUND';\n\t\t\tthrow e;\n\t\t});\n\t}\n\n\tvar ids = map[req], id = ids[0];\n\treturn __webpack_require__.e(ids[1]).then(function() {\n\t\treturn __webpack_require__(id);\n\t});\n}\nwebpackAsyncContext.keys = function webpackAsyncContextKeys() {\n\treturn Object.keys(map);\n};\nwebpackAsyncContext.id = 238;\nmodule.exports = webpackAsyncContext;","import { IonIcon } from '@ionic/react';\nimport React from 'react';\nimport * as IonIcons from 'ionicons';\nimport * as icons from 'ionicons/icons';\n\nexport const Icons = icons;\n\nconst IconRegistry = {\n    'list-outline': icons.notificationsOutline,\n    'menu-outline': icons.menuOutline,\n    'close-circle': icons.closeCircle,\n    'notifications-outline': icons.notificationsOutline,\n    'chevron-back-outline': icons.chevronBackOutline,\n};\n\nIonIcons.addIcons(IconRegistry);\n\ninterface IProps {\n    name: string;\n    className?: string;\n    size?: string;\n}\n\nexport const Icon = ({icon, name, className, size}: IProps & any) => {\n    className = className || 'icon';\n    if (!icon && name) {\n        if (!IconRegistry[name])\n            throw new Error(`Icon \"${name}\" not loaded`);\n        icon = IconRegistry[name];\n    }\n    return <IonIcon mode=\"ios\" icon={icon} className={className} size={size}/>;\n};\n","import React, { ReactNode, useCallback } from 'react';\n\nimport { Icon } from '../ui-kit/Icon';\nimport { useHistory } from 'react-router';\n\ninterface IParams {\n    title: string;\n    back?: string | boolean;\n    children?: ReactNode;\n}\n\nexport const Header = ({title, back, children}: IParams) => {\n    const history = useHistory();\n\n    const onClick = useCallback(() => {\n        if (!back)\n            return;\n        if (back === true)\n            return history.goBack();\n        history.replace(back);\n    }, [history, back]);\n\n    return (\n        <div className=\"appHeader\">\n            {back &&\n            <div className=\"left\">\n                <span onClick={onClick} className=\"headerButton goBack\">\n                    <Icon name=\"chevron-back-outline\" role=\"img\" className=\"md hydrated\"\n                          aria-label=\"chevron back outline\"/>\n                </span>\n            </div>\n            }\n            <div className=\"pageTitle\">{title}</div>\n            <div className=\"right\">\n                {children}\n            </div>\n        </div>\n    );\n};\n","import Swipe, { SwipeItem } from 'swipejs/react';\nimport React, { Key, ReactElement, ReactNode, useEffect } from 'react';\nimport styles from './SwipeWidget.module.scss';\n\ninterface IProps {\n    showButtons?: boolean;\n    current?: Key;\n\n    onChange?: (key: Key) => void;\n\n    children: ReactNode[];\n}\n\nexport const SwipeWidget = ({showButtons, children, onChange, current}: IProps) => {\n    let swipeEl: any;\n\n    onChange = onChange || ((_) => null);\n\n    const items = children.flat() as ReactElement[];\n\n    let currentIndex = (items as any).findIndex(item => item.key === current);\n    if (currentIndex === -1)\n        currentIndex = 0;\n\n    console.log('!!!', current, currentIndex);\n    console.log(items);\n    useEffect(() => swipeEl.slide(currentIndex, 0), [currentIndex, swipeEl]);\n\n    const callback = (index) => {\n        console.log('current', index);\n        const current = items[index];\n        console.log('current', current);\n        onChange(current.key);\n    };\n\n    const prev = showButtons && currentIndex > 0 ? items[currentIndex - 1].key : '';\n    const next = showButtons && currentIndex < items.length - 1 ? items[currentIndex + 1].key : '';\n\n    const moveToPrev = () => {\n        swipeEl.prev();\n    };\n\n    const moveToNext = () => {\n        swipeEl.next();\n    };\n\n    return (\n        <div className={styles.swipeWidget}>\n            <Swipe ref={o => swipeEl = o}\n                   className={styles.swipe}\n                   callback={callback}\n                   startSlide={currentIndex}\n                   speed={0}\n                   auto={0}>\n                {items}\n            </Swipe>\n            {prev && <div className={styles.prev}\n                          onClick={moveToPrev}>\n                {/*<svg width=\"24\" height=\"24\"*/}\n                {/*     xmlns=\"http://www.w3.org/2000/svg\"*/}\n                {/*     fillRule=\"evenodd\"*/}\n                {/*     clipRule=\"evenodd\">*/}\n                {/*    <path d=\"M20 .755l-14.374 11.245 14.374 11.219-.619.781-15.381-12 15.391-12 .609.755z\"/>*/}\n                {/*</svg>*/}\n            </div>}\n            {next && <div className={styles.next}\n                          onClick={moveToNext}>\n                {/*<svg width=\"24\" height=\"24\"*/}\n                {/*     xmlns=\"http://www.w3.org/2000/svg\"*/}\n                {/*     fillRule=\"evenodd\"*/}\n                {/*     clipRule=\"evenodd\">*/}\n                {/*    <path d=\"M4 .755l14.374 11.245-14.374 11.219.619.781 15.381-12-15.391-12-.609.755z\"/>*/}\n                {/*</svg>*/}\n            </div>}\n        </div>\n    );\n};\n\nexport const SwipeItemWidget = ({children}) => {\n    return (\n        <SwipeItem className={styles.swipeItem}>\n            {children}\n        </SwipeItem>\n    );\n};\n","import { Reducer, useContext, useEffect, useReducer } from 'react';\nimport { Atom } from '@reatom/core';\nimport { context } from '@reatom/react';\n\n//        \n\n// function useForceUpdate() {\n//     const [state, dispatch] = useReducer(s => {\n//         console.log('reducer', s);\n//         return s + 1;\n//     }, 0);\n//     return () => {\n//         console.log('reducer state', state);\n//         dispatch();\n//     };\n// }\n\nexport function useForceUpdate() {\n    // dispatch don't have action and don't changes between rerenders\n    return useReducer<Reducer<number, null>>(s => s + 1, 0)[1] as () => void;\n}\n\nconst defaultMapper = (atomValue: any) => atomValue;\n\nexport function useAtom<T>(atom: Atom<T>): T;\nexport function useAtom<TI, TO = TI>(\n    atom: Atom<TI>,\n    selector: (atomValue: TI) => TO,\n    deps: any[],\n): TO;\nexport function useAtom<TI, TO = TI>(\n    atom: Atom<TI>,\n    selector: (atomValue: TI) => TO = defaultMapper,\n    deps: any[] = [],\n): TO {\n    const store = useContext(context);\n    console.log('by forceUpdate', atom);\n    const forceUpdate = useForceUpdate();\n    const value = selector(store.getState(atom));\n    useEffect(() => {\n        return store.subscribe(atom, state => {\n            console.log('new value', state, selector(state));\n            forceUpdate();\n        });\n    }, [...deps, store, atom, forceUpdate, selector]);\n\n    return value;\n}\n","import styled from 'styled-components';\n\nexport const Main = styled.main`\n  padding: 56px 12px 72px;\n`;\n","export type Type<T> = any;\n\nexport type Encoder<T> = (obj: T) => any;\nexport type Decoder<T> = (value: unknown) => T;\n\nexport const EncoderSymbol = Symbol('Packable encoder');\nexport const DecoderSymbol = Symbol('Packable decoder');\n\nexport interface IPacker<T> {\n    [DecoderSymbol]: Decoder<T>;\n    [EncoderSymbol]: Encoder<T>;\n}\n\nexport type Fields<T> = { [key in keyof T]: T[key] }\n\nexport type FieldTypePrimitive = StringConstructor | NumberConstructor | BooleanConstructor;\n\nexport type FieldTypeArray<T> = any\nexport type FieldRule<T> = IPacker<T> | Type<T> | FieldTypePrimitive | Array<FieldTypeArray<T>>;\n\nexport type FieldsRules<T> = {\n    [key in keyof T]: FieldRule<T[key]>;\n}\n","import {\n    Decoder, DecoderSymbol,\n    Encoder,\n    EncoderSymbol,\n    FieldRule,\n    Fields,\n    FieldsRules,\n    FieldTypePrimitive,\n    IPacker,\n} from './packable.types';\n\nexport class Packer<T> implements IPacker<T> {\n    private static getSafe(target: any): Packer<any> {\n        if (target === null || target === void 0)\n            return null;\n\n        if (EncoderSymbol in target && typeof target[EncoderSymbol] === 'function' &&\n            DecoderSymbol in target && typeof target[DecoderSymbol] === 'function')\n            return new Packer(target[DecoderSymbol], target[EncoderSymbol]);\n\n        if ('prototype' in target &&\n            EncoderSymbol in target.prototype && typeof target.prototype[EncoderSymbol] === 'function' &&\n            DecoderSymbol in target.prototype && typeof target.prototype[DecoderSymbol] === 'function')\n            return new Packer(target.prototype[DecoderSymbol], target.prototype[EncoderSymbol]);\n\n        return null;\n    }\n\n    static get(target: any): Packer<any> {\n        const packer = Packer.getSafe(target);\n\n        if (packer)\n            return packer;\n\n        throw new Error(`Target not a Packer`);\n    }\n\n    static for<T>(rule: FieldRule<T>): Packer<T> {\n        if (rule === null || rule === void 0)\n            throw new Error(`Rule not defined`);\n\n        if (rule instanceof Packer)\n            return rule;\n\n        const packer = Packer.getSafe(rule);\n        if (packer)\n            return packer;\n\n        if (rule === String || rule === Number || rule === Boolean)\n            return Packer.forPrimitive(rule) as any;\n\n        if (Array.isArray(rule))\n            return Packer.forArray(rule[0]) as any;\n\n        throw new Error(`Invalid rule`);\n    }\n\n    static forPrimitive<T extends FieldTypePrimitive>(type: T): Packer<ReturnType<T>> {\n        if (type === String)\n            return new Packer(\n                raw => typeof raw === 'string'\n                    ? '' + raw\n                    : null,\n                value => typeof value === 'string'\n                    ? value\n                    : null,\n            ) as any;\n        if (type === Number)\n            return new Packer(raw => +raw, value => +value) as any;\n        if (type === Boolean)\n            return new Packer(raw => !!raw, value => !!value) as any;\n        throw new Error(`Invalid type`);\n    }\n\n    static forObject<T extends object>(fields: FieldsRules<T>) {\n        const list: [string, Packer<any>][] = Object\n            .entries(fields)\n            .map(([field, rule]) => [field, Packer.for(rule as FieldRule<any>)]);\n\n        const encoder = obj => list\n            .reduce(\n                (data, [field, packer]) => {\n                    data[field] = packer.encode(obj[field]);\n                    return data;\n                },\n                {},\n            );\n\n        const decoder = data => list\n            .reduce(\n                (obj, [field, packer]) => {\n                    obj[field] = packer.decode(data[field]);\n                    return obj;\n                },\n                {},\n            );\n\n        return new Packer(decoder, encoder);\n    }\n\n    static forClass<T extends object>(fields: FieldsRules<T>, afterDecode: (data: Fields<T>) => T) {\n        const packer = Packer.forObject(fields);\n\n        return new Packer(\n            data => afterDecode(packer.decode(data) as any),\n            packer.encode,\n        );\n    }\n\n    static forArray<T extends object>(rule: FieldRule<T>) {\n        const packer = Packer.for<any>(rule);\n\n        const encoder = value => value.map(packer.encode);\n        const decoder = data => data.map(packer.decode);\n\n        return new Packer<T[]>(decoder, encoder);\n    }\n\n    static maybe<T>(packer: Packer<T>): Packer<T | null> {\n        const encoder: Encoder<T | null> = obj => obj === null || obj === undefined ? null : packer.encode(obj);\n        const decoder: Decoder<T | null> = val => val === null || val === undefined ? null : packer.decode(val);\n        return new Packer<T | null>(decoder, encoder);\n    }\n\n    public [DecoderSymbol]: Decoder<T>;\n    public [EncoderSymbol]: Encoder<T>;\n    public decode: Decoder<T>;\n    public encode: Encoder<T>;\n\n    constructor(decoder: Decoder<T>, encoder: Encoder<T>) {\n        if (!encoder || typeof encoder !== 'function') throw new Error(`Encoder must be a function`);\n        if (!decoder || typeof decoder !== 'function') throw new Error(`Decoder must be a function`);\n\n        this[EncoderSymbol] = encoder;\n        this[DecoderSymbol] = decoder;\n        this.encode = encoder;\n        this.decode = decoder;\n    }\n}\n","import { DecoderSymbol, EncoderSymbol, FieldRule, Fields, IPacker, Type } from './packable.types';\nimport { Packer } from './packable';\n\nconst FieldsSymbol = Symbol('Fields symbol');\n\nexport function PackableClass<T>(afterDecode: (data: Fields<T>) => T) {\n    return (constructor: Type<T>) => {\n        const target = constructor['prototype'];\n        const fields = target[FieldsSymbol];\n        if (!fields)\n            throw new Error(`To use @PackableClass you need declare @Packable`);\n\n        delete target[FieldsSymbol];\n\n        const packer = Packer.forClass<any>(fields, afterDecode);\n\n        target[DecoderSymbol] = packer.decode;\n        target[EncoderSymbol] = packer.encode;\n    };\n}\n\nexport function SelfPackableClass<T>(init: (target: Type<T>) => IPacker<T>) {\n    return (target: Type<T>) => {\n        const initResult = init(target);\n        if (!initResult)\n            throw new Error(`Init function must return IPacker`);\n        const packer = Packer.for(initResult);\n\n        target[DecoderSymbol] = packer.decode;\n        target[EncoderSymbol] = packer.encode;\n    };\n}\n\nexport function Packable(rule: FieldRule<any>) {\n    if (rule === null || rule === void 0)\n        throw new Error(`Rule must be defined`);\n\n    return (target: Type<any>, field: string) => {\n        if (FieldsSymbol in target)\n            target[FieldsSymbol][field] = rule;\n        else\n            target[FieldsSymbol] = {[field]: rule};\n    };\n}\n","import { SelfPackableClass } from '../../libs/packable/decorator';\nimport { Packer } from '../../libs/packable/packable';\n\nconst DEFAULT_CURRENCY = 'RUB';\n\nexport interface ICurrency {\n    code: string;\n    symbol: string;\n    precision: number;\n}\n\nexport const currencies: { [key: string]: ICurrency } = {\n    RUB: {code: 'RUB', symbol: '', precision: 2},\n};\n\n@SelfPackableClass(target => new Packer(target.fromJSON, target.toJSON))\nexport class Money {\n    public readonly amount: string = '';\n\n    public static from(value: Money | string): Money {\n        if (typeof value === 'string')\n            return Money.fromJSON(value);\n        if (value instanceof Money)\n            return value.clone();\n        throw new Error('Can not convert invalid data to Money');\n    }\n\n    public static fromJSON(data: any): Money {\n        if (typeof data === 'object'\n            && typeof data.subunits === 'number'\n            && typeof data.currency === 'object'\n            && typeof data.currency.code === 'string')\n            return new Money(data.subunits, data.currency);\n\n        if (typeof data !== 'string')\n            throw new Error(`Amount \"${data}\" must be a string`);\n\n        let parts = data.trim().split(' ');\n        if (!parts || parts.length !== 2)\n            throw new Error(`Money \"${data}\" must have valid format`);\n\n        const amountText = parts[0];\n        const currencyName = parts[1].toUpperCase();\n\n        const currency = currencies[currencyName];\n        if (!currency)\n            throw new Error(`Unsupported currency \"${currencyName}\"`);\n\n        const units = +amountText;\n        if (Number.isNaN(units))\n            throw new Error(`Invalid amount \"${amountText}\" when parse \"${data}\"`);\n\n        const subunits = Math.round(units * 10 ** currency.precision);\n\n        return new Money(subunits, currency);\n    }\n\n    public static toJSON(money: Money): any {\n        return money.toJSON();\n    }\n\n    public static create(amount: string | number, currencyName: string): Money {\n        if (typeof currencyName !== 'string')\n            throw new Error(`Invalid currency \"${currencyName}\"`);\n        currencyName = currencyName.toUpperCase();\n\n        if (typeof amount === 'string') {\n            if (!amount || Number.isNaN(+amount))\n                throw new Error(`Amount must be valid number but received \"${amount}\"`);\n\n            amount = +amount;\n        }\n\n        const currency = currencies[currencyName];\n        if (!currency)\n            throw new Error(`Unsupported currency \"${currencyName}\"`);\n\n        const units = +amount;\n        if (Number.isNaN(units))\n            throw new Error(`Invalid amount \"${amount}\"`);\n\n        const subunits = Math.round(units * 10 ** currency.precision);\n        return new Money(subunits, currency);\n    }\n\n    public static empty: Money;\n\n    private constructor(public readonly subunits: number,\n                        public readonly currency: ICurrency) {\n        this.amount = (subunits / 10 ** currency.precision).toFixed(2);\n    }\n\n    public clone(): Money {\n        return new Money(this.subunits, this.currency);\n    }\n\n    public toString() {\n        if (this.subunits)\n            return this.amount + ' ' + this.currency.symbol;\n        else\n            return '0 ' + this.currency.symbol;\n    }\n\n    public toJSON() {\n        if (this.subunits)\n            return this.amount + ' ' + this.currency.code;\n        else\n            return '0 ' + this.currency.code;\n    }\n\n    public add(money: Money): Money {\n        if (this.currency.code !== money.currency.code)\n            throw new Error(`Can not do any operations with different currencies`);\n        return new Money(this.subunits + money.subunits, this.currency);\n    }\n\n    public sub(money: Money): Money {\n        if (this.currency.code !== money.currency.code)\n            throw new Error(`Can not do any operations with different currencies`);\n        return new Money(this.subunits - money.subunits, this.currency);\n    }\n\n    public equal(money: Money): boolean {\n        if (this.currency.code !== money.currency.code)\n            return false;\n        return this.subunits === money.subunits;\n    }\n\n    public getEntire(withSign: boolean = false): string {\n        const str = Math.floor(this.subunits / 10 ** this.currency.precision).toString();\n        return withSign && this.subunits > 0\n            ? '+' + str\n            : str;\n    }\n\n    public getFractional(): string {\n        return (this.subunits / 10 ** this.currency.precision)\n            .toFixed(this.currency.precision)\n            .substr(-this.currency.precision);\n    }\n\n    public getSymbol(): string {\n        return this.currency.symbol;\n    }\n\n    public negative(): Money {// TODO rename\n        return new Money(-this.subunits, this.currency);\n    }\n\n    public isPositive() {\n        return this.subunits > 0;\n    }\n\n    public isNegative() {\n        return this.subunits < 0;\n    }\n}\n\nMoney.empty = Money.create(0, DEFAULT_CURRENCY);\n","import React from 'react';\nimport { Money } from '../models/money/money.class';\n\nimport styles from './MoneyView.module.scss';\n\ninterface IProps {\n    money: Money;\n    sign?: boolean;\n}\n\nexport const MoneyView = ({money, sign}: IProps) => {\n    if (money === null)\n        return (\n            <div className={styles.moneyView}>\n                <span className={styles.entire}>N/A</span>\n            </div>\n        );\n\n    if (!(money instanceof Money))\n        throw new Error(`money must be instance of Money, but get ${typeof money} ${JSON.stringify(money)}\"`);\n\n    return (\n        <div className={styles.moneyView}>\n            <span className={styles.entire}>{money.getEntire(sign)}</span>\n            <span className={styles.fractional}>{money.getFractional()}</span>\n            <span className={styles.currency}>{money.getSymbol()}</span>\n        </div>\n    );\n};\n","import React from 'react';\nimport styled from 'styled-components';\nimport { MoneyView } from '../components/MoneyView';\nimport { Icon } from '../ui-kit/Icon';\nimport { Money } from '../models/money/money.class';\n\nconst StatBoxContainer = styled.div`\n  background: #ffffff;\n  box-shadow: 0 1px 3px 0 rgba(0, 0, 0, 0.09);\n  border-radius: 10px;\n  padding: 12px 12px;\n  \n  display: grid;\n  grid-template-columns: auto;\n  grid-template-rows: auto;\n  gap: 12px 12px;\n  grid-template-areas: \"icon amount amount\" \"title title status\";\n\n  .amount { \n    grid-area: amount; \n    text-align: right;\n    \n    align-self: center;\n    font-size: 20px;\n    font-weight: 700;\n    letter-spacing: -0.02em;\n    line-height: 1em;\n    color: #27173E;\n    \n    white-space: nowrap;\n  }\n  \n  .icon-wrapper { \n    grid-area: icon;\n    text-align: left;\n    \n    background: #6236FF;\n    width: 36px;\n    height: 36px;\n    display: inline-flex;\n    align-items: center;\n    justify-content: center;\n    border-radius: 18px;\n    color: #fff;\n    font-size: 24px;\n  }\n  \n  .title { \n    grid-area: title;\n    text-align: left;\n    \n    font-size: 13px;\n    color: #958d9e;\n    font-weight: 500;\n    display: block;\n    line-height: 1em;\n    align-self: end;\n  }\n  \n  .status { \n    grid-area: status;\n    text-align: right; \n    \n    //font-size: 13px;\n    color: #958d9e;\n    font-weight: 500;\n    display: block;\n    line-height: 1em;\n    align-self: end;\n  }\n`;\n\nexport enum BarColor {\n    Neutral = 'neutral',\n    Good = 'good',\n    Normal = 'normal',\n    Bad = 'bad',\n}\n\nexport interface IQuickDetailsItem {\n    amount: Money;\n    progress: number;\n    color: BarColor;\n}\n\nexport interface IQuickDetailsItemProps extends IQuickDetailsItem {\n    title: string;\n    icon: string;\n}\n\nexport const StatBox = ({title, amount, icon, color, progress}: IQuickDetailsItemProps) => {\n    const percent = progress === null\n        ? ''\n        : progress < 0\n            ? progress + '%'\n            : '+' + progress + '%';\n    return (\n        <StatBoxContainer>\n            <div className=\"icon-wrapper\">\n                <Icon icon={icon}/>\n            </div>\n            <div className=\"amount\"><MoneyView money={amount}/></div>\n            <div className=\"title\">{title}</div>\n            <div className=\"status\">{percent}</div>\n        </StatBoxContainer>\n    );\n};\n","import React, { ReactNode } from 'react';\nimport { Money } from '../models/money/money.class';\nimport { Icons } from '../ui-kit/Icon';\nimport { AccountGrip } from '../models/account-grip/grip.class';\nimport { BarColor, IQuickDetailsItem, IQuickDetailsItemProps, StatBox } from './StatBox';\nimport { IGrip } from '../models/abstract-grip/grip.types';\nimport { Main } from '../ui-kit/Main';\n\ninterface IProps {\n    grip: AccountGrip;\n}\n\nexport const GripQuickDetails = ({grip}: IProps) => {\n    if (!grip)\n        return (\n            <div className=\"alert alert-warning mt-2\" role=\"alert\">\n                Grip not specified\n            </div>\n        );\n\n    const {income, expense, planed, total} = getQuickDetails(grip);\n\n    const stats: ReactNode[][] = [\n        [\n            <StatBox title=\"Income\"\n                     icon={Icons.addCircleOutline}\n                     {...income}\n            />,\n            <StatBox title=\"Expense\"\n                     icon={Icons.removeCircleOutline}\n                     {...expense}\n            />,\n        ],\n        [\n            <StatBox title=\"Plan\"\n                     icon={Icons.calendarOutline}\n                     {...planed}\n            />,\n            <StatBox title=\"Total\"\n                     icon={Icons.cashOutline}\n                     {...total}\n            />,\n        ],\n    ];\n\n    return (\n        <div className=\"section\">\n            {stats.map((row, index) => (\n                <div key={index}\n                     className=\"row mt-2 justify-content-center\">\n                    {row.map((cell, cellIndex) => (\n                        <div key={cellIndex}\n                             className=\"col-6\">\n                            {cell}\n                        </div>\n                    ))}\n                </div>\n            ))}\n        </div>\n    );\n};\n\nfunction getQuickDetails(grip: IGrip): {\n    income: IQuickDetailsItem,\n    expense: IQuickDetailsItem,\n    planed: IQuickDetailsItem,\n    total: IQuickDetailsItem,\n} {\n    const month = grip.months[0];\n\n    if (!month)\n        return {\n            income: {\n                amount: null,\n                progress: null,\n                color: BarColor.Neutral,\n            },\n            expense: {\n                amount: null,\n                progress: null,\n                color: BarColor.Neutral,\n            },\n            planed: {\n                amount: Money.create(0, 'RUB'),\n                progress: null,\n                color: BarColor.Neutral,\n            },\n            total: {\n                amount: null,\n                progress: null,\n                color: BarColor.Neutral,\n            },\n        };\n\n    return {\n        income: {\n            amount: month.income,\n            progress: null,\n            color: BarColor.Neutral,\n        },\n        expense: {\n            amount: month.expense,\n            progress: null,\n            color: BarColor.Neutral,\n        },\n        planed: {\n            amount: Money.create(0, 'RUB'),\n            progress: null,\n            color: BarColor.Neutral,\n        },\n        total: {\n            amount: month.balance,\n            progress: null,\n            color: BarColor.Neutral,\n        },\n    };\n}\n","import React from 'react';\nimport styled from 'styled-components';\nimport { ICategory } from '../models/category/category.types';\n\ninterface IProp {\n    category: ICategory;\n    size?: 'default' | 'large';\n}\n\nconst CategoryIconBox = styled.span`\n  display: inline-block;\n  border: 2px solid green;\n  border-radius: 50%;\n  background: url(${process.env.PUBLIC_URL}/category-icons/default.png);\n  width: ${props => props.size};\n  height: ${props => props.size};\n  background-size: 100%;\n  box-sizing: content-box;\n  \n  > span {\n    display: block;\n    background-size: 100%;\n    width: ${props => props.size};\n    height: ${props => props.size};\n  }\n`;\n\nexport const CategoryIcon = ({category, size}: IProp) => {\n    const icon = category.image || 'default';\n    const width = size === 'large' ? '64px' : '32px';\n    const style = {\n        backgroundImage: `url(${process.env.PUBLIC_URL}/category-icons/${icon}.png)`,\n    };\n    return (\n        <CategoryIconBox size={width}>\n            <span style={style}/>\n        </CategoryIconBox>\n    );\n};\n","import { UUID } from '../common/common.types';\nimport { Money } from '../money/money.class';\n\nexport enum TransactionType {\n    Removed,\n    Income,\n    Expense,\n    Adjust,\n    AdjustTo,\n}\n\nexport interface ITransaction {\n    id: UUID;\n    amount: Money;\n    type: TransactionType;\n    category: UUID | '';\n    title: string | '';\n    createdAt?: number;\n    updatedAt?: number;\n}\n\nexport interface IAddTransactionForm {\n    account: UUID;\n    amount: string;\n    type: TransactionType;\n    category: UUID | '';\n    title: string | '';\n    date: string;\n}\n","import styled from 'styled-components';\nimport { CategoryIcon } from '../components/CategoryIcon';\nimport React from 'react';\nimport { ICategory } from '../models/category/category.types';\nimport { TransactionType } from '../models/transaction/transaction.types';\nimport { Link, paths } from '../routes';\nimport { AccountGrip } from '../models/account-grip/grip.class';\n\nconst QuickCategoriesBox = styled.div`\n  display: flex;\n  margin-top: 16px;\n  overflow-x: hidden;\n  \n  > * {\n    margin: 0 6px;\n    display: flex; // TODO fix it\n  }\n`;\n\ninterface IProps {\n    grip: AccountGrip;\n}\n\nexport const QuickCategories = ({grip}: IProps) => {\n    if (!grip)\n        return (\n            <div className=\"alert alert-outline-dark mt-2\" role=\"alert\">\n                No data\n            </div>\n        )\n\n    const categories: ICategory[] = [\n        {\n            id: '0000-111',\n            name: 'Home',\n            image: 'essentials-01',\n            parent: null,\n            defaultTxType: TransactionType.Income,\n        },\n        {\n            id: 'default',\n            name: 'Default',\n            image: '',\n            parent: null,\n            defaultTxType: TransactionType.Income,\n        },\n        {\n            id: '0000-111',\n            name: 'Home',\n            image: 'essentials-01',\n            parent: null,\n            defaultTxType: TransactionType.Income,\n        },\n        {\n            id: 'default',\n            name: 'Default',\n            image: '',\n            parent: null,\n            defaultTxType: TransactionType.Income,\n        },\n        {\n            id: '0000-111',\n            name: 'Home',\n            image: 'essentials-01',\n            parent: null,\n            defaultTxType: TransactionType.Income,\n        },\n        {\n            id: 'default',\n            name: 'Default',\n            image: '',\n            parent: null,\n            defaultTxType: TransactionType.Income,\n        },\n        {\n            id: '0000-111',\n            name: 'Home',\n            image: 'essentials-01',\n            parent: null,\n            defaultTxType: TransactionType.Income,\n        },\n        {\n            id: 'default',\n            name: 'Default',\n            image: '',\n            parent: null,\n            defaultTxType: TransactionType.Income,\n        },\n        {\n            id: '0000-111',\n            name: 'Home',\n            image: 'essentials-01',\n            parent: null,\n            defaultTxType: TransactionType.Income,\n        },\n        {\n            id: 'default',\n            name: 'Default',\n            image: '',\n            parent: null,\n            defaultTxType: TransactionType.Income,\n        },\n    ];\n    return (\n        <QuickCategoriesBox>\n            {categories.map(category =>\n                <Link to={paths.transactions.add({\n                    account: grip.id,\n                    category: category.id,\n                })}>\n                    <CategoryIcon category={category} size={'large'}/>\n                </Link>,\n            )}\n        </QuickCategoriesBox>\n    );\n};\n","import React from 'react';\nimport { useHistory } from 'react-router';\nimport { paths } from '../routes';\nimport { Icon, Icons } from '../ui-kit/Icon';\nimport { MoneyView } from '../components/MoneyView';\nimport styles from './AccountWidget.module.scss';\nimport { AccountGrip } from '../models/account-grip/grip.class';\n\ninterface IProps {\n    account: AccountGrip;\n}\n\nexport const AccountWidget = ({account}: IProps) => {\n    const history = useHistory();\n\n    function addTx() {\n        history.push(paths.transactions.add({account: account.id}));\n    }\n\n    return (\n        <div className=\"card-block bg-primary\">\n            <div className=\"card-main\">\n                <div className=\"card-button dropdown\">\n                    <button type=\"button\" className=\"btn btn-link btn-icon\" data-toggle=\"dropdown\">\n                        <Icon icon={Icons.cogOutline} role=\"img\" className=\"md hydrated\"\n                              aria-label=\"ellipsis horizontal\"/>\n                    </button>\n                    <div className=\"dropdown-menu dropdown-menu-right\">\n                        <a className=\"dropdown-item\" href=\"javacript:;\">\n                            <Icon icon={Icons.pencilOutline} role=\"img\" className=\"md hydrated\"\n                                  aria-label=\"pencil outline\"/>\n                            Edit\n                        </a>\n                        <a className=\"dropdown-item\" href=\"javacript:;\">\n                            <Icon icon={Icons.closeOutline} role=\"img\" className=\"md hydrated\"\n                                  aria-label=\"close outline\"/>\n                            Remove\n                        </a>\n                        <a className=\"dropdown-item\" href=\"javacript:;\">\n                            <Icon icon={Icons.arrowUpCircleOutline} role=\"img\" className=\"md hydrated\"\n                                  aria-label=\"arrow up circle outline\"/>\n                            Upgrade\n                        </a>\n                    </div>\n                </div>\n                <div className=\"balance\">\n                    <span className=\"label\">BALANCE</span>\n                    <h1 className=\"title\"><MoneyView money={account.balance}/></h1>\n                </div>\n                <div className=\"in\">\n                    <div className=\"card-number\">\n                        <span className=\"label\">Account name</span>\n                        {account.name}\n                    </div>\n                    {/*<div className=\"card-number\">*/}\n                    {/*    <span className=\"label\">Card Number</span>*/}\n                    {/*       9905*/}\n                    {/*</div>*/}\n                    <div className=\"bottom\">\n                        <div className=\"card-expiry\">\n                            <span className=\"label\">Statistics for</span>\n                            Last month\n                        </div>\n                    </div>\n                </div>\n            </div>\n        </div>\n    );\n};\n","import { declareAction } from '@reatom/core';\nimport { UUID } from '../../models/common/common.types';\nimport { Account } from '../../models/account/account.class';\nimport { AccountGrip } from '../../models/account-grip/grip.class';\n\nconst NS = 'grips/account';\nexport const chooseAccountGrip = declareAction<UUID>(NS + ':chooseAccountGrip');\n\nexport const updateAccountGrip = declareAction<Account>(NS + ':updateAccountGrip');\nexport const updateAccountGripSuccess = declareAction<AccountGrip>(NS + ':updateAccountGrip success');\nexport const updateAccountGripFailed = declareAction<any>(NS + ':updateAccountGrip failed');\n\nexport const updateAccountGrips = declareAction<Account[]>(NS + ':updateAccountGrips');\nexport const updateAccountGripsSuccess = declareAction<AccountGrip[]>(NS + ':updateAccountGrips success');\nexport const updateAccountGripsFailed = declareAction<any>(NS + ':updateAccountGrips failed');\n","import { declareAtom } from '@reatom/core';\nimport { Map } from 'immutable';\nimport { UUID } from '../../models/common/common.types';\nimport { AccountGrip } from '../../models/account-grip/grip.class';\nimport { chooseAccountGrip, updateAccountGripsSuccess, updateAccountGripSuccess } from './account-grips.actions';\nimport { chooseAccount } from '../accounts/accounts.actions';\n\nexport interface IAccountGripsState {\n    currentID: UUID | null;\n    current: AccountGrip | null;\n    accounts: Map<UUID, AccountGrip>;\n}\n\nexport const AccountGrips = declareAtom<IAccountGripsState>(\n    ['grips/account'],\n    {\n        currentID: null,\n        current: null,\n        accounts: Map(),\n    },\n    on => ({\n        choose: [\n            on(chooseAccountGrip, (state, id) => {\n                const current = state.accounts.get(id);\n                if (current)\n                    return {\n                        ...state,\n                        currentID: id,\n                        current,\n                    };\n                else\n                    return {\n                        ...state,\n                        currentID: id,\n                    };\n            }),\n        ],\n        update: [\n            on(updateAccountGripSuccess, (state, grip) => {\n                const accounts = state.accounts.set(grip.id, grip);\n\n                let current = accounts.get(state.currentID);\n\n                if (!current)\n                    current = accounts.get(grip.id);\n\n                return {\n                    ...state,\n                    accounts,\n                    current,\n                    currentID: current.id,\n                };\n            }),\n            on(updateAccountGripsSuccess, (state, grips) => {\n                const accounts = grips.reduce(\n                    (acc, grip) => acc.set(grip.id, grip),\n                    state.accounts,\n                );\n\n                let current = accounts.get(state.currentID);\n\n                if (!current)\n                    current = accounts.get(grips[0].id);\n\n                return {\n                    ...state,\n                    accounts,\n                    current,\n                    currentID: current.id,\n                };\n            }),\n        ],\n    }),\n);\n","import React from 'react';\nimport { MoneyView } from '../components/MoneyView';\nimport { IGrip } from '../models/abstract-grip/grip.types';\nimport { Link, paths } from '../routes';\nimport format from \"date-fns/format\";\n\ninterface IProps {\n    grip: IGrip;\n}\n\nexport const LastMonthsList = ({grip}: IProps) => {\n    if (!grip)\n        return (\n            <div className=\"alert alert-outline-dark mt-2\" role=\"alert\">\n                No data\n            </div>\n        )\n\n    const months = grip.months.slice(0, 4);\n\n    if (!months.length)\n        return null;\n        // return (\n        //     <div className=\"alert alert-outline-dark mt-2\" role=\"alert\">\n        //         No months found\n        //     </div>\n        // )\n\n    return (\n        <ul className=\"listview link-listview inset mt-2\" style={{\n            margin: '0',\n        }}>\n            {months.map(month => (\n                <li>\n                    <Link to={paths.account.month(grip.id, month.month)} className=\"item\">\n                        {format(new Date(month.month), 'MMMM yyyy')}\n                        <span className=\"text\">\n                            <MoneyView money={month.balance} sign/>\n                        </span>\n                    </Link>\n                </li>\n            ))}\n        </ul>\n    );\n};\n","import React from 'react';\nimport { useAction } from '@reatom/react';\nimport { Accounts } from '../atoms/accounts/accounts.atom';\nimport { Header } from '../components/Header';\nimport { SwipeItemWidget, SwipeWidget } from '../widgets/SwipeWidget';\nimport { useAtom } from '../store/reatom';\nimport { Main } from '../ui-kit/Main';\nimport { GripQuickDetails } from '../widgets/GripQuickDetails';\nimport { QuickCategories } from '../widgets/QuickCategories';\nimport { AccountWidget } from '../widgets/AccountWidget';\nimport { AccountGrips } from '../atoms/account-grips/account-grips.atom';\nimport { chooseAccountGrip } from '../atoms/account-grips/account-grips.actions';\nimport { LastMonthsList } from '../widgets/LastMonthsList';\nimport { CategoriesList } from '../widgets/CategoriesList';\n\nexport const AccountsPage = () => {\n    const {current, accounts} = useAtom(AccountGrips);\n    const chooseAccountHandler = useAction(id => id === 'create' ? null : chooseAccountGrip(id));\n    const list = Array.from(accounts.values());\n\n    if (!accounts.size)\n        return (\n            <>\n                <Header title={`Wallets`}/>\n                Loading...\n            </>\n        );\n\n    return (\n        <>\n            <Header title={`Wallets`}/>\n            <Main>\n                <SwipeWidget current={current?.id || ''}\n                             showButtons\n                             onChange={chooseAccountHandler as ((key: any) => void)}>\n                    {list.map(account => (\n                        <SwipeItemWidget key={account.id}>\n                            <AccountWidget account={account}/>\n                        </SwipeItemWidget>\n                    ))}\n                    {/*<SwipeItemWidget key=\"create\">*/}\n                    {/*    <CreateAccountWidget/>*/}\n                    {/*</SwipeItemWidget>*/}\n                </SwipeWidget>\n                <GripQuickDetails grip={current}/>\n                <QuickCategories grip={current}/>\n                <LastMonthsList grip={current}/>\n            </Main>\n        </>\n    );\n};\n","import { UUID } from '../../models/common/common.types';\nimport { declareAction } from '@reatom/core';\nimport { Month } from '../../models/month/month.class';\n\nconst NS = 'months';\n\nexport const loadMonths = declareAction<UUID[]>(NS + ':loadMonths');\nexport const loadMonthsSuccess = declareAction<Month[]>(NS + ':loadMonths success');\nexport const loadMonthsFailed = declareAction<{ ids: UUID[], error: any }>(NS + ':loadMonths failed');\n\nexport const saveMonths = declareAction<Month[]>(NS + ':saveMonths');\nexport const saveMonthsSuccess = declareAction<UUID[]>(NS + ':saveMonths success');\nexport const saveMonthsFailed = declareAction<{ ids: UUID[], error: any }>(NS + ':saveMonths failed');\n","import React from 'react';\nimport { ITransaction } from '../models/transaction/transaction.types';\n\nimport styles from './TxList.module.scss';\nimport { makeTxList } from './TxList.utils';\nimport { MoneyView } from '../components/MoneyView';\nimport { DayDate } from '../models/common/date.types';\nimport { TransactionGrip } from '../models/abstract-grip/transaction-grip.class';\nimport { CategoryIcon } from '../components/CategoryIcon';\nimport { Link, paths } from '../routes';\nimport { dayDateToMonth } from '../models/common/date.utils';\n\ninterface IProps {\n    list: TransactionGrip[];\n    dayDate: DayDate;\n}\n\nexport const TxList = React.memo(({list, dayDate}: IProps) => {\n    const txList = makeTxList(list);\n\n    return (\n        <ul className=\"listview image-listview inset\">\n            {txList.map((tx, index) => (\n                <li>\n                    <Link to={paths.transactions.view(tx.account.id, tx.date, tx.id)} className=\"item\">\n                        <div className=\"icon-box\">\n                            <CategoryIcon category={tx.category}/>\n                        </div>\n                        <div className=\"in\">\n                            <div>\n                                {tx.first\n                                    ? tx.first\n                                    : <span className={styles.empty}> </span>\n                                }\n                                <footer>{tx.second\n                                    ? tx.second\n                                    : <span className={styles.empty}> </span>\n                                }</footer>\n                            </div>\n                            <span><MoneyView money={tx.amount}/></span>\n                        </div>\n                        {/*<CategoryIcon category={tx.category}/>*/}\n                        {/*<img src=\"assets/img/sample/avatar/avatar1.jpg\" alt=\"image\" className=\"image\"/>*/}\n                        {/*<div className=\"in\">*/}\n                        {/*    <div>*/}\n                        {/*        {tx.first*/}\n                        {/*            ? tx.first*/}\n                        {/*            : <span className={styles.empty}> </span>*/}\n                        {/*        }*/}\n                        {/*        <footer>{tx.second*/}\n                        {/*            ? tx.second*/}\n                        {/*            : <span className={styles.empty}> </span>*/}\n                        {/*        }</footer>*/}\n                        {/*    </div>*/}\n                        {/*    <span className=\"text-muted\">*/}\n                        {/*        <MoneyView money={tx.amount}/>*/}\n                        {/*    </span>*/}\n                        {/*</div>*/}\n                    </Link>\n                </li>\n            ))}\n        </ul>\n    );\n\n    return (\n        <ul className={styles.txList}>\n            {txList.map((tx, index) => (\n                <li key={index} className={styles.txItem}>\n                    <div className={styles.txItem__left}>\n                        <div className={styles.txItem__first}>\n\n                        </div>\n                        <div className={styles.txItem__second}>\n\n                        </div>\n                    </div>\n                    <div className={styles.txItem__right}>\n                        <div className={styles.txItem__amount}>\n                            <MoneyView money={tx.amount}/>\n                        </div>\n                        <div className={styles.txItem__date}>\n                            {tx.date}\n                        </div>\n                    </div>\n                </li>\n            ))}\n        </ul>\n    );\n});\n","import { ITransaction, TransactionType } from '../models/transaction/transaction.types';\nimport { format } from 'date-fns';\nimport { Money } from '../models/money/money.class';\nimport { DayDate } from '../models/common/date.types';\nimport { ITransactionGrip } from '../models/abstract-grip/grip.types';\nimport { UUID } from '../models/common/common.types';\n\nexport interface IDisplayedTransaction extends ITransactionGrip {\n    first: string;\n    second: string;\n    dateString: string;\n}\n\nexport function makeTxList(list: ITransactionGrip[]): IDisplayedTransaction[] {\n    return list.map(item => {\n        return {\n            ...item,\n            first: item.category.name,\n            second: item.title,\n            dateString: item.date\n                ? format(new Date(item.date), 'PP')\n                : '',\n        };\n    });\n}\n","import React, { ReactNode } from 'react';\nimport styled from 'styled-components';\n\ninterface IProps {\n    full?: boolean;\n    title?: string;\n    children: ReactNode;\n}\n\n// Standard Section\n\nconst SectionContainer = styled.section`\n  margin: 16px 0;\n  padding: ${props => props.full\n    ? '0'\n    : '0 16px'};\n`;\n\nexport const SectionTitle = styled.h3`\n  text-align: left;\n  font-size: 15px;\n  padding: ${props => props.full\n    ? '6px 16px'\n    : '6px 0'};\n  color: #27173E;\n  font-weight: 500;\n  margin: 0;\n`;\n\nexport const Section = ({full, title, children}: IProps) => {\n    return (\n        <SectionContainer full={full}>\n            <SectionTitle full={full}>{title}</SectionTitle>\n            {children}\n        </SectionContainer>\n    );\n};\n","import React from 'react';\n\nimport styles from './MonthTxList.module.scss';\nimport { Month } from '../models/month/month.class';\nimport { TxList } from './TxList';\nimport { DayDate } from '../models/common/date.types';\nimport format from 'date-fns/format';\nimport { AbstractMonthGrip } from '../models/abstract-grip/month-grip.class';\nimport { Section } from '../ui-kit/Section';\n\ninterface IProps {\n    month: AbstractMonthGrip;\n}\n\nexport const MonthTxList = React.memo(({month}: IProps) => {\n    if (!month)\n        return (\n            <div>No data</div>\n        );\n\n    const days = month.days;\n\n    return (\n        <>\n            {days.map(day => (\n                <Section full title={formatDayDate(day.date)}>\n                    <TxList list={day.transactions} dayDate={day.date}/>\n                </Section>\n            ))}\n        </>\n    );\n});\n\n\nfunction formatDayDate(date: DayDate): string {\n    return format(new Date(date), 'do LLLL');\n}\n","import { MonthsMap } from '../atoms/months/months.types';\nimport { IMonthBrief } from '../models/month/month.types';\nimport React from 'react';\nimport { MoneyView } from '../components/MoneyView';\nimport { MonthTxList } from './MonthTxList';\nimport styles from './MonthViewWidget.module.scss';\nimport format from 'date-fns/format';\nimport { IMonthGripBrief } from '../models/abstract-grip/grip.types';\nimport { MonthGripsMap } from '../atoms/month-grips/month-grips.types';\n\ninterface IProps {\n    months: MonthGripsMap;\n    brief?: IMonthGripBrief;\n    prev?: IMonthGripBrief;\n    next?: IMonthGripBrief;\n    moveToPrev?: () => void;\n    moveToNext?: () => void;\n}\n\nexport const MonthViewHeadWidget = ({brief}: IProps) => {\n    if (!brief)\n        return <div>No month</div>;\n\n    const circumference = 452;\n    const totalSum = brief.income.subunits + brief.expense.subunits;\n    const incomePercent = brief.income.subunits / totalSum * circumference;\n    const expensePercent = brief.expense.subunits / totalSum * circumference;\n\n    return (\n        <div className=\"section\">\n            <div className=\"card\">\n                <div className=\"card-header\">\n                    {format(new Date(brief.month), 'MMMM yyyy')}\n                </div>\n                <div className=\"card-body\">\n                    <div className={styles.head}>\n                        <div className={styles.info}>\n                            <div className={styles.circle}>\n                                <svg width=\"160\" height=\"160\">\n                                    <circle transform=\"rotate(-90)\"\n                                            r=\"72\" cx=\"-80\" cy=\"80\"/>\n                                    <circle className=\"income\"\n                                            transform=\"rotate(-90)\"\n                                            r=\"72\" cx=\"-80\" cy=\"80\"\n                                            stroke=\"30bae7\"\n                                            strokeDasharray={[incomePercent, circumference].join(' ')}/>\n                                    <circle className=\"expense\"\n                                            transform=\"rotate(-90)\"\n                                            r=\"72\" cx=\"-80\" cy=\"80\"\n                                            strokeDasharray={[0, incomePercent, expensePercent, circumference].join(' ')}/>\n                                </svg>\n                                <h4 className={styles.balance}><MoneyView money={brief.balance}/></h4>\n                                <div>+<MoneyView money={brief.income}/></div>\n                                <div>-<MoneyView money={brief.expense}/></div>\n                            </div>\n                        </div>\n                    </div>\n                </div>\n            </div>\n        </div>\n    );\n\n    return (\n        <div className={styles.head}>\n            {/*<h3 className={styles.title}>{format(new Date(brief.month), 'MMMM yyyy')}</h3>*/}\n        </div>\n    );\n};\n\n\nexport const MonthViewWidget = ({months, brief, prev, next, moveToPrev, moveToNext}: IProps) => {\n    moveToPrev = moveToPrev || (() => null);\n    moveToNext = moveToNext || (() => null);\n\n    if (!brief)\n        return <div>No month</div>;\n\n    if (!months.has(brief.id)) {\n        return <div>Loading month</div>;\n    }\n\n    const month = months.get(brief.id);\n\n    if (!month)\n        return <div>Loading month</div>;\n\n    const circumference = 452;\n    const totalSum = month.income.subunits + month.expense.subunits;\n    const incomePercent = month.income.subunits / totalSum * circumference;\n    const expensePercent = month.expense.subunits / totalSum * circumference;\n\n    return (\n        <>\n            <div className={styles.head}>\n                <h3 className={styles.title}>{format(new Date(month.month), 'MMMM yyyy')}</h3>\n                <div className={styles.info}>\n                    {prev && <div className={styles.prev}\n                                  onClick={moveToPrev}>\n                        <svg width=\"24\" height=\"24\"\n                             xmlns=\"http://www.w3.org/2000/svg\"\n                             fillRule=\"evenodd\"\n                             clipRule=\"evenodd\">\n                            <path d=\"M20 .755l-14.374 11.245 14.374 11.219-.619.781-15.381-12 15.391-12 .609.755z\"/>\n                        </svg>\n                    </div>}\n                    {next && <div className={styles.next}\n                                  onClick={moveToNext}>\n                        <svg width=\"24\" height=\"24\"\n                             xmlns=\"http://www.w3.org/2000/svg\"\n                             fillRule=\"evenodd\"\n                             clipRule=\"evenodd\">\n                            <path d=\"M4 .755l14.374 11.245-14.374 11.219.619.781 15.381-12-15.391-12-.609.755z\"/>\n                        </svg>\n                    </div>}\n                    <div className={styles.circle}>\n                        <svg width=\"160\" height=\"160\">\n                            <circle transform=\"rotate(-90)\"\n                                    r=\"72\" cx=\"-80\" cy=\"80\"/>\n                            <circle className=\"income\"\n                                    transform=\"rotate(-90)\"\n                                    r=\"72\" cx=\"-80\" cy=\"80\"\n                                    stroke=\"30bae7\"\n                                    strokeDasharray={[incomePercent, circumference].join(' ')}/>\n                            <circle className=\"expense\"\n                                    transform=\"rotate(-90)\"\n                                    r=\"72\" cx=\"-80\" cy=\"80\"\n                                    strokeDashoffset={incomePercent}\n                                    strokeDasharray={[expensePercent, circumference].join(' ')}/>\n                        </svg>\n                        <h4 className={styles.balance}><MoneyView money={month.balance}/></h4>\n                        <div>+<MoneyView money={month.income}/></div>\n                        <div>-<MoneyView money={month.expense}/></div>\n                    </div>\n                </div>\n            </div>\n            <MonthTxList month={month}/>\n        </>\n    );\n};\n","import { declareAction } from '@reatom/core';\nimport { AbstractMonthGrip } from '../../models/abstract-grip/month-grip.class';\n\nconst NS = 'grips/month';\n\nexport const updateMonthGrip = declareAction(NS + ':updateMonthGrip');\nexport const updateMonthGripSuccess = declareAction<AbstractMonthGrip>(NS + ':updateMonthGrip success');\nexport const updateMonthGripFailed = declareAction<any>(NS + ':updateMonthGrip failed');\n\nexport const updateMonthGrips = declareAction(NS + ':updateMonthGrips');\nexport const updateMonthGripsSuccess = declareAction<AbstractMonthGrip[]>(NS + ':updateMonthGrips success');\nexport const updateMonthGripsFailed = declareAction<any>(NS + ':updateMonthGrips failed');\n","import { declareAtom } from '@reatom/core';\nimport { Map } from 'immutable';\nimport { IMonthGripsState } from './month-grips.types';\nimport {\n    updateMonthGripSuccess,\n    updateMonthGripsSuccess,\n} from './month-grips.actions';\n\nexport const MonthGrips = declareAtom<IMonthGripsState>(\n    ['grips/month'],\n    Map(),\n    on => ({\n        update: [\n            on(updateMonthGripSuccess, (state, month) => {\n                return state.set(month.id, month);\n            }),\n            on(updateMonthGripsSuccess, (state, months) => {\n                return months.reduce(\n                    (acc, month) => acc.set(month.id, month),\n                    state,\n                );\n            }),\n        ],\n    }),\n);\n","import React, { useCallback, useEffect } from 'react';\nimport { useAction, useAtom } from '@reatom/react';\nimport { useHistory, useRouteMatch } from 'react-router';\nimport { MonthDate } from '../models/common/date.types';\nimport { loadMonths } from '../atoms/months/months.actions';\nimport { IMonthBrief } from '../models/month/month.types';\nimport { MonthViewHeadWidget } from '../widgets/MonthViewWidget';\nimport { Header } from '../components/Header';\nimport { paths } from '../routes';\nimport styles from './AccountMonthsPage.module.scss';\nimport { MonthTxList } from '../widgets/MonthTxList';\nimport { SwipeItemWidget, SwipeWidget } from '../widgets/SwipeWidget';\nimport { AccountGrips } from '../atoms/account-grips/account-grips.atom';\nimport { MonthGrips } from '../atoms/month-grips/month-grips.atom';\nimport { IMonthGripBrief } from '../models/abstract-grip/grip.types';\nimport { IAccount } from '../models/account/account.types';\nimport { AccountGrip } from '../models/account-grip/grip.class';\nimport { Main } from '../ui-kit/Main';\n\ninterface IParams {\n    account: string;\n    month?: MonthDate;\n}\n\nexport const AccountMonthsPage = () => {\n    // prepare\n    const {params} = useRouteMatch<IParams>();\n    const account = useAtom(AccountGrips, ({accounts}) => accounts.get(params.account), [params.account]);\n    const months = useAtom(MonthGrips);\n    const history = useHistory();\n\n    // create months list\n    const monthsList = [...account ? account.months : []];\n    monthsList.reverse();\n\n    // create handlers\n    const changeMonth = useCallback((newMonthNum) => {\n        history.replace(paths.account.month(account.id, newMonthNum));\n    }, [account, history]);\n\n    const loadMonth = useAction(id => id ? loadMonths([id]) : null, []);\n\n    // check before render\n    if (!account)\n        return (\n            <div>No account</div>\n        );\n\n    if (!account.months.length)\n        return (\n            <div>No months in this account</div>\n        );\n\n    return <AccountMonthsPageDisplay account={account}\n                                     month={params.month || account.lastMonthDate}/>;\n};\n\ninterface IPropsDisplay {\n    account: AccountGrip;\n    month: MonthDate;\n}\n\nexport const AccountMonthsPageDisplay = ({account, month}: IPropsDisplay) => {\n    // prepare\n    const months = useAtom(MonthGrips);\n    const history = useHistory();\n\n    // create months list\n    const monthsList = [...account ? account.months : []];\n    monthsList.reverse();\n\n    // create handlers\n    const changeMonth = useCallback((newMonthNum) => {\n        history.replace(paths.account.month(account.id, newMonthNum));\n    }, [account, history]);\n\n    const loadMonth = useAction(id => id ? loadMonths([id]) : null, []);\n\n    // get months\n    let monthIndex = account.months.findIndex(item => item.month === month);\n    if (monthIndex === -1)\n        monthIndex = 0;\n    const monthBrief: IMonthGripBrief = account.months[monthIndex];\n    const prevMonth = account.months[monthIndex + 1];\n    const nextMonth = account.months[monthIndex - 1];\n\n    // load months\n    useEffect(() => {\n        if (monthBrief && !months.has(monthBrief.id))\n            loadMonth(monthBrief.id);\n        if (prevMonth && !months.has(prevMonth.id))\n            loadMonth(prevMonth.id);\n        if (nextMonth && !months.has(nextMonth.id))\n            loadMonth(nextMonth.id);\n    }, [prevMonth, nextMonth, monthBrief]);\n    const currentMonth = months.get(monthBrief?.id);\n\n    // render\n    return (\n        <>\n            <Header back title={`Account ${account.name}`}/>\n            <Main className={styles.main + ' noselect'}>\n                <SwipeWidget onChange={changeMonth}\n                             current={monthBrief.month}\n                             showButtons>\n                    {monthsList.map(item => (\n                        <SwipeItemWidget key={item.month}>\n                            <MonthViewHeadWidget months={months}\n                                                 brief={item}\n                            />\n                        </SwipeItemWidget>\n                    ))}\n                </SwipeWidget>\n                <MonthTxList month={currentMonth}/>\n            </Main>\n        </>\n    );\n};\n","import { RouteProps } from 'react-router';\nimport { AccountsPage } from '../pages/AccountsPage';\nimport { AccountMonthsPage } from '../pages/AccountMonthsPage';\nimport { baseUrl } from './config';\nimport { MonthDate } from '../models/common/date.types';\n\nexport const account = {\n    list: () => `${baseUrl}/accounts`,\n    view: (account = ':account') => `${baseUrl}/accounts/${account}`,\n    monthsList: (account = ':account') => `${baseUrl}/accounts/${account}/months`,\n    month: (account = ':account', month: MonthDate = ':month') => `${baseUrl}/accounts/${account}/months/${month}`,\n};\n\nexport const accountsRoutes: RouteProps[] = [\n    {\n        path: account.list(),\n        exact: true,\n        component: AccountsPage,\n    },\n    {\n        path: account.view(),\n        exact: true,\n        component: AccountsPage,\n    },\n    {\n        path: account.month(),\n        component: AccountMonthsPage,\n    },\n    {\n        path: account.monthsList(),\n        component: AccountMonthsPage,\n    },\n];\n","export const baseUrl = '';\n\nexport function addQueryString(params: {[key:string]: any}): string {\n    if (!params)\n        return '';\n    if (!Object.keys(params).length)\n        return '';\n\n    return '?' + new URLSearchParams(params).toString();\n}\n","import { declareAction } from '@reatom/core';\nimport { loadAccounts, loadAccountsSuccess } from '../accounts/accounts.actions';\nimport { updateAccountGrips, updateAccountGripsSuccess } from '../account-grips/account-grips.actions';\n\nconst NS = 'client';\n\nexport const setOnlineStatus = declareAction<any>(NS + ':setOnlineStatus');\nexport const refresh = declareAction(NS + ':refresh');\n","import { declareAtom } from '@reatom/core';\nimport { IClientState } from './client.types';\nimport { setOnlineStatus } from './client.actions';\n\nexport const Client = declareAtom<IClientState>(\n    ['client'],\n    {\n        online: false,\n    },\n    on => ({\n        online: [\n            on(setOnlineStatus, (state, online) => ({...state, online})),\n        ],\n    }),\n);\n","import { declareAction } from '@reatom/core';\nimport { UUID } from '../../models/common/common.types';\nimport { Account } from '../../models/account/account.class';\n\nconst NS = 'accounts';\n/**\n * @deprecated\n */\nexport const chooseAccount = declareAction<UUID>(NS + ':chooseAccount');\n\nexport const loadAccounts = declareAction(NS + ':loadAccounts');\nexport const loadAccountsSuccess = declareAction<{\n    current?: UUID;\n    accounts: Account[];\n}>(NS + ':loadAccounts success');\nexport const loadAccountsFailed = declareAction<any>(NS + ':loadAccounts failed');\n\nexport const saveAccount = declareAction<Account>(NS + ':saveAccounts');\nexport const saveAccountSuccess = declareAction<UUID>(NS + ':saveAccounts success');\nexport const saveAccountFailed = declareAction<{ id: UUID, error: any }>(NS + ':saveAccounts failed');\n\n\n","import { declareAtom } from '@reatom/core';\nimport { Account } from '../../models/account/account.class';\nimport { Map } from 'immutable';\nimport { UUID } from '../../models/common/common.types';\nimport { chooseAccount, loadAccountsSuccess, saveAccount } from './accounts.actions';\n\nexport interface IAccountsState {\n    current: Account | null;\n    accounts: Map<UUID, Account>;\n}\n\nexport const Accounts = declareAtom<IAccountsState>(\n    ['accounts'],\n    {\n        current: null,\n        accounts: Map(),\n    },\n    on => ({\n        choose: [\n            on(chooseAccount, (state, id) => {\n                const current = state.accounts.get(id);\n                if (current)\n                    return {\n                        ...state,\n                        current,\n                    };\n                else\n                    return state;\n            }),\n        ],\n        load: [\n            on(loadAccountsSuccess, (state, {current, accounts}) => {\n                const list: Array<[string, Account]> = accounts.map(account => [account.id, account]);\n                const map = Map(list);\n                return {\n                    ...state,\n                    current: map.has(current) ? map.get(current) : accounts[0],\n                    accounts: map,\n                };\n            }),\n        ],\n        save: [\n            on(saveAccount, (state, account) => {\n                return {\n                    accounts: state.accounts.set(account.id, account),\n                    current: account.id === state.current?.id\n                        ? account\n                        : state.current,\n                };\n            }),\n        ],\n    }),\n);\n","import { declareAtom } from '@reatom/core';\nimport { Map } from 'immutable';\nimport { IMonthsState } from './months.types';\nimport { loadMonthsSuccess, saveMonths } from './months.actions';\n\nexport const Months = declareAtom<IMonthsState>(\n    ['months'],\n    Map(),\n    on => ({\n        load: [\n            on(loadMonthsSuccess, (months, items) => {\n                return items.reduce((acc, item) => acc.set(item.id, item), months);\n            }),\n        ],\n        save: [\n            on(saveMonths, (state, months) => {\n                return months.reduce(\n                    (acc, month) => acc.set(month.id, month),\n                    state,\n                );\n            }),\n        ],\n    }),\n);\n","import { UUID } from '../../models/common/common.types';\nimport { declareAction } from '@reatom/core';\nimport { CategoriesBlock } from '../../models/category/categoryBlock.class';\n\nconst NS = 'categories';\n\nexport const loadCategories = declareAction<UUID>(NS + ':loadCategories');\nexport const loadCategoriesSuccess = declareAction<CategoriesBlock>(NS + ':loadCategories success');\nexport const loadCategoriesFailed = declareAction<{ ids: UUID, error: any }>(NS + ':loadCategories failed');\n\nexport const saveCategories = declareAction<CategoriesBlock>(NS + ':saveCategories');\nexport const saveCategoriesSuccess = declareAction<UUID>(NS + ':saveCategories success');\nexport const saveCategoriesFailed = declareAction<{ ids: UUID, error: any }>(NS + ':saveCategories failed');\n","import { DefaultTransactionType, ICategory } from './category.types';\nimport { UUID } from '../common/common.types';\nimport { TransactionType } from '../transaction/transaction.types';\nimport { v4 } from 'uuid';\nimport { Packable, PackableClass } from '../../libs/packable/decorator';\nimport { Packer } from '../../libs/packable/packable';\n\n@PackableClass(data => new Category(data))\nexport class Category implements ICategory {\n    @Packable(String) public readonly id: UUID = '';\n    @Packable(String) public readonly name: string = '';\n    @Packable(String) public readonly parent: UUID | null = null;\n    @Packable(Number) public readonly defaultTxType: DefaultTransactionType = TransactionType.Expense;\n    @Packable(String) public readonly image: string = 'default';\n    @Packable(Boolean) public readonly isInitial = false;\n\n    public static create(name: string,\n                         defaultTransactionType: DefaultTransactionType,\n                         parent: ICategory | UUID | null,\n                         image: string = 'default',\n                         id?: UUID): Category {\n        return new Category({\n            id: id || v4(),\n            name,\n            image,\n            defaultTxType: defaultTransactionType,\n        }).setParent(parent);\n    }\n\n    public static createInitial(name: string,\n                                defaultTransactionType: DefaultTransactionType,\n                                parent: ICategory | UUID | null,\n                                image: string,\n                                id: UUID): Category {\n        if (!id) throw new Error('ID must be set');\n        return new Category({\n            ...Category.create(name, defaultTransactionType, parent, image, id),\n            isInitial: true,\n        });\n    }\n\n    public static fromJSON(data: any): Category {\n        return Packer.get(Category).decode(data);\n    }\n\n    public static toJSON(category: Category): any {\n        return category.toJSON();\n    }\n\n    protected constructor(data: Partial<ICategory>) {\n        if (!data.name) throw new Error('Name must be set');\n        Object.assign(this, data);\n    }\n\n    public toJSON(): any {\n        return Packer.get(Category).encode(this);\n    }\n\n    public setName(name: string): Category {\n        if (this.isInitial)\n            throw new Error(`Can not set name to initial category`);\n\n        return new Category({\n            ...this,\n            name,\n        });\n    }\n\n    public setDefaultTransactionType(type: DefaultTransactionType): Category {\n        return new Category({\n            ...this,\n            defaultTxType: type,\n        });\n    }\n\n    public setImage(image: string): Category {\n        return new Category({\n            ...this,\n            image,\n        });\n    }\n\n    public setParent(parent: ICategory | UUID | null): Category {\n        if (this.isInitial)\n            throw new Error(`Can not set parent to initial category`);\n\n        if (!parent)\n            return new Category({\n                ...this,\n                parent: null,\n            });\n        if (typeof parent === 'string')\n            return new Category({\n                ...this,\n                parent,\n            });\n        return new Category({\n            ...this,\n            parent: parent.id,\n        });\n    }\n}\n\nexport class RootCategory extends Category {\n    public readonly children: Category[] = [];\n\n    constructor(parent: Category, children: ReadonlyArray<Category>) {\n        super(parent);\n        this.children = children.filter(item => item.parent === this.id);\n    }\n}\n","import { declareAtom } from '@reatom/core';\nimport { ICategoriesState } from './categories.types';\nimport { loadCategoriesSuccess, saveCategories } from './categories.actions';\nimport { Map } from 'immutable';\nimport { RootCategory } from '../../models/category/category.class';\n\nexport const Categories = declareAtom<ICategoriesState>(\n    ['categories'],\n    Map(),\n    on => ({\n        load: [\n            on(loadCategoriesSuccess, (collection, block) => {\n                const tree = block.list\n                                  .filter(category => !category.parent)\n                                  .map(category => new RootCategory(category, block.list));\n\n                const list = tree.flatMap(parent => [parent, ...parent.children]);\n\n                const map = Map(list.map(category => [category.id, category]));\n\n                collection = collection.set(block.id, {block, tree, list, map}); // FIXME need create CategoriesBlocksAtom\n                return collection.set(block.account, {block, tree, list, map});\n            }),\n        ],\n        save: [\n            on(saveCategories, (state, months) => {\n                throw new Error('Not implemented');\n            }),\n        ],\n    }),\n);\n","import { combine, createStore } from '@reatom/core';\nimport { connectReduxDevtools } from '@reatom/debug';\nimport { Client } from '../atoms/client/client.atom';\nimport { Accounts } from '../atoms/accounts/accounts.atom';\nimport { Months } from '../atoms/months/months.atom';\nimport { Categories } from '../atoms/categories/categories.atom';\nimport { AccountGrips } from '../atoms/account-grips/account-grips.atom';\nimport { MonthGrips } from '../atoms/month-grips/month-grips.atom';\n\nexport const store = createStore(combine({\n    Client,\n    Accounts,\n    Categories,\n    Months,\n    AccountGrips,\n    MonthGrips,\n}));\n\nconnectReduxDevtools(store);\n\nexport function useStore() {\n    return store;\n}\n\nstore.subscribe((action, state) => {\n    console.group('*** action', action.type);\n    console.log(action.payload);\n    console.log(state);\n    console.groupEnd();\n});\n","import { declareAction } from '@reatom/core';\nimport { IAddTransactionForm } from './transaction.types';\n\nconst NS = 'transaction';\n\nexport const addTransaction = declareAction<IAddTransactionForm>(NS + ':addTransaction');\n","import { Icon } from '../../ui-kit/Icon';\nimport React, { MutableRefObject, ReactHTMLElement, useCallback, useEffect, useRef, useState } from 'react';\nimport { Field, RenderableProps, useField, UseFieldConfig } from 'react-final-form';\n\n// UseFieldConfig<FieldValue>,\n\nexport interface IBaseInputProps extends RenderableProps<any> {\n    name: string;\n    label: string;\n    clearable?: boolean;\n    placeholder?: string;\n    hint?: string;\n}\n\nexport const BaseInput = ({\n                              name, label, clearable, placeholder, hint, component, children, render,\n                          }: IBaseInputProps) => {\n    const field = useField(name);\n\n    const input: MutableRefObject<HTMLInputElement> = useRef();\n    const [active, setActive] = useState(false);\n\n    const onFocus = useCallback(() => setActive(true), [setActive]);\n    const onBlur = useCallback(() => setActive(false), [setActive]);\n    const onClearInput = useCallback(() => {\n        input.current.focus();\n        field.input.onChange('');\n    }, [input]);\n\n    return (\n        <div className=\"form-group basic\">\n            <div className={['input-wrapper', active ? 'active' : '', 'not-empty'].join(' ')}>\n                <label className=\"label\" htmlFor={`form-input-${name}`}>{label}</label>\n                <Field id={`form-input-${name}`}\n                       name={name}\n                       className=\"form-control\"\n                       ref={input}\n                       onFocus={onFocus} onBlur={onBlur}\n                       placeholder={placeholder}\n                       component={component} render={render}>{children}</Field>\n                {clearable &&\n                <i className=\"clear-input\" onClick={onClearInput}>\n                    <Icon name=\"close-circle\" role=\"img\" className=\"md hydrated\"\n                          aria-label=\"close circle\"/>\n                </i>\n                }\n            </div>\n            <div className=\"input-info\">{hint}</div>\n        </div>\n    );\n};\n","import NumberFormat from 'react-number-format';\nimport React from 'react';\nimport { BaseInput, IBaseInputProps } from './BaseInput';\n\nfunction NumberFormatCustom(props) {\n    const {inputRef, onChange, ...other} = props;\n\n    return (\n        <NumberFormat\n            {...other}\n            getInputRef={inputRef}\n            onValueChange={(values) => {\n                onChange({\n                    target: {\n                        name: props.name,\n                        value: values.value,\n                    },\n                });\n            }}\n            prefix=\"$\"\n            thousandSeparator=\" \"\n            isNumericString\n        />\n    );\n}\n\ninterface IProps extends IBaseInputProps {\n\n}\n\nexport const MoneyField = (props: IProps) => (\n    <BaseInput {...props}>\n        {({input, meta}) => (\n            <NumberFormatCustom {...input} className=\"form-control\" type=\"text\" placeholder=\"Amount\"/>\n        )}\n    </BaseInput>\n);\n","import { Field } from 'react-final-form';\nimport React, { useCallback } from 'react';\nimport styled from 'styled-components';\nimport { BaseInput, IBaseInputProps } from './BaseInput';\nimport { TransactionType } from '../../models/transaction/transaction.types';\n\ninterface ITxTypeButtonProps {\n    type: TransactionType;\n    value?: TransactionType;\n    disabled?: boolean;\n    onChange?: (type: TransactionType) => void;\n}\n\nconst TxTypeButton = ({type, value, disabled, onChange}: ITxTypeButtonProps) => {\n    const label = TransactionType[type];\n\n    const active = value === type;\n\n    const onClick = useCallback(() => onChange(type), [onChange, type]);\n\n    const classNames = [\n        'btn',\n        'rounded',\n        'mr-1',\n        'mb-1',\n        active\n            ? 'btn-primary '\n            : 'btn-outline-primary ',\n    ];\n\n    if (disabled)\n        return (\n            <button type=\"button\"\n                    className={classNames.join(' ')}\n                    disabled\n            >{label}</button>\n        );\n    else\n        return (\n            <button type=\"button\"\n                    className={classNames.join(' ')}\n                    onClick={onClick}\n            >{label}</button>\n        );\n};\n\nconst CheckboxWrapper = styled.div`\n    display: inline-block;\n    padding: 5px 10px;\n    cursor: pointer;\n    user-select: none;\n`;\n\nconst TxTypeCheckbox = ({type, value, disabled, onChange}: ITxTypeButtonProps) => {\n    const label = TransactionType[type];\n\n    const active = value === type;\n\n    const onClick = useCallback(() => onChange(type), [onChange, type]);\n\n    if (disabled)\n        return (\n            <CheckboxWrapper>\n                <div className=\"custom-control custom-checkbox d-inline\">\n                    <input type=\"checkbox\" className=\"custom-control-input\" id=\"customCheck2\"\n                           checked={active}/>\n                    <label className=\"custom-control-label p-0\" htmlFor=\"customCheck2\"/>\n                </div>\n                {label}\n            </CheckboxWrapper>\n        );\n    else\n        return (\n            <CheckboxWrapper onClick={onClick}>\n                <div className=\"custom-control custom-checkbox d-inline\">\n                    <input type=\"checkbox\" className=\"custom-control-input\" id=\"customCheck2\"\n                           value={type}\n                           checked={active}/>\n                    <label className=\"custom-control-label p-0\" htmlFor=\"customCheck2\"/>\n                </div>\n                {label}\n            </CheckboxWrapper>\n        );\n};\n\n\ninterface IProps extends IBaseInputProps {\n    types: TransactionType[];\n}\n\nexport const TxTypeField = ({types, ...props}: IProps) => {\n    return (\n        <BaseInput {...props} clearable={false}>\n            {({input}) => types.map(type => <TxTypeCheckbox\n                type={type}\n                value={input.value}\n                onChange={input.onChange}\n            />)}\n        </BaseInput>\n    );\n};\n","import React from 'react';\nimport { BaseInput, IBaseInputProps } from './BaseInput';\n\nexport const TextField = (props: IBaseInputProps) => (\n    <BaseInput {...props} component=\"input\"/>\n);\n","import React from 'react';\nimport { BaseInput, IBaseInputProps } from './BaseInput';\n\nexport const DayDateField = (props: IBaseInputProps) => (\n    <BaseInput {...props}>\n        {({input, meta}) => (\n            <input {...input} className=\"form-control\" type=\"date\" placeholder=\"Date\"/>\n        )}\n    </BaseInput>\n);\n","import React from 'react';\nimport { BaseInput, IBaseInputProps } from './BaseInput';\n\nexport interface ISelectInputProps extends IBaseInputProps {\n    options: Array<{ value: string, label: string }>\n}\n\nexport const SelectField = ({options, ...props}: ISelectInputProps) => (\n    <BaseInput {...props}>\n        {({input, meta}) => (\n            <select {...input} className=\"form-control custom-select\">\n                {options.map(({value, label}) =>\n                    <option value={value}>{label}</option>,\n                )}\n            </select>\n        )}\n    </BaseInput>\n);\n","import React from 'react';\nimport { BaseInput, IBaseInputProps } from './BaseInput';\nimport { SelectField } from './SelectField';\nimport { IAccount } from '../../models/account/account.types';\n\ninterface IAccountFieldProps extends IBaseInputProps {\n    accounts: IAccount[];\n}\n\nexport const AccountField = ({accounts, ...props}: IAccountFieldProps) => {\n    const options = accounts.map(acc => ({\n        value: acc.id,\n        label: acc.name,\n    }));\n\n    return <SelectField  {...props} options={options}/>;\n};\n","import React from 'react';\nimport { BaseInput, IBaseInputProps } from './BaseInput';\nimport { SelectField } from './SelectField';\nimport { IAccount } from '../../models/account/account.types';\nimport { ICategory } from '../../models/category/category.types';\n\ninterface ICategoryFieldProps extends IBaseInputProps {\n    categories: ICategory[];\n}\n\nexport const CategoryField = ({categories, ...props}: ICategoryFieldProps) => {\n    const options = categories.map(cat => ({\n        value: cat.id,\n        label: cat.name,\n    }));\n\n    return <SelectField  {...props} options={options}/>;\n};\n","import React from 'react';\nimport { Field, Form } from 'react-final-form';\nimport { MoneyField } from '../components/inputs/MoneyField';\nimport { IAddTransactionForm, TransactionType } from '../models/transaction/transaction.types';\nimport { TxTypeField } from '../components/inputs/TxTypeField';\nimport { BaseInput } from '../components/inputs/BaseInput';\nimport { TextField } from '../components/inputs/TextField';\nimport { DayDateField } from '../components/inputs/DayDateField';\nimport { AccountField } from '../components/inputs/AccountField';\nimport { IAccount } from '../models/account/account.types';\nimport { CategoryField } from '../components/inputs/CategoryField';\nimport { ICategory } from '../models/category/category.types';\n\ninterface IProps {\n    accounts: IAccount[];\n    categories: ICategory[];\n    value: IAddTransactionForm;\n    onSubmit: (value: IAddTransactionForm) => void;\n    validate: (value: IAddTransactionForm) => Partial<{ [key in keyof IAddTransactionForm]: string }>;\n}\n\nexport const TransactionForm = ({accounts, categories, onSubmit, value, validate}: IProps) => {\n    return (\n        <Form\n            onSubmit={onSubmit}\n            initialValues={value}\n            validate={validate}\n            render={({handleSubmit, form, submitting, pristine, values}) => (\n                <form onSubmit={handleSubmit} noValidate autoComplete=\"off\">\n                    <MoneyField name=\"amount\"\n                                label=\"Amount\"\n                                hint=\"This is amount\"\n                                placeholder=\"Enter amount\"\n                    />\n                    <CategoryField name=\"category\"\n                                   label=\"Category\"\n                                   categories={categories}\n                    />\n                    <TxTypeField name=\"type\"\n                                 label=\"\"\n                                 types={[\n                                     TransactionType.Income,\n                                     TransactionType.Expense,\n                                 ]}\n                    />\n                    <TextField name=\"title\"\n                               label=\"Title\"\n                    />\n                    <DayDateField name=\"date\"\n                                  label=\"Date\"\n                                  component=\"input\"/>\n                    <AccountField name=\"account\"\n                                  label=\"Account\"\n                                  accounts={accounts}\n                    />\n                    <button type=\"submit\" className=\"btn btn-primary rounded mr-1\">Save</button>\n                </form>\n            )}\n        />\n    );\n};\n","import React, { ReactNode } from 'react';\n\ninterface IProps {\n    full?: boolean;\n    children: ReactNode;\n}\n\nexport const Card = ({full, children}: IProps) => (\n    <div className={['card', 'mt-1', full ? 'full' : ''].join(' ')}>\n        <div className=\"card-body\">\n            {children}\n        </div>\n    </div>\n);\n","import { Map } from 'immutable';\nimport { IMonthGrip } from './grip.types';\nimport { UUID } from '../common/common.types';\nimport { ICategory } from '../category/category.types';\nimport { Money } from '../money/money.class';\nimport { MonthDate } from '../common/date.types';\nimport { ITag, TagName } from '../tag/tag.types';\nimport { AbstractDayGrip } from './day-grip.class';\n\nexport abstract class AbstractMonthGrip implements IMonthGrip {\n    id: UUID;\n    readonly balance: Money;\n    readonly balanceOnEnd: Money;\n    readonly balanceOnStart: Money;\n    readonly categories: Map<UUID, ICategory>;\n    readonly days: AbstractDayGrip[];\n    readonly expense: Money;\n    readonly income: Money;\n    readonly month: MonthDate;\n    readonly tags: Map<TagName, ITag>;\n\n    [Symbol.toStringTag] = 'AbstractMonthGrip';\n\n    constructor(month: MonthDate,\n                balanceOnStart: Money,\n                days: AbstractDayGrip[],\n    ) {\n        this.month = month;\n        if (days.length)\n            days.reduce(\n                (last, next) => {\n                    if (last.date >= next.date)\n                        throw new Error(`Days must be sorted`);\n                    return next;\n                },\n            );\n        this.days = days;\n\n        // categories and tags\n        let categories: Map<UUID, ICategory> = Map();\n        let tags = Map();\n\n        this.days.forEach(day => day.categories.forEach(\n            category => categories = categories.set(category.id, category),\n        ));\n\n        this.categories = categories;\n\n        // balance\n        this.balanceOnStart = balanceOnStart;\n        this.balanceOnEnd = this.days.reduce(\n            (lastSum, day) => {\n                const sum = lastSum.add(day.balance);\n                if (!day.balanceOnStart.equal(lastSum))\n                    throw new Error(`Start balance on day ${day.date} must be ${lastSum} but received ${day.balanceOnStart}`);\n                if (!day.balanceOnEnd.equal(sum))\n                    throw new Error(`End balance on day ${day.date} must be ${sum} but received ${day.balanceOnEnd}`);\n                if (!day.balance.equal(day.balanceOnEnd.sub(day.balanceOnStart)))\n                    throw new Error(`Balance on day ${day.date} must be ${day.balanceOnEnd.sub(day.balanceOnStart)} but received ${day.balance}`);\n                return sum;\n            },\n            this.balanceOnStart,\n        );\n        this.balance = this.balanceOnEnd.sub(this.balanceOnStart);\n\n        this.income = this.days\n                          .reduce(\n                              (sum, tx) => sum.add(tx.income),\n                              Money.empty,\n                          );\n        this.expense = this.days\n                           .reduce(\n                               (sum, tx) => sum.add(tx.expense),\n                               Money.empty,\n                           );\n    }\n}\n","import { Set } from 'immutable';\nimport { ITransactionGrip } from './grip.types';\nimport { ITransaction, TransactionType } from '../transaction/transaction.types';\nimport { DayDate } from '../common/date.types';\nimport { IAccount } from '../account/account.types';\nimport { ICategory } from '../category/category.types';\nimport { Money } from '../money/money.class';\nimport { TagName } from '../tag/tag.types';\nimport { UUID } from '../common/common.types';\n\nexport class TransactionGrip implements ITransactionGrip {\n    id: UUID;\n    account: IAccount;\n    amount: Money;\n    category: ICategory;\n    changeAmount: Money;\n    createdAt: Date;\n    date: DayDate;\n    sourceTxs: ITransaction[];\n    tags: Set<TagName>;\n    title: string | '';\n    type: TransactionType;\n    updatedAt: Date;\n\n    constructor(data: ITransactionGrip) {\n        Object.assign(this, data);\n    }\n}\n","import { Map, Set } from 'immutable';\nimport { AbstractDayGrip } from '../abstract-grip/day-grip.class';\nimport { UUID } from '../common/common.types';\nimport { IDay } from '../day/day.class';\nimport { IAccount } from '../account/account.types';\nimport { ICategory } from '../category/category.types';\nimport { Money } from '../money/money.class';\nimport { ITransactionGrip } from '../abstract-grip/grip.types';\nimport { TransactionType } from '../transaction/transaction.types';\n\nexport class AccountDayGrip extends AbstractDayGrip {\n    constructor(balanceOnStart: Money,\n                day: IDay,\n                account: IAccount,\n                categories: Map<UUID, ICategory>) {\n        const transactions: ITransactionGrip[] = day.transactions.map(tx => {\n            const category = categories.get(tx.category || 'default');\n            if (!category)\n                throw new Error(`Category \"${tx.category || 'default'}\" not found`);\n\n            const grip = {\n                id: tx.id,\n                account,\n                amount: tx.amount,\n                changeAmount: tx.amount,\n                title: tx.title,\n                type: tx.type,\n                category,\n                createdAt: tx.createdAt ? new Date(tx.createdAt) : null,\n                updatedAt: tx.updatedAt ? new Date(tx.updatedAt) : null,\n                date: day.date,\n                sourceTxs: [tx],\n                tags: Set(),\n            };\n\n            switch (tx.type) {\n                case TransactionType.Income:\n                    return grip;\n                case TransactionType.Expense:\n                    return {\n                        ...grip,\n                        changeAmount: tx.amount.negative(),\n                    };\n                default:\n                    throw new Error(`Unsupported type \"${TransactionType[tx.type]}\"`);\n            }\n        });\n\n        super(day.date, balanceOnStart, transactions);\n    }\n}\n","import { Map, Set } from 'immutable';\nimport { IDayGrip, ITransactionGrip } from './grip.types';\nimport { IAccount } from '../account/account.types';\nimport { UUID } from '../common/common.types';\nimport { IDay } from '../day/day.class';\nimport { ICategory } from '../category/category.types';\nimport { Money } from '../money/money.class';\nimport { DayDate } from '../common/date.types';\nimport { ITag, TagName } from '../tag/tag.types';\nimport { TransactionGrip } from './transaction-grip.class';\n\nexport abstract class AbstractDayGrip implements IDayGrip {\n    readonly balance: Money;\n    readonly balanceOnEnd: Money;\n    readonly balanceOnStart: Money;\n    readonly categories: Map<UUID, ICategory>;\n    readonly date: DayDate;\n    readonly expense: Money;\n    readonly income: Money;\n    readonly tags: Map<TagName, ITag>;\n    readonly transactions: TransactionGrip[];\n\n    protected constructor(date: DayDate,\n                          balanceOnStart: Money,\n                          gripTransactions: ITransactionGrip[]) {\n        // base\n        this.date = date;\n        this.transactions = gripTransactions.map(item => new TransactionGrip(item));\n\n        // categories and tags\n        let categories: Map<UUID, ICategory> = Map();\n        let tags = Map();\n\n        this.transactions.forEach(tx => {\n            categories = categories.set(tx.category.id, tx.category);\n        });\n\n        this.categories = categories;\n\n        // balance\n        this.balanceOnStart = balanceOnStart;\n        this.balance = this.transactions.reduce(\n            (sum, tx) => sum.add(tx.changeAmount),\n            Money.empty,\n        );\n        this.balanceOnEnd = this.balanceOnStart.add(this.balance);\n        this.income = this.transactions\n                          .filter(tx => tx.changeAmount.isPositive())\n                          .reduce(\n                              (sum, tx) => sum.add(tx.changeAmount),\n                              Money.empty,\n                          );\n        this.expense = this.transactions\n                           .filter(tx => tx.changeAmount.isNegative())\n                           .reduce(\n                               (sum, tx) => sum.add(tx.changeAmount),\n                               Money.empty,\n                           )\n                           .negative();\n\n        //    ,  tags, categories, accounts(?), balance, balanceOnEnd\n    }\n}\n","import { Map, Set } from 'immutable';\nimport { AbstractMonthGrip } from '../abstract-grip/month-grip.class';\nimport { IMonth } from '../month/month.types';\nimport { IAccount } from '../account/account.types';\nimport { ICategory } from '../category/category.types';\nimport { UUID } from '../common/common.types';\nimport { Money } from '../money/money.class';\nimport { AccountDayGrip } from './day-grip.class';\n\nexport class AccountMonthGrip extends AbstractMonthGrip {\n    constructor(balanceOnStart: Money,\n                month: IMonth,\n                account: IAccount,\n                categories: Map<UUID, ICategory>) {\n        const {days, balanceOnEnd} = month.days.reduce(\n            ({days, balanceOnEnd}, day) => {\n                const grip = new AccountDayGrip(\n                    balanceOnEnd,\n                    day,\n                    account,\n                    categories,\n                );\n                days.push(grip);\n                return {\n                    days,\n                    balanceOnEnd: grip.balanceOnEnd,\n                };\n            }, {\n                days: [],\n                balanceOnEnd: balanceOnStart,\n            });\n\n        super(month.month, balanceOnStart, days);\n        this.id = month.id;\n\n        if (!this.balanceOnEnd.equal(balanceOnEnd))\n            throw new Error(`Wrong balance on end: expected ${balanceOnEnd} but received ${this.balanceOnEnd}`);\n    }\n}\n","import { DayDate, MonthDate } from './date.types';\n\nexport function parseMonthDate(value: MonthDate): Date {\n    const match: RegExpMatchArray | null = value.match(/^(\\d{4})-(\\d{2})$/);\n    if (!match)\n        throw new Error(`Invalid MonthDate \"${value}\"`);\n\n    const year = +match[1];\n    const month = +match[2] - 1;\n    const date = new Date(year, month, 1, 12, 0, 0);\n\n    if (date.getFullYear() !== year)\n        throw new Error(`Invalid year in \"${value}\"`);\n    if (date.getMonth() !== month)\n        throw new Error(`Invalid month in \"${value}\"`);\n\n    return date;\n}\n\nexport function parseDayDate(value: DayDate): Date {\n    const match: RegExpMatchArray | null = value.match(/^(\\d{4})-(\\d{2})-(\\d{2})$/);\n    if (!match)\n        throw new Error(`Invalid DayDate \"${value}\"`);\n\n    const year = +match[1];\n    const month = +match[2] - 1;\n    const day = +match[3];\n    const date = new Date(year, month, day, 12, 0, 0);\n\n    if (date.getFullYear() !== year)\n        throw new Error(`Invalid year in \"${value}\"`);\n    if (date.getMonth() !== month)\n        throw new Error(`Invalid month in \"${value}\"`);\n    if (date.getDate() !== day)\n        throw new Error(`Invalid date in \"${value}\"`);\n\n    return date;\n}\n\nexport function dayDateToMonth(day: DayDate): MonthDate {\n    return day.split('-', 2).join('-');\n}\n","import { UUID } from '../models/common/common.types';\nimport { useAction, useAtom } from '@reatom/react';\nimport { AccountGrips } from '../atoms/account-grips/account-grips.atom';\nimport { DayDate, MonthDate } from '../models/common/date.types';\nimport { Months } from '../atoms/months/months.atom';\nimport { AccountMonthGrip } from '../models/account-grip/month-grip.class';\nimport { dayDateToMonth } from '../models/common/date.utils';\nimport { loadMonths } from '../atoms/months/months.actions';\n\nexport function useAccount(accountId: UUID) {\n    return useAtom(\n        AccountGrips,\n        ({accounts}) => accounts.get(accountId),\n        [accountId],\n    );\n}\n\nexport function useMonth(accountId: UUID, dayDate: MonthDate | DayDate) {\n    const account = useAccount(accountId);\n    const months = useAtom(Months);\n    const loadMonth = useAction(loadMonths);\n\n    const monthDate = dayDateToMonth(dayDate);\n\n    if (!account)\n        return null;\n\n    const foundMonthBrief = account.account.months.find(item => item.month === monthDate);\n\n    if (!foundMonthBrief)\n        return null;\n\n    const monthData = months.get(foundMonthBrief.id);\n    if (!monthData) {\n        loadMonth([foundMonthBrief.id]);\n        return null;\n    }\n\n    return new AccountMonthGrip(monthData.summary.balanceOnStart, monthData, account.account, account.categories);\n}\n\nexport function useTransaction(accountId: UUID, dayDate: DayDate, txId: UUID) {\n    const month = useMonth(accountId, dayDate);\n\n    if (!month)\n        return null;\n\n    const day = month.days.find(item => item.date === dayDate);\n    if (!day)\n        return null;\n\n    console.log(day);\n    return day.transactions.find(item => item.id === txId);\n}\n","import React from 'react';\nimport { ITransactionGrip } from '../models/abstract-grip/grip.types';\nimport { Header } from '../components/Header';\nimport { Icon, Icons } from '../ui-kit/Icon';\nimport { Main } from '../ui-kit/Main';\nimport { UUID } from '../models/common/common.types';\nimport { DayDate } from '../models/common/date.types';\nimport { useRouteMatch } from 'react-router';\nimport { useAccount, useMonth, useTransaction } from '../hooks';\nimport { TransactionType } from '../models/transaction/transaction.types';\nimport { MoneyView } from '../components/MoneyView';\nimport { Link, paths } from '../routes';\n\ninterface IParams {\n    accountId: UUID;\n    date: DayDate;\n    txId: UUID;\n}\n\nexport const TransactionViewPage = () => {\n    const {accountId, date, txId} = useRouteMatch<IParams>().params;\n\n    const tx = useTransaction(accountId, date, txId);\n\n    if (!tx)\n        return (\n            <div>\n                Not found\n            </div>\n        );\n\n    return (\n        <>\n            <Header title=\"Transaction details\" back/>\n            <Main>\n                <div className=\"section mt-2 mb-2\">\n                    <div className=\"card inner\" style={{padding: 16}}>\n                        <div className=\"listed-detail mt-3\">\n                            <div className=\"icon-wrapper\">\n                                <div className=\"iconbox\">\n                                    <Icon icon={Icons.arrowForwardOutline} role=\"img\" className=\"md hydrated\"/>\n                                </div>\n                            </div>\n                            <h3 className=\"text-center mt-2\">{TransactionType[tx.type]}</h3>\n                        </div>\n\n                        <ul className=\"listview flush transparent simple-listview no-space mt-3\">\n                            <li>\n                                <strong>Amount</strong>\n                                <span><MoneyView money={tx.amount}/></span>\n                            </li>\n                            <li>\n                                <strong>Category</strong>\n                                <span>{tx.category.name}</span>\n                            </li>\n                            <li>\n                                <strong>Title</strong>\n                                <span>{tx.title || 'No title'}</span>\n                            </li>\n                            <li>\n                                <strong>Tags</strong>\n                                <span>{tx.tags.join(', ') || 'No tags'}</span>\n                            </li>\n                            <li>\n                                <strong>Wallet</strong>\n                                <span><Link to={paths.account.view(tx.account.id)}>{tx.account.name}</Link></span>\n                            </li>\n                            <li>\n                                <strong>Date</strong>\n                                <span>{tx.date}</span>\n                            </li>\n                        </ul>\n                    </div>\n                </div>\n            </Main>\n        </>\n    );\n};\n","import { RouteProps } from 'react-router';\nimport { TransactionAddPage } from '../pages/TransactionAddPage';\nimport { TransactionsPage } from '../pages/TransactionsPage';\nimport { addQueryString, baseUrl } from './config';\nimport { UUID } from '../models/common/common.types';\nimport { IAddTransactionForm } from '../models/transaction/transaction.types';\nimport { TransactionViewPage } from '../pages/TransactionViewPage';\nimport { DayDate, MonthDate } from '../models/common/date.types';\n\nexport const transactions = {\n    list: () => `${baseUrl}/transactions`,\n    add: (params?: Partial<IAddTransactionForm>) => `${baseUrl}/transaction/add` + addQueryString(params),\n    view: (accountId: UUID = ':accountId',\n           date: DayDate = ':date',\n           txId: UUID = ':txId') => `${baseUrl}/accounts/${accountId}/day/${date}/${txId}`,\n};\n\nexport const transactionRoutes: RouteProps[] = [\n    {\n        path: transactions.add(),\n        component: TransactionAddPage,\n    },\n    {\n        path: transactions.view(),\n        component: TransactionViewPage,\n    },\n    {\n        path: transactions.list(),\n        component: TransactionsPage,\n    },\n];\n","import React, { useState } from 'react';\nimport { IAddTransactionForm, TransactionType } from '../models/transaction/transaction.types';\nimport { store } from '../store/store';\nimport { addTransaction } from '../models/transaction/transaction.actions';\nimport { useHistory, useLocation } from 'react-router';\nimport { Header } from '../components/Header';\nimport { TransactionForm } from '../widgets/TransactionForm';\nimport { Section } from '../ui-kit/Section';\nimport { Card } from '../ui-kit/Card';\nimport { Main } from '../ui-kit/Main';\nimport { useAtom } from '../store/reatom';\nimport { AccountGrips } from '../atoms/account-grips/account-grips.atom';\nimport { Accounts } from '../atoms/accounts/accounts.atom';\n\nexport const TransactionAddPage = () => {\n    const params = new URLSearchParams(useLocation().search);\n    const history = useHistory();\n\n    const {current: currentAccount} = useAtom(AccountGrips);\n    const {accounts} = useAtom(Accounts);\n    const categories = currentAccount ? Array.from(currentAccount.categories.values()) : [];\n\n    const [data, setData] = useState({\n        type: params.get('type')\n            ? params.get('type') in TransactionType\n                ? TransactionType[params.get('type')]\n                : TransactionType.Expense\n            : TransactionType.Expense,\n        amount: params.get('amount') || '', // todo use Money\n        date: params.get('date') || '2020-06-01', // todo use today\n        account: params.get('account') || currentAccount?.id || '',\n        category: params.get('category') || 'default',\n    } as IAddTransactionForm);\n\n    const submitHandler = (data: IAddTransactionForm) => {\n        console.log(data);\n        setData(data);\n        store.dispatch(addTransaction(data));\n        history.goBack();\n    };\n\n    function validate(data: IAddTransactionForm) {\n        const errors: Partial<{ [key in keyof IAddTransactionForm]: string }> = {};\n        if (!data.account)\n            errors.account = 'Required';\n        return errors;\n    }\n\n    return (\n        <>\n            <Header title=\"Add transaction\"\n                    back/>\n            <Main>\n                <Section full title=\"Add transaction\">\n                    <Card>\n                        <TransactionForm value={data}\n                                         onSubmit={submitHandler}\n                                         validate={validate}\n                                         accounts={Array.from(accounts.values())}\n                                         categories={categories}\n                        />\n                    </Card>\n                </Section>\n            </Main>\n        </>\n    );\n};\n","import React from 'react';\n\nimport styles from './TransactionsPage.module.scss';\nimport { Header } from '../components/Header';\nimport { TxList } from '../widgets/TxList';\nimport { TransactionGrip } from '../models/abstract-grip/transaction-grip.class';\nimport { MonthDate } from '../models/common/date.types';\nimport { Main } from '../ui-kit/Main';\n\ninterface IProps {\n    month: MonthDate;\n    transactions: TransactionGrip[];\n}\n\nexport const TransactionsPage = ({month, transactions}: IProps) => {\n    transactions = transactions || [];\n    return (\n        <div className={styles.page}>\n            <Header title={`Transactions of ${month}`}/>\n            <Main>\n                <div className={styles.filter}>\n                    <button className={styles.active}></button>\n                    <button></button>\n                    <button></button>\n                </div>\n                <TxList list={transactions} dayDate=\"2020-05-05\"/>\n            </Main>\n        </div>\n    );\n};\n","import { account } from './accounts';\nimport { transactions } from './transactions';\nimport { baseUrl } from './config';\n\nexport const paths = {\n    account,\n    transactions,\n    home: () => `${baseUrl}/accounts`,\n    licenses: () => `${baseUrl}/licenses`,\n    menu: () => `${baseUrl}/menu`,\n};\n","import React from 'react';\nimport styles from './LicensesPage.module.scss';\nimport { Header } from '../components/Header';\nimport { Main } from '../ui-kit/Main';\nimport { Section } from '../ui-kit/Section';\nimport { Card } from '../ui-kit/Card';\n\ninterface IProps {\n    link: string;\n    title: string;\n    author: string;\n    license: string;\n}\n\nconst LicenseItem = ({title, link, author, license}: IProps) => (\n    <li>\n        <a href={link} target=\"_blank\"\n           className=\"item\">\n            {/*<img src=\"assets/img/sample/avatar/avatar1.jpg\" alt=\"image\" className=\"image\"/>*/}\n            <div className=\"in\">\n                <div>\n                    <header>{author}</header>\n                    {title}\n                    <footer>{license}</footer>\n                </div>\n            </div>\n        </a>\n    </li>\n);\n\nexport const LicensesPage = () => {\n\n    return (\n        <>\n            <Header title=\"Licenses\"/>\n            <Main className={styles.licenses}>\n                <ul className=\"listview link-listview inset mt-2\">\n                    <LicenseItem link=\"https://reactjs.org/\"\n                                 title=\"ReactJS\"\n                                 author=\"Facebook Open Source\"\n                                 license=\"MIT License\"/>\n                    <LicenseItem link=\"https://reatom.js.org/\"\n                                 title=\"Reatom state manager\"\n                                 author=\"Arutyunyan Artyom\"\n                                 license=\"MIT License\"/>\n                    <LicenseItem link=\"https://iconstore.co/icons/dripicons-v2/\"\n                                 title={'Icons \"Dripicons\" Version 2.0'}\n                                 author=\"Amit Jakhu\"\n                                 license=\"CC BY 4.0\"/>\n                </ul>\n            </Main>\n        </>\n    );\n};\n","import { RouteProps } from 'react-router';\nimport { accountsRoutes } from './accounts';\nimport { transactionRoutes } from './transactions';\nimport { paths } from './index';\nimport { LicensesPage } from '../pages/LicensesPage';\nimport { MainMenu } from '../pages/MainMenu';\n\nexport const routes: RouteProps[] = [\n    // {\n    //     path: '/finman/',\n    //     exact: true,\n    //     component: SubsetsPage,\n    // },\n    ...accountsRoutes,\n    ...transactionRoutes,\n    {\n        path: paths.menu(),\n        component: MainMenu,\n    },\n    {\n        path: paths.licenses(),\n        component: LicensesPage,\n    },\n];\n","import React from 'react';\nimport { Header } from '../components/Header';\nimport { Main } from '../ui-kit/Main';\nimport { paths } from '../routes';\n\nexport const MainMenu = () => {\n    return (\n        <>\n            <Header title=\"Menu\" back/>\n            <Main>\n                <div className=\"listview-title mt-1\">Storage</div>\n                <ul className=\"listview image-listview text inset\"\n                    style={{marginLeft: '0', marginRight: '0'}}>\n                    <li>\n                        <div className=\"item\">\n                            <div className=\"in\">\n                                <div>Subsets</div>\n                                <span className=\"text-muted\">0</span>\n                            </div>\n                        </div>\n                    </li>\n                    <li>\n                        <div className=\"item\">\n                            <div className=\"in\">\n                                <div>Accounts</div>\n                                <span className=\"text-muted\">1</span>\n                            </div>\n                        </div>\n                    </li>\n                    <li>\n                        <div className=\"item\">\n                            <div className=\"in\">\n                                <div>Month blocks</div>\n                                <span className=\"text-muted\">123</span>\n                            </div>\n                        </div>\n                    </li>\n                    <li>\n                        <div className=\"button item\">\n                            <div className=\"in\">\n                                <div>\n                                    Remove all data\n                                    <div className=\"text-muted\">\n                                        This action cannot be undone\n                                    </div>\n                                </div>\n                            </div>\n                        </div>\n                    </li>\n                </ul>\n\n                {/*<div className=\"listview-title mt-1\">Notifications</div>*/}\n                {/*<ul className=\"listview image-listview text inset\">*/}\n                {/*    <li>*/}\n                {/*        <div className=\"item\">*/}\n                {/*            <div className=\"in\">*/}\n                {/*                <div>*/}\n                {/*                    Payment Alert*/}\n                {/*                    <div className=\"text-muted\">*/}\n                {/*                        Send notification when new payment received*/}\n                {/*                    </div>*/}\n                {/*                </div>*/}\n                {/*                <div className=\"custom-control custom-switch\">*/}\n                {/*                    <input type=\"checkbox\" className=\"custom-control-input\" id=\"customSwitch4\"/>*/}\n                {/*                    <label className=\"custom-control-label\" htmlFor=\"customSwitch4\"/>*/}\n                {/*                </div>*/}\n                {/*            </div>*/}\n                {/*        </div>*/}\n                {/*    </li>*/}\n                {/*    <li>*/}\n                {/*        <a href=\"#\" className=\"item\">*/}\n                {/*            <div className=\"in\">*/}\n                {/*                <div>Notification Sound</div>*/}\n                {/*                <span className=\"text-primary\">Beep</span>*/}\n                {/*            </div>*/}\n                {/*        </a>*/}\n                {/*    </li>*/}\n                {/*</ul>*/}\n\n                {/*<div className=\"listview-title mt-1\">Profile Settings</div>*/}\n                {/*<ul className=\"listview image-listview text inset\">*/}\n                {/*    <li>*/}\n                {/*        <a href=\"#\" className=\"item\">*/}\n                {/*            <div className=\"in\">*/}\n                {/*                <div>Change Username</div>*/}\n                {/*            </div>*/}\n                {/*        </a>*/}\n                {/*    </li>*/}\n                {/*    <li>*/}\n                {/*        <a href=\"#\" className=\"item\">*/}\n                {/*            <div className=\"in\">*/}\n                {/*                <div>Update E-mail</div>*/}\n                {/*            </div>*/}\n                {/*        </a>*/}\n                {/*    </li>*/}\n                {/*    <li>*/}\n                {/*        <a href=\"#\" className=\"item\">*/}\n                {/*            <div className=\"in\">*/}\n                {/*                <div>Address</div>*/}\n                {/*                <span className=\"text-primary\">Edit</span>*/}\n                {/*            </div>*/}\n                {/*        </a>*/}\n                {/*    </li>*/}\n                {/*    <li>*/}\n                {/*        <div className=\"item\">*/}\n                {/*            <div className=\"in\">*/}\n                {/*                <div>*/}\n                {/*                    Private Profile*/}\n                {/*                </div>*/}\n                {/*                <div className=\"custom-control custom-switch\">*/}\n                {/*                    <input type=\"checkbox\" className=\"custom-control-input\" id=\"customSwitch2\"/>*/}\n                {/*                    <label className=\"custom-control-label\" htmlFor=\"customSwitch2\"/>*/}\n                {/*                </div>*/}\n                {/*            </div>*/}\n                {/*        </div>*/}\n                {/*    </li>*/}\n                {/*</ul>*/}\n\n                {/*<div className=\"listview-title mt-1\">Security</div>*/}\n                {/*<ul className=\"listview image-listview text mb-2 inset\">*/}\n                {/*    <li>*/}\n                {/*        <a href=\"#\" className=\"item\">*/}\n                {/*            <div className=\"in\">*/}\n                {/*                <div>Update Password</div>*/}\n                {/*            </div>*/}\n                {/*        </a>*/}\n                {/*    </li>*/}\n                {/*    <li>*/}\n                {/*        <div className=\"item\">*/}\n                {/*            <div className=\"in\">*/}\n                {/*                <div>*/}\n                {/*                    2 Step Verification*/}\n                {/*                </div>*/}\n                {/*                <div className=\"custom-control custom-switch\">*/}\n                {/*                    <input type=\"checkbox\" className=\"custom-control-input\" id=\"customSwitch3\"/>*/}\n                {/*                    <label className=\"custom-control-label\" htmlFor=\"customSwitch3\"/>*/}\n                {/*                </div>*/}\n                {/*            </div>*/}\n                {/*        </div>*/}\n                {/*    </li>*/}\n                {/*    <li>*/}\n                {/*        <a href=\"#\" className=\"item\">*/}\n                {/*            <div className=\"in\">*/}\n                {/*                <div>Log out all devices</div>*/}\n                {/*            </div>*/}\n                {/*        </a>*/}\n                {/*    </li>*/}\n                {/*</ul>*/}\n            </Main>\n        </>\n    );\n};\n\n","import * as ReactRouterDom from 'react-router-dom';\n\nexport const Link = ReactRouterDom.Link;\nexport const NavLink = ReactRouterDom.NavLink;\n","import React from 'react';\nimport { paths, NavLink } from '../routes';\nimport { Icon, Icons } from '../ui-kit/Icon';\n\ninterface INavLink {\n    path: string;\n    exact?: boolean;\n    icon: string;\n    label: string;\n}\n\nconst links: INavLink[] = [\n    {\n        path: paths.home(),\n        exact: true,\n        icon: Icons.walletOutline,\n        label: 'Wallets',\n    },\n    // {\n    //     path: paths.home(),\n    //     exact: true,\n    //     icon: Icons.cardOutline,\n    //     label: 'Wallets',\n    // },\n    {\n        path: paths.transactions.add(),\n        icon: Icons.addCircleOutline,\n        label: 'New item',\n    },\n    {\n        path: paths.menu(),\n        icon: Icons.ellipsisHorizontalOutline,\n        label: 'Menu',\n    },\n];\n\nexport const NavBar = () => {\n    return (\n        <div className=\"appBottomMenu\">\n            {links.map(link => (\n                <NavLink to={link.path} exact={link.exact} className=\"item\">\n                    <div className=\"col\">\n                        <Icon icon={link.icon} role=\"img\" className=\"md hydrated\"\n                              aria-label=\"pie chart outline\"/>\n                        <strong>{link.label}</strong>\n                    </div>\n                </NavLink>\n            ))}\n        </div>\n    );\n};\n","export enum DBStatus {\n    Initializing,\n    Upgrading,\n    Migrating,\n    Ready,\n    Failed,\n}\n\nexport interface IScheme<T = any, K extends keyof T = any> {\n    collection: string;\n    dbVersion: number;\n    key: K;\n\n    upgrade?(objectStore: IDBObjectStore, oldVersion: number, newVersion: number): void;\n}\n\nexport type DBStatusListener = (status: DBStatus) => void;\n","export function eventLogger<T extends { addEventListener: Function }>(emitter: T, emitterName: string, eventName: string | string[]) {\n    if (Array.isArray(eventName))\n        eventName.forEach(name => eventLogger(emitter, emitterName, name));\n    else\n        emitter.addEventListener(eventName, event => {\n            console.log(`[eventLogger] Emitter: \"${emitterName}\", event \"${eventName}\":`, event);\n        });\n}\n","import { eventLogger } from './db.utils';\nimport { UUID } from '../../models/common/common.types';\n\nexport class Collection<T = any> {\n    private readonly transaction: IDBTransaction;\n    private readonly storage: IDBObjectStore;\n\n    constructor(private db: IDBDatabase, private scheme: any) {\n        this.transaction = db.transaction(scheme.collection, 'readwrite');\n        eventLogger(\n            this.transaction,\n            'transaction',\n            [\n                'abort',\n                'complete',\n                'error',\n            ],\n        );\n        this.storage = this.transaction.objectStore(scheme.collection);\n    }\n\n    //\n    // public commit(): Promise<void> {\n    //     return new Promise<void>((resolve, reject) => {\n    //         // this.transaction.commit();\n    //     });\n    // }\n\n\n    // Returns an IDBRequest object, and, in a separate thread, creates a structured clone of the value, and stores the cloned value in the object store. This is for adding new records to an object store.\n    public add(value: T): Promise<T> {\n        return new Promise((resolve, reject) => {\n            const request = this.storage.add(value);\n\n            eventLogger(request, 'request', [\n                'error',\n                'success',\n            ]);\n\n            request.onsuccess = (event: any) => resolve(event.target.result);\n            request.onerror = error => reject(error);\n        });\n    }\n\n    // Creates and immediately returns an IDBRequest object, and clears this object store in a separate thread. This is for deleting all current records out of an object store.\n    // IDBObjectStore.clear()\n    // Returns an IDBRequest object, and, in a separate thread, returns the total number of records that match the provided key or IDBKeyRange. If no arguments are provided, it returns the total number of records in the store.\n    // IDBObjectStore.count()\n    // Creates a new index during a version upgrade, returning a new IDBIndex object in the connected database.\n    // IDBObjectStore.createIndex()\n    // returns an IDBRequest object, and, in a separate thread, deletes the store object selected by the specified key. This is for deleting individual records out of an object store.\n    // IDBObjectStore.delete()\n    // Destroys the specified index in the connected database, used during a version upgrade.\n    // IDBObjectStore.deleteIndex()\n\n    /** Returns an IDBRequest object, and, in a separate thread, returns the store object store\n     *  selected by the specified key. This is for retrieving specific records from an object store.\n     *\n     *  *IDBObjectStore.get()*\n     */\n    public get(id: UUID): Promise<T> {\n        return new Promise((resolve, reject) => {\n            const request = this.storage.get(id);\n\n            eventLogger(request, 'request', [\n                'error',\n                'success',\n            ]);\n\n            request.onsuccess = (event: any) => resolve(event.target.result);\n            request.onerror = error => reject(error);\n        });\n    }\n\n    // Returns an IDBRequest object, and, in a separate thread retrieves and returns the record key for the object in the object stored matching the specified parameter.\n    // IDBObjectStore.getKey()\n\n    // Returns an IDBRequest object retrieves all objects in the object store matching the specified parameter or all objects in the store if no parameters are given.\n    public getAll(query?: string[], count?: number): Promise<T[]> {\n        if (Array.isArray(query))\n            return Promise.all(query.map(id => this.get(id)));\n\n        return new Promise((resolve, reject) => {\n            const request = this.storage.getAll(query);\n\n            eventLogger(request, 'request', [\n                'error',\n                'success',\n            ]);\n\n            request.onsuccess = (event: any) => resolve(event.target.result);\n            request.onerror = error => reject(error);\n        });\n    }\n\n\n    // Returns an IDBRequest object retrieves record keys for all objects in the object store matching the specified parameter or all objects in the store if no parameters are given.\n    // IDBObjectStore.getAllKeys()\n    // Opens an index from this object store after which it can, for example, be used to return a sequence of records sorted by that index using a cursor.\n    // IDBObjectStore.index()\n    // Returns an IDBRequest object, and, in a separate thread, returns a new IDBCursorWithValue object. Used for iterating through an object store by primary key with a cursor.\n    // IDBObjectStore.openCursor()\n    // Returns an IDBRequest object, and, in a separate thread, returns a new IDBCursor. Used for iterating through an object store with a key.\n    // IDBObjectStore.openKeyCursor()\n\n    /**\n     * Returns an IDBRequest object, and, in a separate thread, creates a structured clone\n     * of the value, and stores the cloned value in the object store. This is for updating\n     * existing records in an object store when the transaction's mode is readwrite.\n     *\n     * *IDBObjectStore.put()*\n     */\n    //\n    public update(value: T): Promise<T> {\n        return new Promise((resolve, reject) => {\n            const request = this.storage.put(value);\n\n            eventLogger(request, 'request', [\n                'error',\n                'success',\n            ]);\n\n            request.onsuccess = (event: any) => resolve(event.target.result);\n            request.onerror = error => reject(error);\n        });\n    }\n}\n","import { DBStatus, DBStatusListener, IScheme } from './db.types';\nimport { Collection } from './collection';\nimport { eventLogger } from './db.utils';\n\nexport class IndexedDB {\n    get status(): DBStatus {\n        return this._status;\n    }\n\n    private listeners: DBStatusListener[] = [];\n\n    private _status = DBStatus.Initializing;\n\n    private db: IDBDatabase | null = null;\n\n    constructor(dbName: string,\n                public schemes: IScheme[],\n                private onInstall: (objectStore: IndexedDB) => Promise<void>,\n                private onUpgrade?: (objectStore: IndexedDB, oldVersion: number, newVersion: number) => Promise<void>,\n    ) {\n        if (!window.indexedDB)\n            throw new Error('IndexedDB not supported');\n\n        schemes.forEach(scheme => {\n            const exists = schemes.find(item => item !== scheme && item.collection === scheme.collection);\n            if (exists)\n                throw new Error(`Collection \"${scheme.collection}\" used in different schemes.\\nYou can use collection only in one scheme`);\n        });\n\n        const version = Math.max(1, ...schemes.map(model => model.dbVersion));\n\n        console.log(`Start DB with version: ${version}, count of models: ${schemes.length}`);\n\n        this.openDB(dbName, version).then(\n            () => console.log('Successfully open DB'),\n            event => console.error('Failed to open DB', event),\n        );\n    }\n\n    public transaction<T>(scheme: IScheme<T>): Collection<T> {\n        if (this._status !== DBStatus.Ready && this._status !== DBStatus.Migrating)\n            throw new Error('Database not ready');\n\n        return this.getAccessor(scheme);\n    }\n\n    public addStatusListener(fn: DBStatusListener): void {\n        this.listeners.push(fn);\n        setTimeout(() => fn(this.status));\n    }\n\n    public removeStatusListener(fn: DBStatusListener): void {\n        this.listeners = this.listeners.filter(item => item !== fn);\n    }\n\n    private setStatus(status: DBStatus): void {\n        console.log(`change DB status to \"${DBStatus[status]}\"`);\n        if (status === this._status)\n            return;\n        console.log(`Change DB status from \"${DBStatus[this._status]}\" to \"${DBStatus[status]}\"`);\n        this._status = status;\n        this.listeners.forEach(fn => fn(status));\n    }\n\n    private getAccessor(scheme: IScheme): Collection {\n        if (this.db)\n            return new Collection(this.db, scheme);\n        else\n            throw new Error('Cannot create accessor for closed database');\n    }\n\n    private openDB(dbName: string, version: number): Promise<void> {\n        this.setStatus(DBStatus.Initializing);\n        return new Promise(((resolve, reject) => {\n            const openRequest = window.indexedDB.open(dbName, version);\n\n            let isUpgrade = false;\n            let oldVersion = version;\n            let newVersion = version;\n\n            eventLogger(\n                openRequest,\n                'openRequest',\n                [\n                    'upgradeneeded',\n                    'blocked',\n                    'error',\n                    'success',\n                ],\n            );\n\n            openRequest.addEventListener('upgradeneeded', (event: any) => {\n                this.setStatus(DBStatus.Upgrading);\n                isUpgrade = true;\n                oldVersion = event.oldVersion;\n                newVersion = event.newVersion;\n                if (oldVersion)\n                    console.log(`Upgrade DB from version ${oldVersion}`);\n                else\n                    console.log('Initialize DB');\n\n                const transaction: IDBTransaction = this.db = event.target.transaction;\n                console.log(transaction);\n                const db: IDBDatabase = this.db = event.target.result;\n\n                console.log(Array.from(db.objectStoreNames));\n\n                this.schemes.forEach(scheme => {\n                    let objectStore: IDBObjectStore;\n                    try {\n                        objectStore = transaction.objectStore(scheme.collection);\n                    } catch (e) {\n                        console.warn(e);\n                        objectStore = db.createObjectStore(scheme.collection, {keyPath: scheme.key});\n                    }\n\n                    console.log(objectStore);\n                    if (scheme.upgrade) {\n                        scheme.upgrade(objectStore!, oldVersion, newVersion);\n                    }\n                });\n            });\n\n            openRequest.addEventListener('success', async (event: any) => {\n                this.db = event.target.result;\n\n                if (isUpgrade) {\n                    this.setStatus(DBStatus.Migrating);\n\n                    if (!oldVersion)\n                        await this.onInstall(this);\n                    else if (this.onUpgrade)\n                        await this.onUpgrade(this, oldVersion, newVersion);\n                }\n                this.setStatus(DBStatus.Ready);\n                resolve();\n            });\n            openRequest.addEventListener('error', (event: any) => {\n                console.log(event);\n                this.setStatus(DBStatus.Failed);\n                reject(event);\n            });\n        }));\n    }\n}\n","import { IScheme } from '../../libs/indexed-db';\nimport { IAccount } from '../../models/account/account.types';\n\nexport const AccountScheme: IScheme<IAccount> = {\n    collection: 'accounts',\n    dbVersion: 1,\n    key: 'id',\n    upgrade(objectStore, oldVersion, newVersion): void {\n        console.log('update account from ', oldVersion, newVersion);\n    },\n};\n","import { Money } from '../money/money.class';\nimport { Packer } from '../../libs/packable/packable';\n\nexport type UUID = string;\nexport type HASH = string;\n\nexport enum SyncStatus {\n    NoSynced,\n    Prepared,\n    Syncing,\n    FullySynced,\n    Fixed,\n}\n\nexport interface ISummary {\n    balance: Money;\n    income: Money;\n    expense: Money;\n}\n\nexport const summaryPacker = Packer.forObject<ISummary>({\n    balance: Money,\n    income: Money,\n    expense: Money,\n});\n\nexport interface IExtendSummary extends ISummary {\n    balanceOnStart: Money;\n    balanceOnEnd: Money;\n}\n\nexport const extendSummaryPacker = Packer.forObject<IExtendSummary>({\n    balance: Money,\n    income: Money,\n    expense: Money,\n    balanceOnStart: Money,\n    balanceOnEnd: Money,\n});\n\nexport const EmptySummary: ISummary = {\n    balance: Money.empty,\n    income: Money.empty,\n    expense: Money.empty,\n};\n\nexport const EmptyExtendSummary: IExtendSummary = {\n    ...EmptySummary,\n    balanceOnStart: Money.empty,\n    balanceOnEnd: Money.empty,\n};\n\nObject.freeze(EmptySummary);\nObject.freeze(EmptyExtendSummary);\n","import { IScheme } from '../../libs/indexed-db';\nimport { IMonth } from '../../models/month/month.types';\n\nexport const MonthScheme: IScheme<IMonth> = {\n    collection: 'months',\n    dbVersion: 1,\n    key: 'id',\n    upgrade(objectStore, oldVersion, newVersion): void {\n        console.log('update months from ', oldVersion, newVersion);\n    },\n};\n","import { extendSummaryPacker, IExtendSummary, SyncStatus, UUID } from '../common/common.types';\nimport { IDay } from '../day/day.class';\nimport { MonthDate } from '../common/date.types';\nimport { Packer } from '../../libs/packable/packable';\n\nexport interface IMonthBrief {\n    id: UUID;\n    month: MonthDate;\n    summary: IExtendSummary;\n    prevMonths: UUID[];\n    prevVersions: UUID[];\n    dataHash: string;\n}\n\nexport const monthBriefPacker = Packer.maybe(Packer.forObject<IMonthBrief>({\n    id: String,\n    month: String,\n    summary: extendSummaryPacker,\n    prevMonths: [String],\n    prevVersions: [String],\n    dataHash: String,\n}));\n\nexport interface IMonth extends IMonthBrief {\n    syncStatus: SyncStatus;\n    timestamp: number;\n    account: UUID;\n    days: IDay[];\n}\n","import { ITransaction, TransactionType } from './transaction.types';\nimport { IExtendSummary, ISummary } from '../common/common.types';\nimport { Money } from '../money/money.class';\n\nexport const EMPTY_SUMMARY: ISummary = {\n    income: Money.empty,\n    expense: Money.empty,\n    balance: Money.empty,\n};\n\nexport function calculateSummary(transactions: ITransaction[]): ISummary {\n    let [expense, income] = transactions.reduce(\n        ([expense, income], tx) => {\n            switch (tx.type) {\n                case TransactionType.Removed:\n                    return [expense, income];\n                case TransactionType.Income:\n                    return [\n                        expense,\n                        income.add(tx.amount),\n                    ];\n                case TransactionType.Expense:\n                    return [\n                        expense.add(tx.amount),\n                        income,\n                    ];\n                default:\n                    throw new Error(`Can't process type \"${TransactionType[tx.type]}\"`);\n            }\n        },\n        [Money.empty, Money.empty],\n    );\n\n    const balance = income.sub(expense);\n\n    return {\n        balance,\n        expense,\n        income,\n    };\n}\n\nexport function calculateExtendSummary(transactions: ITransaction[]): IExtendSummary {\n    let balanceOnStart = Money.empty;\n\n    const summary = calculateSummary(transactions);\n\n    return {\n        ...summary,\n        balanceOnStart,\n        balanceOnEnd: balanceOnStart.add(summary.balance),\n    };\n}\n\nexport function addSummary(base: ISummary, add: ISummary): ISummary {\n    const balance = base.balance.add(add.balance);\n    const expense = base.expense.add(add.expense);\n    const income = base.income.add(add.income);\n    if (!income.sub(expense).equal(balance)) {\n        if (!checkSummary(base))\n            throw new Error(`\"Base\" summary invalid`);\n        if (!checkSummary(add))\n            throw new Error(`\"Add\" summary invalid`);\n        throw new Error(`Incorrect balance`);\n    }\n    return {\n        balance,\n        expense,\n        income,\n    };\n}\n\nexport function addExtendSummary(base: IExtendSummary, add: ISummary): IExtendSummary {\n    const summary = addSummary(base, add);\n    const balanceOnStart = base.balanceOnStart;\n    const balanceOnEnd = base.balanceOnEnd.add(add.balance);\n    if (!summary.income.sub(summary.expense).equal(summary.balance)) {\n        if (!checkExtendSummary(base))\n            throw new Error(`\"Base\" summary invalid`);\n        if (!checkSummary(add))\n            throw new Error(`\"Add\" summary invalid`);\n        throw new Error(`Incorrect balance`);\n    }\n    return {\n        ...summary,\n        balanceOnStart,\n        balanceOnEnd,\n    };\n}\n\nexport function checkSummary(summary: ISummary): boolean {\n    const balance = summary.income.sub(summary.expense);\n    return balance.equal(summary.balance);\n}\n\nexport function checkExtendSummary(summary: IExtendSummary): boolean {\n    if (!checkSummary(summary))\n        return false;\n    const balance = summary.income.sub(summary.expense);\n    const balanceOnEnd = summary.balanceOnStart.add(balance);\n    return balanceOnEnd.equal(summary.balanceOnEnd);\n}\n","import { v1 as uuidGenerator } from 'uuid';\nimport { ITransaction, TransactionType } from './transaction.types';\nimport { UUID } from '../common/common.types';\nimport { Money } from '../money/money.class';\nimport { Packable, PackableClass } from '../../libs/packable/decorator';\nimport { Packer } from '../../libs/packable/packable';\n\n@PackableClass(data => new Transaction(data))\nexport class Transaction implements ITransaction {\n    @Packable(String) public id: UUID = '';\n    @Packable(Money) public amount: Money = Money.empty;\n    @Packable(Number) public type: TransactionType = TransactionType.Removed;\n    @Packable(String) public category: UUID | '' = '';\n    @Packable(String) public title: string | '' = '';\n    @Packable(Number) public createdAt: number = 0;\n    @Packable(Number) public updatedAt: number = 0;\n\n    public static createWithID(id: UUID, type?: TransactionType,\n                               amount?: Money): Transaction;\n    public static createWithID(id: UUID, type: TransactionType,\n                               amount: string | number,\n                               currencyName: string): Transaction;\n    public static createWithID(id: UUID, type: TransactionType = TransactionType.Removed,\n                               amount?: string | number | Money,\n                               currencyName?: string): Transaction {\n        const tx = new Transaction({\n            id,\n            amount: Money.empty,\n            type,\n            category: '',\n            title: '',\n            createdAt: 0,\n            updatedAt: 0,\n        });\n\n        if (amount)\n            return tx.setAmount(amount as any, currencyName as any);\n        else\n            return tx;\n    }\n\n    public static create(type?: TransactionType,\n                         amount?: Money): Transaction;\n    public static create(type: TransactionType,\n                         amount: string | number,\n                         currencyName: string): Transaction;\n    public static create(type: TransactionType = TransactionType.Removed,\n                         amount?: string | number | Money,\n                         currencyName?: string): Transaction {\n        const id = uuidGenerator();\n\n        const tx = new Transaction({\n            id,\n            amount: Money.empty,\n            type,\n            category: '',\n            title: '',\n            createdAt: 0,\n            updatedAt: 0,\n        });\n\n        if (amount)\n            return tx.setAmount(amount as any, currencyName as any);\n        else\n            return tx;\n    }\n\n    public static fromJSON(data: any): Transaction { // TODO  \n        return Packer.get(Transaction).decode(data);\n    }\n\n    public static toJSON(tx: Transaction): any {\n        return tx.toJSON();\n    }\n\n    private constructor(data: unknown) {\n        Object.assign(this, data);\n    }\n\n    public toJSON(): object {\n        return Packer.get(Transaction).encode(this);\n    }\n\n    public setAmount(money: Money): Transaction;\n    public setAmount(amount: string | number, currencyName: string): Transaction;\n    public setAmount(amount: string | number | Money, currencyName?: string): Transaction {\n        let money: Money;\n        if ((typeof amount === 'string' || typeof amount === 'number') && typeof currencyName === 'string')\n            money = Money.create(amount, currencyName);\n        else\n            money = Money.from(amount as (string | Money));\n\n        return new Transaction({\n            ...this,\n            amount: money,\n        });\n    }\n\n    public setType(type: TransactionType): Transaction {\n        return new Transaction({\n            ...this,\n            type,\n        });\n    }\n\n    public setCategory(category: UUID | null): Transaction {\n        return new Transaction({\n            ...this,\n            category,\n        });\n    }\n\n    public setTitle(title: string | ''): Transaction {\n        return new Transaction({\n            ...this,\n            title,\n        });\n    }\n\n    public setCreatedAt(createdAt: number): Transaction {\n        return new Transaction({\n            ...this,\n            createdAt,\n        });\n    }\n\n    public setUpdatedAt(updatedAt: number): Transaction {\n        return new Transaction({\n            ...this,\n            updatedAt,\n        });\n    }\n}\n","import { EmptySummary, ISummary, summaryPacker } from '../common/common.types';\nimport { ITransaction } from '../transaction/transaction.types';\nimport { calculateSummary } from '../transaction/transactions.utils';\nimport { DayDate } from '../common/date.types';\nimport { parseDayDate } from '../common/date.utils';\nimport { Transaction } from '../transaction/transaction.class';\nimport { Packable, PackableClass } from '../../libs/packable/decorator';\nimport { Packer } from '../../libs/packable/packable';\n\nexport interface IDay {\n    date: DayDate;\n    summary: ISummary;\n    transactions: ITransaction[];\n}\n\n@PackableClass(data => new Day(data))\nexport class Day implements IDay {\n    @Packable(String) public readonly date: DayDate = '';\n    @Packable(summaryPacker) public readonly summary: ISummary = EmptySummary;\n    @Packable([Transaction]) public readonly transactions: Transaction[] = [];\n    public readonly dateTime: Date = new Date();\n\n    public static create(date: DayDate): Day {\n        return new Day({date});\n    }\n\n    public static fromJSON(value: any): Day {\n        return Packer.get(Day).decode(value);\n    }\n\n    protected constructor(data: Partial<Day>) {\n        Object.assign(this, data);\n        this.dateTime = parseDayDate(this.date);\n    }\n\n    public toJSON(): any {\n        return Packer.get(Day).encode(this);\n    }\n\n    // FIXME remove interface or make transaction by data\n    public addTransaction(tx: ITransaction): Day {\n        const transactions: ITransaction[] = [\n            ...this.transactions,\n            tx,\n        ];\n\n        const summary: ISummary = calculateSummary(transactions);\n\n        return new Day({\n            ...this,\n            summary,\n            transactions,\n        });\n    }\n}\n","import sha1 from 'crypto-js/sha1';\nimport {\n    EmptyExtendSummary,\n    EmptySummary,\n    extendSummaryPacker,\n    IExtendSummary,\n    SyncStatus,\n    UUID,\n} from '../common/common.types';\nimport { IMonth, IMonthBrief } from './month.types';\nimport { Day, IDay } from '../day/day.class';\nimport { getDaysInMonth } from 'date-fns';\nimport { parseMonthDate } from '../common/date.utils';\nimport { DayDate, MonthDate } from '../common/date.types';\nimport { addSummary } from '../transaction/transactions.utils';\nimport { Money } from '../money/money.class';\nimport { Packable, PackableClass } from '../../libs/packable/decorator';\nimport { Packer } from '../../libs/packable/packable';\n\n/**\n * ID    ,         ID\n *       ID\n */\n@PackableClass(data => new Month(data))\nexport class Month implements IMonth {\n    @Packable(String) public readonly id: UUID = '';\n    @Packable(Number) public readonly version: number = 1;\n    @Packable(String) public readonly account: UUID = '';\n    @Packable(String) public readonly month: MonthDate = '';\n    @Packable(Number) public readonly syncStatus: SyncStatus = SyncStatus.NoSynced;\n    @Packable([String]) public readonly prevMonths: UUID[] = [];\n    @Packable([String]) public readonly prevVersions: UUID[] = [];\n    @Packable(String) public readonly dataHash: string = '';\n    @Packable(Number) public readonly timestamp: number = 0;\n    public readonly updatedAt: Date = new Date(0);\n    @Packable(extendSummaryPacker) public readonly summary: IExtendSummary = EmptyExtendSummary;\n    @Packable([Day]) public readonly days: Day[] = [];\n    @Packable(Number) public readonly daysInMonth: number = 0;\n\n    /**\n     * @param account\n     * @param month\n     * @param timestamp\n     */\n    public static createFirstBlock(account: UUID, month: MonthDate, timestamp: number): Month {\n        const daysInMonth = getDaysInMonth(parseMonthDate(month));\n\n        return new Month({\n            timestamp,\n            account,\n            month,\n            daysInMonth,\n            days: [],\n            syncStatus: SyncStatus.Fixed,\n        });\n    }\n\n    public static generateID(month: Month, dataHash?: string): string {\n        if (month.version !== 1)\n            throw new Error(`Version ${month.version} not supported`);\n\n        const data = {\n            version: month.version,\n            account: month.account,\n            prevMonths: month.prevMonths,\n            prevVersions: month.prevVersions,\n            dataHash: dataHash || month.getDataHash(),\n        };\n\n        const hash = sha1(JSON.stringify(data)).toString();\n\n        const date = parseMonthDate(month.month);\n        const year = date.getFullYear() - 1970;\n        const monthID = (year * 12 + date.getMonth()).toString(16).padStart(3, '0');\n\n        const ts = (month.timestamp / 1000).toString(16)\n                                           .substr(0, 11)\n                                           .replace('.', '');\n\n        let id = `${monthID}${ts}${hash}`.substr(0, 32);\n\n        id = [\n            id.substr(0, 8),\n            id.substr(8, 4),\n            id.substr(12, 4),\n            id.substr(16, 4),\n            id.substr(20, 12),\n        ].join('-');\n\n        return id;\n    }\n\n    /**\n     *   \n     *\n     * @param blocks   \n     * @param revisions   \n     */\n    public static merge(blocks: Month[], revisions: Month[]): Month {\n        //   \n        //  sync \n\n        throw new Error();\n    }\n\n    public static getBrief(month: IMonthBrief): IMonthBrief {\n        return {\n            id: month.id,\n            month: month.month,\n            summary: month.summary,\n            prevMonths: month.prevMonths,\n            prevVersions: month.prevVersions,\n            dataHash: month.dataHash,\n        };\n    }\n\n    public static fromJSON(value: any): Month {\n        return Packer.get(Month).decode(value);\n    }\n\n    public toJSON(): any {\n        return Packer.get(Month).encode(this);\n    }\n\n    protected constructor(value: Partial<Month>) { // FIXME use all fields of Month\n        Object.assign(this, value);\n        this.dataHash = this.getDataHash();\n        this.id = Month.generateID(this, this.dataHash);\n    }\n\n    public getBrief(): IMonthBrief {\n        return Month.getBrief(this);\n    }\n\n    public getDataHash(): string {\n        if (!this.days.length)\n            return '0000000000000000000000000000000000000000';\n\n        const data = {\n            days: this.days!.map(day => day.toJSON()),\n        };\n        return sha1(JSON.stringify(data)).toString();\n    }\n\n    public changeSyncStatus(syncStatus: SyncStatus): Month {\n        if (syncStatus === this.syncStatus)\n            return this;\n\n        switch (this.syncStatus) {\n            case SyncStatus.NoSynced:\n                if (syncStatus === SyncStatus.Prepared)\n                    return new Month({...this, syncStatus});\n                break;\n            case SyncStatus.Prepared:\n                if (syncStatus === SyncStatus.Syncing)\n                    return new Month({...this, syncStatus});\n                break;\n            case SyncStatus.Syncing:\n                if (syncStatus === SyncStatus.FullySynced)\n                    return new Month({...this, syncStatus});\n                break;\n            case SyncStatus.FullySynced:\n        }\n\n        throw new Error(`Can not change sync status from \"${SyncStatus[this.syncStatus]}\" to \"${SyncStatus[syncStatus]}\"`);\n    }\n\n    public createDay(date: number | DayDate): Day {\n        if (typeof date === 'number')\n            return Day.create(this.createDayDate(date));\n        else if (date.substr(0, 7) === this.month)\n            return Day.create(date);\n        else\n            throw new Error(`Date \"${date}\" not of month \"${this.month}\"`);\n    }\n\n    public createDayDate(day: number): string {\n        return this.month + '-' + day.toString().padStart(2, '0');\n    }\n\n    public createNextBlock(month: MonthDate, timestamp: number): Month {\n        const daysInMonth = getDaysInMonth(parseMonthDate(month));\n\n        const summary: IExtendSummary = {\n            balanceOnStart: this.summary.balanceOnEnd,\n            income: Money.empty,\n            expense: Money.empty,\n            balanceOnEnd: this.summary.balanceOnEnd,\n            balance: Money.empty,\n        };\n\n        return new Month({\n            account: this.account,\n            month,\n            prevMonths: [this.id],\n            prevVersions: [],\n            timestamp,\n            // updatedAt: timestamp, // TODO\n            summary,\n            days: [],\n            daysInMonth,\n            syncStatus: SyncStatus.Fixed,\n        });\n    }\n\n    public isDateOfMonth(date: DayDate): boolean {\n        return date.substr(0, 7) === this.month;\n    }\n\n    public recalculateWithNewStartBalance(startBalance: Money): Month {\n        return new Month({\n            ...this,\n            summary: calculateSummaryFromStartBalance(startBalance, this.days),\n        });\n    }\n\n    public updatePrevMonths(prevMonths: IMonthBrief[], timestamp: number): Month {\n        if (prevMonths.length !== 1)\n            throw new Error(`Sorry, can not process not one prevMonths`);\n\n        if (prevMonths[0].month >= this.month)\n            throw new Error(`All prevMonths must be earlier then updating month`);\n\n        if (prevMonths.length === this.prevMonths.length\n            && prevMonths.every((item, index) => this.prevMonths[index] === item.id))\n            return this;\n\n        return new Month({\n            ...this,\n            timestamp,\n            prevMonths: prevMonths.map(item => item.id),\n            prevVersions: this.syncStatus\n                ? this.id\n                    ? [this.id]\n                    : []\n                : this.prevVersions || [],\n            summary: calculateSummaryFromStartBalance(Money.from(prevMonths[0].summary.balanceOnEnd), this.days),\n        });\n    }\n\n    public getDay(dayDate: DayDate): Day {\n        const day = this.days.find(item => item.date === dayDate);\n        return day || this.createDay(dayDate);\n    }\n\n    public updateDay(newDay: Day): Month {\n        if (!(newDay instanceof Day))\n            throw new Error(`Cannot update month, newDay must be instance of Day`);\n\n        if (!this.isDateOfMonth(newDay.date))\n            throw new Error(`Day \"${newDay.date}\" not of month \"${this.month}\"`);\n\n        const days = this.days.slice();\n        const dayIndex = this.days.findIndex(item => item.date === newDay.date);\n        if (dayIndex === -1) {\n            days.push(newDay);\n            days.sort((a, b) => a.date > b.date ? 1 : -1);\n        } else {\n            days.splice(dayIndex, 1, newDay);\n        }\n\n        const summary = calculateSummaryFromStartBalance(this.summary.balanceOnStart, days);\n\n        return new Month({\n            ...this,\n            syncStatus: SyncStatus.NoSynced,\n            days,\n            summary,\n            prevVersions: this.syncStatus\n                ? this.id\n                    ? [this.id]\n                    : []\n                : this.prevVersions || [],\n        });\n    }\n}\n\nfunction calculateSummaryFromStartBalance(startBalance: Money, days: IDay[]): IExtendSummary {\n    const baseSummary = days.reduce(\n        (acc, day) => addSummary(acc, day.summary),\n        EmptySummary,\n    );\n\n    return {\n        ...baseSummary,\n        balanceOnStart: startBalance,\n        balanceOnEnd: startBalance.add(baseSummary.balance),\n    };\n}\n","import { IMonthBrief } from '../month/month.types';\nimport { Month } from '../month/month.class';\nimport { UUID } from '../common/common.types';\n\n/**\n *  \n * @param head  \n * @param additions  \n * @param old  \n */\nexport function updateMonthChain(head: IMonthBrief | Month,\n                                 additions: ReadonlyArray<IMonthBrief | Month>,\n                                 old: ReadonlyArray<IMonthBrief>): ReadonlyArray<IMonthBrief> {\n    head = Month.getBrief(head);\n\n    additions = additions.map(Month.getBrief);\n\n    old = old.map(Month.getBrief);\n\n    const {chain, completed} = findChain(head, additions);\n\n    // console.log(completed, chain.map(item => item.month + ' ' + item.id), old.length);\n\n    if (old.length === 0)\n        if (completed)\n            return chain;\n        else\n            throw new RequiredMonthsError(...chain.pop()!.prevMonths);\n\n    if (completed) {\n        if (!isVersionOfMonth(chain[chain.length - 1], old[old.length - 1], additions))\n            throw new CanNotFastForwardMonthError(old, chain);\n    } else {\n        const first = chain[chain.length - 1];\n\n        const preFirstID = first.prevMonths[0];\n\n        const preFirstIndex = old.findIndex(item => item.id === preFirstID);\n\n        console.log('completed', completed);\n        console.log('preFirstIndex', preFirstIndex);\n\n        console.log('head', [head.month, head.id, head.prevMonths, head.prevVersions].join(' '));\n        console.log('adds');\n        console.log(additions.map(item => [item.month, item.id, item.prevMonths, item.prevVersions].join(' ')));\n        console.log('old chain');\n        console.log(old.map(item => [item.month, item.id, item.prevMonths, item.prevVersions].join(' ')));\n\n        if (preFirstIndex === -1)\n            throw new RequiredMonthsError(preFirstID);\n    }\n\n    const monthsNumbersSet = new Set();\n    // for (let i = 0; i < preFirstIndex; i++)\n    //     monthsNumbersSet.add(old[i].month);\n    old.forEach(item => monthsNumbersSet.add(item.month));\n\n    chain.forEach(item => monthsNumbersSet.add(item.month));\n\n    const monthsNumbers = Array.from(monthsNumbersSet.keys());\n    monthsNumbers.sort();\n\n    const table = monthsNumbers.map(month => {\n        const element = chain.find(item => item.month === month);\n        const oldEl = old.find(item => item.month === month);\n\n        const check = element\n            ? isVersionOfMonth(element, oldEl, additions)\n            : null;\n\n        if (check === false)\n            throw new CanNotFastForwardMonthError(old, chain);\n\n        return {\n            month,\n            oldEl,\n            element,\n            check,\n        };\n    });\n\n    console.log('table');\n    console.table(table);\n\n    table.reverse();\n\n    const newChain = table.map(item => item.element || item.oldEl!);\n\n    checkChain(newChain);\n\n    if (newChain[0]!.id !== head.id)\n        throw new Error('Invalid Head month');\n\n    return newChain;\n}\n\n/**\n *    element  oldEl\n *    true  element   oldEl\n * @param element  \n * @param oldEl  \n * @param additions  \n */\nexport function isVersionOfMonth(element: IMonthBrief, oldEl: IMonthBrief | undefined, additions: ReadonlyArray<IMonthBrief> = []): boolean {\n    if (!oldEl)\n        return true;\n\n    if (element.month !== oldEl.month)\n        return false;\n\n    const items = [oldEl, ...additions];\n\n    if (element.prevVersions.every((id, index) => oldEl.prevVersions[index] === id))\n        return true;\n\n    for (; element.id !== oldEl.id;) {\n        if (element.prevVersions.length === 0)\n            return false;\n\n        if (element.prevVersions.length > 1)\n            throw new Error('      ');\n\n        const nextId = element.prevVersions[0];\n\n        const next = items.find(item => item.id === nextId);\n\n        if (next)\n            element = next;\n        else\n            throw new RequiredMonthsError(nextId);\n    }\n\n    return true;\n}\n\nexport function findChain(head: IMonthBrief, items: ReadonlyArray<IMonthBrief>): {\n    completed: boolean,\n    chain: IMonthBrief[],\n} {\n    const chain: IMonthBrief[] = [];\n\n    let lastBlock: IMonthBrief | undefined = head;\n    do {\n        chain.push(lastBlock);\n\n        if (lastBlock.prevMonths.length === 0)\n            return {\n                completed: true,\n                chain,\n            };\n\n        if (lastBlock.prevMonths.length !== 1)\n            throw new Error(`Can not process merged month ${lastBlock.id} (${lastBlock.month}): more then 1 prevMonths`);\n        if (lastBlock.prevVersions.length > 1)\n            throw new Error(`Can not process merged month ${lastBlock.id} (${lastBlock.month}): more then 1 prevVersions`);\n\n        const nextID = lastBlock.prevMonths[0];\n        lastBlock = items.find(item => item.id === nextID);\n\n        if (!lastBlock) {\n            return {\n                completed: false,\n                chain,\n            };\n        }\n    } while (true);\n}\n\nexport function checkChain(chain: ReadonlyArray<IMonthBrief>): boolean {\n    if (chain.length === 0) return false;\n\n    console.log('check chain');\n    console.table(chain);\n\n    for (let i = 0; i < chain.length - 1; i++) {\n        const current = chain[i];\n        const next = chain[i + 1];\n        if (next.month >= current.month)\n            throw new MonthChainError(`month must be less then ${current.month}`, chain, next);\n\n        if (!current.prevMonths.length)\n            throw new MonthChainError(`unexpected end of chain`, chain, current);\n\n        if (current.prevMonths.length > 1)\n            throw new MonthChainError(`can not process month with not 1 prevMonths`, chain, current);\n\n        if (current.prevMonths[0] !== next.id)\n            throw new MonthChainError('invalid prevMonth', chain, current);\n    }\n\n    // let lastBlock: IMonthBrief | undefined = head;\n    // do {\n    //     chain.push(lastBlock);\n    //\n    //     if (lastBlock.prevMonths.length === 0)\n    //         return {\n    //             completed: true,\n    //             chain,\n    //         };\n    //\n    //     if (lastBlock.prevMonths.length !== 1)\n    //         throw new Error(`Can not process merged month ${lastBlock.id} (${lastBlock.month}): more then 1 prevMonths`);\n    //     if (lastBlock.prevVersions.length > 1)\n    //         throw new Error(`Can not process merged month ${lastBlock.id} (${lastBlock.month}): more then 1 prevVersions`);\n    //\n    //     const nextID = lastBlock.prevMonths[0];\n    //     lastBlock = items.find(item => item.id === nextID);\n    //\n    //     if (!lastBlock) {\n    //         return {\n    //             completed: false,\n    //             chain,\n    //         };\n    //     }\n    // } while (true);\n    return true;\n}\n\nexport class MonthChainError extends Error {\n    constructor(public reason: string,\n                public chain: ReadonlyArray<IMonthBrief>,\n                public invalidMonth: IMonthBrief) {\n        super(`Invalid chain: ${reason} at ${invalidMonth.id} (${invalidMonth.month})`);\n    }\n}\n\nexport class RequiredMonthsError extends Error {\n    public ids: UUID[];\n\n    constructor(...ids: UUID[]) {\n        super(`Required months: ${ids.join(', ')}`);\n        this.ids = ids;\n    }\n}\n\nexport class CanNotFastForwardMonthError extends Error {\n    constructor(public from: ReadonlyArray<IMonthBrief>,\n                public to: ReadonlyArray<IMonthBrief>) {\n        super([`Can not fast forward`,\n            `from ${from[0].id} (${from[0].month}, length ${from.length})`,\n            `to ${to[0].id} (${to[0].month}, length ${to.length})`,\n        ].join('\\n'));\n    }\n}\n","import { ISummary, UUID } from '../common/common.types';\nimport { Money } from '../money/money.class';\nimport { IMonthBrief, monthBriefPacker } from '../month/month.types';\nimport { IAccount } from './account.types';\nimport { v1 as uuidGenerator } from 'uuid';\nimport { Month } from '../month/month.class';\nimport { Map } from 'immutable';\nimport { findChain, RequiredMonthsError, updateMonthChain } from './chain.utils';\nimport { addSummary, EMPTY_SUMMARY } from '../transaction/transactions.utils';\nimport { Packable, PackableClass } from '../../libs/packable/decorator';\nimport { Packer } from '../../libs/packable/packable';\nimport { CategoriesBlock } from '../category/categoryBlock.class';\n\n/**\n * Contains information about Account\n */\n@PackableClass(data => new Account(data))\nexport class Account implements IAccount, ISummary {\n    @Packable(String) public readonly id: UUID = '';\n    @Packable(String) public readonly name: string = '';\n    @Packable(Money) public readonly balance: Money = Money.empty;\n    @Packable(Money) public readonly income: Money = Money.empty;\n    @Packable(Money) public readonly expense: Money = Money.empty;\n    @Packable(String) public readonly categoriesBlockId: string = 'default';\n    @Packable(monthBriefPacker) public readonly head: IMonthBrief | null = null;\n    @Packable([monthBriefPacker]) public readonly months: ReadonlyArray<Readonly<IMonthBrief>> = [];\n    public readonly fullMonths: Map<UUID, Month> = Map();\n\n    public static create(name: string, id?: UUID): Account {\n        return new Account({\n            id: id || uuidGenerator(),\n            name,\n        });\n    }\n\n    public static fromJSON(data: any): Account {\n        return Packer.get(Account).decode(data);\n    }\n\n    public static toJSON(account: Account): any {\n        return account.toJSON();\n    }\n\n    private constructor(account: Partial<Account>) {\n        return Object.assign(this, account);\n    }\n\n    public toJSON(): any {\n        return Packer.get(Account).encode(this);\n    }\n\n    public UNSAFE_forceSetHead(head: Month, months: Month[]): Account {\n        const {chain, completed} = findChain(head, months);\n\n        if (!completed) {\n            const last = chain.pop();\n            const required = [\n                ...last!.prevMonths,\n                ...last!.prevVersions,\n            ].filter(\n                id => !months.find(item => item.id !== id),\n            );\n\n            throw new RequiredMonthsError(...required);\n        }\n\n        const {income, expense, balance} = chain.reduce((acc, item) => addSummary(acc, item.summary), EMPTY_SUMMARY);\n\n        return new Account({\n            ...this,\n            head,\n            months: chain.map(Month.getBrief),\n            balance,\n            income,\n            expense,\n        });\n        // throw new Error('Not implements');\n        // throw new RequiredMonthsError(['123123123']);\n    }\n\n    public updateHead(head: Month, additions: Month[] = []): Account {\n        const chain = updateMonthChain(head, additions, this.months);\n\n        const {income, expense, balance} = chain.reduce((acc, item) => addSummary(acc, item.summary), EMPTY_SUMMARY);\n\n        return new Account({\n            ...this,\n            head: Month.getBrief(head),\n            months: chain.map(Month.getBrief),\n            balance,\n            income,\n            expense,\n        });\n    }\n\n    public UNSAFE_updateCategoriesBlock(block: CategoriesBlock): Account { // FIXME\n        if (block.account !== this.id)\n            throw new Error('CategoriesBlock.id must be equal to Account.id');\n\n        return new Account({\n            ...this,\n            categoriesBlockId: block.id,\n        });\n    }\n\n    public checkChain(): boolean {\n        if (!this.head && this.months.length === 0)\n            return true;\n\n        const {chain, completed} = findChain(this.head!, this.months);\n\n        if (!completed)\n            return false;\n\n        if (chain.length !== this.months.length)\n            return false;\n\n        return true;\n    }\n}\n\n","import sha1 from 'crypto-js/sha1';\nimport { IInitialCategoryTree } from './category.types';\nimport { SyncStatus, UUID } from '../common/common.types';\nimport { Category } from './category.class';\nimport { Packable, PackableClass } from '../../libs/packable/decorator';\nimport { Packer } from '../../libs/packable/packable';\nimport { ICategoriesBlock } from './categoryBlock.types';\n\n/**\n * ID    ,         ID\n *       ID\n */\n@PackableClass(data => new CategoriesBlock(data))\nexport class CategoriesBlock implements ICategoriesBlock {\n    @Packable(String) public readonly id: UUID = '';\n    @Packable(String) public readonly account: UUID = '';\n    @Packable(Number) public readonly version: number = 1;\n    @Packable(Number) public readonly syncStatus: SyncStatus = SyncStatus.NoSynced;\n    @Packable(String) public readonly dataHash: string = '';\n    @Packable(Number) public readonly timestamp: number = 0;\n\n    @Packable([String]) public readonly prevVersions: UUID[] = [];\n    public readonly updatedAt: Date = new Date(0);\n\n    @Packable([Category]) public readonly list: ReadonlyArray<Category>;\n\n    /**\n     * @param account\n     * @param initialsCategories\n     * @param timestamp\n     */\n    public static createInitialBlock(account: UUID, initialsCategories: IInitialCategoryTree, timestamp: number): CategoriesBlock {\n        const list: Category [] = initialsCategories.flatMap(\n            parent => [\n                Category.createInitial(\n                    parent.name,\n                    parent.defaultType,\n                    null,\n                    parent.image,\n                    parent.id,\n                ),\n                ...parent.children.map(\n                    child => Category.createInitial(\n                        child.name,\n                        child.defaultType,\n                        parent.id,\n                        child.image,\n                        child.id,\n                    ),\n                ),\n            ],\n        );\n\n        return new CategoriesBlock({\n            account,\n            syncStatus: SyncStatus.Prepared,\n            timestamp,\n            prevVersions: [],\n            list,\n        });\n    }\n\n    public static getDataHash(target: { list: ReadonlyArray<Category> }): string {\n        if (!target.list.length)\n            return '0000000000000000000000000000000000000000';\n\n        const data = {\n            list: target.list.map(item => item.toJSON()),\n        };\n\n        return sha1(JSON.stringify(data)).toString();\n    }\n\n    public static generateID(block: CategoriesBlock, dataHash?: string): string {\n        if (block.version !== 1)\n            throw new Error(`Version ${block.version} not supported`);\n\n        if (!dataHash)\n            dataHash = CategoriesBlock.getDataHash(block);\n        if (dataHash === '0000000000000000000000000000000000000000')\n            return '00000000-0000-0000-0000-000000000000';\n\n        const data = {\n            version: block.version,\n            account: block.account,\n            prevVersions: block.prevVersions,\n            dataHash,\n        };\n\n        const hash = sha1(JSON.stringify(data)).toString();\n\n        // const ts = (block.timestamp / 1000).toString(16)\n        //                                    .substr(0, 11)\n        //                                    .replace('.', '');\n\n        // let id = `${ts}${hash}`.substr(0, 32);\n        let id = `${hash}`.substr(0, 32);\n\n        id = [\n            id.substr(0, 8),\n            id.substr(8, 4),\n            id.substr(12, 4),\n            id.substr(16, 4),\n            id.substr(20, 12),\n        ].join('-');\n\n        return id;\n    }\n\n    /**\n     *   \n     *\n     * @param blocks   \n     */\n    public static merge(blocks: CategoriesBlock[]): CategoriesBlock {\n        throw new Error('Not implemented');\n    }\n\n    public static fromJSON(value: any): CategoriesBlock {\n        return Packer.get(CategoriesBlock).decode(value);\n    }\n\n    public static toJSON(category: CategoriesBlock): any {\n        return category.toJSON();\n    }\n\n    protected constructor(value: Partial<CategoriesBlock>) { // FIXME use all fields of Month\n        Object.assign(this, value);\n        this.dataHash = CategoriesBlock.getDataHash(this);\n        this.id = CategoriesBlock.generateID(this, this.dataHash);\n        this.updatedAt = new Date(this.timestamp);\n    }\n\n    public toJSON(): any {\n        return Packer.get(CategoriesBlock).encode(this);\n    }\n\n    public get(id: UUID): Category {\n        return this.list.find(item => item.id === id);\n    }\n\n    public getList(parent?: UUID): ReadonlyArray<Category> {\n        if (!parent)\n            return this.list;\n        else\n            return this.list.filter(item => item.parent === parent);\n    }\n\n    public changeSyncStatus(syncStatus: SyncStatus): CategoriesBlock {\n        if (syncStatus === this.syncStatus)\n            return this;\n\n        switch (this.syncStatus) {\n            case SyncStatus.NoSynced:\n                if (syncStatus === SyncStatus.Prepared)\n                    return new CategoriesBlock({...this, syncStatus});\n                break;\n            case SyncStatus.Prepared:\n                if (syncStatus === SyncStatus.Syncing)\n                    return new CategoriesBlock({...this, syncStatus});\n                break;\n            case SyncStatus.Syncing:\n                if (syncStatus === SyncStatus.FullySynced)\n                    return new CategoriesBlock({...this, syncStatus});\n                break;\n            case SyncStatus.FullySynced:\n        }\n\n        throw new Error(`Can not change sync status from \"${SyncStatus[this.syncStatus]}\" to \"${SyncStatus[syncStatus]}\"`);\n    }\n\n    public addCategory(category: Category): CategoriesBlock {\n        let exists = this.list.find(item => item.id === category.id);\n        if (exists)\n            throw new CategoryConflictError(`Category with this ID already exists`, this, category);\n        exists = this.list.find(item => item.name.toLowerCase() === category.name.toLowerCase());\n        if (exists)\n            throw new CategoryConflictError(`Category with this Name already exists`, this, category);\n\n        return new CategoriesBlock({\n            ...this,\n            syncStatus: SyncStatus.NoSynced,\n            list: [...this.list, category],\n        });\n    }\n\n    public updateCategory(category: Category): CategoriesBlock {\n        if (this.list.find(\n            item =>\n                item.name.toLowerCase() === category.name.toLowerCase()\n                && item.id !== category.id,\n        ))\n            throw new CategoryConflictError(`Category with name \"${category.name}\" already exists`);\n\n        const toUpdate = this.list.find(item => item.id === category.id);\n\n        if (!toUpdate)\n            throw new Error(`Category \"${category.name}\" (${category.id}) not found`);\n\n        return new CategoriesBlock({\n            ...this,\n            syncStatus: SyncStatus.NoSynced,\n            list: this.list.map(\n                item => item.id === category.id\n                    ? category\n                    : item,\n            ),\n        });\n    }\n\n    public removeCategory(id: UUID): CategoriesBlock {\n        const toRemove = this.list.find(item => item.id === id);\n\n        if (!toRemove)\n            throw new Error(`Category ${id} not found`);\n\n        return new CategoriesBlock({\n            ...this,\n            syncStatus: SyncStatus.NoSynced,\n            list: this.list.filter(item => item !== toRemove),\n        });\n    }\n}\n\nexport class CategoryConflictError extends Error {\n    constructor(message: string,\n                public readonly block?: CategoriesBlock,\n                public readonly category?: Category) {\n        super(message);\n    }\n}\n","import { IInitialCategoryTree } from '../../models/category/category.types';\nimport { TransactionType } from '../../models/transaction/transaction.types';\n\nexport const initialCategories: IInitialCategoryTree = [\n    {\n        id: 'default',\n        name: 'Default',\n        image: 'default',\n        defaultType: TransactionType.Expense,\n        children: [],\n    },\n    {\n        id: '0000-111',\n        name: 'Home',\n        image: 'default',\n        defaultType: TransactionType.Income,\n        children: [],\n    },\n];\n","import { IScheme } from '../../libs/indexed-db';\nimport { ICategoriesBlock } from '../../models/category/categoryBlock.types';\n\nexport const CategoriesScheme: IScheme<ICategoriesBlock> = {\n    collection: 'categories',\n    dbVersion: 1,\n    key: 'id',\n    upgrade(objectStore, oldVersion, newVersion): void {\n        console.log('update categories from ', oldVersion, newVersion);\n    },\n};\n","import { IndexedDB } from '../libs/indexed-db';\nimport { PayloadActionCreator, Store } from '@reatom/core';\nimport { AccountScheme, MonthScheme } from './schemes';\nimport { Account } from '../models/account/account.class';\nimport { CategoriesBlock } from '../models/category/categoryBlock.class';\nimport { initialCategories } from './data/initialCategories';\nimport { CategoriesScheme } from './schemes/categories.scheme';\n\nexport const db = new IndexedDB(\n    'finman',\n    [\n        CategoriesScheme,\n        AccountScheme,\n        MonthScheme,\n    ],\n    async (db) => {\n        let defaultAccount = Account.create('Default');\n        const categoriesBlock = CategoriesBlock.createInitialBlock(\n            defaultAccount.id,\n            initialCategories,\n            new Date().getTime(),\n        );\n        defaultAccount = defaultAccount.UNSAFE_updateCategoriesBlock(categoriesBlock);\n\n        await db.transaction(AccountScheme).add(defaultAccount.toJSON());\n        await db.transaction(CategoriesScheme).add(categoriesBlock.toJSON());\n    },\n);\n\nconst handlers: { [action: string]: Function } = {};\n\nexport function addActionHandler<T>(action: PayloadActionCreator<T>, handler: (payload: T, store: Store) => void) {\n    if (handlers[action.getType()])\n        throw new Error(`Can not add new handler for action \"${action.getType()}\"`);\n\n    handlers[action.getType()] = handler;\n}\n\nexport function initIndexedDB(store: Store) {\n    store.subscribe(action => {\n        console.log(action);\n\n        if (handlers[action.type])\n            handlers[action.type](action.payload, store);\n    });\n}\n","import { addActionHandler, db } from '../db';\nimport {\n    chooseAccount,\n    loadAccounts,\n    loadAccountsFailed,\n    loadAccountsSuccess, saveAccount, saveAccountFailed, saveAccountSuccess,\n} from '../../atoms/accounts/accounts.actions';\nimport { AccountScheme } from '../schemes';\nimport { Account } from '../../models/account/account.class';\nimport { loadCategories } from '../../atoms/categories/categories.actions';\nimport { chooseAccountGrip } from '../../atoms/account-grips/account-grips.actions';\n\nconst CURRENT_ACCOUNT_KEY = 'currentAccount';\n\naddActionHandler(chooseAccount, payload => {\n    localStorage.setItem(CURRENT_ACCOUNT_KEY, payload);\n});\n\naddActionHandler(loadAccounts, (_, store) => {\n    db.transaction(AccountScheme)\n      .getAll().then(\n        result => {\n            if (!result.length)\n                return console.warn('No accounts exists');\n\n            const accounts = result.map(Account.fromJSON);\n\n            const currentID = localStorage.getItem(CURRENT_ACCOUNT_KEY);\n\n            store.dispatch(loadAccountsSuccess({\n                accounts,\n            }));\n\n            store.dispatch(chooseAccountGrip(currentID));\n        },\n        error => store.dispatch(loadAccountsFailed(error)),\n    );\n});\n\naddActionHandler(saveAccount, (account, store) => {\n    db.transaction(AccountScheme)\n      .update(account.toJSON() as any).then(\n        result => store.dispatch(saveAccountSuccess(account.id)),\n        error => store.dispatch(saveAccountFailed({id: account.id, error})),\n    );\n});\n","import { addActionHandler, db } from '../db';\nimport {\n    loadMonths,\n    loadMonthsFailed,\n    loadMonthsSuccess,\n    saveMonths, saveMonthsFailed,\n    saveMonthsSuccess,\n} from '../../atoms/months/months.actions';\nimport { MonthScheme } from '../schemes';\nimport { Month } from '../../models/month/month.class';\n\naddActionHandler(loadMonths, (ids, store) => {\n    db.transaction(MonthScheme)\n      .getAll(ids).then(\n        result => {\n            console.log(ids);\n            console.log(result);\n            const months = result.map(Month.fromJSON);\n            store.dispatch(loadMonthsSuccess(months));\n        },\n        error => store.dispatch(loadMonthsFailed({ids, error})),\n    );\n});\n\naddActionHandler(saveMonths, (months, store) => {\n    const ids = months.map(item => item.id);\n    const tx = db.transaction(MonthScheme);\n    Promise.all(months.map(month => tx.update(month.toJSON())))\n           .then(\n               () => store.dispatch(saveMonthsSuccess(ids)),\n               error => store.dispatch(saveMonthsFailed({ids, error})),\n           );\n});\n","import { addActionHandler, db } from '../db';\nimport { loadCategories, loadCategoriesFailed, loadCategoriesSuccess } from '../../atoms/categories/categories.actions';\nimport { CategoriesScheme } from '../schemes/categories.scheme';\nimport { CategoriesBlock } from '../../models/category/categoryBlock.class';\n\naddActionHandler(loadCategories, (id, store) => {\n    db.transaction(CategoriesScheme)\n      .get(id).then(\n        result => store.dispatch(loadCategoriesSuccess(CategoriesBlock.fromJSON(result))),\n        error => store.dispatch(loadCategoriesFailed(error)),\n    );\n});\n","import { runSaga, stdChannel, Saga } from 'redux-saga';\nimport { PayloadActionCreator, Store } from '@reatom/core';\nimport { takeEvery, call } from 'redux-saga/effects';\n\nclass SagaLauncher {\n    private sagas: Saga[] = [];\n\n    register(saga: Saga): void {\n        this.sagas.push(saga);\n    }\n\n    onAction(actionCreator: PayloadActionCreator<any>,\n             saga: Saga,\n             sagaName = 'Some saga'): void {\n        this.register(function* () {\n            yield takeEvery(actionCreator.getType(), saga);\n            // yield takeEvery(actionCreator.getType(), function* (...params) {\n            //     try {\n            //         console.log(`[Saga logger] Saga \"${sagaName}\" started`);\n            //         yield* saga(...params);\n            //         console.log(`[Saga logger] Saga \"${sagaName}\" completed`);\n            //     } catch (e) {\n            //         console.log(`[Saga logger] Saga \"${sagaName}\" failed`);\n            //         console.error(e);\n            //     }\n            // });\n        });\n    }\n\n    start(store: Store) {\n        console.log(`Start ${this.sagas.length} sagas`);\n\n        const sagaOptions = {\n            dispatch: store.dispatch,\n            getState: () => store.getState,\n            channel: stdChannel(),\n        };\n\n        store.subscribe(sagaOptions.channel.put);\n\n        this.sagas.forEach(saga => runSaga(sagaOptions, saga));\n    }\n}\n\nexport const sagaLauncher = new SagaLauncher();\n\ntype ExtractInner<T> = T extends Generator<any, infer R, any> ? R : never;\n\nexport interface PackedSaga<Fn extends (...args: any[]) => any> {\n    (...args: Parameters<Fn>): Generator<any, ExtractInner<ReturnType<Fn>>, any>;\n\n    originalSaga: (...args: Parameters<Fn>) => Generator<any, ExtractInner<ReturnType<Fn>>, any>;\n}\n\nfunction sagaCallPacker<Fn extends (...args: any[]) => any = any>(saga: Fn): PackedSaga<Fn> {\n    const fn = function* PackedSaga<Fn extends (...args: any[]) => any = any>(...params: Parameters<Fn>): Generator<any, ExtractInner<Fn>, any> {\n        return yield call(saga as any, ...params);\n    };\n    fn.originalSaga = saga;\n    return fn;\n}\n\nexport const SagaPacker = {\n    call: sagaCallPacker,\n};\n","import { Action } from '@reatom/core';\nimport { put, take } from 'redux-saga/effects';\nimport { sagaLauncher } from '../saga-launcher';\nimport { IAddTransactionForm } from '../../models/transaction/transaction.types';\nimport { refresh } from '../../atoms/client/client.actions';\nimport { loadAccounts, loadAccountsFailed, loadAccountsSuccess } from '../../atoms/accounts/accounts.actions';\nimport { updateAccountGrips } from '../../atoms/account-grips/account-grips.actions';\nimport { Account } from '../../models/account/account.class';\n\nsagaLauncher.onAction(refresh, refreshSaga);\n\nexport function* refreshSaga(action: Action<null>) {\n    console.log('*** refreshSaga started');\n\n    yield put(loadAccounts());\n    const resultAction = yield take([loadAccountsSuccess.getType(), loadAccountsFailed.getType()]);\n    if (resultAction.type === loadAccountsFailed.getType())\n        return;\n\n    const accounts: Account[] = (resultAction as any).payload.accounts;\n    yield put(updateAccountGrips(accounts));\n}\n","import { select, call } from 'redux-saga/effects';\nimport { Atom } from '@reatom/core';\nimport { SagaPacker } from '../saga-launcher';\n\nexport const SagaUtils = {\n    /**\n     * Select atom from Store\n     * @param atom\n     */\n    selectAtom: SagaPacker.call(selectAtomFn),\n    /**\n     * Get current timestamp\n     */\n    getTimestamp: SagaPacker.call(getTimestampFn),\n};\n\n/**\n * @deprecated\n * @param atom\n */\nexport const selectAtom = atom => call(selectAtomFn, atom);\n\nexport function* selectAtomFn(atom: Atom<any>) {\n    return yield select(getState => getState(atom));\n}\n\n/**\n * @deprecated\n */\nexport const getTimestamp = () => call(getTimestampFn);\n\nexport function getTimestampFn() {\n    return new Date().getTime();\n}\n\nexport function delay(timeout = 0): Promise<void> {\n    return new Promise(resolve => setTimeout(resolve, timeout));\n}\n","import { put, take } from 'redux-saga/effects';\nimport { Action } from '@reatom/core';\nimport { MonthDate } from '../../models/common/date.types';\nimport { Account } from '../../models/account/account.class';\nimport { Month } from '../../models/month/month.class';\nimport { getTimestamp, SagaUtils, selectAtom } from '../helpers/helpers';\nimport { SagaPacker } from '../saga-launcher';\nimport {\n    saveMonths,\n    saveMonthsSuccess,\n    saveMonthsFailed,\n    loadMonths,\n    loadMonthsSuccess,\n    loadMonthsFailed,\n} from '../../atoms/months/months.actions';\nimport { UUID } from '../../models/common/common.types';\nimport { Months } from '../../atoms/months/months.atom';\nimport { CategoriesBlock } from '../../models/category/categoryBlock.class';\nimport { Categories } from '../../atoms/categories/categories.atom';\nimport { ICategoriesState } from '../../atoms/categories/categories.types';\nimport { loadCategories, loadCategoriesFailed, loadCategoriesSuccess } from '../../atoms/categories/categories.actions';\n\nexport const CategoriesBlockUtils = {\n    /**\n     * Get or load CategoriesBlock\n     */\n    get: SagaPacker.call(getCategoriesBlockSaga),\n};\n\nfunction* getCategoriesBlockSaga(id: UUID): Generator<any, CategoriesBlock, any> {\n    const categoriesBlocks: ICategoriesState = yield selectAtom(Categories);\n\n    if (categoriesBlocks.has(id))\n        return categoriesBlocks.get(id)?.block;\n\n    yield put(loadCategories(id));\n    let action: Action<any>;\n    do {\n        action = yield take([loadCategoriesSuccess.getType(), loadCategoriesFailed.getType()]);\n        if (action.type === loadCategoriesSuccess.getType()) {\n            if (action.payload.id === id) {\n                const categories = yield selectAtom(Categories);\n                return categories.get(id);\n            }\n        } else {\n            if (action.payload.id === id)\n                throw action.payload.error;\n        }\n    } while (true);\n}\n","import { AbstractGrip } from '../abstract-grip/grip.class';\nimport { IAccount } from '../account/account.types';\nimport { CategoriesBlock } from '../category/categoryBlock.class';\nimport { IMonth, IMonthBrief } from '../month/month.types';\nimport { AccountMonthGrip } from './month-grip.class';\nimport { Map } from 'immutable';\nimport { Money } from '../money/money.class';\nimport { IMonthGripBrief } from '../abstract-grip/grip.types';\n\nexport class AccountGrip extends AbstractGrip {\n    public readonly account: IAccount;\n\n    constructor(account: IAccount, categoriesBlock: CategoriesBlock) {\n        const categories = Map(categoriesBlock.list.map(item => [item.id, item]));\n        super([account], categories);\n\n        this.id = account.id;\n        this.account = account;\n        this.name = account.name;\n\n        if (!account.head)\n            return;\n\n        this.lastMonthDate = account.head.month;\n        this.firstMonthDate = account.months[account.months.length - 1].month;\n        this.months = account.months.map(makeMonthGripBriefFromMonthBrief);\n        this.balance = account.head.summary.balanceOnEnd;\n        this.income = Money.empty; // FIXME\n        this.expense = Money.empty; // FIXME\n    }\n\n    public makeMonth(month: IMonth): AccountMonthGrip {\n        return new AccountMonthGrip(month.summary.balanceOnStart, month, this.account, this.categories);\n    }\n}\n\nfunction makeMonthGripBriefFromMonthBrief(month: IMonthBrief): IMonthGripBrief {\n    return {\n        id: month.id,\n        month: month.month,\n        balanceOnStart: month.summary.balanceOnStart,\n        balanceOnEnd: month.summary.balanceOnEnd,\n        balance: month.summary.balance,\n        income: month.summary.income,\n        expense: month.summary.expense,\n        categories: Map(),\n        tags: Map(),\n    };\n}\n","import { IAccount } from '../account/account.types';\nimport { UUID } from '../common/common.types';\nimport { CategoriesBlock } from '../category/categoryBlock.class';\nimport { IGrip, IMonthGripBrief } from './grip.types';\nimport { ICategory } from '../category/category.types';\nimport { MonthDate } from '../common/date.types';\nimport { ITag, TagName } from '../tag/tag.types';\nimport { Map } from 'immutable';\nimport { Money } from '../money/money.class';\nimport { AbstractMonthGrip } from './month-grip.class';\nimport { IMonth } from '../month/month.types';\nimport { AccountMonthGrip } from '../account-grip/month-grip.class';\n\n\n/**\n * TODO: Grip must know about categories and tags in months from IMonthBrief\n */\nexport abstract class AbstractGrip implements IGrip {\n    id: UUID;\n    name: string;\n    categories: Map<UUID, ICategory> = Map();\n    firstMonthDate: MonthDate = null;\n    lastMonthDate: MonthDate = null;\n    months: IMonthGripBrief[] = [];\n    tags: Map<TagName, ITag> = Map();\n\n    balance: Money = Money.empty;\n    expense: Money = Money.empty;\n    income: Money = Money.empty;\n\n    protected constructor(accounts: IAccount[],\n                          categories: Map<UUID, ICategory>) {\n        this.categories = categories;\n    }\n\n    public abstract makeMonth(month: IMonth): AbstractMonthGrip;\n}\n","import { Action } from '@reatom/core';\nimport { put, take, fork } from 'redux-saga/effects';\nimport { sagaLauncher } from '../saga-launcher';\nimport { IAddTransactionForm } from '../../models/transaction/transaction.types';\nimport { refresh } from '../../atoms/client/client.actions';\nimport { loadAccounts, loadAccountsSuccess } from '../../atoms/accounts/accounts.actions';\nimport {\n    updateAccountGrip,\n    updateAccountGrips,\n    updateAccountGripSuccess,\n} from '../../atoms/account-grips/account-grips.actions';\nimport { Account } from '../../models/account/account.class';\nimport { loadCategories, loadCategoriesSuccess } from '../../atoms/categories/categories.actions';\nimport { CategoriesBlockUtils } from '../utils/categoriesBlock.saga';\nimport { AccountGrip } from '../../models/account-grip/grip.class';\n\nsagaLauncher.onAction(updateAccountGrips, updateAccountGripsSaga);\nsagaLauncher.onAction(updateAccountGrip, updateAccountGripSaga);\n\nexport function* updateAccountGripsSaga(action: Action<Account[]>) {\n    console.log('*** updateAccountGripsSaga started');\n    const accounts = action.payload;\n\n    for (let account of accounts)\n        yield fork(updateAccountGripSaga, updateAccountGrip(account));\n}\n\nexport function* updateAccountGripSaga(action: Action<Account>) {\n    const account = action.payload;\n\n    console.log(`*** updateAccountGripSaga started for account ${account.name}`);\n\n    const block = yield* CategoriesBlockUtils.get(account.categoriesBlockId);\n\n    console.log('loadCategories', block);\n\n    const grip = new AccountGrip(account, block);\n\n    yield put(updateAccountGripSuccess(grip));\n}\n","import { put, take } from 'redux-saga/effects';\nimport { Action } from '@reatom/core';\nimport { MonthDate } from '../../models/common/date.types';\nimport { Account } from '../../models/account/account.class';\nimport { Month } from '../../models/month/month.class';\nimport { getTimestamp, SagaUtils, selectAtom } from '../helpers/helpers';\nimport { SagaPacker } from '../saga-launcher';\nimport {\n    saveMonths,\n    saveMonthsSuccess,\n    saveMonthsFailed,\n    loadMonths,\n    loadMonthsSuccess,\n    loadMonthsFailed,\n} from '../../atoms/months/months.actions';\nimport { UUID } from '../../models/common/common.types';\nimport { Months } from '../../atoms/months/months.atom';\n\nexport const MonthUtils = {\n    /**\n     * Get or create Month of Account's chain\n     */\n    get: SagaPacker.call(getMonthSaga),\n    /**\n     * Get months from DB\n     */\n    getByIds: SagaPacker.call(getMonthsByIdsSaga),\n    /**\n     * Save months to DB\n     */\n    save: SagaPacker.call(saveMonthsSaga),\n};\n\nfunction* getMonthsByIdsSaga(ids: UUID[]): Generator<any, Month[], any> {\n    const months: Map<UUID, Month> = yield selectAtom(Months);\n\n    console.log(months);\n    const notExists = ids.filter(id => !months.has(id));\n\n    if (!notExists)\n        return ids.map(id => months.get(id));\n\n    yield put(loadMonths(notExists));\n    let action: Action<any>;\n    do {\n        action = yield take([loadMonthsSuccess, loadMonthsFailed]);\n        if (action.type === loadMonthsSuccess.getType()) {\n            if (action.payload.every((item, index) => item.id === notExists[index])) {\n                const months = yield selectAtom(Months);\n                return ids.map(id => months.get(id));\n            }\n        } else {\n            if (action.payload.ids.every((item, index) => item === notExists[index]))\n                throw action.payload.error;\n        }\n    } while (true);\n}\n\nfunction* getMonthSaga(account: Account, monthDate: MonthDate) {\n    if (!account.head) {\n        const timestamp: number = yield getTimestamp();\n        console.log('timestamp', timestamp);\n        return Month.createFirstBlock(account.id, monthDate, timestamp);\n    }\n\n    // create next block\n    if (monthDate > account.head.month) {\n        const [head]: Month[] = yield* MonthUtils.getByIds([account.head.id]);\n        const timestamp: number = yield getTimestamp();\n        return head.createNextBlock(monthDate, timestamp);\n    }\n\n    // return exists month\n    {\n        const indexOfMonth = account.months.findIndex(item => item.month === monthDate);\n        if (indexOfMonth > -1) {\n            const monthsIds = account.months\n                                     .slice(0, indexOfMonth + 1)\n                                     .map(item => item.id);\n            const months = yield* MonthUtils.getByIds(monthsIds);\n            return months.pop();\n        }\n    }\n\n    // create block in the middle of chain\n    {\n        const monthsIds: UUID[] = [];\n\n        for (let i = 0; i < account.months.length; i++) {\n            const currentMonth = account.months[i];\n\n            monthsIds.push(currentMonth.id);\n\n            if (currentMonth.month < monthDate)\n                break;\n        }\n\n        const months = yield* MonthUtils.getByIds(monthsIds);\n        const monthsToSave: Month[] = [];\n\n        const timestamp = yield* SagaUtils.getTimestamp();\n\n        let lastMonth = months.pop();\n\n        const newMonth = lastMonth = lastMonth.createNextBlock(monthDate, timestamp);\n        monthsToSave.push(lastMonth);\n\n        for (let month = months.pop(); month; month = months.pop()) {\n            const updated = month.updatePrevMonths([lastMonth], timestamp);\n            monthsToSave.push(updated);\n            lastMonth = updated;\n        }\n\n        yield* MonthUtils.save(monthsToSave);\n\n        return newMonth;\n    }\n}\n\nfunction* saveMonthsSaga(months: Month[]) {\n    yield put(saveMonths(months));\n    for (; ;) {\n        const action = yield take([saveMonthsSuccess.getType(), saveMonthsFailed.getType()]);\n        console.log(action);\n        if (action.type === saveMonthsSuccess.getType()) {\n            if (months.every((item, index) => action.payload[index] === item.id))\n                return;\n        } else if (action.type === saveMonthsFailed.getType()) {\n            if (months.every((item, index) => action.payload.ids[index] === item.id))\n                throw action.payload.error;\n        } else {\n            console.error('invalid action ' + action.type, action);\n        }\n    }\n}\n","import { Month } from '../../models/month/month.class';\nimport { Account } from '../../models/account/account.class';\nimport { UUID } from '../../models/common/common.types';\nimport { SagaPacker } from '../saga-launcher';\nimport { Accounts, IAccountsState } from '../../atoms/accounts/accounts.atom';\nimport { select, put, take } from 'redux-saga/effects';\nimport { saveAccount, saveAccountSuccess, saveAccountFailed } from '../../atoms/accounts/accounts.actions';\nimport { MonthUtils } from './month.saga';\nimport { isVersionOfMonth, RequiredMonthsError } from '../../models/account/chain.utils';\nimport { SagaUtils } from '../helpers/helpers';\nimport { AccountGrips, IAccountGripsState } from '../../atoms/account-grips/account-grips.atom';\nimport { AccountGrip } from '../../models/account-grip/grip.class';\n\nexport const AccountUtils = {\n    select: SagaPacker.call(selectAccountSaga),\n    getGrip: SagaPacker.call(getAccountGripSaga),\n    update: SagaPacker.call(updateAccountSaga),\n    save: SagaPacker.call(saveAccountSaga),\n};\n\n/**\n * Select account from Store\n * @param id\n */\nfunction* selectAccountSaga(id: UUID) {\n    const accounts: IAccountsState = yield select(getState => getState(Accounts));\n    const account: Account = accounts.accounts.get(id);\n\n    if (!account)\n        throw new Error(`Account \"${id}\" not found`);\n\n    return account;\n}\n\n/**\n * Get account grip from Store\n * @param id\n */\nfunction* getAccountGripSaga(id: UUID) {\n    const accounts: IAccountGripsState = yield select(getState => getState(AccountGrips));\n    const account: AccountGrip = accounts.accounts.get(id);\n\n    if (!account)\n        throw new Error(`AccountGrip \"${id}\" not found`);\n\n    return account;\n}\n\n/**\n *    ,     , \n *\n * FIXME So raw. Needs refactoring\n *\n * @param account\n * @param month\n */\nfunction* updateAccountSaga(account: Account, month: Month) {\n    console.log('*** updateAccountSaga');\n    console.log(account.months.map(item => item.month));\n    console.log(month.month, month.id);\n    let currentMonthIndex = account.months.findIndex(item => item.month === month.month);\n    let prevMonthIndex = account.months.findIndex(item => item.month < month.month);\n\n    if (!account.head) {\n        yield* MonthUtils.save([month]);\n        const accountToUpdate = account.updateHead(month);\n        yield* AccountUtils.save(accountToUpdate);\n        return accountToUpdate;\n    }\n\n    let toIndex = currentMonthIndex === -1\n        ? prevMonthIndex\n        : currentMonthIndex;\n\n    const monthsIds: UUID[] = account.months\n                                     .slice(0, toIndex + 1)\n                                     .map(item => item.id);\n\n    const additionalMonths: Month[] = [month];\n\n    console.log(monthsIds);\n\n    if (monthsIds.length)\n        additionalMonths.push(...yield* MonthUtils.getByIds(monthsIds));\n\n    const timestamp = yield* SagaUtils.getTimestamp();\n\n    console.log({\n        currentMonthIndex,\n        prevMonthIndex,\n        toIndex,\n        additions: additionalMonths.map(item => [item.month + ' ' + item.id]),\n        months: account.months\n                       .slice(0, toIndex + 1)\n                       .map(item => item.month),\n    });\n\n    let monthsToUpdate = [month];\n\n    console.log('additional');\n    console.log(additionalMonths.map(item => `${item.month} ${item.id}`));\n    console.log('chain');\n    console.log(account.months.map(item => `${item.month} ${item.id}`));\n\n    console.log('prevMonthIndex', prevMonthIndex, account.months[prevMonthIndex]?.month);\n\n    if (currentMonthIndex === -1 && prevMonthIndex === -1)\n        throw new Error('Unexpection');\n\n    if (currentMonthIndex === -1 && prevMonthIndex !== -1) {\n        currentMonthIndex = prevMonthIndex;\n    } else {\n        const existsMonth = account.months[currentMonthIndex];\n        if (existsMonth.month !== month.month)\n            throw new Error('somethings wrong');\n        if (!isVersionOfMonth(month, existsMonth))\n            throw new Error('somethings wrong');\n\n    }\n\n    console.log('currentMonthIndex', currentMonthIndex, account.months[currentMonthIndex]?.month);\n    if (currentMonthIndex !== -1) {\n        let previousMonth: Month = month;\n\n        for (let index = currentMonthIndex - 1; index >= 0; index--) {\n            console.log('index', index, account.months[index].month);\n            const currentMonthId = account.months[index].id;\n            const currentMonth = additionalMonths.find(item => item.id === currentMonthId);\n            if (!currentMonth)\n                throw new RequiredMonthsError(currentMonthId);\n            previousMonth = currentMonth.updatePrevMonths([previousMonth], timestamp);\n            additionalMonths.push(previousMonth);\n            monthsToUpdate.push(previousMonth);\n        }\n\n        console.log('additionalMonths', additionalMonths.map(item => [item.month + ' ' + item.id]));\n\n        const accountToUpdate = account.updateHead(previousMonth, additionalMonths);\n\n        yield* MonthUtils.save(monthsToUpdate);\n        yield* AccountUtils.save(accountToUpdate);\n        return accountToUpdate;\n    }\n\n    throw new Error('may be first');\n}\n\nexport function* saveAccountSaga(account: Account) {\n    yield put(saveAccount(account));\n    for (; ;) {\n        const action = yield take([saveAccountSuccess, saveAccountFailed]);\n        if (action.type === saveAccountSuccess.getType()) {\n            if (action.payload === account.id)\n                return;\n        } else {\n            if (action.payload.id === account.id)\n                throw action.payload.error;\n        }\n    }\n}\n","import { sagaLauncher } from '../saga-launcher';\nimport { loadMonthsSuccess } from '../../atoms/months/months.actions';\nimport { Action } from '@reatom/core';\nimport { Month } from '../../models/month/month.class';\nimport { put, fork } from 'redux-saga/effects';\nimport { Account } from '../../models/account/account.class';\nimport { AccountUtils } from '../utils/account.saga';\nimport { updateMonthGripSuccess } from '../../atoms/month-grips/month-grips.actions';\n\nsagaLauncher.onAction(loadMonthsSuccess, updateMonthGripsSaga);\n\nexport function* updateMonthGripsSaga(action: Action<Month[]>) {\n    console.log('update Month grips saga');\n    const months = action.payload;\n\n    for (let month of months)\n        yield fork(updateMonthGripSaga, month);\n}\n\nexport function* updateMonthGripSaga(month: Month) {\n    console.log(`update Month grip saga for ${month.month}`);\n    console.log('123456');\n\n    const accountGrip = yield* AccountUtils.getGrip(month.account);\n    console.log('123');\n    const grip = accountGrip.makeMonth(month);\n    console.log('234');\n\n    yield put(updateMonthGripSuccess(grip));\n    console.log('345');\n}\n","import { addTransaction } from '../../models/transaction/transaction.actions';\nimport { sagaLauncher } from '../saga-launcher';\nimport { IAddTransactionForm } from '../../models/transaction/transaction.types';\nimport { dayDateToMonth } from '../../models/common/date.utils';\nimport { Action } from '@reatom/core';\nimport { AccountUtils } from '../utils/account.saga';\nimport { MonthUtils } from '../utils/month.saga';\nimport { Transaction } from '../../models/transaction/transaction.class';\nimport { put } from 'redux-saga/effects';\nimport { updateAccountGrip } from '../../atoms/account-grips/account-grips.actions';\n\nsagaLauncher.onAction(addTransaction, addTransactionSaga);\n\nexport function* addTransactionSaga(action: Action<IAddTransactionForm>) {\n    console.log('*** addTransactionSaga started');\n    const payload: IAddTransactionForm = action.payload;\n    const account = yield* AccountUtils.select(payload.account);\n    const month = yield* MonthUtils.get(account, dayDateToMonth(payload.date));\n\n    console.log('addTransactionSaga', month.id, month.prevVersions);\n\n    let tx = Transaction.create(\n        payload.type,\n        payload.amount,\n        'RUB',\n    );\n\n    if (payload.title) tx = tx.setTitle(payload.title);\n    if (payload.category) tx = tx.setCategory(payload.category);\n\n    const day = month.getDay(payload.date)\n                     .addTransaction(tx);\n\n    const updatedMonth = month.updateDay(day);\n\n    console.log('updatedMonth', updatedMonth.id, updatedMonth.prevVersions);\n\n    const value = yield* AccountUtils.update(account, updatedMonth);\n    console.log('*** addTransactionSaga complete');\n    yield put(updateAccountGrip(value));\n    return value;\n}\n","import { take } from 'redux-saga/effects';\nimport { sagaLauncher } from '../saga-launcher';\nimport { loadAccountsSuccess } from '../../atoms/accounts/accounts.actions';\n\nsagaLauncher.register(transactionUpdateSaga);\n\nfunction* transactionUpdateSaga() {\n    console.log('init transactionUpdateSaga');\n    while (true) {\n        const action = yield take(loadAccountsSuccess.getType());\n        console.log('load successssssss', action);\n    }\n}\n","/**\n * @packageDocumentation\n * @module app-root\n */\n\nimport React from 'react';\nimport styles from './App.module.scss';\nimport { Redirect, Route, Switch } from 'react-router';\nimport { HashRouter } from 'react-router-dom';\nimport { NavBar } from './widgets/NavBar';\nimport { useAction } from '@reatom/react';\nimport { startListenOnlineStatus } from './atoms/client/client.service';\nimport { store } from './store';\nimport { initIndexedDB, useDBReady } from './db';\nimport './sagas';\nimport { sagaLauncher } from './sagas';\nimport { paths, routes } from './routes';\nimport { refresh } from './atoms/client/client.actions';\n\nexport const App = () => {\n    const refreshAllHandler = useAction(() => {\n        console.log('*** refreshAllHandler');\n\n        initIndexedDB(store);\n\n        console.log('*** refreshAllHandler complete');\n\n        return refresh();\n    }, []);\n    useDBReady(refreshAllHandler);\n\n    return (\n        <div className={styles.App}>\n            <HashRouter>\n                <Switch>\n                    {routes.map((route, index) => <Route {...route} key={index}/>)}\n                    <Redirect to={paths.home()}/>\n                </Switch>\n                <NavBar/>\n            </HashRouter>\n        </div>\n    );\n};\n\nstartListenOnlineStatus(store);\nsagaLauncher.start(store);\n","import { Store } from '@reatom/core';\nimport { setOnlineStatus } from './client.actions';\n\nexport function startListenOnlineStatus(store: Store) {\n    store.dispatch(setOnlineStatus(navigator.onLine));\n\n    window.addEventListener('online',\n        () => store.dispatch(setOnlineStatus(true)),\n    );\n    window.addEventListener('offline',\n        () => store.dispatch(setOnlineStatus(false)),\n    );\n}\n","import { DBStatus } from '../libs/indexed-db';\nimport { useEffect } from 'react';\nimport { db } from './db';\n\nexport function useDBReady(onReady: () => void) {\n    console.log('useDBReady');\n\n    const onChangeStatusEvent = (status: DBStatus) => {\n        console.log(DBStatus[status]);\n        if (status === DBStatus.Ready)\n            onReady();\n    };\n\n    useEffect(() => {\n        db.addStatusListener(onChangeStatusEvent);\n        return () => db.removeStatusListener(onChangeStatusEvent);\n    });\n}\n","/**\n * @packageDocumentation\n * @module app-root\n */\n\n// This optional code is used to register a service worker.\n// register() is not called by default.\n\n// This lets the app load faster on subsequent visits in production, and gives\n// it offline capabilities. However, it also means that developers (and users)\n// will only see deployed updates on subsequent visits to a page, after all the\n// existing tabs open on the page have been closed, since previously cached\n// resources are updated in the background.\n\n// To learn more about the benefits of this model and instructions on how to\n// opt-in, read https://bit.ly/CRA-PWA\n\nconst SW_DEBUG = false;\n\nconst isLocalhost = SW_DEBUG ||\n    Boolean(\n        window.location.hostname === 'localhost' ||\n        // [::1] is the IPv6 localhost address.\n        window.location.hostname === '[::1]' ||\n        // 127.0.0.0/8 are considered localhost for IPv4.\n        window.location.hostname.match(\n            /^127(?:\\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/,\n        ),\n    );\n\ntype Config = {\n    onSuccess?: (registration: ServiceWorkerRegistration) => void;\n    onUpdate?: (registration: ServiceWorkerRegistration) => void;\n};\n\nexport function register(config?: Config) {\n    if ((SW_DEBUG || process.env.NODE_ENV === 'production') && 'serviceWorker' in navigator) {\n        // The URL constructor is available in all browsers that support SW.\n        const publicUrl = new URL(\n            process.env.PUBLIC_URL,\n            window.location.href,\n        );\n        if (publicUrl.origin !== window.location.origin) {\n            // Our service worker won't work if PUBLIC_URL is on a different origin\n            // from what our page is served on. This might happen if a CDN is used to\n            // serve assets; see https://github.com/facebook/create-react-app/issues/2374\n            return;\n        }\n\n        window.addEventListener('load', () => {\n            const swUrl = `${process.env.PUBLIC_URL}/service-worker.js`;\n\n            if (isLocalhost) {\n                checkValidServiceWorker(swUrl, config);\n\n                // Add some additional logging to localhost, pointing developers to the\n                // service worker/PWA documentation.\n                navigator.serviceWorker.ready.then(() => {\n                    console.log('Offline Mode ready');\n                });\n            } else {\n                // Is not localhost. Just register service worker\n                registerValidSW(swUrl, config);\n            }\n        });\n    }\n}\n\nfunction registerValidSW(swUrl: string, config?: Config) {\n    navigator.serviceWorker\n             .register(swUrl)\n             .then(registration => {\n                 registration.onupdatefound = () => {\n                     const installingWorker = registration.installing;\n                     if (installingWorker == null) {\n                         return;\n                     }\n                     installingWorker.onstatechange = () => {\n                         if (installingWorker.state === 'installed') {\n                             if (navigator.serviceWorker.controller) {\n                                 // At this point, the updated precached content has been fetched,\n                                 // but the previous service worker will still serve the older\n                                 // content until all client tabs are closed.\n                                 console.log(\n                                     'New content is available and will be used when all ' +\n                                     'tabs for this page are closed. See https://bit.ly/CRA-PWA.',\n                                 );\n\n                                 // Execute callback\n                                 if (config && config.onUpdate) {\n                                     config.onUpdate(registration);\n                                 }\n                             } else {\n                                 // At this point, everything has been precached.\n                                 // It's the perfect time to display a\n                                 // \"Content is cached for offline use.\" message.\n                                 console.log('Content is cached for offline use.');\n\n                                 // Execute callback\n                                 if (config && config.onSuccess) {\n                                     config.onSuccess(registration);\n                                 }\n                             }\n                         }\n                     };\n                 };\n             })\n             .catch(error => {\n                 console.error('Error during service worker registration:', error);\n             });\n}\n\nfunction checkValidServiceWorker(swUrl: string, config?: Config) {\n    // Check if the service worker can be found. If it can't reload the page.\n    fetch(swUrl, {\n        headers: {'Service-Worker': 'script'},\n    })\n        .then(response => {\n            // Ensure service worker exists, and that we really are getting a JS file.\n            const contentType = response.headers.get('content-type');\n            if (\n                response.status === 404 ||\n                (contentType != null && contentType.indexOf('javascript') === -1)\n            ) {\n                // No service worker found. Probably a different app. Reload the page.\n                navigator.serviceWorker.ready.then(registration => {\n                    registration.unregister().then(() => {\n                        window.location.reload();\n                    });\n                });\n            } else {\n                // Service worker found. Proceed as normal.\n                registerValidSW(swUrl, config);\n            }\n        })\n        .catch(() => {\n            console.log(\n                'No internet connection found. App is running in offline mode.',\n            );\n        });\n}\n\nexport function unregister() {\n    if ('serviceWorker' in navigator) {\n        navigator.serviceWorker.ready\n                 .then(registration => {\n                     registration.unregister();\n                 })\n                 .catch(error => {\n                     console.error(error.message);\n                 });\n    }\n}\n","/**\n * This comment will be used as the summary for the \"thing2\" module.\n *\n * @packageDocumentation\n * @module app-root\n * @preferred\n */\n\nimport React from 'react';\nimport ReactDOM from 'react-dom';\nimport { context } from '@reatom/react';\nimport './styles/index.scss';\nimport { App } from './App';\nimport * as serviceWorker from './serviceWorker';\nimport { store } from './store';\n\nReactDOM.render(\n    <React.StrictMode>\n        <context.Provider value={store}>\n            <App/>\n        </context.Provider>\n    </React.StrictMode>,\n    document.getElementById('root'),\n);\n\n// If you want your app to work offline and load faster, you can change\n// unregister() to register() below. Note this comes with some pitfalls.\n// Learn more about service workers: https://bit.ly/CRA-PWA\nserviceWorker.unregister();\n","// extracted by mini-css-extract-plugin\nmodule.exports = {\"head\":\"MonthViewWidget_head__2tdqX\",\"title\":\"MonthViewWidget_title__2uHWT\",\"info\":\"MonthViewWidget_info__ltwmS\",\"circle\":\"MonthViewWidget_circle__19VOB\",\"balance\":\"MonthViewWidget_balance__qUNX4\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"txList\":\"TxList_txList__3rowt\",\"txItem\":\"TxList_txItem__2-7sR\",\"txItem__left\":\"TxList_txItem__left__3Dekh\",\"txItem__first\":\"TxList_txItem__first__eF_WE\",\"txItem__second\":\"TxList_txItem__second__-lQ89\",\"txItem__amount\":\"TxList_txItem__amount__2PbUA\",\"txItem__date\":\"TxList_txItem__date__3uUSP\",\"empty\":\"TxList_empty__2S-7j\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"moneyView\":\"MoneyView_moneyView__2U7sP\",\"fractional\":\"MoneyView_fractional__1hdQj\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"swipeWidget\":\"SwipeWidget_swipeWidget__12ZdL\",\"prev\":\"SwipeWidget_prev__UDZne\",\"next\":\"SwipeWidget_next__1huSl\",\"swipe\":\"SwipeWidget_swipe__1ww0t\",\"swipe-wrap\":\"SwipeWidget_swipe-wrap__x4MEz\",\"swipeItem\":\"SwipeWidget_swipeItem__2D3OP\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"page\":\"TransactionsPage_page__1uE4j\",\"filter\":\"TransactionsPage_filter__3x4B8\",\"active\":\"TransactionsPage_active__3XoOk\"};"],"sourceRoot":""}