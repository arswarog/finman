(this.webpackJsonpfinman=this.webpackJsonpfinman||[]).push([[1],{178:function(e,t,n){e.exports={App:"App_App__15LM-","App-logo":"App_App-logo__1GLNd","App-logo-spin":"App_App-logo-spin__1EbLw","App-header":"App_App-header__3nnPn","App-link":"App_App-link__TRj1P"}},184:function(e,t,n){},187:function(e,t,n){e.exports={licenses:"LicensesPage_licenses__3Ik4Y"}},192:function(e,t,n){e.exports=n(319)},197:function(e,t,n){},199:function(e,t,n){var a={"./ion-action-sheet.entry.js":[321,5],"./ion-alert.entry.js":[322,6],"./ion-app_8.entry.js":[323,7],"./ion-avatar_3.entry.js":[324,18],"./ion-back-button.entry.js":[325,19],"./ion-backdrop.entry.js":[326,43],"./ion-button_2.entry.js":[327,20],"./ion-card_5.entry.js":[328,21],"./ion-checkbox.entry.js":[329,22],"./ion-chip.entry.js":[330,23],"./ion-col_3.entry.js":[331,44],"./ion-datetime_3.entry.js":[332,10],"./ion-fab_3.entry.js":[333,24],"./ion-img.entry.js":[334,45],"./ion-infinite-scroll_2.entry.js":[335,46],"./ion-input.entry.js":[336,25],"./ion-item-option_3.entry.js":[337,26],"./ion-item_8.entry.js":[338,27],"./ion-loading.entry.js":[339,28],"./ion-menu_3.entry.js":[340,29],"./ion-modal.entry.js":[341,8],"./ion-nav_2.entry.js":[342,15],"./ion-popover.entry.js":[343,9],"./ion-progress-bar.entry.js":[344,30],"./ion-radio_2.entry.js":[345,31],"./ion-range.entry.js":[346,32],"./ion-refresher_2.entry.js":[347,11],"./ion-reorder_2.entry.js":[348,17],"./ion-ripple-effect.entry.js":[349,47],"./ion-route_4.entry.js":[350,33],"./ion-searchbar.entry.js":[351,34],"./ion-segment_2.entry.js":[352,35],"./ion-select_3.entry.js":[353,36],"./ion-slide_2.entry.js":[354,48],"./ion-spinner.entry.js":[355,13],"./ion-split-pane.entry.js":[356,49],"./ion-tab-bar_2.entry.js":[357,37],"./ion-tab_2.entry.js":[358,16],"./ion-text.entry.js":[359,38],"./ion-textarea.entry.js":[360,39],"./ion-toast.entry.js":[361,40],"./ion-toggle.entry.js":[362,12],"./ion-virtual-scroll.entry.js":[363,50]};function r(e){if(!n.o(a,e))return Promise.resolve().then((function(){var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}));var t=a[e],r=t[0];return n.e(t[1]).then((function(){return n(r)}))}r.keys=function(){return Object.keys(a)},r.id=199,e.exports=r},221:function(e,t,n){var a={"./ion-icon.entry.js":[367,57]};function r(e){if(!n.o(a,e))return Promise.resolve().then((function(){var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}));var t=a[e],r=t[0];return n.e(t[1]).then((function(){return n(r)}))}r.keys=function(){return Object.keys(a)},r.id=221,e.exports=r},233:function(e,t){},235:function(e,t){},245:function(e,t){},247:function(e,t){},275:function(e,t){},276:function(e,t){},319:function(e,t,n){"use strict";n.r(t);var a=n(0),r=n.n(a),c=n(63),i=n.n(c),o=n(31),s=(n(197),n(178)),u=n.n(s),l=n(13),d=n(83),m=n(179),f=n(220),h=n(27),p=h,b={"list-outline":h.notificationsOutline,"menu-outline":h.menuOutline,"close-circle":h.closeCircle,"notifications-outline":h.notificationsOutline,"chevron-back-outline":h.chevronBackOutline};f.a(b);var g=function(e){var t=e.icon,n=e.name,a=e.className,c=e.size;if(a=a||"icon",!t&&n){if(!b[n])throw new Error('Icon "'.concat(n,'" not loaded'));t=b[n]}return r.a.createElement(m.a,{mode:"ios",icon:t,className:a,size:c})},v=function(e){var t=e.title,n=e.back,c=e.children,i=Object(l.g)(),o=Object(a.useCallback)((function(){if(n)return!0===n?i.goBack():void i.replace(n)}),[i,n]);return r.a.createElement("div",{className:"appHeader"},n&&r.a.createElement("div",{className:"left"},r.a.createElement("span",{onClick:o,className:"headerButton goBack"},r.a.createElement(g,{name:"chevron-back-outline",role:"img",className:"md hydrated","aria-label":"chevron back outline"}))),r.a.createElement("div",{className:"pageTitle"},t),r.a.createElement("div",{className:"right"},c))},y=n(119),O=n.n(y),j=n(68),w=n.n(j),E=function(e){var t,n=e.showButtons,c=e.children,i=e.onChange,o=e.current;i=i||function(e){return null};var s=c.flat(),u=s.findIndex((function(e){return e.key===o}));-1===u&&(u=0),console.log("!!!",o,u),console.log(s),Object(a.useEffect)((function(){return t.slide(u,0)}),[u,t]);var l=n&&u>0?s[u-1].key:"",d=n&&u<s.length-1?s[u+1].key:"";return r.a.createElement("div",{className:w.a.swipeWidget},r.a.createElement(O.a,{ref:function(e){return t=e},className:w.a.swipe,callback:function(e){console.log("current",e);var t=s[e];console.log("current",t),i(t.key)},startSlide:u,speed:0,auto:0},s),l&&r.a.createElement("div",{className:w.a.prev,onClick:function(){t.prev()}}),d&&r.a.createElement("div",{className:w.a.next,onClick:function(){t.next()}}))},x=function(e){var t=e.children;return r.a.createElement(y.SwipeItem,{className:w.a.swipeItem},t)},k=n(22);function N(){return Object(a.useReducer)((function(e){return e+1}),0)[1]}var S=function(e){return e};function _(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:S,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],r=Object(a.useContext)(o.a);console.log("by forceUpdate",e);var c=N(),i=t(r.getState(e));return Object(a.useEffect)((function(){return r.subscribe(e,(function(e){console.log("new value",e,t(e)),c()}))}),[].concat(Object(k.a)(n),[r,e,c,t])),i}var A=n(36),I=n(37);function M(){var e=Object(A.a)(["\n  padding: 56px 12px 72px;\n"]);return M=function(){return e},e}var T,D,C,z=I.a.main(M()),B=n(5),V=n(7),L=n(38),P=Symbol("Packable encoder"),F=Symbol("Packable decoder"),J=n(34),U=function(){function e(t,n){if(Object(B.a)(this,e),this[F]=void 0,this[P]=void 0,this.decode=void 0,this.encode=void 0,!n||"function"!==typeof n)throw new Error("Encoder must be a function");if(!t||"function"!==typeof t)throw new Error("Decoder must be a function");this[P]=n,this[F]=t,this.encode=n,this.decode=t}return Object(V.a)(e,null,[{key:"getSafe",value:function(t){return null===t||void 0===t?null:P in t&&"function"===typeof t[P]&&F in t&&"function"===typeof t[F]?new e(t[F],t[P]):"prototype"in t&&P in t.prototype&&"function"===typeof t.prototype[P]&&F in t.prototype&&"function"===typeof t.prototype[F]?new e(t.prototype[F],t.prototype[P]):null}},{key:"get",value:function(t){var n=e.getSafe(t);if(n)return n;throw new Error("Target not a Packer")}},{key:"for",value:function(t){if(null===t||void 0===t)throw new Error("Rule not defined");if(t instanceof e)return t;var n=e.getSafe(t);if(n)return n;if(t===String||t===Number||t===Boolean)return e.forPrimitive(t);if(Array.isArray(t))return e.forArray(t[0]);throw new Error("Invalid rule")}},{key:"forPrimitive",value:function(t){if(t===String)return new e((function(e){return"string"===typeof e?""+e:null}),(function(e){return"string"===typeof e?e:null}));if(t===Number)return new e((function(e){return+e}),(function(e){return+e}));if(t===Boolean)return new e((function(e){return!!e}),(function(e){return!!e}));throw new Error("Invalid type")}},{key:"forObject",value:function(t){var n=Object.entries(t).map((function(t){var n=Object(J.a)(t,2),a=n[0],r=n[1];return[a,e.for(r)]}));return new e((function(e){return n.reduce((function(t,n){var a=Object(J.a)(n,2),r=a[0],c=a[1];return t[r]=c.decode(e[r]),t}),{})}),(function(e){return n.reduce((function(t,n){var a=Object(J.a)(n,2),r=a[0],c=a[1];return t[r]=c.encode(e[r]),t}),{})}))}},{key:"forClass",value:function(t,n){var a=e.forObject(t);return new e((function(e){return n(a.decode(e))}),a.encode)}},{key:"forArray",value:function(t){var n=e.for(t);return new e((function(e){return e.map(n.decode)}),(function(e){return e.map(n.encode)}))}},{key:"maybe",value:function(t){return new e((function(e){return null===e||void 0===e?null:t.decode(e)}),(function(e){return null===e||void 0===e?null:t.encode(e)}))}}]),e}(),R=Symbol("Fields symbol");function H(e){return function(t){var n=t.prototype,a=n[R];if(!a)throw new Error("To use @PackableClass you need declare @Packable");delete n[R];var r=U.forClass(a,e);n[F]=r.decode,n[P]=r.encode}}function W(e){if(null===e||void 0===e)throw new Error("Rule must be defined");return function(t,n){R in t?t[R][n]=e:t[R]=Object(L.a)({},n,e)}}var G,Y={RUB:{code:"RUB",symbol:"\u20bd",precision:2}},q=(G=function(e){return new U(e.fromJSON,e.toJSON)},function(e){var t=G(e);if(!t)throw new Error("Init function must return IPacker");var n=U.for(t);e[F]=n.decode,e[P]=n.encode}((C=D=function(){function e(t,n){Object(B.a)(this,e),this.subunits=t,this.currency=n,this.amount="",this.amount=(t/Math.pow(10,n.precision)).toFixed(2)}return Object(V.a)(e,null,[{key:"from",value:function(t){if("string"===typeof t)return e.fromJSON(t);if(t instanceof e)return t.clone();throw new Error("Can not convert invalid data to Money")}},{key:"fromJSON",value:function(t){if("object"===typeof t&&"number"===typeof t.subunits&&"object"===typeof t.currency&&"string"===typeof t.currency.code)return new e(t.subunits,t.currency);if("string"!==typeof t)throw new Error('Amount "'.concat(t,'" must be a string'));var n=t.trim().split(" ");if(!n||2!==n.length)throw new Error('Money "'.concat(t,'" must have valid format'));var a=n[0],r=n[1].toUpperCase(),c=Y[r];if(!c)throw new Error('Unsupported currency "'.concat(r,'"'));var i=+a;if(Number.isNaN(i))throw new Error('Invalid amount "'.concat(a,'" when parse "').concat(t,'"'));return new e(Math.round(i*Math.pow(10,c.precision)),c)}},{key:"toJSON",value:function(e){return e.toJSON()}},{key:"create",value:function(t,n){if("string"!==typeof n)throw new Error('Invalid currency "'.concat(n,'"'));if(n=n.toUpperCase(),"string"===typeof t){if(!t||Number.isNaN(+t))throw new Error('Amount must be valid number but received "'.concat(t,'"'));t=+t}var a=Y[n];if(!a)throw new Error('Unsupported currency "'.concat(n,'"'));var r=+t;if(Number.isNaN(r))throw new Error('Invalid amount "'.concat(t,'"'));return new e(Math.round(r*Math.pow(10,a.precision)),a)}}]),Object(V.a)(e,[{key:"clone",value:function(){return new e(this.subunits,this.currency)}},{key:"toString",value:function(){return this.subunits?this.amount+" "+this.currency.symbol:"0 "+this.currency.symbol}},{key:"toJSON",value:function(){return this.subunits?this.amount+" "+this.currency.code:"0 "+this.currency.code}},{key:"add",value:function(t){if(this.currency.code!==t.currency.code)throw new Error("Can not do any operations with different currencies");return new e(this.subunits+t.subunits,this.currency)}},{key:"sub",value:function(t){if(this.currency.code!==t.currency.code)throw new Error("Can not do any operations with different currencies");return new e(this.subunits-t.subunits,this.currency)}},{key:"equal",value:function(e){return this.currency.code===e.currency.code&&this.subunits===e.subunits}},{key:"getEntire",value:function(){return Math.floor(this.subunits/Math.pow(10,this.currency.precision)).toString()}},{key:"getFractional",value:function(){return(this.subunits/Math.pow(10,this.currency.precision)).toFixed(this.currency.precision).substr(-this.currency.precision)}},{key:"getSymbol",value:function(){return this.currency.symbol}},{key:"negative",value:function(){return new e(-this.subunits,this.currency)}},{key:"isPositive",value:function(){return this.subunits>0}},{key:"isNegative",value:function(){return this.subunits<0}}]),e}(),D.empty=void 0,T=C))||T);q.empty=q.create(0,"RUB");var $=n(56),X=n.n($),Q=function(e){var t=e.money;if(null===t)return r.a.createElement("div",{className:X.a.moneyView},r.a.createElement("span",{className:X.a.entire},"N/A"));if(!(t instanceof q))throw new Error("money must be instance of Money, but get ".concat(typeof t," ").concat(JSON.stringify(t),'"'));return r.a.createElement("div",{className:X.a.moneyView},r.a.createElement("span",{className:X.a.entire},t.getEntire()),r.a.createElement("span",{className:X.a.fractional},t.getFractional()),r.a.createElement("span",{className:X.a.currency},t.getSymbol()))};function Z(){var e=Object(A.a)(['\n  background: #ffffff;\n  box-shadow: 0 1px 3px 0 rgba(0, 0, 0, 0.09);\n  border-radius: 10px;\n  padding: 12px 12px;\n  \n  display: grid;\n  grid-template-columns: auto;\n  grid-template-rows: auto;\n  gap: 12px 12px;\n  grid-template-areas: "icon amount amount" "title title status";\n\n  .amount { \n    grid-area: amount; \n    text-align: right;\n    \n    align-self: center;\n    font-size: 20px;\n    font-weight: 700;\n    letter-spacing: -0.02em;\n    line-height: 1em;\n    color: #27173E;\n    \n    white-space: nowrap;\n  }\n  \n  .icon-wrapper { \n    grid-area: icon;\n    text-align: left;\n    \n    background: #6236FF;\n    width: 36px;\n    height: 36px;\n    display: inline-flex;\n    align-items: center;\n    justify-content: center;\n    border-radius: 18px;\n    color: #fff;\n    font-size: 24px;\n  }\n  \n  .title { \n    grid-area: title;\n    text-align: left;\n    \n    font-size: 13px;\n    color: #958d9e;\n    font-weight: 500;\n    display: block;\n    line-height: 1em;\n    align-self: end;\n  }\n  \n  .status { \n    grid-area: status;\n    text-align: right; \n    \n    //font-size: 13px;\n    color: #958d9e;\n    font-weight: 500;\n    display: block;\n    line-height: 1em;\n    align-self: end;\n  }\n']);return Z=function(){return e},e}var K,ee=I.a.div(Z());!function(e){e.Neutral="neutral",e.Good="good",e.Normal="normal",e.Bad="bad"}(K||(K={}));var te=function(e){var t=e.title,n=e.amount,a=e.icon,c=(e.color,e.progress),i=null===c?"":c<0?c+"%":"+"+c+"%";return r.a.createElement(ee,null,r.a.createElement("div",{className:"icon-wrapper"},r.a.createElement(g,{icon:a})),r.a.createElement("div",{className:"amount"},r.a.createElement(Q,{money:n})),r.a.createElement("div",{className:"title"},t),r.a.createElement("div",{className:"status"},i))},ne=function(e){var t=e.grip;if(!t)return r.a.createElement("div",{className:"alert alert-warning mt-2",role:"alert"},"Grip not specified");var n=function(e){var t=e.months[0];return t?{income:{amount:t.income,progress:null,color:K.Neutral},expense:{amount:t.expense,progress:null,color:K.Neutral},planed:{amount:q.create(0,"RUB"),progress:null,color:K.Neutral},total:{amount:t.balance,progress:null,color:K.Neutral}}:{income:{amount:null,progress:null,color:K.Neutral},expense:{amount:null,progress:null,color:K.Neutral},planed:{amount:q.create(0,"RUB"),progress:null,color:K.Neutral},total:{amount:null,progress:null,color:K.Neutral}}}(t),a=n.income,c=n.expense,i=n.planed,o=n.total,s=[[r.a.createElement(te,Object.assign({title:"Income",icon:p.addCircleOutline},a)),r.a.createElement(te,Object.assign({title:"Expense",icon:p.removeCircleOutline},c))],[r.a.createElement(te,Object.assign({title:"Plane",icon:p.calendarOutline},i)),r.a.createElement(te,Object.assign({title:"Total",icon:p.cashOutline},o))]];return r.a.createElement("div",{className:"section"},s.map((function(e,t){return r.a.createElement("div",{key:t,className:"row mt-2 justify-content-center"},e.map((function(e,t){return r.a.createElement("div",{key:t,className:"col-6"},e)})))})))};function ae(){var e=Object(A.a)(["\n  display: inline-block;\n  border: 2px solid green;\n  border-radius: 50%;\n  background: url(","/category-icons/default.png);\n  width: ",";\n  height: ",";\n  background-size: 100%;\n  box-sizing: content-box;\n  \n  > span {\n    display: block;\n    background-size: 100%;\n    width: ",";\n    height: ",";\n  }\n"]);return ae=function(){return e},e}var re,ce=I.a.span(ae(),"/finman",(function(e){return e.size}),(function(e){return e.size}),(function(e){return e.size}),(function(e){return e.size})),ie=function(e){var t=e.category,n=e.size,a=t.image||"default",c="large"===n?"64px":"32px",i={backgroundImage:"url(".concat("/finman","/category-icons/").concat(a,".png)")};return r.a.createElement(ce,{size:c},r.a.createElement("span",{style:i}))};function oe(){var e=Object(A.a)(["\n  display: flex;\n  margin-top: 16px;\n  overflow-x: hidden;\n  \n  > * {\n    margin: 0 6px;\n    display: flex; // TODO fix it\n  }\n"]);return oe=function(){return e},e}!function(e){e[e.Removed=0]="Removed",e[e.Income=1]="Income",e[e.Expense=2]="Expense",e[e.Adjust=3]="Adjust",e[e.AdjustTo=4]="AdjustTo"}(re||(re={}));var se=I.a.div(oe()),ue=function(e){var t=e.grip;if(!t)return r.a.createElement("div",{className:"alert alert-outline-dark mt-2",role:"alert"},"No data");var n=[{id:"0000-111",name:"Home",image:"essentials-01",parent:null,defaultTxType:re.Income},{id:"default",name:"Default",image:"",parent:null,defaultTxType:re.Income},{id:"0000-111",name:"Home",image:"essentials-01",parent:null,defaultTxType:re.Income},{id:"default",name:"Default",image:"",parent:null,defaultTxType:re.Income},{id:"0000-111",name:"Home",image:"essentials-01",parent:null,defaultTxType:re.Income},{id:"default",name:"Default",image:"",parent:null,defaultTxType:re.Income},{id:"0000-111",name:"Home",image:"essentials-01",parent:null,defaultTxType:re.Income},{id:"default",name:"Default",image:"",parent:null,defaultTxType:re.Income},{id:"0000-111",name:"Home",image:"essentials-01",parent:null,defaultTxType:re.Income},{id:"default",name:"Default",image:"",parent:null,defaultTxType:re.Income}];return r.a.createElement(se,null,n.map((function(e){return r.a.createElement(On,{to:pn.transactions.add({account:t.id,category:e.id})},r.a.createElement(ie,{category:e,size:"large"}))})))},le=function(e){var t=e.account;Object(l.g)();return r.a.createElement("div",{className:"card-block bg-primary"},r.a.createElement("div",{className:"card-main"},r.a.createElement("div",{className:"card-button dropdown"},r.a.createElement("button",{type:"button",className:"btn btn-link btn-icon","data-toggle":"dropdown"},r.a.createElement(g,{icon:p.cogOutline,role:"img",className:"md hydrated","aria-label":"ellipsis horizontal"})),r.a.createElement("div",{className:"dropdown-menu dropdown-menu-right"},r.a.createElement("a",{className:"dropdown-item",href:"javacript:;"},r.a.createElement(g,{icon:p.pencilOutline,role:"img",className:"md hydrated","aria-label":"pencil outline"}),"Edit"),r.a.createElement("a",{className:"dropdown-item",href:"javacript:;"},r.a.createElement(g,{icon:p.closeOutline,role:"img",className:"md hydrated","aria-label":"close outline"}),"Remove"),r.a.createElement("a",{className:"dropdown-item",href:"javacript:;"},r.a.createElement(g,{icon:p.arrowUpCircleOutline,role:"img",className:"md hydrated","aria-label":"arrow up circle outline"}),"Upgrade"))),r.a.createElement("div",{className:"balance"},r.a.createElement("span",{className:"label"},"BALANCE"),r.a.createElement("h1",{className:"title"},r.a.createElement(Q,{money:t.balance}))),r.a.createElement("div",{className:"in"},r.a.createElement("div",{className:"card-number"},r.a.createElement("span",{className:"label"},"Account name"),t.name),r.a.createElement("div",{className:"bottom"},r.a.createElement("div",{className:"card-expiry"},r.a.createElement("span",{className:"label"},"Statistics for"),"Last month")))))},de=n(2),me=n(6),fe=n(21),he="grips/account",pe=Object(me.c)(he+":chooseAccountGrip"),be=Object(me.c)(he+":updateAccountGrip"),ge=Object(me.c)(he+":updateAccountGrip success"),ve=(Object(me.c)(he+":updateAccountGrip failed"),Object(me.c)(he+":updateAccountGrips")),ye=Object(me.c)(he+":updateAccountGrips success"),Oe=(Object(me.c)(he+":updateAccountGrips failed"),Object(me.d)(["grips/account"],{currentID:null,current:null,accounts:Object(fe.a)()},(function(e){return{choose:[e(pe,(function(e,t){var n=e.accounts.get(t);return n?Object(de.a)(Object(de.a)({},e),{},{currentID:t,current:n}):Object(de.a)(Object(de.a)({},e),{},{currentID:t})}))],update:[e(ge,(function(e,t){var n=e.accounts.set(t.id,t),a=n.get(e.currentID);return a||(a=n.get(t.id)),Object(de.a)(Object(de.a)({},e),{},{accounts:n,current:a,currentID:a.id})})),e(ye,(function(e,t){var n=t.reduce((function(e,t){return e.set(t.id,t)}),e.accounts),a=n.get(e.currentID);return a||(a=n.get(t[0].id)),Object(de.a)(Object(de.a)({},e),{},{accounts:n,current:a,currentID:a.id})}))]}}))),je=n(55),we=function(e){var t=e.grip;if(!t)return r.a.createElement("div",{className:"alert alert-outline-dark mt-2",role:"alert"},"No data");var n=t.months.slice(0,4);return n.length?r.a.createElement("ul",{className:"listview link-listview inset mt-2",style:{margin:"0"}},n.map((function(e){return r.a.createElement("li",null,r.a.createElement(On,{to:pn.account.month(t.id,e.month),className:"item"},"Balance on ",Object(je.a)(new Date(e.month),"MMMM yyyy"),r.a.createElement("span",{className:"text"},r.a.createElement(Q,{money:e.balanceOnEnd}))))}))):null},Ee=function(){var e=_(Oe),t=e.current,n=e.accounts,a=Object(o.b)((function(e){return"create"===e?null:pe(e)})),c=Array.from(n.values());return n.size?r.a.createElement(r.a.Fragment,null,r.a.createElement(v,{title:"Wallets"}),r.a.createElement(z,null,r.a.createElement(E,{current:(null===t||void 0===t?void 0:t.id)||"",showButtons:!0,onChange:a},c.map((function(e){return r.a.createElement(x,{key:e.id},r.a.createElement(le,{account:e}))}))),r.a.createElement(ne,{grip:t}),r.a.createElement(ue,{grip:t}),r.a.createElement(we,{grip:t}))):r.a.createElement(r.a.Fragment,null,r.a.createElement(v,{title:"Wallets"}),"Loading...")},xe=Object(me.c)("months:loadMonths"),ke=Object(me.c)("months:loadMonths success"),Ne=Object(me.c)("months:loadMonths failed"),Se=Object(me.c)("months:saveMonths"),_e=Object(me.c)("months:saveMonths success"),Ae=Object(me.c)("months:saveMonths failed"),Ie=n(47),Me=n.n(Ie);var Te=r.a.memo((function(e){var t=e.list,n=(e.dayDate,function(e){return e.map((function(e){return Object(de.a)(Object(de.a)({},e),{},{first:e.category.name,second:e.title,dateString:e.date?Object(je.a)(new Date(e.date),"PP"):""})}))}(t));return r.a.createElement("ul",{className:"listview image-listview inset"},n.map((function(e,t){return r.a.createElement("li",null,r.a.createElement(On,{to:pn.transactions.view(e.account.id,e.date,e.id),className:"item"},r.a.createElement("div",{className:"icon-box"},r.a.createElement(ie,{category:e.category})),r.a.createElement("div",{className:"in"},r.a.createElement("div",null,e.first?e.first:r.a.createElement("span",{className:Me.a.empty},"\u0411\u0435\u0437 \u0437\u0430\u0433\u043e\u043b\u043e\u0432\u043a\u0430"),r.a.createElement("footer",null,e.second?e.second:r.a.createElement("span",{className:Me.a.empty},"\u0411\u0435\u0437 \u0437\u0430\u0433\u043e\u043b\u043e\u0432\u043a\u0430"))),r.a.createElement("span",null,r.a.createElement(Q,{money:e.amount})))))})))}));function De(){var e=Object(A.a)(["\n  text-align: left;\n  font-size: 15px;\n  padding: ",";\n  color: #27173E;\n  font-weight: 500;\n  margin: 0;\n"]);return De=function(){return e},e}function Ce(){var e=Object(A.a)(["\n  margin: 16px 0;\n  padding: ",";\n"]);return Ce=function(){return e},e}var ze=I.a.section(Ce(),(function(e){return e.full?"0":"0 16px"})),Be=I.a.h3(De(),(function(e){return e.full?"6px 16px":"6px 0"})),Ve=function(e){var t=e.full,n=e.title,a=e.children;return r.a.createElement(ze,{full:t},r.a.createElement(Be,{full:t},n),a)},Le=r.a.memo((function(e){var t=e.month;if(!t)return r.a.createElement("div",null,"No data");var n=t.days;return r.a.createElement(r.a.Fragment,null,n.map((function(e){return r.a.createElement(Ve,{full:!0,title:(t=e.date,Object(je.a)(new Date(t),"do LLLL"))},r.a.createElement(Te,{list:e.transactions,dayDate:e.date}));var t})))}));var Pe=n(41),Fe=n.n(Pe),Je=function(e){var t=e.brief;if(!t)return r.a.createElement("div",null,"No month");var n=452,a=t.income.subunits+t.expense.subunits,c=t.income.subunits/a*n,i=t.expense.subunits/a*n;return r.a.createElement("div",{className:"section"},r.a.createElement("div",{className:"card"},r.a.createElement("div",{className:"card-header"},Object(je.a)(new Date(t.month),"MMMM yyyy")),r.a.createElement("div",{className:"card-body"},r.a.createElement("div",{className:Fe.a.head},r.a.createElement("div",{className:Fe.a.info},r.a.createElement("div",{className:Fe.a.circle},r.a.createElement("svg",{width:"160",height:"160"},r.a.createElement("circle",{transform:"rotate(-90)",r:"72",cx:"-80",cy:"80"}),r.a.createElement("circle",{className:"income",transform:"rotate(-90)",r:"72",cx:"-80",cy:"80",stroke:"30bae7",strokeDasharray:[c,n].join(" ")}),r.a.createElement("circle",{className:"expense",transform:"rotate(-90)",r:"72",cx:"-80",cy:"80",strokeDasharray:[0,c,i,n].join(" ")})),r.a.createElement("h4",{className:Fe.a.balance},r.a.createElement(Q,{money:t.balance})),r.a.createElement("div",null,"+",r.a.createElement(Q,{money:t.income})),r.a.createElement("div",null,"-",r.a.createElement(Q,{money:t.expense}))))))))},Ue=n(184),Re=n.n(Ue),He=(Object(me.c)("grips/month:updateMonthGrip"),Object(me.c)("grips/month:updateMonthGrip success")),We=(Object(me.c)("grips/month:updateMonthGrip failed"),Object(me.c)("grips/month:updateMonthGrips"),Object(me.c)("grips/month:updateMonthGrips success")),Ge=(Object(me.c)("grips/month:updateMonthGrips failed"),Object(me.d)(["grips/month"],Object(fe.a)(),(function(e){return{update:[e(He,(function(e,t){return e.set(t.id,t)})),e(We,(function(e,t){return t.reduce((function(e,t){return e.set(t.id,t)}),e)}))]}}))),Ye=function(){var e=Object(l.i)().params,t=Object(o.c)(Oe,(function(t){return t.accounts.get(e.account)}),[e.account]),n=(Object(o.c)(Ge),Object(l.g)());Object(k.a)(t?t.months:[]).reverse();Object(a.useCallback)((function(e){n.replace(pn.account.month(t.id,e))}),[t,n]),Object(o.b)((function(e){return e?xe([e]):null}),[]);return t?t.months.length?r.a.createElement(qe,{account:t,month:e.month||t.lastMonthDate}):r.a.createElement("div",null,"No months in this account"):r.a.createElement("div",null,"No account")},qe=function(e){var t=e.account,n=e.month,c=Object(o.c)(Ge),i=Object(l.g)(),s=Object(k.a)(t?t.months:[]);s.reverse();var u=Object(a.useCallback)((function(e){i.replace(pn.account.month(t.id,e))}),[t,i]),d=Object(o.b)((function(e){return e?xe([e]):null}),[]),m=t.months.findIndex((function(e){return e.month===n}));-1===m&&(m=0);var f=t.months[m],h=t.months[m+1],p=t.months[m-1];Object(a.useEffect)((function(){f&&!c.has(f.id)&&d(f.id),h&&!c.has(h.id)&&d(h.id),p&&!c.has(p.id)&&d(p.id)}),[h,p,f]);var b=c.get(null===f||void 0===f?void 0:f.id);return r.a.createElement(r.a.Fragment,null,r.a.createElement(v,{back:!0,title:"Account ".concat(t.name)}),r.a.createElement(z,{className:Re.a.main+" noselect"},r.a.createElement(E,{onChange:u,current:f.month,showButtons:!0},s.map((function(e){return r.a.createElement(x,{key:e.month},r.a.createElement(Je,{months:c,brief:e}))}))),r.a.createElement(Le,{month:b})))};var $e,Xe,Qe,Ze,Ke,et,tt,nt,at,rt,ct,it,ot,st,ut,lt={list:function(){return"".concat("","/accounts")},view:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:":account";return"".concat("","/accounts/").concat(e)},monthsList:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:":account";return"".concat("","/accounts/").concat(e,"/months")},month:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:":account",t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:":month";return"".concat("","/accounts/").concat(e,"/months/").concat(t)}},dt=[{path:lt.list(),exact:!0,component:Ee},{path:lt.view(),exact:!0,component:Ee},{path:lt.month(),component:Ye},{path:lt.monthsList(),component:Ye}],mt=n(185),ft=Object(me.c)("client:setOnlineStatus"),ht=Object(me.c)("client:refresh"),pt=Object(me.d)(["client"],{online:!1},(function(e){return{online:[e(ft,(function(e,t){return Object(de.a)(Object(de.a)({},e),{},{online:t})}))]}})),bt=Object(me.c)("accounts:chooseAccount"),gt=Object(me.c)("accounts:loadAccounts"),vt=Object(me.c)("accounts:loadAccounts success"),yt=Object(me.c)("accounts:loadAccounts failed"),Ot=Object(me.c)("accounts:saveAccounts"),jt=Object(me.c)("accounts:saveAccounts success"),wt=Object(me.c)("accounts:saveAccounts failed"),Et=Object(me.d)(["accounts"],{current:null,accounts:Object(fe.a)()},(function(e){return{choose:[e(bt,(function(e,t){var n=e.accounts.get(t);return n?Object(de.a)(Object(de.a)({},e),{},{current:n}):e}))],load:[e(vt,(function(e,t){var n=t.current,a=t.accounts,r=a.map((function(e){return[e.id,e]})),c=Object(fe.a)(r);return Object(de.a)(Object(de.a)({},e),{},{current:c.has(n)?c.get(n):a[0],accounts:c})}))],save:[e(Ot,(function(e,t){var n;return{accounts:e.accounts.set(t.id,t),current:t.id===(null===(n=e.current)||void 0===n?void 0:n.id)?t:e.current}}))]}})),xt=Object(me.d)(["months"],Object(fe.a)(),(function(e){return{load:[e(ke,(function(e,t){return t.reduce((function(e,t){return e.set(t.id,t)}),e)}))],save:[e(Se,(function(e,t){return t.reduce((function(e,t){return e.set(t.id,t)}),e)}))]}})),kt=Object(me.c)("categories:loadCategories"),Nt=Object(me.c)("categories:loadCategories success"),St=Object(me.c)("categories:loadCategories failed"),_t=Object(me.c)("categories:saveCategories"),At=(Object(me.c)("categories:saveCategories success"),Object(me.c)("categories:saveCategories failed"),n(17)),It=n(18),Mt=n(9),Tt=n(10),Dt=(n(57),n(368)),Ct=($e=H((function(e){return new Ct(e)})),Xe=W(String),Qe=W(String),Ze=W(String),Ke=W(Number),et=W(String),tt=W(Boolean),$e((at=function(){function e(t){if(Object(B.a)(this,e),Object(Mt.a)(this,"id",rt,this),Object(Mt.a)(this,"name",ct,this),Object(Mt.a)(this,"parent",it,this),Object(Mt.a)(this,"defaultTxType",ot,this),Object(Mt.a)(this,"image",st,this),Object(Mt.a)(this,"isInitial",ut,this),!t.name)throw new Error("Name must be set");Object.assign(this,t)}return Object(V.a)(e,null,[{key:"create",value:function(t,n,a){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"default",c=arguments.length>4?arguments[4]:void 0;return new e({id:c||Object(Dt.a)(),name:t,image:r,defaultTxType:n}).setParent(a)}},{key:"createInitial",value:function(t,n,a,r,c){if(!c)throw new Error("ID must be set");return new e(Object(de.a)(Object(de.a)({},e.create(t,n,a,r,c)),{},{isInitial:!0}))}},{key:"fromJSON",value:function(t){return U.get(e).decode(t)}},{key:"toJSON",value:function(e){return e.toJSON()}}]),Object(V.a)(e,[{key:"toJSON",value:function(){return U.get(e).encode(this)}},{key:"setName",value:function(t){if(this.isInitial)throw new Error("Can not set name to initial category");return new e(Object(de.a)(Object(de.a)({},this),{},{name:t}))}},{key:"setDefaultTransactionType",value:function(t){return new e(Object(de.a)(Object(de.a)({},this),{},{defaultTxType:t}))}},{key:"setImage",value:function(t){return new e(Object(de.a)(Object(de.a)({},this),{},{image:t}))}},{key:"setParent",value:function(t){if(this.isInitial)throw new Error("Can not set parent to initial category");return new e(t?"string"===typeof t?Object(de.a)(Object(de.a)({},this),{},{parent:t}):Object(de.a)(Object(de.a)({},this),{},{parent:t.id}):Object(de.a)(Object(de.a)({},this),{},{parent:null}))}}]),e}(),rt=Object(Tt.a)(at.prototype,"id",[Xe],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return""}}),ct=Object(Tt.a)(at.prototype,"name",[Qe],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return""}}),it=Object(Tt.a)(at.prototype,"parent",[Ze],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),ot=Object(Tt.a)(at.prototype,"defaultTxType",[Ke],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return re.Expense}}),st=Object(Tt.a)(at.prototype,"image",[et],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return"default"}}),ut=Object(Tt.a)(at.prototype,"isInitial",[tt],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),nt=at))||nt),zt=function(e){Object(At.a)(n,e);var t=Object(It.a)(n);function n(e,a){var r;return Object(B.a)(this,n),(r=t.call(this,e)).children=[],r.children=a.filter((function(e){return e.parent===r.id})),r}return n}(Ct),Bt=Object(me.d)(["categories"],Object(fe.a)(),(function(e){return{load:[e(Nt,(function(e,t){var n=t.list.filter((function(e){return!e.parent})).map((function(e){return new zt(e,t.list)})),a=n.flatMap((function(e){return[e].concat(Object(k.a)(e.children))})),r=Object(fe.a)(a.map((function(e){return[e.id,e]})));return(e=e.set(t.id,{block:t,tree:n,list:a,map:r})).set(t.account,{block:t,tree:n,list:a,map:r})}))],save:[e(_t,(function(e,t){throw new Error("Not implemented")}))]}})),Vt=Object(me.b)(Object(me.a)({Client:pt,Accounts:Et,Categories:Bt,Months:xt,AccountGrips:Oe,MonthGrips:Ge}));Object(mt.a)(Vt),Vt.subscribe((function(e,t){console.group("*** action",e.type),console.log(e.payload),console.log(t),console.groupEnd()}));var Lt=Object(me.c)("transaction:addTransaction"),Pt=n(84),Ft=n(49),Jt=n(186),Ut=function(e){var t=e.name,n=e.label,c=e.clearable,i=e.placeholder,o=e.hint,s=e.component,u=e.children,l=e.render,d=Object(Pt.c)(t),m=Object(a.useRef)(),f=Object(a.useState)(!1),h=Object(J.a)(f,2),p=h[0],b=h[1],v=Object(a.useCallback)((function(){return b(!0)}),[b]),y=Object(a.useCallback)((function(){return b(!1)}),[b]),O=Object(a.useCallback)((function(){m.current.focus(),d.input.onChange("")}),[m]);return r.a.createElement("div",{className:"form-group basic"},r.a.createElement("div",{className:["input-wrapper",p?"active":"","not-empty"].join(" ")},r.a.createElement("label",{className:"label",htmlFor:"form-input-".concat(t)},n),r.a.createElement(Pt.a,{id:"form-input-".concat(t),name:t,className:"form-control",ref:m,onFocus:v,onBlur:y,placeholder:i,component:s,render:l},u),c&&r.a.createElement("i",{className:"clear-input",onClick:O},r.a.createElement(g,{name:"close-circle",role:"img",className:"md hydrated","aria-label":"close circle"}))),r.a.createElement("div",{className:"input-info"},o))};function Rt(e){var t=e.inputRef,n=e.onChange,a=Object(Ft.a)(e,["inputRef","onChange"]);return r.a.createElement(Jt.a,Object.assign({},a,{getInputRef:t,onValueChange:function(t){n({target:{name:e.name,value:t.value}})},prefix:"$",thousandSeparator:" ",isNumericString:!0}))}var Ht=function(e){return r.a.createElement(Ut,e,(function(e){var t=e.input;e.meta;return r.a.createElement(Rt,Object.assign({},t,{className:"form-control",type:"text",placeholder:"Amount"}))}))};function Wt(){var e=Object(A.a)(["\n    display: inline-block;\n    padding: 5px 10px;\n    cursor: pointer;\n    user-select: none;\n"]);return Wt=function(){return e},e}var Gt,Yt=I.a.div(Wt()),qt=function(e){var t=e.type,n=e.value,c=e.disabled,i=e.onChange,o=re[t],s=n===t,u=Object(a.useCallback)((function(){return i(t)}),[i,t]);return c?r.a.createElement(Yt,null,r.a.createElement("div",{className:"custom-control custom-checkbox d-inline"},r.a.createElement("input",{type:"checkbox",className:"custom-control-input",id:"customCheck2",checked:s}),r.a.createElement("label",{className:"custom-control-label p-0",htmlFor:"customCheck2"})),o):r.a.createElement(Yt,{onClick:u},r.a.createElement("div",{className:"custom-control custom-checkbox d-inline"},r.a.createElement("input",{type:"checkbox",className:"custom-control-input",id:"customCheck2",value:t,checked:s}),r.a.createElement("label",{className:"custom-control-label p-0",htmlFor:"customCheck2"})),o)},$t=function(e){var t=e.types,n=Object(Ft.a)(e,["types"]);return r.a.createElement(Ut,Object.assign({},n,{clearable:!1}),(function(e){var n=e.input;return t.map((function(e){return r.a.createElement(qt,{type:e,value:n.value,onChange:n.onChange})}))}))},Xt=function(e){return r.a.createElement(Ut,Object.assign({},e,{component:"input"}))},Qt=function(e){return r.a.createElement(Ut,e,(function(e){var t=e.input;e.meta;return r.a.createElement("input",Object.assign({},t,{className:"form-control",type:"date",placeholder:"Date"}))}))},Zt=function(e){var t=e.options,n=Object(Ft.a)(e,["options"]);return r.a.createElement(Ut,n,(function(e){var n=e.input;e.meta;return r.a.createElement("select",Object.assign({},n,{className:"form-control custom-select"}),t.map((function(e){var t=e.value,n=e.label;return r.a.createElement("option",{value:t},n)})))}))},Kt=function(e){var t=e.accounts,n=Object(Ft.a)(e,["accounts"]),a=t.map((function(e){return{value:e.id,label:e.name}}));return r.a.createElement(Zt,Object.assign({},n,{options:a}))},en=function(e){var t=e.categories,n=Object(Ft.a)(e,["categories"]),a=t.map((function(e){return{value:e.id,label:e.name}}));return r.a.createElement(Zt,Object.assign({},n,{options:a}))},tn=function(e){var t=e.accounts,n=e.categories,a=e.onSubmit,c=e.value,i=e.validate;return r.a.createElement(Pt.b,{onSubmit:a,initialValues:c,validate:i,render:function(e){var a=e.handleSubmit;e.form,e.submitting,e.pristine,e.values;return r.a.createElement("form",{onSubmit:a,noValidate:!0,autoComplete:"off"},r.a.createElement(Ht,{name:"amount",label:"Amount",hint:"This is amount",placeholder:"Enter amount"}),r.a.createElement(en,{name:"category",label:"Category",categories:n}),r.a.createElement($t,{name:"type",label:"",types:[re.Income,re.Expense]}),r.a.createElement(Xt,{name:"title",label:"Title"}),r.a.createElement(Qt,{name:"date",label:"Date",component:"input"}),r.a.createElement(Kt,{name:"account",label:"Account",accounts:t}),r.a.createElement("button",{type:"submit",className:"btn btn-primary rounded mr-1"},"Save"))}})},nn=function(e){var t=e.full,n=e.children;return r.a.createElement("div",{className:["card","mt-1",t?"full":""].join(" ")},r.a.createElement("div",{className:"card-body"},n))},an=n(96),rn=n.n(an);Gt=Symbol.toStringTag;var cn=function e(t,n,a){Object(B.a)(this,e),this.id=void 0,this.balance=void 0,this.balanceOnEnd=void 0,this.balanceOnStart=void 0,this.categories=void 0,this.days=void 0,this.expense=void 0,this.income=void 0,this.month=void 0,this.tags=void 0,this[Gt]="AbstractMonthGrip",this.month=t,a.length&&a.reduce((function(e,t){if(e.date>=t.date)throw new Error("Days must be sorted");return t})),this.days=a;var r=Object(fe.a)();Object(fe.a)();this.days.forEach((function(e){return e.categories.forEach((function(e){return r=r.set(e.id,e)}))})),this.categories=r,this.balanceOnStart=n,this.balanceOnEnd=this.days.reduce((function(e,t){var n=e.add(t.balance);if(!t.balanceOnStart.equal(e))throw new Error("Start balance on day ".concat(t.date," must be ").concat(e," but received ").concat(t.balanceOnStart));if(!t.balanceOnEnd.equal(n))throw new Error("End balance on day ".concat(t.date," must be ").concat(n," but received ").concat(t.balanceOnEnd));if(!t.balance.equal(t.balanceOnEnd.sub(t.balanceOnStart)))throw new Error("Balance on day ".concat(t.date," must be ").concat(t.balanceOnEnd.sub(t.balanceOnStart)," but received ").concat(t.balance));return n}),this.balanceOnStart),this.balance=this.balanceOnEnd.sub(this.balanceOnStart),this.income=this.days.reduce((function(e,t){return e.add(t.income)}),q.empty),this.expense=this.days.reduce((function(e,t){return e.add(t.expense)}),q.empty)},on=function e(t){Object(B.a)(this,e),this.id=void 0,this.account=void 0,this.amount=void 0,this.category=void 0,this.changeAmount=void 0,this.createdAt=void 0,this.date=void 0,this.sourceTxs=void 0,this.tags=void 0,this.title=void 0,this.type=void 0,this.updatedAt=void 0,Object.assign(this,t)},sn=function(e){Object(At.a)(n,e);var t=Object(It.a)(n);function n(e,a,r,c){Object(B.a)(this,n);var i=a.transactions.map((function(e){var t=c.get(e.category||"default");if(!t)throw new Error('Category "'.concat(e.category||"default",'" not found'));var n={id:e.id,account:r,amount:e.amount,changeAmount:e.amount,title:e.title,type:e.type,category:t,createdAt:e.createdAt?new Date(e.createdAt):null,updatedAt:e.updatedAt?new Date(e.updatedAt):null,date:a.date,sourceTxs:[e],tags:Object(fe.b)()};switch(e.type){case re.Income:return n;case re.Expense:return Object(de.a)(Object(de.a)({},n),{},{changeAmount:e.amount.negative()});default:throw new Error('Unsupported type "'.concat(re[e.type],'"'))}}));return t.call(this,a.date,e,i)}return n}((function e(t,n,a){Object(B.a)(this,e),this.balance=void 0,this.balanceOnEnd=void 0,this.balanceOnStart=void 0,this.categories=void 0,this.date=void 0,this.expense=void 0,this.income=void 0,this.tags=void 0,this.transactions=void 0,this.date=t,this.transactions=a.map((function(e){return new on(e)}));var r=Object(fe.a)();Object(fe.a)();this.transactions.forEach((function(e){r=r.set(e.category.id,e.category)})),this.categories=r,this.balanceOnStart=n,this.balance=this.transactions.reduce((function(e,t){return e.add(t.changeAmount)}),q.empty),this.balanceOnEnd=this.balanceOnStart.add(this.balance),this.income=this.transactions.filter((function(e){return e.changeAmount.isPositive()})).reduce((function(e,t){return e.add(t.changeAmount)}),q.empty),this.expense=this.transactions.filter((function(e){return e.changeAmount.isNegative()})).reduce((function(e,t){return e.add(t.changeAmount)}),q.empty).negative()})),un=function(e){Object(At.a)(n,e);var t=Object(It.a)(n);function n(e,a,r,c){var i;Object(B.a)(this,n);var o=a.days.reduce((function(e,t){var n=e.days,a=e.balanceOnEnd,i=new sn(a,t,r,c);return n.push(i),{days:n,balanceOnEnd:i.balanceOnEnd}}),{days:[],balanceOnEnd:e}),s=o.days,u=o.balanceOnEnd;if((i=t.call(this,a.month,e,s)).id=a.id,!i.balanceOnEnd.equal(u))throw new Error("Wrong balance on end: expected ".concat(u," but received ").concat(i.balanceOnEnd));return i}return n}(cn);function ln(e){var t=e.match(/^(\d{4})-(\d{2})$/);if(!t)throw new Error('Invalid MonthDate "'.concat(e,'"'));var n=+t[1],a=+t[2]-1,r=new Date(n,a,1,12,0,0);if(r.getFullYear()!==n)throw new Error('Invalid year in "'.concat(e,'"'));if(r.getMonth()!==a)throw new Error('Invalid month in "'.concat(e,'"'));return r}function dn(e){return e.split("-",2).join("-")}function mn(e,t){var n=function(e){return Object(o.c)(Oe,(function(t){return t.accounts.get(e)}),[e])}(e),a=Object(o.c)(xt),r=Object(o.b)(xe),c=dn(t);if(!n)return null;var i=n.account.months.find((function(e){return e.month===c}));if(!i)return null;var s=a.get(i.id);return s?new un(s.summary.balanceOnStart,s,n.account,n.categories):(r([i.id]),null)}var fn={list:function(){return"".concat("","/transactions")},add:function(e){return"".concat("","/transaction/add")+function(e){return e&&Object.keys(e).length?"?"+new URLSearchParams(e).toString():""}(e)},view:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:":accountId",t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:":date",n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:":txId";return"".concat("","/accounts/").concat(e,"/day/").concat(t,"/").concat(n)}},hn=[{path:fn.add(),component:function(){var e=new URLSearchParams(Object(l.h)().search),t=Object(l.g)(),n=_(Oe).current,c=_(Et).accounts,i=n?Array.from(n.categories.values()):[],o=Object(a.useState)({type:e.get("type")&&e.get("type")in re?re[e.get("type")]:re.Expense,amount:e.get("amount")||"",date:e.get("date")||"2020-06-01",account:e.get("account")||(null===n||void 0===n?void 0:n.id)||"",category:e.get("category")||"default"}),s=Object(J.a)(o,2),u=s[0],d=s[1];return r.a.createElement(r.a.Fragment,null,r.a.createElement(v,{title:"Add transaction",back:!0}),r.a.createElement(z,null,r.a.createElement(Ve,{full:!0,title:"Add transaction"},r.a.createElement(nn,null,r.a.createElement(tn,{value:u,onSubmit:function(e){console.log(e),d(e),Vt.dispatch(Lt(e)),t.goBack()},validate:function(e){var t={};return e.account||(t.account="Required"),t},accounts:Array.from(c.values()),categories:i})))))}},{path:fn.view(),component:function(){var e=Object(l.i)().params,t=function(e,t,n){var a=mn(e,t);if(!a)return null;var r=a.days.find((function(e){return e.date===t}));return r?(console.log(r),r.transactions.find((function(e){return e.id===n}))):null}(e.accountId,e.date,e.txId);return t?r.a.createElement(r.a.Fragment,null,r.a.createElement(v,{title:"Transaction details",back:!0}),r.a.createElement(z,null,r.a.createElement("div",{className:"section mt-2 mb-2"},r.a.createElement("div",{className:"card inner",style:{padding:16}},r.a.createElement("div",{className:"listed-detail mt-3"},r.a.createElement("div",{className:"icon-wrapper"},r.a.createElement("div",{className:"iconbox"},r.a.createElement(g,{icon:p.arrowForwardOutline,role:"img",className:"md hydrated"}))),r.a.createElement("h3",{className:"text-center mt-2"},re[t.type])),r.a.createElement("ul",{className:"listview flush transparent simple-listview no-space mt-3"},r.a.createElement("li",null,r.a.createElement("strong",null,"Amount"),r.a.createElement("span",null,r.a.createElement(Q,{money:t.amount}))),r.a.createElement("li",null,r.a.createElement("strong",null,"Category"),r.a.createElement("span",null,t.category.name)),r.a.createElement("li",null,r.a.createElement("strong",null,"Title"),r.a.createElement("span",null,t.title||"No title")),r.a.createElement("li",null,r.a.createElement("strong",null,"Tags"),r.a.createElement("span",null,t.tags.join(", ")||"No tags")),r.a.createElement("li",null,r.a.createElement("strong",null,"Wallet"),r.a.createElement("span",null,r.a.createElement(On,{to:pn.account.view(t.account.id)},t.account.name))),r.a.createElement("li",null,r.a.createElement("strong",null,"Date"),r.a.createElement("span",null,t.date))))))):r.a.createElement("div",null,"Not found")}},{path:fn.list(),component:function(e){var t=e.month,n=e.transactions;return n=n||[],r.a.createElement("div",{className:rn.a.page},r.a.createElement(v,{title:"Transactions of ".concat(t)}),r.a.createElement(z,null,r.a.createElement("div",{className:rn.a.filter},r.a.createElement("button",{className:rn.a.active},"\u0412\u0441\u0435"),r.a.createElement("button",null,"\u0422\u0440\u0430\u0442\u044b"),r.a.createElement("button",null,"\u041f\u0440\u0438\u0445\u043e\u0434")),r.a.createElement(Te,{list:n,dayDate:"2020-05-05"})))}}],pn={account:lt,transactions:fn,home:function(){return"".concat("","/accounts")},licenses:function(){return"".concat("","/licenses")},menu:function(){return"".concat("","/menu")}},bn=n(187),gn=n.n(bn),vn=function(e){var t=e.title,n=e.link,a=e.author,c=e.license;return r.a.createElement("li",null,r.a.createElement("a",{href:n,target:"_blank",className:"item"},r.a.createElement("div",{className:"in"},r.a.createElement("div",null,r.a.createElement("header",null,a),t,r.a.createElement("footer",null,c)))))},yn=[].concat(Object(k.a)(dt),Object(k.a)(hn),[{path:pn.menu(),component:function(){return r.a.createElement(r.a.Fragment,null,r.a.createElement(v,{title:"Menu",back:!0}),r.a.createElement(z,null,r.a.createElement("div",{className:"listview-title mt-1"},"Storage"),r.a.createElement("ul",{className:"listview image-listview text inset",style:{marginLeft:"0",marginRight:"0"}},r.a.createElement("li",null,r.a.createElement("div",{className:"item"},r.a.createElement("div",{className:"in"},r.a.createElement("div",null,"Subsets"),r.a.createElement("span",{className:"text-muted"},"0")))),r.a.createElement("li",null,r.a.createElement("div",{className:"item"},r.a.createElement("div",{className:"in"},r.a.createElement("div",null,"Accounts"),r.a.createElement("span",{className:"text-muted"},"1")))),r.a.createElement("li",null,r.a.createElement("div",{className:"item"},r.a.createElement("div",{className:"in"},r.a.createElement("div",null,"Month blocks"),r.a.createElement("span",{className:"text-muted"},"123")))),r.a.createElement("li",null,r.a.createElement("div",{className:"button item"},r.a.createElement("div",{className:"in"},r.a.createElement("div",null,"Remove all data",r.a.createElement("div",{className:"text-muted"},"This action cannot be undone"))))))))}},{path:pn.licenses(),component:function(){return r.a.createElement(r.a.Fragment,null,r.a.createElement(v,{title:"Licenses"}),r.a.createElement(z,{className:gn.a.licenses},r.a.createElement("ul",{className:"listview link-listview inset mt-2"},r.a.createElement(vn,{link:"https://reactjs.org/",title:"ReactJS",author:"Facebook Open Source",license:"MIT License"}),r.a.createElement(vn,{link:"https://reatom.js.org/",title:"Reatom state manager",author:"Arutyunyan Artyom",license:"MIT License"}),r.a.createElement(vn,{link:"https://iconstore.co/icons/dripicons-v2/",title:'Icons "Dripicons" Version 2.0',author:"Amit Jakhu",license:"CC BY 4.0"}))))}}]),On=d.b,jn=d.c,wn=[{path:pn.home(),exact:!0,icon:p.walletOutline,label:"Wallets"},{path:pn.transactions.add(),icon:p.addCircleOutline,label:"New item"},{path:pn.menu(),icon:p.ellipsisHorizontalOutline,label:"Menu"}],En=function(){return r.a.createElement("div",{className:"appBottomMenu"},wn.map((function(e){return r.a.createElement(jn,{to:e.path,exact:e.exact,className:"item"},r.a.createElement("div",{className:"col"},r.a.createElement(g,{icon:e.icon,role:"img",className:"md hydrated","aria-label":"pie chart outline"}),r.a.createElement("strong",null,e.label)))})))};var xn,kn=n(4),Nn=n.n(kn),Sn=n(46);function _n(e,t,n){Array.isArray(n)?n.forEach((function(n){return _n(e,t,n)})):e.addEventListener(n,(function(e){console.log('[eventLogger] Emitter: "'.concat(t,'", event "').concat(n,'":'),e)}))}!function(e){e[e.Initializing=0]="Initializing",e[e.Upgrading=1]="Upgrading",e[e.Migrating=2]="Migrating",e[e.Ready=3]="Ready",e[e.Failed=4]="Failed"}(xn||(xn={}));var An=function(){function e(t,n){Object(B.a)(this,e),this.db=t,this.scheme=n,this.transaction=void 0,this.storage=void 0,this.transaction=t.transaction(n.collection,"readwrite"),_n(this.transaction,"transaction",["abort","complete","error"]),this.storage=this.transaction.objectStore(n.collection)}return Object(V.a)(e,[{key:"add",value:function(e){var t=this;return new Promise((function(n,a){var r=t.storage.add(e);_n(r,"request",["error","success"]),r.onsuccess=function(e){return n(e.target.result)},r.onerror=function(e){return a(e)}}))}},{key:"get",value:function(e){var t=this;return new Promise((function(n,a){var r=t.storage.get(e);_n(r,"request",["error","success"]),r.onsuccess=function(e){return n(e.target.result)},r.onerror=function(e){return a(e)}}))}},{key:"getAll",value:function(e,t){var n=this;return Array.isArray(e)?Promise.all(e.map((function(e){return n.get(e)}))):new Promise((function(t,a){var r=n.storage.getAll(e);_n(r,"request",["error","success"]),r.onsuccess=function(e){return t(e.target.result)},r.onerror=function(e){return a(e)}}))}},{key:"update",value:function(e){var t=this;return new Promise((function(n,a){var r=t.storage.put(e);_n(r,"request",["error","success"]),r.onsuccess=function(e){return n(e.target.result)},r.onerror=function(e){return a(e)}}))}}]),e}(),In=function(){function e(t,n,a,r){if(Object(B.a)(this,e),this.schemes=n,this.onInstall=a,this.onUpgrade=r,this.listeners=[],this._status=xn.Initializing,this.db=null,!window.indexedDB)throw new Error("IndexedDB not supported");n.forEach((function(e){if(n.find((function(t){return t!==e&&t.collection===e.collection})))throw new Error('Collection "'.concat(e.collection,'" used in different schemes.\nYou can use collection only in one scheme'))}));var c=Math.max.apply(Math,[1].concat(Object(k.a)(n.map((function(e){return e.dbVersion})))));console.log("Start DB with version: ".concat(c,", count of models: ").concat(n.length)),this.openDB(t,c).then((function(){return console.log("Successfully open DB")}),(function(e){return console.error("Failed to open DB",e)}))}return Object(V.a)(e,[{key:"status",get:function(){return this._status}}]),Object(V.a)(e,[{key:"transaction",value:function(e){if(this._status!==xn.Ready&&this._status!==xn.Migrating)throw new Error("Database not ready");return this.getAccessor(e)}},{key:"addStatusListener",value:function(e){var t=this;this.listeners.push(e),setTimeout((function(){return e(t.status)}))}},{key:"removeStatusListener",value:function(e){this.listeners=this.listeners.filter((function(t){return t!==e}))}},{key:"setStatus",value:function(e){console.log('change DB status to "'.concat(xn[e],'"')),e!==this._status&&(console.log('Change DB status from "'.concat(xn[this._status],'" to "').concat(xn[e],'"')),this._status=e,this.listeners.forEach((function(t){return t(e)})))}},{key:"getAccessor",value:function(e){if(this.db)return new An(this.db,e);throw new Error("Cannot create accessor for closed database")}},{key:"openDB",value:function(e,t){var n=this;return this.setStatus(xn.Initializing),new Promise((function(a,r){var c=window.indexedDB.open(e,t),i=!1,o=t,s=t;_n(c,"openRequest",["upgradeneeded","blocked","error","success"]),c.addEventListener("upgradeneeded",(function(e){n.setStatus(xn.Upgrading),i=!0,o=e.oldVersion,s=e.newVersion,o?console.log("Upgrade DB from version ".concat(o)):console.log("Initialize DB");var t=n.db=e.target.transaction;console.log(t);var a=n.db=e.target.result;console.log(Array.from(a.objectStoreNames)),n.schemes.forEach((function(e){var n;try{n=t.objectStore(e.collection)}catch(r){console.warn(r),n=a.createObjectStore(e.collection,{keyPath:e.key})}console.log(n),e.upgrade&&e.upgrade(n,o,s)}))})),c.addEventListener("success",function(){var e=Object(Sn.a)(Nn.a.mark((function e(t){return Nn.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n.db=t.target.result,!i){e.next=11;break}if(n.setStatus(xn.Migrating),o){e.next=8;break}return e.next=6,n.onInstall(n);case 6:e.next=11;break;case 8:if(!n.onUpgrade){e.next=11;break}return e.next=11,n.onUpgrade(n,o,s);case 11:n.setStatus(xn.Ready),a();case 13:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),c.addEventListener("error",(function(e){console.log(e),n.setStatus(xn.Failed),r(e)}))}))}}]),e}();var Mn,Tn={collection:"accounts",dbVersion:1,key:"id",upgrade:function(e,t,n){console.log("update account from ",t,n)}},Dn={collection:"months",dbVersion:1,key:"id",upgrade:function(e,t,n){console.log("update months from ",t,n)}},Cn=n(66);!function(e){e[e.NoSynced=0]="NoSynced",e[e.Prepared=1]="Prepared",e[e.Syncing=2]="Syncing",e[e.FullySynced=3]="FullySynced",e[e.Fixed=4]="Fixed"}(Mn||(Mn={}));var zn=U.forObject({balance:q,income:q,expense:q}),Bn=U.forObject({balance:q,income:q,expense:q,balanceOnStart:q,balanceOnEnd:q}),Vn={balance:q.empty,income:q.empty,expense:q.empty},Ln=Object(de.a)(Object(de.a)({},Vn),{},{balanceOnStart:q.empty,balanceOnEnd:q.empty});Object.freeze(Vn),Object.freeze(Ln);var Pn,Fn,Jn,Un,Rn,Hn,Wn,Gn,Yn,qn,$n,Xn,Qn,Zn,Kn,ea,ta,na=U.maybe(U.forObject({id:String,month:String,summary:Bn,prevMonths:[String],prevVersions:[String],dataHash:String})),aa=n(369),ra=n(67),ca=n.n(ra),ia={income:q.empty,expense:q.empty,balance:q.empty};function oa(e){var t=e.reduce((function(e,t){var n=Object(J.a)(e,2),a=n[0],r=n[1];switch(t.type){case re.Removed:return[a,r];case re.Income:return[a,r.add(t.amount)];case re.Expense:return[a.add(t.amount),r];default:throw new Error("Can't process type \"".concat(re[t.type],'"'))}}),[q.empty,q.empty]),n=Object(J.a)(t,2),a=n[0],r=n[1];return{balance:r.sub(a),expense:a,income:r}}function sa(e,t){var n=e.balance.add(t.balance),a=e.expense.add(t.expense),r=e.income.add(t.income);if(!r.sub(a).equal(n)){if(!ua(e))throw new Error('"Base" summary invalid');if(!ua(t))throw new Error('"Add" summary invalid');throw new Error("Incorrect balance")}return{balance:n,expense:a,income:r}}function ua(e){return e.income.sub(e.expense).equal(e.balance)}var la,da,ma,fa,ha,pa,ba,ga,va,ya,Oa,ja,wa,Ea,xa,ka,Na,Sa,_a,Aa,Ia,Ma,Ta,Da,Ca,za,Ba,Va,La,Pa,Fa,Ja,Ua,Ra,Ha,Wa,Ga=(Pn=H((function(e){return new Ga(e)})),Fn=W(String),Jn=W(q),Un=W(Number),Rn=W(String),Hn=W(String),Wn=W(Number),Gn=W(Number),Pn((qn=function(){function e(t){Object(B.a)(this,e),Object(Mt.a)(this,"id",$n,this),Object(Mt.a)(this,"amount",Xn,this),Object(Mt.a)(this,"type",Qn,this),Object(Mt.a)(this,"category",Zn,this),Object(Mt.a)(this,"title",Kn,this),Object(Mt.a)(this,"createdAt",ea,this),Object(Mt.a)(this,"updatedAt",ta,this),Object.assign(this,t)}return Object(V.a)(e,null,[{key:"createWithID",value:function(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:re.Removed,a=arguments.length>2?arguments[2]:void 0,r=arguments.length>3?arguments[3]:void 0,c=new e({id:t,amount:q.empty,type:n,category:"",title:"",createdAt:0,updatedAt:0});return a?c.setAmount(a,r):c}},{key:"create",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:re.Removed,n=arguments.length>1?arguments[1]:void 0,a=arguments.length>2?arguments[2]:void 0,r=Object(aa.a)(),c=new e({id:r,amount:q.empty,type:t,category:"",title:"",createdAt:0,updatedAt:0});return n?c.setAmount(n,a):c}},{key:"fromJSON",value:function(t){return U.get(e).decode(t)}},{key:"toJSON",value:function(e){return e.toJSON()}}]),Object(V.a)(e,[{key:"toJSON",value:function(){return U.get(e).encode(this)}},{key:"setAmount",value:function(t,n){var a;return a="string"!==typeof t&&"number"!==typeof t||"string"!==typeof n?q.from(t):q.create(t,n),new e(Object(de.a)(Object(de.a)({},this),{},{amount:a}))}},{key:"setType",value:function(t){return new e(Object(de.a)(Object(de.a)({},this),{},{type:t}))}},{key:"setCategory",value:function(t){return new e(Object(de.a)(Object(de.a)({},this),{},{category:t}))}},{key:"setTitle",value:function(t){return new e(Object(de.a)(Object(de.a)({},this),{},{title:t}))}},{key:"setCreatedAt",value:function(t){return new e(Object(de.a)(Object(de.a)({},this),{},{createdAt:t}))}},{key:"setUpdatedAt",value:function(t){return new e(Object(de.a)(Object(de.a)({},this),{},{updatedAt:t}))}}]),e}(),$n=Object(Tt.a)(qn.prototype,"id",[Fn],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return""}}),Xn=Object(Tt.a)(qn.prototype,"amount",[Jn],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return q.empty}}),Qn=Object(Tt.a)(qn.prototype,"type",[Un],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return re.Removed}}),Zn=Object(Tt.a)(qn.prototype,"category",[Rn],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return""}}),Kn=Object(Tt.a)(qn.prototype,"title",[Hn],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return""}}),ea=Object(Tt.a)(qn.prototype,"createdAt",[Wn],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),ta=Object(Tt.a)(qn.prototype,"updatedAt",[Gn],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),Yn=qn))||Yn),Ya=(la=H((function(e){return new Ya(e)})),da=W(String),ma=W(zn),fa=W([Ga]),la((pa=function(){function e(t){Object(B.a)(this,e),Object(Mt.a)(this,"date",ba,this),Object(Mt.a)(this,"summary",ga,this),Object(Mt.a)(this,"transactions",va,this),this.dateTime=new Date,Object.assign(this,t),this.dateTime=function(e){var t=e.match(/^(\d{4})-(\d{2})-(\d{2})$/);if(!t)throw new Error('Invalid DayDate "'.concat(e,'"'));var n=+t[1],a=+t[2]-1,r=+t[3],c=new Date(n,a,r,12,0,0);if(c.getFullYear()!==n)throw new Error('Invalid year in "'.concat(e,'"'));if(c.getMonth()!==a)throw new Error('Invalid month in "'.concat(e,'"'));if(c.getDate()!==r)throw new Error('Invalid date in "'.concat(e,'"'));return c}(this.date)}return Object(V.a)(e,null,[{key:"create",value:function(t){return new e({date:t})}},{key:"fromJSON",value:function(t){return U.get(e).decode(t)}}]),Object(V.a)(e,[{key:"toJSON",value:function(){return U.get(e).encode(this)}},{key:"addTransaction",value:function(t){var n=[].concat(Object(k.a)(this.transactions),[t]),a=oa(n);return new e(Object(de.a)(Object(de.a)({},this),{},{summary:a,transactions:n}))}}]),e}(),ba=Object(Tt.a)(pa.prototype,"date",[da],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return""}}),ga=Object(Tt.a)(pa.prototype,"summary",[ma],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return Vn}}),va=Object(Tt.a)(pa.prototype,"transactions",[fa],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),ha=pa))||ha),qa=n(370),$a=(ya=H((function(e){return new $a(e)})),Oa=W(String),ja=W(Number),wa=W(String),Ea=W(String),xa=W(Number),ka=W([String]),Na=W([String]),Sa=W(String),_a=W(Number),Aa=W(Bn),Ia=W([Ya]),Ma=W(Number),ya((Da=function(){function e(t){Object(B.a)(this,e),Object(Mt.a)(this,"id",Ca,this),Object(Mt.a)(this,"version",za,this),Object(Mt.a)(this,"account",Ba,this),Object(Mt.a)(this,"month",Va,this),Object(Mt.a)(this,"syncStatus",La,this),Object(Mt.a)(this,"prevMonths",Pa,this),Object(Mt.a)(this,"prevVersions",Fa,this),Object(Mt.a)(this,"dataHash",Ja,this),Object(Mt.a)(this,"timestamp",Ua,this),this.updatedAt=new Date(0),Object(Mt.a)(this,"summary",Ra,this),Object(Mt.a)(this,"days",Ha,this),Object(Mt.a)(this,"daysInMonth",Wa,this),Object.assign(this,t),this.dataHash=this.getDataHash(),this.id=e.generateID(this,this.dataHash)}return Object(V.a)(e,[{key:"toJSON",value:function(){return U.get(e).encode(this)}}],[{key:"createFirstBlock",value:function(t,n,a){return new e({timestamp:a,account:t,month:n,daysInMonth:Object(qa.a)(ln(n)),days:[],syncStatus:Mn.Fixed})}},{key:"generateID",value:function(e,t){if(1!==e.version)throw new Error("Version ".concat(e.version," not supported"));var n={version:e.version,account:e.account,prevMonths:e.prevMonths,prevVersions:e.prevVersions,dataHash:t||e.getDataHash()},a=ca()(JSON.stringify(n)).toString(),r=ln(e.month),c=(12*(r.getFullYear()-1970)+r.getMonth()).toString(16).padStart(3,"0"),i=(e.timestamp/1e3).toString(16).substr(0,11).replace(".",""),o="".concat(c).concat(i).concat(a).substr(0,32);return o=[o.substr(0,8),o.substr(8,4),o.substr(12,4),o.substr(16,4),o.substr(20,12)].join("-")}},{key:"merge",value:function(e,t){throw new Error}},{key:"getBrief",value:function(e){return{id:e.id,month:e.month,summary:e.summary,prevMonths:e.prevMonths,prevVersions:e.prevVersions,dataHash:e.dataHash}}},{key:"fromJSON",value:function(t){return U.get(e).decode(t)}}]),Object(V.a)(e,[{key:"getBrief",value:function(){return e.getBrief(this)}},{key:"getDataHash",value:function(){if(!this.days.length)return"0000000000000000000000000000000000000000";var e={days:this.days.map((function(e){return e.toJSON()}))};return ca()(JSON.stringify(e)).toString()}},{key:"changeSyncStatus",value:function(t){if(t===this.syncStatus)return this;switch(this.syncStatus){case Mn.NoSynced:if(t===Mn.Prepared)return new e(Object(de.a)(Object(de.a)({},this),{},{syncStatus:t}));break;case Mn.Prepared:if(t===Mn.Syncing)return new e(Object(de.a)(Object(de.a)({},this),{},{syncStatus:t}));break;case Mn.Syncing:if(t===Mn.FullySynced)return new e(Object(de.a)(Object(de.a)({},this),{},{syncStatus:t}));break;case Mn.FullySynced:}throw new Error('Can not change sync status from "'.concat(Mn[this.syncStatus],'" to "').concat(Mn[t],'"'))}},{key:"createDay",value:function(e){if("number"===typeof e)return Ya.create(this.createDayDate(e));if(e.substr(0,7)===this.month)return Ya.create(e);throw new Error('Date "'.concat(e,'" not of month "').concat(this.month,'"'))}},{key:"createDayDate",value:function(e){return this.month+"-"+e.toString().padStart(2,"0")}},{key:"createNextBlock",value:function(t,n){var a=Object(qa.a)(ln(t)),r={balanceOnStart:this.summary.balanceOnEnd,income:q.empty,expense:q.empty,balanceOnEnd:this.summary.balanceOnEnd,balance:q.empty};return new e({account:this.account,month:t,prevMonths:[this.id],prevVersions:[],timestamp:n,summary:r,days:[],daysInMonth:a,syncStatus:Mn.Fixed})}},{key:"isDateOfMonth",value:function(e){return e.substr(0,7)===this.month}},{key:"recalculateWithNewStartBalance",value:function(t){return new e(Object(de.a)(Object(de.a)({},this),{},{summary:Xa(t,this.days)}))}},{key:"updatePrevMonths",value:function(t,n){var a=this;if(1!==t.length)throw new Error("Sorry, can not process not one prevMonths");if(t[0].month>=this.month)throw new Error("All prevMonths must be earlier then updating month");return t.length===this.prevMonths.length&&t.every((function(e,t){return a.prevMonths[t]===e.id}))?this:new e(Object(de.a)(Object(de.a)({},this),{},{timestamp:n,prevMonths:t.map((function(e){return e.id})),prevVersions:this.syncStatus?this.id?[this.id]:[]:this.prevVersions||[],summary:Xa(q.from(t[0].summary.balanceOnEnd),this.days)}))}},{key:"getDay",value:function(e){return this.days.find((function(t){return t.date===e}))||this.createDay(e)}},{key:"updateDay",value:function(t){if(!(t instanceof Ya))throw new Error("Cannot update month, newDay must be instance of Day");if(!this.isDateOfMonth(t.date))throw new Error('Day "'.concat(t.date,'" not of month "').concat(this.month,'"'));var n=this.days.slice(),a=this.days.findIndex((function(e){return e.date===t.date}));-1===a?(n.push(t),n.sort((function(e,t){return e.date>t.date?1:-1}))):n.splice(a,1,t);var r=Xa(this.summary.balanceOnStart,n);return new e(Object(de.a)(Object(de.a)({},this),{},{syncStatus:Mn.NoSynced,days:n,summary:r,prevVersions:this.syncStatus?this.id?[this.id]:[]:this.prevVersions||[]}))}}]),e}(),Ca=Object(Tt.a)(Da.prototype,"id",[Oa],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return""}}),za=Object(Tt.a)(Da.prototype,"version",[ja],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1}}),Ba=Object(Tt.a)(Da.prototype,"account",[wa],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return""}}),Va=Object(Tt.a)(Da.prototype,"month",[Ea],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return""}}),La=Object(Tt.a)(Da.prototype,"syncStatus",[xa],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return Mn.NoSynced}}),Pa=Object(Tt.a)(Da.prototype,"prevMonths",[ka],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),Fa=Object(Tt.a)(Da.prototype,"prevVersions",[Na],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),Ja=Object(Tt.a)(Da.prototype,"dataHash",[Sa],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return""}}),Ua=Object(Tt.a)(Da.prototype,"timestamp",[_a],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),Ra=Object(Tt.a)(Da.prototype,"summary",[Aa],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return Ln}}),Ha=Object(Tt.a)(Da.prototype,"days",[Ia],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),Wa=Object(Tt.a)(Da.prototype,"daysInMonth",[Ma],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),Ta=Da))||Ta);function Xa(e,t){var n=t.reduce((function(e,t){return sa(e,t.summary)}),Vn);return Object(de.a)(Object(de.a)({},n),{},{balanceOnStart:e,balanceOnEnd:e.add(n.balance)})}var Qa=n(53);function Za(e,t,n){e=$a.getBrief(e),t=t.map($a.getBrief),n=n.map($a.getBrief);var a=er(e,t),r=a.chain,c=a.completed;if(0===n.length){if(c)return r;throw Object(Cn.a)(Fr,Object(k.a)(r.pop().prevMonths))}if(c){if(!Ka(r[r.length-1],n[n.length-1],t))throw new Jr(n,r)}else{var i=r[r.length-1].prevMonths[0],o=n.findIndex((function(e){return e.id===i}));if(console.log("completed",c),console.log("preFirstIndex",o),console.log("head",[e.month,e.id,e.prevMonths,e.prevVersions].join(" ")),console.log("adds"),console.log(t.map((function(e){return[e.month,e.id,e.prevMonths,e.prevVersions].join(" ")}))),console.log("old chain"),console.log(n.map((function(e){return[e.month,e.id,e.prevMonths,e.prevVersions].join(" ")}))),-1===o)throw new Fr(i)}var s=new Set;n.forEach((function(e){return s.add(e.month)})),r.forEach((function(e){return s.add(e.month)}));var u=Array.from(s.keys());u.sort();var l=u.map((function(e){var a=r.find((function(t){return t.month===e})),c=n.find((function(t){return t.month===e})),i=a?Ka(a,c,t):null;if(!1===i)throw new Jr(n,r);return{month:e,oldEl:c,element:a,check:i}}));console.log("table"),console.table(l),l.reverse();var d=l.map((function(e){return e.element||e.oldEl}));if(function(e){if(0===e.length)return!1;console.log("check chain"),console.table(e);for(var t=0;t<e.length-1;t++){var n=e[t],a=e[t+1];if(a.month>=n.month)throw new Pr("month must be less then ".concat(n.month),e,a);if(!n.prevMonths.length)throw new Pr("unexpected end of chain",e,n);if(n.prevMonths.length>1)throw new Pr("can not process month with not 1 prevMonths",e,n);if(n.prevMonths[0]!==a.id)throw new Pr("invalid prevMonth",e,n)}}(d),d[0].id!==e.id)throw new Error("Invalid Head month");return d}function Ka(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[];if(!t)return!0;if(e.month!==t.month)return!1;var a=[t].concat(Object(k.a)(n));if(e.prevVersions.every((function(e,n){return t.prevVersions[n]===e})))return!0;for(var r=function(){if(0===e.prevVersions.length)return{v:!1};if(e.prevVersions.length>1)throw new Error("\u042f \u043d\u0435 \u0443\u043c\u0435\u044e \u0432\u043e \u043c\u043d\u043e\u0433\u043e \u043f\u0440\u0435\u0434\u044b\u0434\u0443\u0449\u0438\u0445 \u043c\u0435\u0441\u044f\u0446\u0435\u0432");var t=e.prevVersions[0],n=a.find((function(e){return e.id===t}));if(!n)throw new Fr(t);e=n};e.id!==t.id;){var c=r();if("object"===typeof c)return c.v}return!0}function er(e,t){for(var n=[],a=e,r=function(){if(n.push(a),0===a.prevMonths.length)return{v:{completed:!0,chain:n}};if(1!==a.prevMonths.length)throw new Error("Can not process merged month ".concat(a.id," (").concat(a.month,"): more then 1 prevMonths"));if(a.prevVersions.length>1)throw new Error("Can not process merged month ".concat(a.id," (").concat(a.month,"): more then 1 prevVersions"));var e=a.prevMonths[0];return(a=t.find((function(t){return t.id===e})))?void 0:{v:{completed:!1,chain:n}}};;){var c=r();if("object"===typeof c)return c.v}}var tr,nr,ar,rr,cr,ir,or,sr,ur,lr,dr,mr,fr,hr,pr,br,gr,vr,yr,Or,jr,wr,Er,xr,kr,Nr,Sr,_r,Ar,Ir,Mr,Tr,Dr,Cr,zr,Br,Vr,Lr,Pr=function(e){Object(At.a)(n,e);var t=Object(It.a)(n);function n(e,a,r){var c;return Object(B.a)(this,n),(c=t.call(this,"Invalid chain: ".concat(e," at ").concat(r.id," (").concat(r.month,")"))).reason=e,c.chain=a,c.invalidMonth=r,c}return n}(Object(Qa.a)(Error)),Fr=function(e){Object(At.a)(n,e);var t=Object(It.a)(n);function n(){var e;Object(B.a)(this,n);for(var a=arguments.length,r=new Array(a),c=0;c<a;c++)r[c]=arguments[c];return(e=t.call(this,"Required months: ".concat(r.join(", ")))).ids=void 0,e.ids=r,e}return n}(Object(Qa.a)(Error)),Jr=function(e){Object(At.a)(n,e);var t=Object(It.a)(n);function n(e,a){var r;return Object(B.a)(this,n),(r=t.call(this,["Can not fast forward","from ".concat(e[0].id," (").concat(e[0].month,", length ").concat(e.length,")"),"to ".concat(a[0].id," (").concat(a[0].month,", length ").concat(a.length,")")].join("\n"))).from=e,r.to=a,r}return n}(Object(Qa.a)(Error)),Ur=(tr=H((function(e){return new Ur(e)})),nr=W(String),ar=W(String),rr=W(q),cr=W(q),ir=W(q),or=W(String),sr=W(na),ur=W([na]),tr((dr=function(){function e(t){return Object(B.a)(this,e),Object(Mt.a)(this,"id",mr,this),Object(Mt.a)(this,"name",fr,this),Object(Mt.a)(this,"balance",hr,this),Object(Mt.a)(this,"income",pr,this),Object(Mt.a)(this,"expense",br,this),Object(Mt.a)(this,"categoriesBlockId",gr,this),Object(Mt.a)(this,"head",vr,this),Object(Mt.a)(this,"months",yr,this),this.fullMonths=Object(fe.a)(),Object.assign(this,t)}return Object(V.a)(e,null,[{key:"create",value:function(t,n){return new e({id:n||Object(aa.a)(),name:t})}},{key:"fromJSON",value:function(t){return U.get(e).decode(t)}},{key:"toJSON",value:function(e){return e.toJSON()}}]),Object(V.a)(e,[{key:"toJSON",value:function(){return U.get(e).encode(this)}},{key:"UNSAFE_forceSetHead",value:function(t,n){var a=er(t,n),r=a.chain;if(!a.completed){var c=r.pop(),i=[].concat(Object(k.a)(c.prevMonths),Object(k.a)(c.prevVersions)).filter((function(e){return!n.find((function(t){return t.id!==e}))}));throw Object(Cn.a)(Fr,Object(k.a)(i))}var o=r.reduce((function(e,t){return sa(e,t.summary)}),ia),s=o.income,u=o.expense,l=o.balance;return new e(Object(de.a)(Object(de.a)({},this),{},{head:t,months:r.map($a.getBrief),balance:l,income:s,expense:u}))}},{key:"updateHead",value:function(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],a=Za(t,n,this.months),r=a.reduce((function(e,t){return sa(e,t.summary)}),ia),c=r.income,i=r.expense,o=r.balance;return new e(Object(de.a)(Object(de.a)({},this),{},{head:$a.getBrief(t),months:a.map($a.getBrief),balance:o,income:c,expense:i}))}},{key:"UNSAFE_updateCategoriesBlock",value:function(t){if(t.account!==this.id)throw new Error("CategoriesBlock.id must be equal to Account.id");return new e(Object(de.a)(Object(de.a)({},this),{},{categoriesBlockId:t.id}))}},{key:"checkChain",value:function(){if(!this.head&&0===this.months.length)return!0;var e=er(this.head,this.months),t=e.chain;return!!e.completed&&t.length===this.months.length}}]),e}(),mr=Object(Tt.a)(dr.prototype,"id",[nr],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return""}}),fr=Object(Tt.a)(dr.prototype,"name",[ar],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return""}}),hr=Object(Tt.a)(dr.prototype,"balance",[rr],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return q.empty}}),pr=Object(Tt.a)(dr.prototype,"income",[cr],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return q.empty}}),br=Object(Tt.a)(dr.prototype,"expense",[ir],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return q.empty}}),gr=Object(Tt.a)(dr.prototype,"categoriesBlockId",[or],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return"default"}}),vr=Object(Tt.a)(dr.prototype,"head",[sr],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),yr=Object(Tt.a)(dr.prototype,"months",[ur],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),lr=dr))||lr),Rr=(Or=H((function(e){return new Rr(e)})),jr=W(String),wr=W(String),Er=W(Number),xr=W(Number),kr=W(String),Nr=W(Number),Sr=W([String]),_r=W([Ct]),Or((Ir=function(){function e(t){Object(B.a)(this,e),Object(Mt.a)(this,"id",Mr,this),Object(Mt.a)(this,"account",Tr,this),Object(Mt.a)(this,"version",Dr,this),Object(Mt.a)(this,"syncStatus",Cr,this),Object(Mt.a)(this,"dataHash",zr,this),Object(Mt.a)(this,"timestamp",Br,this),Object(Mt.a)(this,"prevVersions",Vr,this),this.updatedAt=new Date(0),Object(Mt.a)(this,"list",Lr,this),Object.assign(this,t),this.dataHash=e.getDataHash(this),this.id=e.generateID(this,this.dataHash),this.updatedAt=new Date(this.timestamp)}return Object(V.a)(e,null,[{key:"createInitialBlock",value:function(t,n,a){var r=n.flatMap((function(e){return[Ct.createInitial(e.name,e.defaultType,null,e.image,e.id)].concat(Object(k.a)(e.children.map((function(t){return Ct.createInitial(t.name,t.defaultType,e.id,t.image,t.id)}))))}));return new e({account:t,syncStatus:Mn.Prepared,timestamp:a,prevVersions:[],list:r})}},{key:"getDataHash",value:function(e){if(!e.list.length)return"0000000000000000000000000000000000000000";var t={list:e.list.map((function(e){return e.toJSON()}))};return ca()(JSON.stringify(t)).toString()}},{key:"generateID",value:function(t,n){if(1!==t.version)throw new Error("Version ".concat(t.version," not supported"));if(n||(n=e.getDataHash(t)),"0000000000000000000000000000000000000000"===n)return"00000000-0000-0000-0000-000000000000";var a={version:t.version,account:t.account,prevVersions:t.prevVersions,dataHash:n},r=ca()(JSON.stringify(a)).toString(),c="".concat(r).substr(0,32);return c=[c.substr(0,8),c.substr(8,4),c.substr(12,4),c.substr(16,4),c.substr(20,12)].join("-")}},{key:"merge",value:function(e){throw new Error("Not implemented")}},{key:"fromJSON",value:function(t){return U.get(e).decode(t)}},{key:"toJSON",value:function(e){return e.toJSON()}}]),Object(V.a)(e,[{key:"toJSON",value:function(){return U.get(e).encode(this)}},{key:"get",value:function(e){return this.list.find((function(t){return t.id===e}))}},{key:"getList",value:function(e){return e?this.list.filter((function(t){return t.parent===e})):this.list}},{key:"changeSyncStatus",value:function(t){if(t===this.syncStatus)return this;switch(this.syncStatus){case Mn.NoSynced:if(t===Mn.Prepared)return new e(Object(de.a)(Object(de.a)({},this),{},{syncStatus:t}));break;case Mn.Prepared:if(t===Mn.Syncing)return new e(Object(de.a)(Object(de.a)({},this),{},{syncStatus:t}));break;case Mn.Syncing:if(t===Mn.FullySynced)return new e(Object(de.a)(Object(de.a)({},this),{},{syncStatus:t}));break;case Mn.FullySynced:}throw new Error('Can not change sync status from "'.concat(Mn[this.syncStatus],'" to "').concat(Mn[t],'"'))}},{key:"addCategory",value:function(t){var n=this.list.find((function(e){return e.id===t.id}));if(n)throw new Hr("Category with this ID already exists",this,t);if(n=this.list.find((function(e){return e.name.toLowerCase()===t.name.toLowerCase()})))throw new Hr("Category with this Name already exists",this,t);return new e(Object(de.a)(Object(de.a)({},this),{},{syncStatus:Mn.NoSynced,list:[].concat(Object(k.a)(this.list),[t])}))}},{key:"updateCategory",value:function(t){if(this.list.find((function(e){return e.name.toLowerCase()===t.name.toLowerCase()&&e.id!==t.id})))throw new Hr('Category with name "'.concat(t.name,'" already exists'));if(!this.list.find((function(e){return e.id===t.id})))throw new Error('Category "'.concat(t.name,'" (').concat(t.id,") not found"));return new e(Object(de.a)(Object(de.a)({},this),{},{syncStatus:Mn.NoSynced,list:this.list.map((function(e){return e.id===t.id?t:e}))}))}},{key:"removeCategory",value:function(t){var n=this.list.find((function(e){return e.id===t}));if(!n)throw new Error("Category ".concat(t," not found"));return new e(Object(de.a)(Object(de.a)({},this),{},{syncStatus:Mn.NoSynced,list:this.list.filter((function(e){return e!==n}))}))}}]),e}(),Mr=Object(Tt.a)(Ir.prototype,"id",[jr],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return""}}),Tr=Object(Tt.a)(Ir.prototype,"account",[wr],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return""}}),Dr=Object(Tt.a)(Ir.prototype,"version",[Er],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1}}),Cr=Object(Tt.a)(Ir.prototype,"syncStatus",[xr],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return Mn.NoSynced}}),zr=Object(Tt.a)(Ir.prototype,"dataHash",[kr],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return""}}),Br=Object(Tt.a)(Ir.prototype,"timestamp",[Nr],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),Vr=Object(Tt.a)(Ir.prototype,"prevVersions",[Sr],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),Lr=Object(Tt.a)(Ir.prototype,"list",[_r],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Ar=Ir))||Ar),Hr=function(e){Object(At.a)(n,e);var t=Object(It.a)(n);function n(e,a,r){var c;return Object(B.a)(this,n),(c=t.call(this,e)).block=a,c.category=r,c}return n}(Object(Qa.a)(Error)),Wr=[{id:"default",name:"Default",image:"default",defaultType:re.Expense,children:[]},{id:"0000-111",name:"Home",image:"default",defaultType:re.Income,children:[]}],Gr={collection:"categories",dbVersion:1,key:"id",upgrade:function(e,t,n){console.log("update categories from ",t,n)}},Yr=new In("finman",[Gr,Tn,Dn],function(){var e=Object(Sn.a)(Nn.a.mark((function e(t){var n,a;return Nn.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=Ur.create("Default"),a=Rr.createInitialBlock(n.id,Wr,(new Date).getTime()),n=n.UNSAFE_updateCategoriesBlock(a),e.next=5,t.transaction(Tn).add(n.toJSON());case 5:return e.next=7,t.transaction(Gr).add(a.toJSON());case 7:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),qr={};function $r(e,t){if(qr[e.getType()])throw new Error('Can not add new handler for action "'.concat(e.getType(),'"'));qr[e.getType()]=t}$r(bt,(function(e){localStorage.setItem("currentAccount",e)})),$r(gt,(function(e,t){Yr.transaction(Tn).getAll().then((function(e){if(!e.length)return console.warn("No accounts exists");var n=e.map(Ur.fromJSON),a=localStorage.getItem("currentAccount");t.dispatch(vt({accounts:n})),t.dispatch(pe(a))}),(function(e){return t.dispatch(yt(e))}))})),$r(Ot,(function(e,t){Yr.transaction(Tn).update(e.toJSON()).then((function(n){return t.dispatch(jt(e.id))}),(function(n){return t.dispatch(wt({id:e.id,error:n}))}))})),$r(xe,(function(e,t){Yr.transaction(Dn).getAll(e).then((function(n){console.log(e),console.log(n);var a=n.map($a.fromJSON);t.dispatch(ke(a))}),(function(n){return t.dispatch(Ne({ids:e,error:n}))}))})),$r(Se,(function(e,t){var n=e.map((function(e){return e.id})),a=Yr.transaction(Dn);Promise.all(e.map((function(e){return a.update(e.toJSON())}))).then((function(){return t.dispatch(_e(n))}),(function(e){return t.dispatch(Ae({ids:n,error:e}))}))})),$r(kt,(function(e,t){Yr.transaction(Gr).get(e).then((function(e){return t.dispatch(Nt(Rr.fromJSON(e)))}),(function(e){return t.dispatch(St(e))}))}));var Xr=n(121),Qr=n(16),Zr=new(function(){function e(){Object(B.a)(this,e),this.sagas=[]}return Object(V.a)(e,[{key:"register",value:function(e){this.sagas.push(e)}},{key:"onAction",value:function(e,t){arguments.length>2&&void 0!==arguments[2]&&arguments[2];this.register(Nn.a.mark((function n(){return Nn.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,Object(Qr.f)(e.getType(),t);case 2:case"end":return n.stop()}}),n)})))}},{key:"start",value:function(e){console.log("Start ".concat(this.sagas.length," sagas"));var t={dispatch:e.dispatch,getState:function(){return e.getState},channel:Object(Xr.b)()};e.subscribe(t.channel.put),this.sagas.forEach((function(e){return Object(Xr.a)(t,e)}))}}]),e}());var Kr={call:function(e){var t=Nn.a.mark((function t(){var n,a,r,c=arguments;return Nn.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:for(n=c.length,a=new Array(n),r=0;r<n;r++)a[r]=c[r];return t.next=3,Qr.a.apply(void 0,[e].concat(a));case 3:return t.abrupt("return",t.sent);case 4:case"end":return t.stop()}}),t)}));return t.originalSaga=e,t}},ec=Nn.a.mark(tc);function tc(e){var t,n;return Nn.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("*** refreshSaga started"),e.next=3,Object(Qr.c)(gt());case 3:return e.next=5,Object(Qr.e)([vt.getType(),yt.getType()]);case 5:if((t=e.sent).type!==yt.getType()){e.next=8;break}return e.abrupt("return");case 8:return n=t.payload.accounts,e.next=11,Object(Qr.c)(ve(n));case 11:case"end":return e.stop()}}),ec)}Zr.onAction(ht,tc);var nc=n(94),ac=Nn.a.mark(ic),rc={selectAtom:Kr.call(ic),getTimestamp:Kr.call(sc)},cc=function(e){return Object(Qr.a)(ic,e)};function ic(e){return Nn.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,Object(Qr.d)((function(t){return t(e)}));case 2:return t.abrupt("return",t.sent);case 3:case"end":return t.stop()}}),ac)}var oc=function(){return Object(Qr.a)(sc)};function sc(){return(new Date).getTime()}var uc=Nn.a.mark(dc),lc={get:Kr.call(dc)};function dc(e){var t,n,a,r;return Nn.a.wrap((function(c){for(;;)switch(c.prev=c.next){case 0:return c.next=2,cc(Bt);case 2:if(!(n=c.sent).has(e)){c.next=5;break}return c.abrupt("return",null===(t=n.get(e))||void 0===t?void 0:t.block);case 5:return c.next=7,Object(Qr.c)(kt(e));case 7:return c.next=9,Object(Qr.e)([Nt.getType(),St.getType()]);case 9:if((a=c.sent).type!==Nt.getType()){c.next=18;break}if(a.payload.id!==e){c.next=16;break}return c.next=14,cc(Bt);case 14:return r=c.sent,c.abrupt("return",r.get(e));case 16:c.next=20;break;case 18:if(a.payload.id!==e){c.next=20;break}throw a.payload.error;case 20:c.next=7;break;case 21:case"end":return c.stop()}}),uc)}var mc=n(95),fc=function(e){Object(At.a)(n,e);var t=Object(It.a)(n);function n(e,a){var r;Object(B.a)(this,n);var c=Object(fe.a)(a.list.map((function(e){return[e.id,e]})));return(r=t.call(this,[e],c)).account=void 0,r.id=e.id,r.account=e,r.name=e.name,e.head?(r.lastMonthDate=e.head.month,r.firstMonthDate=e.months[e.months.length-1].month,r.months=e.months.map(hc),r.balance=e.head.summary.balanceOnEnd,r.income=q.empty,r.expense=q.empty,r):Object(mc.a)(r)}return Object(V.a)(n,[{key:"makeMonth",value:function(e){return new un(e.summary.balanceOnStart,e,this.account,this.categories)}}]),n}((function e(t,n){Object(B.a)(this,e),this.id=void 0,this.name=void 0,this.categories=Object(fe.a)(),this.firstMonthDate=null,this.lastMonthDate=null,this.months=[],this.tags=Object(fe.a)(),this.balance=q.empty,this.expense=q.empty,this.income=q.empty,this.categories=n}));function hc(e){return{id:e.id,month:e.month,balanceOnStart:e.summary.balanceOnStart,balanceOnEnd:e.summary.balanceOnEnd,balance:e.summary.balance,income:e.summary.income,expense:e.summary.expense,categories:Object(fe.a)(),tags:Object(fe.a)()}}var pc=Nn.a.mark(gc),bc=Nn.a.mark(vc);function gc(e){var t,n,a,r;return Nn.a.wrap((function(c){for(;;)switch(c.prev=c.next){case 0:console.log("*** updateAccountGripsSaga started"),t=e.payload,n=Object(nc.a)(t),c.prev=3,n.s();case 5:if((a=n.n()).done){c.next=11;break}return r=a.value,c.next=9,Object(Qr.b)(vc,be(r));case 9:c.next=5;break;case 11:c.next=16;break;case 13:c.prev=13,c.t0=c.catch(3),n.e(c.t0);case 16:return c.prev=16,n.f(),c.finish(16);case 19:case"end":return c.stop()}}),pc,null,[[3,13,16,19]])}function vc(e){var t,n,a;return Nn.a.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return t=e.payload,console.log("*** updateAccountGripSaga started for account ".concat(t.name)),r.delegateYield(lc.get(t.categoriesBlockId),"t0",3);case 3:return n=r.t0,console.log("loadCategories",n),a=new fc(t,n),r.next=8,Object(Qr.c)(ge(a));case 8:case"end":return r.stop()}}),bc)}Zr.onAction(ve,gc),Zr.onAction(be,vc);var yc=Nn.a.mark(Ec),Oc=Nn.a.mark(xc),jc=Nn.a.mark(kc),wc={get:Kr.call(xc),getByIds:Kr.call(Ec),save:Kr.call(kc)};function Ec(e){var t,n,a,r;return Nn.a.wrap((function(c){for(;;)switch(c.prev=c.next){case 0:return c.next=2,cc(xt);case 2:if(t=c.sent,console.log(t),n=e.filter((function(e){return!t.has(e)}))){c.next=7;break}return c.abrupt("return",e.map((function(e){return t.get(e)})));case 7:return c.next=9,Object(Qr.c)(xe(n));case 9:return c.next=11,Object(Qr.e)([ke,Ne]);case 11:if((a=c.sent).type!==ke.getType()){c.next=20;break}if(!a.payload.every((function(e,t){return e.id===n[t]}))){c.next=18;break}return c.delegateYield(Nn.a.mark((function t(){var n;return Nn.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,cc(xt);case 2:return n=t.sent,t.abrupt("return",{v:e.map((function(e){return n.get(e)}))});case 4:case"end":return t.stop()}}),t)}))(),"t0",15);case 15:if("object"!==typeof(r=c.t0)){c.next=18;break}return c.abrupt("return",r.v);case 18:c.next=22;break;case 20:if(!a.payload.ids.every((function(e,t){return e===n[t]}))){c.next=22;break}throw a.payload.error;case 22:c.next=9;break;case 23:case"end":return c.stop()}}),yc)}function xc(e,t){var n,a,r,c,i,o,s,u,l,d,m,f,h,p,b,g,v,y;return Nn.a.wrap((function(O){for(;;)switch(O.prev=O.next){case 0:if(e.head){O.next=6;break}return O.next=3,oc();case 3:return n=O.sent,console.log("timestamp",n),O.abrupt("return",$a.createFirstBlock(e.id,t,n));case 6:if(!(t>e.head.month)){O.next=15;break}return O.delegateYield(wc.getByIds([e.head.id]),"t0",8);case 8:return a=O.t0,r=Object(J.a)(a,1),c=r[0],O.next=13,oc();case 13:return i=O.sent,O.abrupt("return",c.createNextBlock(t,i));case 15:if(!((o=e.months.findIndex((function(e){return e.month===t})))>-1)){O.next=21;break}return s=e.months.slice(0,o+1).map((function(e){return e.id})),O.delegateYield(wc.getByIds(s),"t1",19);case 19:return u=O.t1,O.abrupt("return",u.pop());case 21:l=[],d=0;case 23:if(!(d<e.months.length)){O.next=31;break}if(m=e.months[d],l.push(m.id),!(m.month<t)){O.next=28;break}return O.abrupt("break",31);case 28:d++,O.next=23;break;case 31:return O.delegateYield(wc.getByIds(l),"t2",32);case 32:return f=O.t2,h=[],O.delegateYield(rc.getTimestamp(),"t3",35);case 35:for(p=O.t3,b=f.pop(),g=b=b.createNextBlock(t,p),h.push(b),v=f.pop();v;v=f.pop())y=v.updatePrevMonths([b],p),h.push(y),b=y;return O.delegateYield(wc.save(h),"t4",41);case 41:return O.abrupt("return",g);case 42:case"end":return O.stop()}}),Oc)}function kc(e){var t,n;return Nn.a.wrap((function(a){for(;;)switch(a.prev=a.next){case 0:return a.next=2,Object(Qr.c)(Se(e));case 2:t=Nn.a.mark((function t(){var n;return Nn.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,Object(Qr.e)([_e.getType(),Ae.getType()]);case 2:if(n=t.sent,console.log(n),n.type!==_e.getType()){t.next=9;break}if(!e.every((function(e,t){return n.payload[t]===e.id}))){t.next=7;break}return t.abrupt("return",{v:void 0});case 7:t.next=15;break;case 9:if(n.type!==Ae.getType()){t.next=14;break}if(!e.every((function(e,t){return n.payload.ids[t]===e.id}))){t.next=12;break}throw n.payload.error;case 12:t.next=15;break;case 14:console.error("invalid action "+n.type,n);case 15:case"end":return t.stop()}}),t)}));case 3:return a.delegateYield(t(),"t0",4);case 4:if("object"!==typeof(n=a.t0)){a.next=7;break}return a.abrupt("return",n.v);case 7:a.next=3;break;case 9:case"end":return a.stop()}}),jc)}var Nc=Nn.a.mark(Mc),Sc=Nn.a.mark(Tc),_c=Nn.a.mark(Dc),Ac=Nn.a.mark(Cc),Ic={select:Kr.call(Mc),getGrip:Kr.call(Tc),update:Kr.call(Dc),save:Kr.call(Cc)};function Mc(e){var t,n;return Nn.a.wrap((function(a){for(;;)switch(a.prev=a.next){case 0:return a.next=2,Object(Qr.d)((function(e){return e(Et)}));case 2:if(t=a.sent,n=t.accounts.get(e)){a.next=6;break}throw new Error('Account "'.concat(e,'" not found'));case 6:return a.abrupt("return",n);case 7:case"end":return a.stop()}}),Nc)}function Tc(e){var t,n;return Nn.a.wrap((function(a){for(;;)switch(a.prev=a.next){case 0:return a.next=2,Object(Qr.d)((function(e){return e(Oe)}));case 2:if(t=a.sent,n=t.accounts.get(e)){a.next=6;break}throw new Error('AccountGrip "'.concat(e,'" not found'));case 6:return a.abrupt("return",n);case 7:case"end":return a.stop()}}),Sc)}function Dc(e,t){var n,a,r,c,i,o,s,u,l,d,m,f,h,p,b;return Nn.a.wrap((function(g){for(;;)switch(g.prev=g.next){case 0:if(console.log("*** updateAccountSaga"),console.log(e.months.map((function(e){return e.month}))),console.log(t.month,t.id),r=e.months.findIndex((function(e){return e.month===t.month})),c=e.months.findIndex((function(e){return e.month<t.month})),e.head){g.next=10;break}return g.delegateYield(wc.save([t]),"t0",7);case 7:return i=e.updateHead(t),g.delegateYield(Ic.save(i),"t1",9);case 9:return g.abrupt("return",i);case 10:if(o=-1===r?c:r,s=e.months.slice(0,o+1).map((function(e){return e.id})),u=[t],console.log(s),!s.length){g.next=22;break}return g.t2=u.push,g.t3=u,g.t4=k.a,g.delegateYield(wc.getByIds(s),"t5",19);case 19:g.t6=g.t5,g.t7=(0,g.t4)(g.t6),g.t2.apply.call(g.t2,g.t3,g.t7);case 22:return g.delegateYield(rc.getTimestamp(),"t8",23);case 23:if(l=g.t8,console.log({currentMonthIndex:r,prevMonthIndex:c,toIndex:o,additions:u.map((function(e){return[e.month+" "+e.id]})),months:e.months.slice(0,o+1).map((function(e){return e.month}))}),d=[t],console.log("additional"),console.log(u.map((function(e){return"".concat(e.month," ").concat(e.id)}))),console.log("chain"),console.log(e.months.map((function(e){return"".concat(e.month," ").concat(e.id)}))),console.log("prevMonthIndex",c,null===(n=e.months[c])||void 0===n?void 0:n.month),-1!==r||-1!==c){g.next=33;break}throw new Error("Unexpection");case 33:if(-1!==r||-1===c){g.next=37;break}r=c,g.next=42;break;case 37:if((m=e.months[r]).month===t.month){g.next=40;break}throw new Error("somethings wrong");case 40:if(Ka(t,m)){g.next=42;break}throw new Error("somethings wrong");case 42:if(console.log("currentMonthIndex",r,null===(a=e.months[r])||void 0===a?void 0:a.month),-1===r){g.next=52;break}for(f=t,h=function(t){console.log("index",t,e.months[t].month);var n=e.months[t].id,a=u.find((function(e){return e.id===n}));if(!a)throw new Fr(n);f=a.updatePrevMonths([f],l),u.push(f),d.push(f)},p=r-1;p>=0;p--)h(p);return console.log("additionalMonths",u.map((function(e){return[e.month+" "+e.id]}))),b=e.updateHead(f,u),g.delegateYield(wc.save(d),"t9",50);case 50:return g.delegateYield(Ic.save(b),"t10",51);case 51:return g.abrupt("return",b);case 52:throw new Error("may be first");case 53:case"end":return g.stop()}}),_c)}function Cc(e){var t;return Nn.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,Object(Qr.c)(Ot(e));case 2:return n.next=4,Object(Qr.e)([jt,wt]);case 4:if((t=n.sent).type!==jt.getType()){n.next=10;break}if(t.payload!==e.id){n.next=8;break}return n.abrupt("return");case 8:n.next=12;break;case 10:if(t.payload.id!==e.id){n.next=12;break}throw t.payload.error;case 12:n.next=2;break;case 14:case"end":return n.stop()}}),Ac)}var zc=Nn.a.mark(Vc),Bc=Nn.a.mark(Lc);function Vc(e){var t,n,a,r;return Nn.a.wrap((function(c){for(;;)switch(c.prev=c.next){case 0:console.log("update Month grips saga"),t=e.payload,n=Object(nc.a)(t),c.prev=3,n.s();case 5:if((a=n.n()).done){c.next=11;break}return r=a.value,c.next=9,Object(Qr.b)(Lc,r);case 9:c.next=5;break;case 11:c.next=16;break;case 13:c.prev=13,c.t0=c.catch(3),n.e(c.t0);case 16:return c.prev=16,n.f(),c.finish(16);case 19:case"end":return c.stop()}}),zc,null,[[3,13,16,19]])}function Lc(e){var t,n;return Nn.a.wrap((function(a){for(;;)switch(a.prev=a.next){case 0:return console.log("update Month grip saga for ".concat(e.month)),console.log("123456"),a.delegateYield(Ic.getGrip(e.account),"t0",3);case 3:return t=a.t0,console.log("123"),n=t.makeMonth(e),console.log("234"),a.next=9,Object(Qr.c)(He(n));case 9:console.log("345");case 10:case"end":return a.stop()}}),Bc)}Zr.onAction(ke,Vc);var Pc=Nn.a.mark(Fc);function Fc(e){var t,n,a,r,c,i,o;return Nn.a.wrap((function(s){for(;;)switch(s.prev=s.next){case 0:return console.log("*** addTransactionSaga started"),t=e.payload,s.delegateYield(Ic.select(t.account),"t0",3);case 3:return n=s.t0,s.delegateYield(wc.get(n,dn(t.date)),"t1",5);case 5:return a=s.t1,console.log("addTransactionSaga",a.id,a.prevVersions),r=Ga.create(t.type,t.amount,"RUB"),t.title&&(r=r.setTitle(t.title)),t.category&&(r=r.setCategory(t.category)),c=a.getDay(t.date).addTransaction(r),i=a.updateDay(c),console.log("updatedMonth",i.id,i.prevVersions),s.delegateYield(Ic.update(n,i),"t2",14);case 14:return o=s.t2,console.log("*** addTransactionSaga complete"),s.next=18,Object(Qr.c)(be(o));case 18:return s.abrupt("return",o);case 19:case"end":return s.stop()}}),Pc)}Zr.onAction(Lt,Fc);var Jc=Nn.a.mark(Uc);function Uc(){var e;return Nn.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:console.log("init transactionUpdateSaga");case 1:return t.next=4,Object(Qr.e)(vt.getType());case 4:e=t.sent,console.log("load successssssss",e),t.next=1;break;case 8:case"end":return t.stop()}}),Jc)}Zr.register(Uc);var Rc,Hc=function(){return function(e){console.log("useDBReady");var t=function(t){console.log(xn[t]),t===xn.Ready&&e()};Object(a.useEffect)((function(){return Yr.addStatusListener(t),function(){return Yr.removeStatusListener(t)}}))}(Object(o.b)((function(){var e;return console.log("*** refreshAllHandler"),(e=Vt).subscribe((function(t){console.log(t),qr[t.type]&&qr[t.type](t.payload,e)})),console.log("*** refreshAllHandler complete"),ht()}),[])),r.a.createElement("div",{className:u.a.App},r.a.createElement(d.a,null,r.a.createElement(l.d,null,yn.map((function(e,t){return r.a.createElement(l.b,Object.assign({},e,{key:t}))})),r.a.createElement(l.a,{to:pn.home()})),r.a.createElement(En,null)))};(Rc=Vt).dispatch(ft(navigator.onLine)),window.addEventListener("online",(function(){return Rc.dispatch(ft(!0))})),window.addEventListener("offline",(function(){return Rc.dispatch(ft(!1))})),Zr.start(Vt);Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));i.a.render(r.a.createElement(r.a.StrictMode,null,r.a.createElement(o.a.Provider,{value:Vt},r.a.createElement(Hc,null))),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()})).catch((function(e){console.error(e.message)}))},41:function(e,t,n){e.exports={head:"MonthViewWidget_head__2tdqX",title:"MonthViewWidget_title__2uHWT",info:"MonthViewWidget_info__ltwmS",circle:"MonthViewWidget_circle__19VOB",balance:"MonthViewWidget_balance__qUNX4"}},47:function(e,t,n){e.exports={txList:"TxList_txList__3rowt",txItem:"TxList_txItem__2-7sR",txItem__left:"TxList_txItem__left__3Dekh",txItem__first:"TxList_txItem__first__eF_WE",txItem__second:"TxList_txItem__second__-lQ89",txItem__amount:"TxList_txItem__amount__2PbUA",txItem__date:"TxList_txItem__date__3uUSP",empty:"TxList_empty__2S-7j"}},56:function(e,t,n){e.exports={moneyView:"MoneyView_moneyView__2U7sP",fractional:"MoneyView_fractional__1hdQj"}},68:function(e,t,n){e.exports={swipeWidget:"SwipeWidget_swipeWidget__12ZdL",prev:"SwipeWidget_prev__UDZne",next:"SwipeWidget_next__1huSl",swipe:"SwipeWidget_swipe__1ww0t","swipe-wrap":"SwipeWidget_swipe-wrap__x4MEz",swipeItem:"SwipeWidget_swipeItem__2D3OP"}},96:function(e,t,n){e.exports={page:"TransactionsPage_page__1uE4j",filter:"TransactionsPage_filter__3x4B8",active:"TransactionsPage_active__3XoOk"}}},[[192,3,4]]]);
//# sourceMappingURL=main.e832598e.chunk.js.map